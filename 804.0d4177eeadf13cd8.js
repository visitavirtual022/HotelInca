"use strict";(self.webpackChunktourmkr_download=self.webpackChunktourmkr_download||[]).push([[804],{7591:(b,y,h)=>{h.d(y,{I:()=>f});var o=h(4537),d=h(8692);const m=["ref"];let f=(()=>{class c{constructor(){this.standart=!0,this.pos={left:0,top:0}}}return c.\u0275fac=function(p){return new(p||c)},c.\u0275cmp=o.Xpm({type:c,selectors:[["sh-tool-tip"]],viewQuery:function(p,l){if(1&p&&o.Gf(m,5,o.SBq),2&p){let r;o.iGM(r=o.CRH())&&(l.ref=r.first)}},inputs:{position:"position",standart:"standart"},decls:3,vars:10,consts:[[1,"sh-tooltip",3,"ngClass"],["ref",""]],template:function(p,l){1&p&&(o.TgZ(0,"span",0,1),o._uU(2),o.qZA()),2&p&&(o.Udp("left",l.pos.left,"px")("top",l.pos.top,"px"),o.ekj("show",l.show)("standart",l.standart),o.Q6J("ngClass",l.position),o.xp6(2),o.Oqu(l.text))},dependencies:[d.mk],styles:["span[_ngcontent-%COMP%]{position:absolute;top:0;font-size:12px;left:0;padding:2px 8px;background:inherit;color:inherit;border-radius:3px;white-space:nowrap;visibility:hidden;opacity:0;z-index:999;cursor:default}span.show[_ngcontent-%COMP%]{visibility:visible;opacity:1}span.standart[_ngcontent-%COMP%]{background:rgba(0,0,0,.5);color:#fff}span.above[_ngcontent-%COMP%]{transform:translate(-50%,-100%)}span.below[_ngcontent-%COMP%]{transform:translate(-50%)}span.before[_ngcontent-%COMP%]{transform:translate(-100%,-50%)}span.after[_ngcontent-%COMP%]{transform:translateY(-50%)}  #overlay.mobile span.sh-tooltip{display:none}"]}),c})()},563:(b,y,h)=>{h.d(y,{h:()=>d});var o=h(4537);let d=(()=>{class m{constructor(c){this._elementRef=c,this.showToolTip=!0,this.margin=5,this._position="above"}click(){setTimeout(()=>{this.shToolTipComponent.text=this.text,(!this.text||!Object.values(this._elementRef.nativeElement.getBoundingClientRect().toJSON()).find(c=>0!=c))&&(this.shToolTipComponent.show=!1)})}show(){!this.text||(this.shToolTipComponent.text=this.text,this.shToolTipPosition?(this._position=this.shToolTipPosition,this.shToolTipComponent.position=this._position):this.shToolTipComponent.position?this._position=this.shToolTipComponent.position:this.shToolTipComponent.position=this._position,this.shToolTipComponent.pos=this._getPos(),this.shToolTipComponent.show=!0)}hide(){this.shToolTipComponent.text=void 0,this.shToolTipComponent.show=!1}_getPos(){let c=this._elementRef.nativeElement.getBoundingClientRect(),a={left:c.left,top:c.top,width:c.width,height:c.height},p=document.getElementById("overlay").getBoundingClientRect();a.left-=p.left,a.top-=p.top;let l=this.shToolTipComponent.ref.nativeElement,r={left:0,top:0};return"above"==this._position||"below"==this._position?(r.left=a.left+a.width/2,r.left-l.offsetWidth/2<0?r.left=l.offsetWidth/2:r.left+l.offsetWidth/2>document.body.clientWidth&&(r.left=document.body.clientWidth-l.offsetWidth/2),"above"==this._position?(r.top=a.top-this.margin,r.top-l.offsetHeight<0&&(r.top=l.offsetHeight)):"below"==this._position&&(r.top=a.top+a.height+this.margin,r.top+l.offsetHeight>document.body.clientHeight&&(r.top=document.body.clientHeight-l.offsetHeight))):("before"==this._position||"after"==this._position)&&(r.top=a.top+a.height/2,r.top-l.offsetHeight/2<0?r.top=l.offsetHeight/2:r.top+l.offsetHeight/2>document.body.clientHeight&&(r.top=document.body.clientHeight-l.offsetHeight/2),"before"==this._position?(r.left=a.left-this.margin,r.left-l.offsetWidth<0&&(r.left=l.offsetWidth)):"after"==this._position&&(r.left=a.left+a.width+this.margin,r.left+l.offsetWidth>document.body.clientWidth&&(r.left=document.body.clientWidth-l.offsetWidth))),r}}return m.\u0275fac=function(c){return new(c||m)(o.Y36(o.SBq))},m.\u0275dir=o.lG2({type:m,selectors:[["","shToolTip",""]],hostBindings:function(c,a){1&c&&o.NdJ("click",function(){return a.click()})("mouseenter",function(){return a.show()})("mouseleave",function(){return a.hide()})},inputs:{showToolTip:"showToolTip",text:["shToolTip","text"],shToolTipComponent:"shToolTipComponent",shToolTipPosition:"shToolTipPosition"}}),m})()},9488:(b,y,h)=>{h.d(y,{y:()=>m});var o=h(8692),d=h(4537);let m=(()=>{class f{}return f.\u0275fac=function(a){return new(a||f)},f.\u0275mod=d.oAB({type:f}),f.\u0275inj=d.cJS({imports:[o.ez]}),f})()},3107:(b,y,h)=>{h.d(y,{F:()=>R});var o=h(4537),d=h(9911),m=h(7072),f=h(8692),c=h(6883),a=h(2001),p=h(4445),l=h(9321),r=h(4827),P=h(5056),D=h(7267),k=h(8066),M=h(5732);const O=["shareDropdown"];let R=(()=>{class T extends m.o{constructor(t,e,i,n,g,v,u,w,_,E,S){super(t),this.injector=t,this.controlService=e,this.viewerService=i,this.hotspotService=n,this.menuService=g,this.schemeService=v,this.viewerDataService=u,this.otherService=w,this.doc=_,this.windowRef=E,this.http=S,this.data=null,this.widgetInit=!1,this.control=null,this.slideInterval={angle:null,pano:null},this.shareUrl=null,this.editorMode=!1,this.vrLinkShow=!1,this._toolActions={hotspot_search:()=>this.openHotspotSearch(),modal:()=>this.openModal(),berlin_map:()=>{let s=this.otherService.getWidget("OtherBerlinMapComponent");s&&setTimeout(()=>{s.show=!s.show})},splash_map:()=>this.openSpalshMap(),prev_pano_button:()=>this.previousPano(),next_pano_button:()=>this.nextPano(),fullscreen:()=>this.toggleFullscreen(),hotspot:()=>this.toggleHotspot(),map:()=>this.toggleScheme(),vr_link:()=>this.goToVrLink(),gyroscope:()=>this.gyroscopeToggle(),photo:()=>this.openActivePanoPhoto(),slider:()=>this.toggleSlider(),sound:()=>this.toggleSound(),menu:()=>this.toggleMenu(),share:s=>this.toggleShare(s)},this.shareDropdownShow=!1,this.platforms=[{key:"facebook",name:"Facebook",icon:{prefix:"fab",iconName:"facebook-f",icon:[320,512,[],"f1e0","M279.14 288l14.22-92.66h-88.91v-60.13c0-25.35 12.42-50.06 52.24-50.06h40.42V6.26S260.43 0 225.36 0c-73.22 0-121.08 44.38-121.08 124.72v70.62H22.89V288h81.39v224h100.17V288z"]}},{key:"linkedin",name:"Linkedin",icon:{prefix:"fab",iconName:"linkedin-in",icon:[448,512,[],"f1e0","M100.28 448H7.4V148.9h92.88zM53.79 108.1C24.09 108.1 0 83.5 0 53.8a53.79 53.79 0 0 1 107.58 0c0 29.7-24.1 54.3-53.79 54.3zM447.9 448h-92.68V302.4c0-34.7-.7-79.2-48.29-79.2-48.29 0-55.69 37.7-55.69 76.7V448h-92.78V148.9h89.08v40.8h1.3c12.4-23.5 42.69-48.3 87.88-48.3 94 0 111.28 61.9 111.28 142.3V448z"]}},{key:"twitter",name:"Twitter",icon:{prefix:"fab",iconName:"twitter",icon:[512,512,[],"f1e0","M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"]}}],this.observableFunc={background:s=>this.onBackgroundChange(s),active_color:s=>this.onActiveColorChange(s),text_color:s=>this.onTextColorChange(s),common_color:s=>this.onCommonColorChange(s),common_background:s=>this.onCommonBackgroundChange(s),common_active_color:s=>this.onCommonActiveColorChange(s),common_text_color:s=>this.onCommonTextColorChange(s),area:s=>this.onAreaChange(s),vertical:s=>this.onVerticalChange(s),border_radius:s=>this.onBorderRadiusChange(s),margin:s=>this.onMarginChange(s),panos_font:s=>this.onPanosFontChange(s),title_font:s=>this.onTitleFontChange(s),tool_width:s=>this.onToolWidthChange(s),tool_height:s=>this.onToolHeightChange(s),tool_icon_size:s=>this.onToolIconSizeChange(s),styles:s=>this.onStylesChange(s)},this.fontsLoading=[]}get show(){return this.controlService.show}get activePano(){return this.viewerService.active}get hotspots(){return this.hotspotService.hotspots}get menu(){return this.menuService.menu}get map(){return this.schemeService.scheme}get hotspotsVisible(){return this.viewerDataService.widgetVisibility.hotspot}get menuVisible(){return this.menuService.show}get mapVisible(){return this.schemeService.show}get fullscreen(){return this.viewerService.fullscreen}get isMarzipano(){return!!this.viewerService.viewer?.scene}get isDownload(){return!this.panoService.moderationUrl&&!this.editorMode}toggle(){this.controlService.toggle()}goToPano(t,e){this.viewerService.goToPano(t,e)}fontStyle(t){return this.fontsService.fontStyle(t)}openHotspotSearch(){let t=this.otherService.getWidget("OtherHotspotSearchComponent");t&&(t.show=!0)}openModal(){let t=this.otherService.getWidget("OtherModalComponent");t&&setTimeout(()=>{t.show=!0})}openSpalshMap(){let t=this.otherService.getWidget("OtherSplashMapComponent");t&&setTimeout(()=>{t.show=!0})}previousPano(){this.viewerService.previousPano();let t=this.statsService.getWidget(this.control.widget);this.statsService.send({plugin:t.name,type:t.key,details:"previous"})}nextPano(){this.viewerService.nextPano();let t=this.statsService.getWidget(this.control.widget);this.statsService.send({plugin:t.name,type:t.key,details:"next"})}toggleFullscreen(){this.viewerService.toggleFullscreen();let t=this.statsService.getWidget(this.control.widget);this.statsService.send({plugin:t.name,type:t.key,details:"full"})}toggleHotspot(){this.viewerService.toggleHotspot();let t=this.statsService.getWidget(this.control.widget);this.statsService.send({plugin:t.name,type:t.key,details:"hotspots"})}toggleScheme(){this.viewerDataService.widgetVisibility.scheme?this.schemeService.toggle():this.viewerDataService.widgetVisibility.scheme=!0;let t=this.statsService.getWidget(this.control.widget);this.statsService.send({plugin:t.name,type:t.key,details:"map"})}goToVrLink(){this.editorMode||this.windowRef.open(`https://vr.tourmkr.app/?tour=${this.panoService.moderationUrl.slice(2)}&scene=${this.viewerDataService.active.id}&vr`)}gyroscopeToggle(){this.viewerService.gyroscopeToggle()}openActivePanoPhoto(){if(this.isDownload){const t=this.viewerService.viewer.stage().takeSnapshot(),e="image/jpeg",i=atob(t.substr(`data:${e};base64,`.length)),n=[];for(let u=0;u<i.length;u+=1024){const w=i.slice(u,u+1024),_=new Array(w.length);for(let S=0;S<w.length;S++)_[S]=w.charCodeAt(S);const E=new Uint8Array(_);n.push(E)}const g=new Blob(n,{type:e}),v=URL.createObjectURL(g);window.open(v,"_blank")}else{let t=this.panoService.getPanoById(this.viewerService.active.id);if(!t)return;let e=t.id,i=t.url.split("?")[0].replace("https://img.gothru.org/","").replace("_thumb",""),n=3*this.viewerDataService.viewer.nativeElement.offsetWidth,g=3*this.viewerDataService.viewer.nativeElement.offsetHeight,v=parseInt(t.url.split("?")[1].replace("pad=bg:","")),u=(Math.round(180*this.viewerService.viewer.scene().view().fov()/Math.PI/2*10)/10).toFixed(1),w=(-180*this.viewerService.viewer.scene().view().pitch()/Math.PI).toFixed(1),_=Math.round(this.viewerService.angle-t.north_angle);_<0&&(_+=360),_>=360&&(_-=360),this.windowRef.open(`https://img.gothru.org/pano_zoom.php?p=${e}&i=${i}&w=${n}&h=${g}&a=${u}&y=${_}&t=${w}&v=${v}`)}}toggleSlider(){this.viewerService.slideInterval.angle?this.viewerService.slideStop():this.viewerService.slidePano();let t=this.statsService.getWidget(this.control.widget);this.statsService.send({plugin:t.name,type:t.key,details:"play"})}toggleSound(){this.controlService.audioPlaying?this.controlService.pauseSound():this.controlService.playSound();let t=this.statsService.getWidget(this.control.widget);this.statsService.send({plugin:t.name,type:t.key,details:"sound"})}toggleMenu(){this.menuService.toggle(),this.menuService.menu&&this.menuService.menu.hide_control&&(this.viewerDataService.widgetVisibility.control=!this.viewerDataService.widgetVisibility.control),this.menuService.menu&&this.menuService.menu.hide_scheme&&(this.viewerDataService.widgetVisibility.scheme=!this.viewerDataService.widgetVisibility.scheme),this.menuService.menu&&this.menuService.menu.hide_hotspot&&(this.viewerDataService.widgetVisibility.menu=!this.viewerDataService.widgetVisibility.menu);let t=this.statsService.getWidget(this.control.widget);this.statsService.send({plugin:t.name,type:t.key,details:"menu"})}toggleShare(t){if(this.shareDropdownElm&&this.shareDropdownElm.nativeElement){let e=t.target;for(;"BUTTON"!=e.tagName;)e=e.parentElement;this.shareButton=e,this.control.vertical?this.shareDropdownElm.nativeElement.style.top=e.offsetTop+e.offsetHeight/2+"px":this.shareDropdownElm.nativeElement.style.left=e.offsetLeft+e.offsetWidth/2+"px"}setTimeout(()=>{this.shareDropdownShow=!this.shareDropdownShow})}openLink(t){let e=this.control.tools.filter(i=>i.key==t).pop();e&&e.href&&this.i18n.t(e.href)&&this.windowRef.open(this.i18n.t(e.href),e.current_tab?"_self":"_blank")}doToolAction(t,e){this._toolActions[t]?this._toolActions[t](e):this.openLink(t)}share(t){let e="";if("linkedin"==t){e="https://www.linkedin.com/shareArticle?url=";let i=this.statsService.getWidget(this.control.widget);this.statsService.send({plugin:i.name,type:i.key,details:"share_lk"})}else if("twitter"==t){e="https://twitter.com/intent/tweet?url=";let i=this.statsService.getWidget(this.control.widget);this.statsService.send({plugin:i.name,type:i.key,details:"share_tw"})}else if("facebook"==t){e="https://www.facebook.com/sharer/sharer.php?u=";let i=this.statsService.getWidget(this.control.widget);this.statsService.send({plugin:i.name,type:i.key,details:"share_fb"})}e+=this.doc.location.href,this.windowRef.open(e,"Share","width=800,height=500,resizable,scrollbars=yes,status=1")}clickoutDropdown(t){this.shareDropdownShow&&this.shareDropdownElm&&!this.shareDropdownElm.nativeElement.contains(t.target)&&this.shareButton&&!this.shareButton.contains(t.target)&&(this.shareDropdownShow=!1)}onCommonBackgroundChange(t){this.elRef.nativeElement.style.setProperty("--background",d.v.backgroundStyle(t))}onCommonActiveColorChange(t){this.elRef.nativeElement.style.setProperty("--active-color",d.v.backgroundStyle(t))}onCommonTextColorChange(t){this.elRef.nativeElement.style.setProperty("--text-color",t?t.color:null)}onBackgroundChange(t){this.elRef.nativeElement.style.setProperty("--background",d.v.backgroundStyle(t))}onActiveColorChange(t){this.elRef.nativeElement.style.setProperty("--active-color",d.v.backgroundStyle(t))}onTextColorChange(t){this.elRef.nativeElement.style.setProperty("--text-color",t?t.color:null)}onCommonColorChange(t){this.elRef.nativeElement.style.setProperty("--background",d.v.backgroundStyle(t?this.panoService.commonColor.background:this.control.background)),this.elRef.nativeElement.style.setProperty("--active-color",d.v.backgroundStyle(t?this.panoService.commonColor.active_color:this.control.active_color)),this.elRef.nativeElement.style.setProperty("--text-color",t?this.panoService.commonColor.text_color.color:this.control.text_color.color)}onAreaChange(t){this._updateToolTipPosition()}onVerticalChange(t){this._updateToolTipPosition(),this.control.wide&&(this.control.vertical?(this.elRef.nativeElement.style.setProperty("--height","100%"),this.elRef.nativeElement.style.setProperty("--width",null)):(this.elRef.nativeElement.style.setProperty("--width","100%"),this.elRef.nativeElement.style.setProperty("--height",null)))}onBorderRadiusChange(t){this.elRef.nativeElement.style.setProperty("--border-radius-top-left",t?t.topLeft+"px":null),this.elRef.nativeElement.style.setProperty("--border-radius-top-right",t?t.topRight+"px":null),this.elRef.nativeElement.style.setProperty("--border-radius-bottom-left",t?t.bottomLeft+"px":null),this.elRef.nativeElement.style.setProperty("--border-radius-bottom-right",t?t.bottomRight+"px":null)}onMarginChange(t){this.elRef.nativeElement.style.setProperty("--margin",t+"px")}onPanosFontChange(t){this.fontsService.setFontStyle(this.elRef,t,"--pano-style-")}onTitleFontChange(t){this.fontsService.setFontStyle(this.elRef,t,"--title-style-")}onToolWidthChange(t){this.elRef.nativeElement.style.setProperty("--tool-width",t?t+"px":null)}onToolHeightChange(t){this.elRef.nativeElement.style.setProperty("--tool-height",t?t+"px":null)}onToolIconSizeChange(t){this.elRef.nativeElement.style.setProperty("--tool-icon-size",t?t+"%":null)}onStylesChange(t){this.styles=d.v.getStyleCode(this.elRef.nativeElement,t)}_updateToolTipPosition(){this.toolTipPosition=this.control.vertical?-1!=this.control.area.indexOf("left")?"after":-1!=this.control.area.indexOf("right")?"before":"above":-1!=this.control.area.indexOf("top")?"below":"above","right"==this.control.area?this.toolTipPosition="before":"left"==this.control.area&&(this.toolTipPosition="after")}initObs(){Object.keys(this.dataObs).forEach(t=>{this.dataObs[t].subscribe(e=>{this.observableFunc[t]&&this.observableFunc[t](e)})}),Object.keys(this.panoService.commonColorObs).forEach(t=>{this.panoService.commonColorObs[t].subscribe(e=>{this.observableFunc["common_"+t]&&this.control.common_color&&this.observableFunc["common_"+t](e)})})}checkDefaultDataText(){!this.default_options||(null!=this.default_options.title&&"string"==typeof this.default_options.title&&(this.default_options.title=this.i18n.toLangFormat(this.default_options.title)),null!=this.default_options.tools&&this.default_options.tools.forEach(t=>{null!=t.inputs&&t.inputs.map(e=>{if(("text"==e.type||"textarea"==e.type)&&"string"==typeof e.value&&(e.value=this.i18n.toLangFormat(e.value)),"table"==e.type){let i=[];e.value.map(n=>{let g=[];n.map(v=>{g.push(this.i18n.toLangFormat(v))}),i.push(g)}),e.value=i}})}))}checkDefaultDataUpdate(){!this.default_options||Object.keys(this.default_options).forEach(t=>{"tools"==t?this.default_options.tools.forEach(e=>{let i=this.data.tools.filter(n=>n.key==e.key).pop();i?(Object.keys(e).forEach(n=>{null==i[n]&&(i[n]=e[n])}),i.inputs?.forEach((n,g)=>{let v=e.inputs.find(u=>u.key==n.key);v?(n.type=v.type,n.label=v.label,n.help=v.help,n.font&&this._updateFontStyle(n.font,v.font)):i.inputs.splice(g,1)}),e.inputs?.forEach((n,g)=>{i.inputs.find(u=>u.key==n.key)||i.inputs.splice(g,0,n)})):(e.visible=!1,this.data.tools.push(e))}):null==this.data[t]?(this.panoService.newIdentification.control[t]=!0,this.data[t]=this.default_options[t],"vertical"==t&&("left"==this.data.area||"right"==this.data.area)&&(this.data.vertical=!0)):t.endsWith("_font")&&this._updateFontStyle(this.data[t],this.default_options[t])})}checkFontStyle(){!this.controlService.control||(this.controlService.control.tools&&this.controlService.control.tools.forEach(t=>{let e=this.default_options.tools.find(i=>i.key==t.key);t.inputs&&t.inputs.map(i=>{let n=e.inputs.find(g=>g.key==i.key);n.font&&("text"==i.type||"textarea"==i.type)&&(i.font?i.font.family&&this.fontsLoading.push(this.fontsService.loadFonts([i.font.family])):i.font=n.font)})}),Object.entries(this.controlService.control).forEach(t=>{t[0].endsWith("_font")&&t[1]&&t[1].family&&this.fontsLoading.push(this.fontsService.loadFonts([t[1].family]))}))}initData(){this.vrLinkShow=this.viewerService.mobileCheck(),this.data||this.checkDefaultDataText(),this.data?(this.checkDefaultDataUpdate(),this.controlService.init(this.data),this.control=this.controlService.control,this.control&&null!=this.control.hide_on_start&&this.control.hide_on_start[this.viewerService.overlayDeviceClass]&&(this.controlService.show=!1)):(this.controlService.init(this.default_options),this.controlService.show=!0),this.checkFontStyle(),this.control=this.controlService.control,this.slideInterval=this.viewerService.slideInterval,this.keyStarts=this.panoService.keyStarts,this.shareUrl=this.controlService.shareUrl,this.editorMode=this.viewerService.editor,this.dataObs=this.controlService.dataObs,(0,f.NF)(this.panoService.platformId)&&this.initObs(),this.widgetInit=!0}ngOnInit(){setTimeout(()=>this.initData())}ngAfterViewInit(){this.controlService.loadSound()}}return T.\u0275fac=function(t){return new(t||T)(o.Y36(o.zs3),o.Y36(c.B),o.Y36(a.a),o.Y36(p.N),o.Y36(l.h),o.Y36(r.p),o.Y36(P.m),o.Y36(D.m),o.Y36(f.K0),o.Y36(k.X),o.Y36(M.eN))},T.\u0275cmp=o.Xpm({type:T,selectors:[["control-component"]],viewQuery:function(t,e){if(1&t&&o.Gf(O,5,o.SBq),2&t){let i;o.iGM(i=o.CRH())&&(e.shareDropdownElm=i.first)}},hostBindings:function(t,e){1&t&&o.NdJ("click",function(n){return e.clickoutDropdown(n)},!1,o.evT)},inputs:{data:"data"},features:[o.qOj],decls:0,vars:0,template:function(t,e){},encapsulation:2}),T})()}}]);