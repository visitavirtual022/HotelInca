"use strict";(self.webpackChunktourmkr_download=self.webpackChunktourmkr_download||[]).push([[804],{7591:(T,m,h)=>{h.d(m,{I:()=>f});var i=h(4537),d=h(8692);const u=["ref"];let f=(()=>{class c{constructor(){this.standart=!0,this.pos={left:0,top:0}}}return c.\u0275fac=function(p){return new(p||c)},c.\u0275cmp=i.Xpm({type:c,selectors:[["sh-tool-tip"]],viewQuery:function(p,r){if(1&p&&i.Gf(u,5,i.SBq),2&p){let n;i.iGM(n=i.CRH())&&(r.ref=n.first)}},inputs:{position:"position",standart:"standart"},decls:3,vars:10,consts:[[1,"sh-tooltip",3,"ngClass"],["ref",""]],template:function(p,r){1&p&&(i.TgZ(0,"span",0,1),i._uU(2),i.qZA()),2&p&&(i.Udp("left",r.pos.left,"px")("top",r.pos.top,"px"),i.ekj("show",r.show)("standart",r.standart),i.Q6J("ngClass",r.position),i.xp6(2),i.Oqu(r.text))},dependencies:[d.mk],styles:["span[_ngcontent-%COMP%]{position:absolute;top:0;font-size:12px;left:0;padding:2px 8px;background:inherit;color:inherit;border-radius:3px;white-space:nowrap;visibility:hidden;opacity:0;z-index:999;cursor:default}span.show[_ngcontent-%COMP%]{visibility:visible;opacity:1}span.standart[_ngcontent-%COMP%]{background:rgba(0,0,0,.5);color:#fff}span.above[_ngcontent-%COMP%]{transform:translate(-50%,-100%)}span.below[_ngcontent-%COMP%]{transform:translate(-50%)}span.before[_ngcontent-%COMP%]{transform:translate(-100%,-50%)}span.after[_ngcontent-%COMP%]{transform:translateY(-50%)}  #overlay.mobile span.sh-tooltip{display:none}"]}),c})()},563:(T,m,h)=>{h.d(m,{h:()=>d});var i=h(4537);let d=(()=>{class u{constructor(c){this._elementRef=c,this.showToolTip=!0,this.margin=5,this._position="above"}click(){setTimeout(()=>{this.shToolTipComponent.text=this.text,(!this.text||!Object.values(this._elementRef.nativeElement.getBoundingClientRect().toJSON()).find(c=>0!=c))&&(this.shToolTipComponent.show=!1)})}show(){!this.text||(this.shToolTipComponent.text=this.text,this.shToolTipPosition?(this._position=this.shToolTipPosition,this.shToolTipComponent.position=this._position):this.shToolTipComponent.position?this._position=this.shToolTipComponent.position:this.shToolTipComponent.position=this._position,this.shToolTipComponent.pos=this._getPos(),this.shToolTipComponent.show=!0)}hide(){this.shToolTipComponent.text=void 0,this.shToolTipComponent.show=!1}_getPos(){let c=this._elementRef.nativeElement.getBoundingClientRect(),a={left:c.left,top:c.top,width:c.width,height:c.height},p=document.getElementById("overlay").getBoundingClientRect();a.left-=p.left,a.top-=p.top;let r=this.shToolTipComponent.ref.nativeElement,n={left:0,top:0};return"above"==this._position||"below"==this._position?(n.left=a.left+a.width/2,n.left-r.offsetWidth/2<0?n.left=r.offsetWidth/2:n.left+r.offsetWidth/2>document.body.clientWidth&&(n.left=document.body.clientWidth-r.offsetWidth/2),"above"==this._position?(n.top=a.top-this.margin,n.top-r.offsetHeight<0&&(n.top=r.offsetHeight)):"below"==this._position&&(n.top=a.top+a.height+this.margin,n.top+r.offsetHeight>document.body.clientHeight&&(n.top=document.body.clientHeight-r.offsetHeight))):("before"==this._position||"after"==this._position)&&(n.top=a.top+a.height/2,n.top-r.offsetHeight/2<0?n.top=r.offsetHeight/2:n.top+r.offsetHeight/2>document.body.clientHeight&&(n.top=document.body.clientHeight-r.offsetHeight/2),"before"==this._position?(n.left=a.left-this.margin,n.left-r.offsetWidth<0&&(n.left=r.offsetWidth)):"after"==this._position&&(n.left=a.left+a.width+this.margin,n.left+r.offsetWidth>document.body.clientWidth&&(n.left=document.body.clientWidth-r.offsetWidth))),n}}return u.\u0275fac=function(c){return new(c||u)(i.Y36(i.SBq))},u.\u0275dir=i.lG2({type:u,selectors:[["","shToolTip",""]],hostBindings:function(c,a){1&c&&i.NdJ("click",function(){return a.click()})("mouseenter",function(){return a.show()})("mouseleave",function(){return a.hide()})},inputs:{showToolTip:"showToolTip",text:["shToolTip","text"],shToolTipComponent:"shToolTipComponent",shToolTipPosition:"shToolTipPosition"}}),u})()},9488:(T,m,h)=>{h.d(m,{y:()=>u});var i=h(8692),d=h(4537);let u=(()=>{class f{}return f.\u0275fac=function(a){return new(a||f)},f.\u0275mod=d.oAB({type:f}),f.\u0275inj=d.cJS({imports:[i.ez]}),f})()},3107:(T,m,h)=>{h.d(m,{F:()=>M});var i=h(4537),d=h(9911),u=h(7072),f=h(8692),c=h(6883),a=h(2001),p=h(4445),r=h(9321),n=h(4827),b=h(5056),E=h(7267),P=h(8066),D=h(5732);const k=["shareDropdown"];let M=(()=>{class w extends u.o{constructor(t,e,o,l,v,g,_,C,y,R,O){super(t),this.injector=t,this.controlService=e,this.viewerService=o,this.hotspotService=l,this.menuService=v,this.schemeService=g,this.viewerDataService=_,this.otherService=C,this.doc=y,this.windowRef=R,this.http=O,this.data=null,this.widgetInit=!1,this.control=null,this.slideInterval={angle:null,pano:null},this.shareUrl=null,this.editorMode=!1,this.vrLinkShow=!1,this._toolActions={hotspot_search:()=>this.openHotspotSearch(),modal:()=>this.openModal(),prev_pano_button:()=>this.previousPano(),next_pano_button:()=>this.nextPano(),fullscreen:()=>this.toggleFullscreen(),hotspot:()=>this.toggleHotspot(),map:()=>this.toggleScheme(),vr_link:()=>this.goToVrLink(),gyroscope:()=>this.gyroscopeToggle(),photo:()=>this.openActivePanoPhoto(),slider:()=>this.toggleSlider(),sound:()=>this.toggleSound(),menu:()=>this.toggleMenu(),share:s=>this.toggleShare(s)},this.shareDropdownShow=!1,this.platforms=[{key:"facebook",name:"Facebook",icon:{prefix:"fab",iconName:"facebook-f",icon:[320,512,[],"f1e0","M279.14 288l14.22-92.66h-88.91v-60.13c0-25.35 12.42-50.06 52.24-50.06h40.42V6.26S260.43 0 225.36 0c-73.22 0-121.08 44.38-121.08 124.72v70.62H22.89V288h81.39v224h100.17V288z"]}},{key:"linkedin",name:"Linkedin",icon:{prefix:"fab",iconName:"linkedin-in",icon:[448,512,[],"f1e0","M100.28 448H7.4V148.9h92.88zM53.79 108.1C24.09 108.1 0 83.5 0 53.8a53.79 53.79 0 0 1 107.58 0c0 29.7-24.1 54.3-53.79 54.3zM447.9 448h-92.68V302.4c0-34.7-.7-79.2-48.29-79.2-48.29 0-55.69 37.7-55.69 76.7V448h-92.78V148.9h89.08v40.8h1.3c12.4-23.5 42.69-48.3 87.88-48.3 94 0 111.28 61.9 111.28 142.3V448z"]}},{key:"twitter",name:"Twitter",icon:{prefix:"fab",iconName:"twitter",icon:[512,512,[],"f1e0","M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"]}}],this.observableFunc={background:s=>this.onBackgroundChange(s),active_color:s=>this.onActiveColorChange(s),text_color:s=>this.onTextColorChange(s),common_color:s=>this.onCommonColorChange(s),common_background:s=>this.onCommonBackgroundChange(s),common_active_color:s=>this.onCommonActiveColorChange(s),common_text_color:s=>this.onCommonTextColorChange(s),area:s=>this.onAreaChange(s),vertical:s=>this.onVerticalChange(s),border_radius:s=>this.onBorderRadiusChange(s),margin:s=>this.onMarginChange(s),panos_font:s=>this.onPanosFontChange(s),title_font:s=>this.onTitleFontChange(s),tool_width:s=>this.onToolWidthChange(s),tool_height:s=>this.onToolHeightChange(s),tool_icon_size:s=>this.onToolIconSizeChange(s),styles:s=>this.onStylesChange(s)},this.fontsLoading=[]}get show(){return this.controlService.show}get activePano(){return this.viewerService.active}get hotspots(){return this.hotspotService.hotspots}get menu(){return this.menuService.menu}get map(){return this.schemeService.scheme}get hotspotsVisible(){return this.viewerDataService.widgetVisibility.hotspot}get menuVisible(){return this.menuService.show}get mapVisible(){return this.schemeService.show}get fullscreen(){return this.viewerService.fullscreen}get isMarzipano(){return!!this.viewerService.viewer?.scene}get isDownload(){return!this.panoService.moderationUrl&&!this.editorMode}toggle(){this.controlService.toggle()}goToPano(t,e){this.viewerService.goToPano(t,e)}fontStyle(t){return this.fontsService.fontStyle(t)}openHotspotSearch(){let t=this.otherService.getWidget("OtherHotspotSearchComponent");t&&(t.show=!0)}openModal(){let t=this.otherService.getWidget("OtherModalComponent");t&&setTimeout(()=>{t.show=!0})}previousPano(){this.viewerService.previousPano();let t=this.statsService.getWidget(this.control.widget);this.statsService.send({plugin:t.name,type:t.key,details:"previous"})}nextPano(){this.viewerService.nextPano();let t=this.statsService.getWidget(this.control.widget);this.statsService.send({plugin:t.name,type:t.key,details:"next"})}toggleFullscreen(){this.viewerService.toggleFullscreen();let t=this.statsService.getWidget(this.control.widget);this.statsService.send({plugin:t.name,type:t.key,details:"full"})}toggleHotspot(){this.viewerService.toggleHotspot();let t=this.statsService.getWidget(this.control.widget);this.statsService.send({plugin:t.name,type:t.key,details:"hotspots"})}toggleScheme(){this.viewerDataService.widgetVisibility.scheme?this.schemeService.toggle():this.viewerDataService.widgetVisibility.scheme=!0;let t=this.statsService.getWidget(this.control.widget);this.statsService.send({plugin:t.name,type:t.key,details:"map"})}goToVrLink(){this.editorMode||this.windowRef.open(`https://vr.tourmkr.app/?tour=${this.panoService.moderationUrl.slice(2)}&scene=${this.viewerDataService.active.id}&vr`)}gyroscopeToggle(){this.viewerService.gyroscopeToggle()}openActivePanoPhoto(){let t=this.panoService.getPanoById(this.viewerService.active.id);if(!t)return;let e=t.id,o=t.url.split("?")[0].replace("https://img.gothru.org/","").replace("_thumb",""),l=3*this.viewerDataService.viewer.nativeElement.offsetWidth,v=3*this.viewerDataService.viewer.nativeElement.offsetHeight,g=parseInt(t.url.split("?")[1].replace("pad=bg:","")),_=(Math.round(180*this.viewerService.viewer.scene().view().fov()/Math.PI/2*10)/10).toFixed(1),C=(-180*this.viewerService.viewer.scene().view().pitch()/Math.PI).toFixed(1),y=Math.round(this.viewerService.angle-t.north_angle);y<0&&(y+=360),y>=360&&(y-=360),this.windowRef.open(`https://img.gothru.org/pano_zoom.php?p=${e}&i=${o}&w=${l}&h=${v}&a=${_}&y=${y}&t=${C}&v=${g}`)}toggleSlider(){this.viewerService.slideInterval.angle?this.viewerService.slideStop():this.viewerService.slidePano();let t=this.statsService.getWidget(this.control.widget);this.statsService.send({plugin:t.name,type:t.key,details:"play"})}toggleSound(){this.controlService.audioPlaying?this.controlService.pauseSound():this.controlService.playSound();let t=this.statsService.getWidget(this.control.widget);this.statsService.send({plugin:t.name,type:t.key,details:"sound"})}toggleMenu(){this.menuService.toggle(),this.menuService.menu&&this.menuService.menu.hide_control&&(this.viewerDataService.widgetVisibility.control=!this.viewerDataService.widgetVisibility.control),this.menuService.menu&&this.menuService.menu.hide_scheme&&(this.viewerDataService.widgetVisibility.scheme=!this.viewerDataService.widgetVisibility.scheme),this.menuService.menu&&this.menuService.menu.hide_hotspot&&(this.viewerDataService.widgetVisibility.menu=!this.viewerDataService.widgetVisibility.menu);let t=this.statsService.getWidget(this.control.widget);this.statsService.send({plugin:t.name,type:t.key,details:"menu"})}toggleShare(t){if(this.shareDropdownElm&&this.shareDropdownElm.nativeElement){let e=t.target;for(;"BUTTON"!=e.tagName;)e=e.parentElement;this.shareButton=e,this.control.vertical?this.shareDropdownElm.nativeElement.style.top=e.offsetTop+e.offsetHeight/2+"px":this.shareDropdownElm.nativeElement.style.left=e.offsetLeft+e.offsetWidth/2+"px"}setTimeout(()=>{this.shareDropdownShow=!this.shareDropdownShow})}openLink(t){let e=this.control.tools.filter(o=>o.key==t).pop();e&&e.href&&this.i18n.t(e.href)&&this.windowRef.open(this.i18n.t(e.href),e.current_tab?"_self":"_blank")}doToolAction(t,e){this._toolActions[t]?this._toolActions[t](e):this.openLink(t)}share(t){let e="";if("linkedin"==t){e="https://www.linkedin.com/shareArticle?url=";let o=this.statsService.getWidget(this.control.widget);this.statsService.send({plugin:o.name,type:o.key,details:"share_lk"})}else if("twitter"==t){e="https://twitter.com/intent/tweet?url=";let o=this.statsService.getWidget(this.control.widget);this.statsService.send({plugin:o.name,type:o.key,details:"share_tw"})}else if("facebook"==t){e="https://www.facebook.com/sharer/sharer.php?u=";let o=this.statsService.getWidget(this.control.widget);this.statsService.send({plugin:o.name,type:o.key,details:"share_fb"})}e+=this.doc.location.href,this.windowRef.open(e,"Share","width=800,height=500,resizable,scrollbars=yes,status=1")}clickoutDropdown(t){this.shareDropdownShow&&this.shareDropdownElm&&!this.shareDropdownElm.nativeElement.contains(t.target)&&this.shareButton&&!this.shareButton.contains(t.target)&&(this.shareDropdownShow=!1)}onCommonBackgroundChange(t){this.elRef.nativeElement.style.setProperty("--background",d.v.backgroundStyle(t))}onCommonActiveColorChange(t){this.elRef.nativeElement.style.setProperty("--active-color",d.v.backgroundStyle(t))}onCommonTextColorChange(t){this.elRef.nativeElement.style.setProperty("--text-color",t?t.color:null)}onBackgroundChange(t){this.elRef.nativeElement.style.setProperty("--background",d.v.backgroundStyle(t))}onActiveColorChange(t){this.elRef.nativeElement.style.setProperty("--active-color",d.v.backgroundStyle(t))}onTextColorChange(t){this.elRef.nativeElement.style.setProperty("--text-color",t?t.color:null)}onCommonColorChange(t){this.elRef.nativeElement.style.setProperty("--background",d.v.backgroundStyle(t?this.panoService.commonColor.background:this.control.background)),this.elRef.nativeElement.style.setProperty("--active-color",d.v.backgroundStyle(t?this.panoService.commonColor.active_color:this.control.active_color)),this.elRef.nativeElement.style.setProperty("--text-color",t?this.panoService.commonColor.text_color.color:this.control.text_color.color)}onAreaChange(t){this._updateToolTipPosition()}onVerticalChange(t){this._updateToolTipPosition(),this.control.wide&&(this.control.vertical?(this.elRef.nativeElement.style.setProperty("--height","100%"),this.elRef.nativeElement.style.setProperty("--width",null)):(this.elRef.nativeElement.style.setProperty("--width","100%"),this.elRef.nativeElement.style.setProperty("--height",null)))}onBorderRadiusChange(t){this.elRef.nativeElement.style.setProperty("--border-radius-top-left",t?t.topLeft+"px":null),this.elRef.nativeElement.style.setProperty("--border-radius-top-right",t?t.topRight+"px":null),this.elRef.nativeElement.style.setProperty("--border-radius-bottom-left",t?t.bottomLeft+"px":null),this.elRef.nativeElement.style.setProperty("--border-radius-bottom-right",t?t.bottomRight+"px":null)}onMarginChange(t){this.elRef.nativeElement.style.setProperty("--margin",t+"px")}onPanosFontChange(t){this.fontsService.setFontStyle(this.elRef,t,"--pano-style-")}onTitleFontChange(t){this.fontsService.setFontStyle(this.elRef,t,"--title-style-")}onToolWidthChange(t){this.elRef.nativeElement.style.setProperty("--tool-width",t?t+"px":null)}onToolHeightChange(t){this.elRef.nativeElement.style.setProperty("--tool-height",t?t+"px":null)}onToolIconSizeChange(t){this.elRef.nativeElement.style.setProperty("--tool-icon-size",t?t+"%":null)}onStylesChange(t){this.styles=d.v.getStyleCode(this.elRef.nativeElement,t)}_updateToolTipPosition(){this.toolTipPosition=this.control.vertical?-1!=this.control.area.indexOf("left")?"after":-1!=this.control.area.indexOf("right")?"before":"above":-1!=this.control.area.indexOf("top")?"below":"above","right"==this.control.area?this.toolTipPosition="before":"left"==this.control.area&&(this.toolTipPosition="after")}initObs(){Object.keys(this.dataObs).forEach(t=>{this.dataObs[t].subscribe(e=>{this.observableFunc[t]&&this.observableFunc[t](e)})}),Object.keys(this.panoService.commonColorObs).forEach(t=>{this.panoService.commonColorObs[t].subscribe(e=>{this.observableFunc["common_"+t]&&this.control.common_color&&this.observableFunc["common_"+t](e)})})}checkDefaultDataText(){!this.default_options||(null!=this.default_options.title&&"string"==typeof this.default_options.title&&(this.default_options.title=this.i18n.toLangFormat(this.default_options.title)),null!=this.default_options.tools&&this.default_options.tools.forEach(t=>{null!=t.inputs&&t.inputs.map(e=>{if(("text"==e.type||"textarea"==e.type)&&"string"==typeof e.value&&(e.value=this.i18n.toLangFormat(e.value)),"table"==e.type){let o=[];e.value.map(l=>{let v=[];l.map(g=>{v.push(this.i18n.toLangFormat(g))}),o.push(v)}),e.value=o}})}))}checkDefaultDataUpdate(){!this.default_options||Object.keys(this.default_options).forEach(t=>{"tools"==t?this.default_options.tools.forEach(e=>{let o=this.data.tools.filter(l=>l.key==e.key).pop();o?(Object.keys(e).forEach(l=>{null==o[l]&&(o[l]=e[l])}),o.inputs?.forEach((l,v)=>{let g=e.inputs.find(_=>_.key==l.key);g?(l.type=g.type,l.label=g.label,l.help=g.help,l.font&&this._updateFontStyle(l.font,g.font)):o.inputs.splice(v,1)}),e.inputs?.forEach((l,v)=>{o.inputs.find(_=>_.key==l.key)||o.inputs.splice(v,0,l)})):(e.visible=!1,this.data.tools.push(e))}):null==this.data[t]?(this.panoService.newIdentification.control[t]=!0,this.data[t]=this.default_options[t],"vertical"==t&&("left"==this.data.area||"right"==this.data.area)&&(this.data.vertical=!0)):t.endsWith("_font")&&this._updateFontStyle(this.data[t],this.default_options[t])})}checkFontStyle(){!this.controlService.control||(this.controlService.control.tools&&this.controlService.control.tools.forEach(t=>{let e=this.default_options.tools.find(o=>o.key==t.key);t.inputs&&t.inputs.map(o=>{let l=e.inputs.find(v=>v.key==o.key);l.font&&("text"==o.type||"textarea"==o.type)&&(o.font?o.font.family&&this.fontsLoading.push(this.fontsService.loadFonts([o.font.family])):o.font=l.font)})}),Object.entries(this.controlService.control).forEach(t=>{t[0].endsWith("_font")&&t[1]&&t[1].family&&this.fontsLoading.push(this.fontsService.loadFonts([t[1].family]))}))}initData(){this.vrLinkShow=this.viewerService.mobileCheck(),this.data||this.checkDefaultDataText(),this.data?(this.checkDefaultDataUpdate(),this.controlService.init(this.data),this.control=this.controlService.control,this.control&&null!=this.control.hide_on_start&&this.control.hide_on_start[this.viewerService.overlayDeviceClass]&&(this.controlService.show=!1)):(this.controlService.init(this.default_options),this.controlService.show=!0),this.checkFontStyle(),this.control=this.controlService.control,this.slideInterval=this.viewerService.slideInterval,this.keyStarts=this.panoService.keyStarts,this.shareUrl=this.controlService.shareUrl,this.editorMode=this.viewerService.editor,this.dataObs=this.controlService.dataObs,(0,f.NF)(this.panoService.platformId)&&this.initObs(),this.widgetInit=!0}ngOnInit(){setTimeout(()=>this.initData())}ngAfterViewInit(){this.controlService.loadSound()}}return w.\u0275fac=function(t){return new(t||w)(i.Y36(i.zs3),i.Y36(c.B),i.Y36(a.a),i.Y36(p.N),i.Y36(r.h),i.Y36(n.p),i.Y36(b.m),i.Y36(E.m),i.Y36(f.K0),i.Y36(P.X),i.Y36(D.eN))},w.\u0275cmp=i.Xpm({type:w,selectors:[["control-component"]],viewQuery:function(t,e){if(1&t&&i.Gf(k,5,i.SBq),2&t){let o;i.iGM(o=i.CRH())&&(e.shareDropdownElm=o.first)}},hostBindings:function(t,e){1&t&&i.NdJ("click",function(l){return e.clickoutDropdown(l)},!1,i.evT)},inputs:{data:"data"},features:[i.qOj],decls:0,vars:0,template:function(t,e){},encapsulation:2}),w})()}}]);