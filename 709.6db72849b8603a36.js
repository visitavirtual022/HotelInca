(self.webpackChunktourmkr_download=self.webpackChunktourmkr_download||[]).push([[709],{358:function(X,k,s){var E;E=function(){var c=!0;function A(S){function _(at){var ht=S.match(at);return ht&&ht.length>1&&ht[1]||""}function d(at){var ht=S.match(at);return ht&&ht.length>1&&ht[2]||""}var T,x=_(/(ipod|iphone|ipad)/i).toLowerCase(),z=!/like android/i.test(S)&&/android/i.test(S),Y=/nexus\s*[0-6]\s*/i.test(S),O=!Y&&/nexus\s*[0-9]+/i.test(S),u=/CrOS/.test(S),W=/silk/i.test(S),H=/sailfish/i.test(S),P=/tizen/i.test(S),w=/(web|hpw)(o|0)s/i.test(S),B=/windows phone/i.test(S),Q=(/SamsungBrowser/i.test(S),!B&&/windows/i.test(S)),b=!x&&!W&&/macintosh/i.test(S),U=!z&&!H&&!P&&!w&&/linux/i.test(S),$=d(/edg([ea]|ios)\/(\d+(\.\d+)?)/i),N=_(/version\/(\d+(\.\d+)?)/i),a=/tablet/i.test(S)&&!/tablet pc/i.test(S),g=!a&&/[^-]mobi/i.test(S),V=/xbox/i.test(S);/opera/i.test(S)?T={name:"Opera",opera:c,version:N||_(/(?:opera|opr|opios)[\s\/](\d+(\.\d+)?)/i)}:/opr\/|opios/i.test(S)?T={name:"Opera",opera:c,version:_(/(?:opr|opios)[\s\/](\d+(\.\d+)?)/i)||N}:/SamsungBrowser/i.test(S)?T={name:"Samsung Internet for Android",samsungBrowser:c,version:N||_(/(?:SamsungBrowser)[\s\/](\d+(\.\d+)?)/i)}:/Whale/i.test(S)?T={name:"NAVER Whale browser",whale:c,version:_(/(?:whale)[\s\/](\d+(?:\.\d+)+)/i)}:/MZBrowser/i.test(S)?T={name:"MZ Browser",mzbrowser:c,version:_(/(?:MZBrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/coast/i.test(S)?T={name:"Opera Coast",coast:c,version:N||_(/(?:coast)[\s\/](\d+(\.\d+)?)/i)}:/focus/i.test(S)?T={name:"Focus",focus:c,version:_(/(?:focus)[\s\/](\d+(?:\.\d+)+)/i)}:/yabrowser/i.test(S)?T={name:"Yandex Browser",yandexbrowser:c,version:N||_(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/ucbrowser/i.test(S)?T={name:"UC Browser",ucbrowser:c,version:_(/(?:ucbrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/mxios/i.test(S)?T={name:"Maxthon",maxthon:c,version:_(/(?:mxios)[\s\/](\d+(?:\.\d+)+)/i)}:/epiphany/i.test(S)?T={name:"Epiphany",epiphany:c,version:_(/(?:epiphany)[\s\/](\d+(?:\.\d+)+)/i)}:/puffin/i.test(S)?T={name:"Puffin",puffin:c,version:_(/(?:puffin)[\s\/](\d+(?:\.\d+)?)/i)}:/sleipnir/i.test(S)?T={name:"Sleipnir",sleipnir:c,version:_(/(?:sleipnir)[\s\/](\d+(?:\.\d+)+)/i)}:/k-meleon/i.test(S)?T={name:"K-Meleon",kMeleon:c,version:_(/(?:k-meleon)[\s\/](\d+(?:\.\d+)+)/i)}:B?(T={name:"Windows Phone",osname:"Windows Phone",windowsphone:c},$?(T.msedge=c,T.version=$):(T.msie=c,T.version=_(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(S)?T={name:"Internet Explorer",msie:c,version:_(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:u?T={name:"Chrome",osname:"Chrome OS",chromeos:c,chromeBook:c,chrome:c,version:_(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/edg([ea]|ios)/i.test(S)?T={name:"Microsoft Edge",msedge:c,version:$}:/vivaldi/i.test(S)?T={name:"Vivaldi",vivaldi:c,version:_(/vivaldi\/(\d+(\.\d+)?)/i)||N}:H?T={name:"Sailfish",osname:"Sailfish OS",sailfish:c,version:_(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(S)?T={name:"SeaMonkey",seamonkey:c,version:_(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel|fxios/i.test(S)?(T={name:"Firefox",firefox:c,version:_(/(?:firefox|iceweasel|fxios)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(S)&&(T.firefoxos=c,T.osname="Firefox OS")):W?T={name:"Amazon Silk",silk:c,version:_(/silk\/(\d+(\.\d+)?)/i)}:/phantom/i.test(S)?T={name:"PhantomJS",phantom:c,version:_(/phantomjs\/(\d+(\.\d+)?)/i)}:/slimerjs/i.test(S)?T={name:"SlimerJS",slimer:c,version:_(/slimerjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(S)||/rim\stablet/i.test(S)?T={name:"BlackBerry",osname:"BlackBerry OS",blackberry:c,version:N||_(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:w?(T={name:"WebOS",osname:"WebOS",webos:c,version:N||_(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(S)&&(T.touchpad=c)):/bada/i.test(S)?T={name:"Bada",osname:"Bada",bada:c,version:_(/dolfin\/(\d+(\.\d+)?)/i)}:P?T={name:"Tizen",osname:"Tizen",tizen:c,version:_(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||N}:/qupzilla/i.test(S)?T={name:"QupZilla",qupzilla:c,version:_(/(?:qupzilla)[\s\/](\d+(?:\.\d+)+)/i)||N}:/chromium/i.test(S)?T={name:"Chromium",chromium:c,version:_(/(?:chromium)[\s\/](\d+(?:\.\d+)?)/i)||N}:/chrome|crios|crmo/i.test(S)?T={name:"Chrome",chrome:c,version:_(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:z?T={name:"Android",version:N}:/safari|applewebkit/i.test(S)?(T={name:"Safari",safari:c},N&&(T.version=N)):x?(T={name:"iphone"==x?"iPhone":"ipad"==x?"iPad":"iPod"},N&&(T.version=N)):T=/googlebot/i.test(S)?{name:"Googlebot",googlebot:c,version:_(/googlebot\/(\d+(\.\d+))/i)||N}:{name:_(/^(.*)\/(.*) /),version:d(/^(.*)\/(.*) /)},!T.msedge&&/(apple)?webkit/i.test(S)?(/(apple)?webkit\/537\.36/i.test(S)?(T.name=T.name||"Blink",T.blink=c):(T.name=T.name||"Webkit",T.webkit=c),!T.version&&N&&(T.version=N)):!T.opera&&/gecko\//i.test(S)&&(T.name=T.name||"Gecko",T.gecko=c,T.version=T.version||_(/gecko\/(\d+(\.\d+)?)/i)),T.windowsphone||!z&&!T.silk?!T.windowsphone&&x?(T[x]=c,T.ios=c,T.osname="iOS"):b?(T.mac=c,T.osname="macOS"):V?(T.xbox=c,T.osname="Xbox"):Q?(T.windows=c,T.osname="Windows"):U&&(T.linux=c,T.osname="Linux"):(T.android=c,T.osname="Android");var rt="";T.windows?rt=function it(at){switch(at){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}(_(/Windows ((NT|XP)( \d\d?.\d)?)/i)):T.windowsphone?rt=_(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):T.mac?rt=(rt=_(/Mac OS X (\d+([_\.\s]\d+)*)/i)).replace(/[_\s]/g,"."):x?rt=(rt=_(/os (\d+([_\s]\d+)*) like mac os x/i)).replace(/[_\s]/g,"."):z?rt=_(/android[ \/-](\d+(\.\d+)*)/i):T.webos?rt=_(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):T.blackberry?rt=_(/rim\stablet\sos\s(\d+(\.\d+)*)/i):T.bada?rt=_(/bada\/(\d+(\.\d+)*)/i):T.tizen&&(rt=_(/tizen[\/\s](\d+(\.\d+)*)/i)),rt&&(T.osversion=rt);var ot=!T.windows&&rt.split(".")[0];return a||O||"ipad"==x||z&&(3==ot||ot>=4&&!g)||T.silk?T.tablet=c:(g||"iphone"==x||"ipod"==x||z||Y||T.blackberry||T.webos||T.bada)&&(T.mobile=c),T.msedge||T.msie&&T.version>=10||T.yandexbrowser&&T.version>=15||T.vivaldi&&T.version>=1||T.chrome&&T.version>=20||T.samsungBrowser&&T.version>=4||T.whale&&1===l([T.version,"1.0"])||T.mzbrowser&&1===l([T.version,"6.0"])||T.focus&&1===l([T.version,"1.0"])||T.firefox&&T.version>=20||T.safari&&T.version>=6||T.opera&&T.version>=10||T.ios&&T.osversion&&T.osversion.split(".")[0]>=6||T.blackberry&&T.version>=10.1||T.chromium&&T.version>=20?T.a=c:T.msie&&T.version<10||T.chrome&&T.version<20||T.firefox&&T.version<20||T.safari&&T.version<6||T.opera&&T.version<10||T.ios&&T.osversion&&T.osversion.split(".")[0]<6||T.chromium&&T.version<20?T.c=c:T.x=c,T}var E=A(typeof navigator<"u"&&navigator.userAgent||"");function p(S){return S.split(".").length}function v(S,_){var x,d=[];if(Array.prototype.map)return Array.prototype.map.call(S,_);for(x=0;x<S.length;x++)d.push(_(S[x]));return d}function l(S){for(var _=Math.max(p(S[0]),p(S[1])),d=v(S,function(x){var R=_-p(x);return v((x+=new Array(R+1).join(".0")).split("."),function(z){return new Array(20-z.length).join("0")+z}).reverse()});--_>=0;){if(d[0][_]>d[1][_])return 1;if(d[0][_]!==d[1][_])return-1;if(0===_)return 0}}function m(S,_,d){var x=E;"string"==typeof _&&(d=_,_=void 0),void 0===_&&(_=!1),d&&(x=A(d));var R=""+x.version;for(var z in S)if(S.hasOwnProperty(z)&&x[z]){if("string"!=typeof S[z])throw new Error("Browser version in the minVersion map should be a string: "+z+": "+String(S));return l([R,S[z]])<0}return _}return E.test=function(S){for(var _=0;_<S.length;++_){var d=S[_];if("string"==typeof d&&d in E)return!0}return!1},E.isUnsupportedBrowser=m,E.compareVersions=l,E.check=function L(S,_,d){return!m(S,_,d)},E._detect=A,E.detect=A,E},X.exports?X.exports=E():s.amdD("bowser",E)},335:(X,k,s)=>{"use strict";s.r(k),s.d(k,{glMatrix:()=>c,mat2:()=>A,mat2d:()=>E,mat3:()=>p,mat4:()=>v,quat:()=>L,quat2:()=>S,vec2:()=>_,vec3:()=>l,vec4:()=>m});var c={};s.r(c),s.d(c,{ARRAY_TYPE:()=>x,EPSILON:()=>d,RANDOM:()=>R,equals:()=>u,setMatrixArrayType:()=>z,toRadian:()=>O});var A={};s.r(A),s.d(A,{LDU:()=>ot,add:()=>at,adjoint:()=>U,clone:()=>H,copy:()=>P,create:()=>W,determinant:()=>$,equals:()=>_t,exactEquals:()=>pt,frob:()=>rt,fromRotation:()=>V,fromScaling:()=>T,fromValues:()=>B,identity:()=>w,invert:()=>b,mul:()=>xt,multiply:()=>N,multiplyScalar:()=>Et,multiplyScalarAndAdd:()=>It,rotate:()=>a,scale:()=>g,set:()=>D,str:()=>it,sub:()=>Tt,subtract:()=>ht,transpose:()=>Q});var E={};s.r(E),s.d(E,{add:()=>Ze,clone:()=>wt,copy:()=>Ut,create:()=>yt,determinant:()=>Ft,equals:()=>he,exactEquals:()=>Le,frob:()=>Ke,fromRotation:()=>Dt,fromScaling:()=>oe,fromTranslation:()=>Ge,fromValues:()=>Bt,identity:()=>Ot,invert:()=>bt,mul:()=>pe,multiply:()=>Wt,multiplyScalar:()=>Pe,multiplyScalarAndAdd:()=>Qe,rotate:()=>ee,scale:()=>re,set:()=>Nt,str:()=>je,sub:()=>$e,subtract:()=>de,translate:()=>kt});var p={};s.r(p),s.d(p,{add:()=>_e,adjoint:()=>me,clone:()=>Je,copy:()=>qe,create:()=>ze,determinant:()=>rr,equals:()=>hr,exactEquals:()=>ge,frob:()=>Fe,fromMat2d:()=>or,fromMat4:()=>ke,fromQuat:()=>ye,fromRotation:()=>ar,fromScaling:()=>ce,fromTranslation:()=>sr,fromValues:()=>le,identity:()=>er,invert:()=>Ie,mul:()=>ve,multiply:()=>Oe,multiplyScalar:()=>ie,multiplyScalarAndAdd:()=>ne,normalFromMat4:()=>Re,projection:()=>De,rotate:()=>be,scale:()=>nr,set:()=>tr,str:()=>He,sub:()=>Vt,subtract:()=>Jt,translate:()=>ir,transpose:()=>Ae});var v={};s.r(v),s.d(v,{add:()=>Si,adjoint:()=>fe,clone:()=>Qt,copy:()=>Kt,create:()=>qt,determinant:()=>Yt,equals:()=>zi,exactEquals:()=>Li,frob:()=>Ti,fromQuat:()=>Ht,fromQuat2:()=>G,fromRotation:()=>Te,fromRotationTranslation:()=>I,fromRotationTranslationScale:()=>gt,fromRotationTranslationScaleOrigin:()=>Rt,fromScaling:()=>Ne,fromTranslation:()=>cr,fromValues:()=>se,fromXRotation:()=>Ve,fromYRotation:()=>vr,fromZRotation:()=>M,frustum:()=>jt,getRotation:()=>ft,getScaling:()=>st,getTranslation:()=>tt,identity:()=>Gt,invert:()=>Be,lookAt:()=>wi,mul:()=>Ai,multiply:()=>ae,multiplyScalar:()=>Ci,multiplyScalarAndAdd:()=>Pi,ortho:()=>xi,perspective:()=>te,perspectiveFromFieldOfView:()=>gi,rotate:()=>Me,rotateX:()=>Ee,rotateY:()=>ue,rotateZ:()=>$t,scale:()=>we,set:()=>Xt,str:()=>Ei,sub:()=>Ii,subtract:()=>Mr,targetTo:()=>Mi,translate:()=>xe,transpose:()=>lr});var l={};s.r(l),s.d(l,{add:()=>Di,angle:()=>en,bezier:()=>Ki,ceil:()=>Hi,clone:()=>Oi,copy:()=>bi,create:()=>fr,cross:()=>We,dist:()=>cn,distance:()=>Pr,div:()=>ln,divide:()=>Cr,dot:()=>dr,equals:()=>an,exactEquals:()=>sn,floor:()=>Fi,forEach:()=>un,fromValues:()=>ur,hermite:()=>ji,inverse:()=>Xi,len:()=>Ir,length:()=>Er,lerp:()=>Gi,max:()=>Ni,min:()=>Bi,mul:()=>hn,multiply:()=>Sr,negate:()=>Ui,normalize:()=>Ar,random:()=>Zi,rotateX:()=>Ji,rotateY:()=>qi,rotateZ:()=>tn,round:()=>Vi,scale:()=>Wi,scaleAndAdd:()=>Yi,set:()=>Ri,sqrDist:()=>vn,sqrLen:()=>fn,squaredDistance:()=>Lr,squaredLength:()=>zr,str:()=>nn,sub:()=>on,subtract:()=>Tr,transformMat3:()=>$i,transformMat4:()=>Qi,transformQuat:()=>ki,zero:()=>rn});var m={};s.r(m),s.d(m,{add:()=>Fr,ceil:()=>dn,clone:()=>br,copy:()=>Dr,create:()=>Or,cross:()=>Mn,dist:()=>In,distance:()=>Yr,div:()=>An,divide:()=>Vr,dot:()=>Gr,equals:()=>Zr,exactEquals:()=>Kr,floor:()=>pn,forEach:()=>Dn,fromValues:()=>Rr,inverse:()=>wn,len:()=>bn,length:()=>pr,lerp:()=>jr,max:()=>yn,min:()=>mn,mul:()=>zn,multiply:()=>Nr,negate:()=>xn,normalize:()=>Xr,random:()=>En,round:()=>_n,scale:()=>Wr,scaleAndAdd:()=>gn,set:()=>Hr,sqrDist:()=>On,sqrLen:()=>Rn,squaredDistance:()=>Ur,squaredLength:()=>mr,str:()=>Pn,sub:()=>Ln,subtract:()=>Br,transformMat4:()=>Tn,transformQuat:()=>Sn,zero:()=>Cn});var L={};s.r(L),s.d(L,{add:()=>Qn,calculateW:()=>Nn,clone:()=>jn,conjugate:()=>Un,copy:()=>yr,create:()=>Ye,dot:()=>_r,equals:()=>es,exactEquals:()=>ts,exp:()=>ti,fromEuler:()=>Xn,fromMat3:()=>ri,fromValues:()=>Kn,getAngle:()=>Bn,getAxisAngle:()=>Fn,identity:()=>Hn,invert:()=>Yn,len:()=>Jn,length:()=>gr,lerp:()=>kn,ln:()=>ei,mul:()=>$n,multiply:()=>$r,normalize:()=>wr,pow:()=>Vn,random:()=>Wn,rotateX:()=>kr,rotateY:()=>Jr,rotateZ:()=>qr,rotationTo:()=>rs,scale:()=>ii,set:()=>Zn,setAxes:()=>ns,setAxisAngle:()=>Qr,slerp:()=>Ue,sqlerp:()=>is,sqrLen:()=>qn,squaredLength:()=>xr,str:()=>Gn});var S={};s.r(S),s.d(S,{add:()=>Cs,clone:()=>as,conjugate:()=>Is,copy:()=>si,create:()=>ss,dot:()=>oi,equals:()=>Fs,exactEquals:()=>Hs,fromMat4:()=>vs,fromRotation:()=>cs,fromRotationTranslation:()=>ni,fromRotationTranslationValues:()=>hs,fromTranslation:()=>ls,fromValues:()=>os,getDual:()=>ps,getReal:()=>ds,getTranslation:()=>_s,identity:()=>fs,invert:()=>As,len:()=>Os,length:()=>hi,lerp:()=>zs,mul:()=>Ps,multiply:()=>ai,normalize:()=>Rs,rotateAroundAxis:()=>Ss,rotateByQuatAppend:()=>Es,rotateByQuatPrepend:()=>Ts,rotateX:()=>xs,rotateY:()=>ws,rotateZ:()=>Ms,scale:()=>Ls,set:()=>us,setDual:()=>ys,setReal:()=>ms,sqrLen:()=>bs,squaredLength:()=>Xe,str:()=>Ds,translate:()=>gs});var _={};s.r(_),s.d(_,{add:()=>Ys,angle:()=>ha,ceil:()=>Us,clone:()=>Bs,copy:()=>Vs,create:()=>li,cross:()=>ta,dist:()=>ya,distance:()=>ui,div:()=>ma,divide:()=>fi,dot:()=>qs,equals:()=>fa,exactEquals:()=>va,floor:()=>Xs,forEach:()=>xa,fromValues:()=>Ns,inverse:()=>ks,len:()=>ua,length:()=>pi,lerp:()=>ea,max:()=>js,min:()=>Gs,mul:()=>pa,multiply:()=>vi,negate:()=>$s,normalize:()=>Js,random:()=>ra,rotate:()=>oa,round:()=>Ks,scale:()=>Zs,scaleAndAdd:()=>Qs,set:()=>Ws,sqrDist:()=>_a,sqrLen:()=>ga,squaredDistance:()=>di,squaredLength:()=>mi,str:()=>ca,sub:()=>da,subtract:()=>ci,transformMat2:()=>ia,transformMat2d:()=>na,transformMat3:()=>sa,transformMat4:()=>aa,zero:()=>la});var d=1e-6,x=typeof Float32Array<"u"?Float32Array:Array,R=Math.random;function z(t){x=t}var Y=Math.PI/180;function O(t){return t*Y}function u(t,e){return Math.abs(t-e)<=d*Math.max(1,Math.abs(t),Math.abs(e))}function W(){var t=new x(4);return x!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t}function H(t){var e=new x(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function P(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function w(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function B(t,e,r,i){var n=new x(4);return n[0]=t,n[1]=e,n[2]=r,n[3]=i,n}function D(t,e,r,i,n){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t}function Q(t,e){if(t===e){var r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function b(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],h=r*o-n*i;return h?(t[0]=o*(h=1/h),t[1]=-i*h,t[2]=-n*h,t[3]=r*h,t):null}function U(t,e){var r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t}function $(t){return t[0]*t[3]-t[2]*t[1]}function N(t,e,r){var i=e[0],n=e[1],o=e[2],h=e[3],f=r[0],y=r[1],C=r[2],F=r[3];return t[0]=i*f+o*y,t[1]=n*f+h*y,t[2]=i*C+o*F,t[3]=n*C+h*F,t}function a(t,e,r){var i=e[0],n=e[1],o=e[2],h=e[3],f=Math.sin(r),y=Math.cos(r);return t[0]=i*y+o*f,t[1]=n*y+h*f,t[2]=i*-f+o*y,t[3]=n*-f+h*y,t}function g(t,e,r){var n=e[1],o=e[2],h=e[3],f=r[0],y=r[1];return t[0]=e[0]*f,t[1]=n*f,t[2]=o*y,t[3]=h*y,t}function V(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=-r,t[3]=i,t}function T(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function it(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function rt(t){return Math.hypot(t[0],t[1],t[2],t[3])}function ot(t,e,r,i){return t[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-t[2]*r[1],[t,e,r]}function at(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function ht(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function pt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function _t(t,e){var r=t[0],i=t[1],n=t[2],o=t[3],h=e[0],f=e[1],y=e[2],C=e[3];return Math.abs(r-h)<=d*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(i-f)<=d*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(n-y)<=d*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(o-C)<=d*Math.max(1,Math.abs(o),Math.abs(C))}function Et(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function It(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var xt=N,Tt=ht;function yt(){var t=new x(6);return x!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t}function wt(t){var e=new x(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function Ut(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Ot(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function Bt(t,e,r,i,n,o){var h=new x(6);return h[0]=t,h[1]=e,h[2]=r,h[3]=i,h[4]=n,h[5]=o,h}function Nt(t,e,r,i,n,o,h){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=o,t[5]=h,t}function bt(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],h=e[4],f=e[5],y=r*o-i*n;return y?(t[0]=o*(y=1/y),t[1]=-i*y,t[2]=-n*y,t[3]=r*y,t[4]=(n*f-o*h)*y,t[5]=(i*h-r*f)*y,t):null}function Ft(t){return t[0]*t[3]-t[1]*t[2]}function Wt(t,e,r){var i=e[0],n=e[1],o=e[2],h=e[3],f=e[4],y=e[5],C=r[0],F=r[1],j=r[2],Z=r[3],K=r[4],q=r[5];return t[0]=i*C+o*F,t[1]=n*C+h*F,t[2]=i*j+o*Z,t[3]=n*j+h*Z,t[4]=i*K+o*q+f,t[5]=n*K+h*q+y,t}function ee(t,e,r){var i=e[0],n=e[1],o=e[2],h=e[3],f=e[4],y=e[5],C=Math.sin(r),F=Math.cos(r);return t[0]=i*F+o*C,t[1]=n*F+h*C,t[2]=i*-C+o*F,t[3]=n*-C+h*F,t[4]=f,t[5]=y,t}function re(t,e,r){var n=e[1],o=e[2],h=e[3],f=e[4],y=e[5],C=r[0],F=r[1];return t[0]=e[0]*C,t[1]=n*C,t[2]=o*F,t[3]=h*F,t[4]=f,t[5]=y,t}function kt(t,e,r){var i=e[0],n=e[1],o=e[2],h=e[3],f=e[4],y=e[5],C=r[0],F=r[1];return t[0]=i,t[1]=n,t[2]=o,t[3]=h,t[4]=i*C+o*F+f,t[5]=n*C+h*F+y,t}function Dt(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=-r,t[3]=i,t[4]=0,t[5]=0,t}function oe(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function Ge(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function je(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function Ke(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)}function Ze(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t}function de(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t}function Pe(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t}function Qe(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t}function Le(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function he(t,e){var r=t[0],i=t[1],n=t[2],o=t[3],h=t[4],f=t[5],y=e[0],C=e[1],F=e[2],j=e[3],Z=e[4],K=e[5];return Math.abs(r-y)<=d*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(i-C)<=d*Math.max(1,Math.abs(i),Math.abs(C))&&Math.abs(n-F)<=d*Math.max(1,Math.abs(n),Math.abs(F))&&Math.abs(o-j)<=d*Math.max(1,Math.abs(o),Math.abs(j))&&Math.abs(h-Z)<=d*Math.max(1,Math.abs(h),Math.abs(Z))&&Math.abs(f-K)<=d*Math.max(1,Math.abs(f),Math.abs(K))}var pe=Wt,$e=de;function ze(){var t=new x(9);return x!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function ke(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function Je(t){var e=new x(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function qe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function le(t,e,r,i,n,o,h,f,y){var C=new x(9);return C[0]=t,C[1]=e,C[2]=r,C[3]=i,C[4]=n,C[5]=o,C[6]=h,C[7]=f,C[8]=y,C}function tr(t,e,r,i,n,o,h,f,y,C){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=o,t[5]=h,t[6]=f,t[7]=y,t[8]=C,t}function er(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Ae(t,e){if(t===e){var r=e[1],i=e[2],n=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=i,t[7]=n}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function Ie(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],h=e[4],f=e[5],y=e[6],C=e[7],F=e[8],j=F*h-f*C,Z=-F*o+f*y,K=C*o-h*y,q=r*j+i*Z+n*K;return q?(t[0]=j*(q=1/q),t[1]=(-F*i+n*C)*q,t[2]=(f*i-n*h)*q,t[3]=Z*q,t[4]=(F*r-n*y)*q,t[5]=(-f*r+n*o)*q,t[6]=K*q,t[7]=(-C*r+i*y)*q,t[8]=(h*r-i*o)*q,t):null}function me(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],h=e[4],f=e[5],y=e[6],C=e[7],F=e[8];return t[0]=h*F-f*C,t[1]=n*C-i*F,t[2]=i*f-n*h,t[3]=f*y-o*F,t[4]=r*F-n*y,t[5]=n*o-r*f,t[6]=o*C-h*y,t[7]=i*y-r*C,t[8]=r*h-i*o,t}function rr(t){var n=t[3],o=t[4],h=t[5],f=t[6],y=t[7],C=t[8];return t[0]*(C*o-h*y)+t[1]*(-C*n+h*f)+t[2]*(y*n-o*f)}function Oe(t,e,r){var i=e[0],n=e[1],o=e[2],h=e[3],f=e[4],y=e[5],C=e[6],F=e[7],j=e[8],Z=r[0],K=r[1],q=r[2],et=r[3],J=r[4],nt=r[5],vt=r[6],lt=r[7],ct=r[8];return t[0]=Z*i+K*h+q*C,t[1]=Z*n+K*f+q*F,t[2]=Z*o+K*y+q*j,t[3]=et*i+J*h+nt*C,t[4]=et*n+J*f+nt*F,t[5]=et*o+J*y+nt*j,t[6]=vt*i+lt*h+ct*C,t[7]=vt*n+lt*f+ct*F,t[8]=vt*o+lt*y+ct*j,t}function ir(t,e,r){var i=e[0],n=e[1],o=e[2],h=e[3],f=e[4],y=e[5],C=e[6],F=e[7],j=e[8],Z=r[0],K=r[1];return t[0]=i,t[1]=n,t[2]=o,t[3]=h,t[4]=f,t[5]=y,t[6]=Z*i+K*h+C,t[7]=Z*n+K*f+F,t[8]=Z*o+K*y+j,t}function be(t,e,r){var i=e[0],n=e[1],o=e[2],h=e[3],f=e[4],y=e[5],C=e[6],F=e[7],j=e[8],Z=Math.sin(r),K=Math.cos(r);return t[0]=K*i+Z*h,t[1]=K*n+Z*f,t[2]=K*o+Z*y,t[3]=K*h-Z*i,t[4]=K*f-Z*n,t[5]=K*y-Z*o,t[6]=C,t[7]=F,t[8]=j,t}function nr(t,e,r){var i=r[0],n=r[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function sr(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function ar(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=-r,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function ce(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function or(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function ye(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],h=r+r,f=i+i,y=n+n,C=r*h,F=i*h,j=i*f,Z=n*h,K=n*f,q=n*y,et=o*h,J=o*f,nt=o*y;return t[0]=1-j-q,t[3]=F-nt,t[6]=Z+J,t[1]=F+nt,t[4]=1-C-q,t[7]=K-et,t[2]=Z-J,t[5]=K+et,t[8]=1-C-j,t}function Re(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],h=e[4],f=e[5],y=e[6],C=e[7],F=e[8],j=e[9],Z=e[10],K=e[11],q=e[12],et=e[13],J=e[14],nt=e[15],vt=r*f-i*h,lt=r*y-n*h,ct=r*C-o*h,dt=i*y-n*f,ut=i*C-o*f,Lt=n*C-o*y,St=F*et-j*q,Ct=F*J-Z*q,Mt=F*nt-K*q,zt=j*J-Z*et,Pt=j*nt-K*et,At=Z*nt-K*J,mt=vt*At-lt*Pt+ct*zt+dt*Mt-ut*Ct+Lt*St;return mt?(t[0]=(f*At-y*Pt+C*zt)*(mt=1/mt),t[1]=(y*Mt-h*At-C*Ct)*mt,t[2]=(h*Pt-f*Mt+C*St)*mt,t[3]=(n*Pt-i*At-o*zt)*mt,t[4]=(r*At-n*Mt+o*Ct)*mt,t[5]=(i*Mt-r*Pt-o*St)*mt,t[6]=(et*Lt-J*ut+nt*dt)*mt,t[7]=(J*ct-q*Lt-nt*lt)*mt,t[8]=(q*ut-et*ct+nt*vt)*mt,t):null}function De(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function He(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function Fe(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function _e(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t}function Jt(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}function ie(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t}function ne(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t}function ge(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function hr(t,e){var r=t[0],i=t[1],n=t[2],o=t[3],h=t[4],f=t[5],y=t[6],C=t[7],F=t[8],j=e[0],Z=e[1],K=e[2],q=e[3],et=e[4],J=e[5],nt=e[6],vt=e[7],lt=e[8];return Math.abs(r-j)<=d*Math.max(1,Math.abs(r),Math.abs(j))&&Math.abs(i-Z)<=d*Math.max(1,Math.abs(i),Math.abs(Z))&&Math.abs(n-K)<=d*Math.max(1,Math.abs(n),Math.abs(K))&&Math.abs(o-q)<=d*Math.max(1,Math.abs(o),Math.abs(q))&&Math.abs(h-et)<=d*Math.max(1,Math.abs(h),Math.abs(et))&&Math.abs(f-J)<=d*Math.max(1,Math.abs(f),Math.abs(J))&&Math.abs(y-nt)<=d*Math.max(1,Math.abs(y),Math.abs(nt))&&Math.abs(C-vt)<=d*Math.max(1,Math.abs(C),Math.abs(vt))&&Math.abs(F-lt)<=d*Math.max(1,Math.abs(F),Math.abs(lt))}var ve=Oe,Vt=Jt;function qt(){var t=new x(16);return x!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function Qt(t){var e=new x(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Kt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function se(t,e,r,i,n,o,h,f,y,C,F,j,Z,K,q,et){var J=new x(16);return J[0]=t,J[1]=e,J[2]=r,J[3]=i,J[4]=n,J[5]=o,J[6]=h,J[7]=f,J[8]=y,J[9]=C,J[10]=F,J[11]=j,J[12]=Z,J[13]=K,J[14]=q,J[15]=et,J}function Xt(t,e,r,i,n,o,h,f,y,C,F,j,Z,K,q,et,J){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=o,t[5]=h,t[6]=f,t[7]=y,t[8]=C,t[9]=F,t[10]=j,t[11]=Z,t[12]=K,t[13]=q,t[14]=et,t[15]=J,t}function Gt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function lr(t,e){if(t===e){var r=e[1],i=e[2],n=e[3],o=e[6],h=e[7],f=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=o,t[11]=e[14],t[12]=n,t[13]=h,t[14]=f}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Be(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],h=e[4],f=e[5],y=e[6],C=e[7],F=e[8],j=e[9],Z=e[10],K=e[11],q=e[12],et=e[13],J=e[14],nt=e[15],vt=r*f-i*h,lt=r*y-n*h,ct=r*C-o*h,dt=i*y-n*f,ut=i*C-o*f,Lt=n*C-o*y,St=F*et-j*q,Ct=F*J-Z*q,Mt=F*nt-K*q,zt=j*J-Z*et,Pt=j*nt-K*et,At=Z*nt-K*J,mt=vt*At-lt*Pt+ct*zt+dt*Mt-ut*Ct+Lt*St;return mt?(t[0]=(f*At-y*Pt+C*zt)*(mt=1/mt),t[1]=(n*Pt-i*At-o*zt)*mt,t[2]=(et*Lt-J*ut+nt*dt)*mt,t[3]=(Z*ut-j*Lt-K*dt)*mt,t[4]=(y*Mt-h*At-C*Ct)*mt,t[5]=(r*At-n*Mt+o*Ct)*mt,t[6]=(J*ct-q*Lt-nt*lt)*mt,t[7]=(F*Lt-Z*ct+K*lt)*mt,t[8]=(h*Pt-f*Mt+C*St)*mt,t[9]=(i*Mt-r*Pt-o*St)*mt,t[10]=(q*ut-et*ct+nt*vt)*mt,t[11]=(j*ct-F*ut-K*vt)*mt,t[12]=(f*Ct-h*zt-y*St)*mt,t[13]=(r*zt-i*Ct+n*St)*mt,t[14]=(et*lt-q*dt-J*vt)*mt,t[15]=(F*dt-j*lt+Z*vt)*mt,t):null}function fe(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],h=e[4],f=e[5],y=e[6],C=e[7],F=e[8],j=e[9],Z=e[10],K=e[11],q=e[12],et=e[13],J=e[14],nt=e[15];return t[0]=f*(Z*nt-K*J)-j*(y*nt-C*J)+et*(y*K-C*Z),t[1]=-(i*(Z*nt-K*J)-j*(n*nt-o*J)+et*(n*K-o*Z)),t[2]=i*(y*nt-C*J)-f*(n*nt-o*J)+et*(n*C-o*y),t[3]=-(i*(y*K-C*Z)-f*(n*K-o*Z)+j*(n*C-o*y)),t[4]=-(h*(Z*nt-K*J)-F*(y*nt-C*J)+q*(y*K-C*Z)),t[5]=r*(Z*nt-K*J)-F*(n*nt-o*J)+q*(n*K-o*Z),t[6]=-(r*(y*nt-C*J)-h*(n*nt-o*J)+q*(n*C-o*y)),t[7]=r*(y*K-C*Z)-h*(n*K-o*Z)+F*(n*C-o*y),t[8]=h*(j*nt-K*et)-F*(f*nt-C*et)+q*(f*K-C*j),t[9]=-(r*(j*nt-K*et)-F*(i*nt-o*et)+q*(i*K-o*j)),t[10]=r*(f*nt-C*et)-h*(i*nt-o*et)+q*(i*C-o*f),t[11]=-(r*(f*K-C*j)-h*(i*K-o*j)+F*(i*C-o*f)),t[12]=-(h*(j*J-Z*et)-F*(f*J-y*et)+q*(f*Z-y*j)),t[13]=r*(j*J-Z*et)-F*(i*J-n*et)+q*(i*Z-n*j),t[14]=-(r*(f*J-y*et)-h*(i*J-n*et)+q*(i*y-n*f)),t[15]=r*(f*Z-y*j)-h*(i*Z-n*j)+F*(i*y-n*f),t}function Yt(t){var e=t[0],r=t[1],i=t[2],n=t[3],o=t[4],h=t[5],f=t[6],y=t[7],C=t[8],F=t[9],j=t[10],Z=t[11],K=t[12],q=t[13],et=t[14],J=t[15];return(e*h-r*o)*(j*J-Z*et)-(e*f-i*o)*(F*J-Z*q)+(e*y-n*o)*(F*et-j*q)+(r*f-i*h)*(C*J-Z*K)-(r*y-n*h)*(C*et-j*K)+(i*y-n*f)*(C*q-F*K)}function ae(t,e,r){var i=e[0],n=e[1],o=e[2],h=e[3],f=e[4],y=e[5],C=e[6],F=e[7],j=e[8],Z=e[9],K=e[10],q=e[11],et=e[12],J=e[13],nt=e[14],vt=e[15],lt=r[0],ct=r[1],dt=r[2],ut=r[3];return t[0]=lt*i+ct*f+dt*j+ut*et,t[1]=lt*n+ct*y+dt*Z+ut*J,t[2]=lt*o+ct*C+dt*K+ut*nt,t[3]=lt*h+ct*F+dt*q+ut*vt,t[4]=(lt=r[4])*i+(ct=r[5])*f+(dt=r[6])*j+(ut=r[7])*et,t[5]=lt*n+ct*y+dt*Z+ut*J,t[6]=lt*o+ct*C+dt*K+ut*nt,t[7]=lt*h+ct*F+dt*q+ut*vt,t[8]=(lt=r[8])*i+(ct=r[9])*f+(dt=r[10])*j+(ut=r[11])*et,t[9]=lt*n+ct*y+dt*Z+ut*J,t[10]=lt*o+ct*C+dt*K+ut*nt,t[11]=lt*h+ct*F+dt*q+ut*vt,t[12]=(lt=r[12])*i+(ct=r[13])*f+(dt=r[14])*j+(ut=r[15])*et,t[13]=lt*n+ct*y+dt*Z+ut*J,t[14]=lt*o+ct*C+dt*K+ut*nt,t[15]=lt*h+ct*F+dt*q+ut*vt,t}function xe(t,e,r){var h,f,y,C,F,j,Z,K,q,et,J,nt,i=r[0],n=r[1],o=r[2];return e===t?(t[12]=e[0]*i+e[4]*n+e[8]*o+e[12],t[13]=e[1]*i+e[5]*n+e[9]*o+e[13],t[14]=e[2]*i+e[6]*n+e[10]*o+e[14],t[15]=e[3]*i+e[7]*n+e[11]*o+e[15]):(f=e[1],y=e[2],C=e[3],F=e[4],j=e[5],Z=e[6],K=e[7],q=e[8],et=e[9],J=e[10],nt=e[11],t[0]=h=e[0],t[1]=f,t[2]=y,t[3]=C,t[4]=F,t[5]=j,t[6]=Z,t[7]=K,t[8]=q,t[9]=et,t[10]=J,t[11]=nt,t[12]=h*i+F*n+q*o+e[12],t[13]=f*i+j*n+et*o+e[13],t[14]=y*i+Z*n+J*o+e[14],t[15]=C*i+K*n+nt*o+e[15]),t}function we(t,e,r){var i=r[0],n=r[1],o=r[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Me(t,e,r,i){var y,C,F,j,Z,K,q,et,J,nt,vt,lt,ct,dt,ut,Lt,St,Ct,Mt,zt,Pt,At,mt,Zt,n=i[0],o=i[1],h=i[2],f=Math.hypot(n,o,h);return f<d?null:(n*=f=1/f,o*=f,h*=f,y=Math.sin(r),C=Math.cos(r),Z=e[1],K=e[2],q=e[3],J=e[5],nt=e[6],vt=e[7],ct=e[9],dt=e[10],ut=e[11],Mt=n*o*(F=1-C)-h*y,zt=o*o*F+C,Pt=h*o*F+n*y,At=n*h*F+o*y,mt=o*h*F-n*y,Zt=h*h*F+C,t[0]=(j=e[0])*(Lt=n*n*F+C)+(et=e[4])*(St=o*n*F+h*y)+(lt=e[8])*(Ct=h*n*F-o*y),t[1]=Z*Lt+J*St+ct*Ct,t[2]=K*Lt+nt*St+dt*Ct,t[3]=q*Lt+vt*St+ut*Ct,t[4]=j*Mt+et*zt+lt*Pt,t[5]=Z*Mt+J*zt+ct*Pt,t[6]=K*Mt+nt*zt+dt*Pt,t[7]=q*Mt+vt*zt+ut*Pt,t[8]=j*At+et*mt+lt*Zt,t[9]=Z*At+J*mt+ct*Zt,t[10]=K*At+nt*mt+dt*Zt,t[11]=q*At+vt*mt+ut*Zt,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function Ee(t,e,r){var i=Math.sin(r),n=Math.cos(r),o=e[4],h=e[5],f=e[6],y=e[7],C=e[8],F=e[9],j=e[10],Z=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*n+C*i,t[5]=h*n+F*i,t[6]=f*n+j*i,t[7]=y*n+Z*i,t[8]=C*n-o*i,t[9]=F*n-h*i,t[10]=j*n-f*i,t[11]=Z*n-y*i,t}function ue(t,e,r){var i=Math.sin(r),n=Math.cos(r),o=e[0],h=e[1],f=e[2],y=e[3],C=e[8],F=e[9],j=e[10],Z=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*n-C*i,t[1]=h*n-F*i,t[2]=f*n-j*i,t[3]=y*n-Z*i,t[8]=o*i+C*n,t[9]=h*i+F*n,t[10]=f*i+j*n,t[11]=y*i+Z*n,t}function $t(t,e,r){var i=Math.sin(r),n=Math.cos(r),o=e[0],h=e[1],f=e[2],y=e[3],C=e[4],F=e[5],j=e[6],Z=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*n+C*i,t[1]=h*n+F*i,t[2]=f*n+j*i,t[3]=y*n+Z*i,t[4]=C*n-o*i,t[5]=F*n-h*i,t[6]=j*n-f*i,t[7]=Z*n-y*i,t}function cr(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function Ne(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Te(t,e,r){var f,y,C,i=r[0],n=r[1],o=r[2],h=Math.hypot(i,n,o);return h<d?null:(i*=h=1/h,n*=h,o*=h,f=Math.sin(e),y=Math.cos(e),t[0]=i*i*(C=1-y)+y,t[1]=n*i*C+o*f,t[2]=o*i*C-n*f,t[3]=0,t[4]=i*n*C-o*f,t[5]=n*n*C+y,t[6]=o*n*C+i*f,t[7]=0,t[8]=i*o*C+n*f,t[9]=n*o*C-i*f,t[10]=o*o*C+y,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function Ve(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function vr(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function M(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function I(t,e,r){var i=e[0],n=e[1],o=e[2],h=e[3],f=i+i,y=n+n,C=o+o,F=i*f,j=i*y,Z=i*C,K=n*y,q=n*C,et=o*C,J=h*f,nt=h*y,vt=h*C;return t[0]=1-(K+et),t[1]=j+vt,t[2]=Z-nt,t[3]=0,t[4]=j-vt,t[5]=1-(F+et),t[6]=q+J,t[7]=0,t[8]=Z+nt,t[9]=q-J,t[10]=1-(F+K),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function G(t,e){var r=new x(3),i=-e[0],n=-e[1],o=-e[2],h=e[3],f=e[4],y=e[5],C=e[6],F=e[7],j=i*i+n*n+o*o+h*h;return j>0?(r[0]=2*(f*h+F*i+y*o-C*n)/j,r[1]=2*(y*h+F*n+C*i-f*o)/j,r[2]=2*(C*h+F*o+f*n-y*i)/j):(r[0]=2*(f*h+F*i+y*o-C*n),r[1]=2*(y*h+F*n+C*i-f*o),r[2]=2*(C*h+F*o+f*n-y*i)),I(t,e,r),t}function tt(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function st(t,e){var o=e[4],h=e[5],f=e[6],y=e[8],C=e[9],F=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(o,h,f),t[2]=Math.hypot(y,C,F),t}function ft(t,e){var r=new x(3);st(r,e);var i=1/r[0],n=1/r[1],o=1/r[2],h=e[0]*i,f=e[1]*n,y=e[2]*o,C=e[4]*i,F=e[5]*n,j=e[6]*o,Z=e[8]*i,K=e[9]*n,q=e[10]*o,et=h+F+q,J=0;return et>0?(J=2*Math.sqrt(et+1),t[3]=.25*J,t[0]=(j-K)/J,t[1]=(Z-y)/J,t[2]=(f-C)/J):h>F&&h>q?(J=2*Math.sqrt(1+h-F-q),t[3]=(j-K)/J,t[0]=.25*J,t[1]=(f+C)/J,t[2]=(Z+y)/J):F>q?(J=2*Math.sqrt(1+F-h-q),t[3]=(Z-y)/J,t[0]=(f+C)/J,t[1]=.25*J,t[2]=(j+K)/J):(J=2*Math.sqrt(1+q-h-F),t[3]=(f-C)/J,t[0]=(Z+y)/J,t[1]=(j+K)/J,t[2]=.25*J),t}function gt(t,e,r,i){var n=e[0],o=e[1],h=e[2],f=e[3],y=n+n,C=o+o,F=h+h,j=n*y,Z=n*C,K=n*F,q=o*C,et=o*F,J=h*F,nt=f*y,vt=f*C,lt=f*F,ct=i[0],dt=i[1],ut=i[2];return t[0]=(1-(q+J))*ct,t[1]=(Z+lt)*ct,t[2]=(K-vt)*ct,t[3]=0,t[4]=(Z-lt)*dt,t[5]=(1-(j+J))*dt,t[6]=(et+nt)*dt,t[7]=0,t[8]=(K+vt)*ut,t[9]=(et-nt)*ut,t[10]=(1-(j+q))*ut,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function Rt(t,e,r,i,n){var o=e[0],h=e[1],f=e[2],y=e[3],C=o+o,F=h+h,j=f+f,Z=o*C,K=o*F,q=o*j,et=h*F,J=h*j,nt=f*j,vt=y*C,lt=y*F,ct=y*j,dt=i[0],ut=i[1],Lt=i[2],St=n[0],Ct=n[1],Mt=n[2],zt=(1-(et+nt))*dt,Pt=(K+ct)*dt,At=(q-lt)*dt,mt=(K-ct)*ut,Zt=(1-(Z+nt))*ut,Se=(J+vt)*ut,Ce=(q+lt)*Lt,yi=(J-vt)*Lt,_i=(1-(Z+et))*Lt;return t[0]=zt,t[1]=Pt,t[2]=At,t[3]=0,t[4]=mt,t[5]=Zt,t[6]=Se,t[7]=0,t[8]=Ce,t[9]=yi,t[10]=_i,t[11]=0,t[12]=r[0]+St-(zt*St+mt*Ct+Ce*Mt),t[13]=r[1]+Ct-(Pt*St+Zt*Ct+yi*Mt),t[14]=r[2]+Mt-(At*St+Se*Ct+_i*Mt),t[15]=1,t}function Ht(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],h=r+r,f=i+i,y=n+n,C=r*h,F=i*h,j=i*f,Z=n*h,K=n*f,q=n*y,et=o*h,J=o*f,nt=o*y;return t[0]=1-j-q,t[1]=F+nt,t[2]=Z-J,t[3]=0,t[4]=F-nt,t[5]=1-C-q,t[6]=K+et,t[7]=0,t[8]=Z+J,t[9]=K-et,t[10]=1-C-j,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function jt(t,e,r,i,n,o,h){var f=1/(r-e),y=1/(n-i),C=1/(o-h);return t[0]=2*o*f,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*y,t[6]=0,t[7]=0,t[8]=(r+e)*f,t[9]=(n+i)*y,t[10]=(h+o)*C,t[11]=-1,t[12]=0,t[13]=0,t[14]=h*o*2*C,t[15]=0,t}function te(t,e,r,i,n){var h,o=1/Math.tan(e/2);return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=n&&n!==1/0?(t[10]=(n+i)*(h=1/(i-n)),t[14]=2*n*i*h):(t[10]=-1,t[14]=-2*i),t}function gi(t,e,r,i){var n=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),h=Math.tan(e.leftDegrees*Math.PI/180),f=Math.tan(e.rightDegrees*Math.PI/180),y=2/(h+f),C=2/(n+o);return t[0]=y,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=C,t[6]=0,t[7]=0,t[8]=-(h-f)*y*.5,t[9]=(n-o)*C*.5,t[10]=i/(r-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=i*r/(r-i),t[15]=0,t}function xi(t,e,r,i,n,o,h){var f=1/(e-r),y=1/(i-n),C=1/(o-h);return t[0]=-2*f,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*C,t[11]=0,t[12]=(e+r)*f,t[13]=(n+i)*y,t[14]=(h+o)*C,t[15]=1,t}function wi(t,e,r,i){var n,o,h,f,y,C,F,j,Z,K,q=e[0],et=e[1],J=e[2],nt=i[0],vt=i[1],lt=i[2],ct=r[0],dt=r[1],ut=r[2];return Math.abs(q-ct)<d&&Math.abs(et-dt)<d&&Math.abs(J-ut)<d?Gt(t):(F=q-ct,j=et-dt,Z=J-ut,n=vt*(Z*=K=1/Math.hypot(F,j,Z))-lt*(j*=K),o=lt*(F*=K)-nt*Z,h=nt*j-vt*F,(K=Math.hypot(n,o,h))?(n*=K=1/K,o*=K,h*=K):(n=0,o=0,h=0),f=j*h-Z*o,y=Z*n-F*h,C=F*o-j*n,(K=Math.hypot(f,y,C))?(f*=K=1/K,y*=K,C*=K):(f=0,y=0,C=0),t[0]=n,t[1]=f,t[2]=F,t[3]=0,t[4]=o,t[5]=y,t[6]=j,t[7]=0,t[8]=h,t[9]=C,t[10]=Z,t[11]=0,t[12]=-(n*q+o*et+h*J),t[13]=-(f*q+y*et+C*J),t[14]=-(F*q+j*et+Z*J),t[15]=1,t)}function Mi(t,e,r,i){var n=e[0],o=e[1],h=e[2],f=i[0],y=i[1],C=i[2],F=n-r[0],j=o-r[1],Z=h-r[2],K=F*F+j*j+Z*Z;K>0&&(F*=K=1/Math.sqrt(K),j*=K,Z*=K);var q=y*Z-C*j,et=C*F-f*Z,J=f*j-y*F;return(K=q*q+et*et+J*J)>0&&(q*=K=1/Math.sqrt(K),et*=K,J*=K),t[0]=q,t[1]=et,t[2]=J,t[3]=0,t[4]=j*J-Z*et,t[5]=Z*q-F*J,t[6]=F*et-j*q,t[7]=0,t[8]=F,t[9]=j,t[10]=Z,t[11]=0,t[12]=n,t[13]=o,t[14]=h,t[15]=1,t}function Ei(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function Ti(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function Si(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}function Mr(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}function Ci(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}function Pi(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t[9]=e[9]+r[9]*i,t[10]=e[10]+r[10]*i,t[11]=e[11]+r[11]*i,t[12]=e[12]+r[12]*i,t[13]=e[13]+r[13]*i,t[14]=e[14]+r[14]*i,t[15]=e[15]+r[15]*i,t}function Li(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function zi(t,e){var r=t[0],i=t[1],n=t[2],o=t[3],h=t[4],f=t[5],y=t[6],C=t[7],F=t[8],j=t[9],Z=t[10],K=t[11],q=t[12],et=t[13],J=t[14],nt=t[15],vt=e[0],lt=e[1],ct=e[2],dt=e[3],ut=e[4],Lt=e[5],St=e[6],Ct=e[7],Mt=e[8],zt=e[9],Pt=e[10],At=e[11],mt=e[12],Zt=e[13],Se=e[14],Ce=e[15];return Math.abs(r-vt)<=d*Math.max(1,Math.abs(r),Math.abs(vt))&&Math.abs(i-lt)<=d*Math.max(1,Math.abs(i),Math.abs(lt))&&Math.abs(n-ct)<=d*Math.max(1,Math.abs(n),Math.abs(ct))&&Math.abs(o-dt)<=d*Math.max(1,Math.abs(o),Math.abs(dt))&&Math.abs(h-ut)<=d*Math.max(1,Math.abs(h),Math.abs(ut))&&Math.abs(f-Lt)<=d*Math.max(1,Math.abs(f),Math.abs(Lt))&&Math.abs(y-St)<=d*Math.max(1,Math.abs(y),Math.abs(St))&&Math.abs(C-Ct)<=d*Math.max(1,Math.abs(C),Math.abs(Ct))&&Math.abs(F-Mt)<=d*Math.max(1,Math.abs(F),Math.abs(Mt))&&Math.abs(j-zt)<=d*Math.max(1,Math.abs(j),Math.abs(zt))&&Math.abs(Z-Pt)<=d*Math.max(1,Math.abs(Z),Math.abs(Pt))&&Math.abs(K-At)<=d*Math.max(1,Math.abs(K),Math.abs(At))&&Math.abs(q-mt)<=d*Math.max(1,Math.abs(q),Math.abs(mt))&&Math.abs(et-Zt)<=d*Math.max(1,Math.abs(et),Math.abs(Zt))&&Math.abs(J-Se)<=d*Math.max(1,Math.abs(J),Math.abs(Se))&&Math.abs(nt-Ce)<=d*Math.max(1,Math.abs(nt),Math.abs(Ce))}var Ai=ae,Ii=Mr;function fr(){var t=new x(3);return x!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Oi(t){var e=new x(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Er(t){return Math.hypot(t[0],t[1],t[2])}function ur(t,e,r){var i=new x(3);return i[0]=t,i[1]=e,i[2]=r,i}function bi(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Ri(t,e,r,i){return t[0]=e,t[1]=r,t[2]=i,t}function Di(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function Tr(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function Sr(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function Cr(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function Hi(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function Fi(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function Bi(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}function Ni(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function Vi(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function Wi(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function Yi(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t}function Pr(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function Lr(t,e){var r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return r*r+i*i+n*n}function zr(t){var e=t[0],r=t[1],i=t[2];return e*e+r*r+i*i}function Ui(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function Xi(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function Ar(t,e){var r=e[0],i=e[1],n=e[2],o=r*r+i*i+n*n;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function dr(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function We(t,e,r){var i=e[0],n=e[1],o=e[2],h=r[0],f=r[1],y=r[2];return t[0]=n*y-o*f,t[1]=o*h-i*y,t[2]=i*f-n*h,t}function Gi(t,e,r,i){var n=e[0],o=e[1],h=e[2];return t[0]=n+i*(r[0]-n),t[1]=o+i*(r[1]-o),t[2]=h+i*(r[2]-h),t}function ji(t,e,r,i,n,o){var h=o*o,f=h*(2*o-3)+1,y=h*(o-2)+o,C=h*(o-1),F=h*(3-2*o);return t[0]=e[0]*f+r[0]*y+i[0]*C+n[0]*F,t[1]=e[1]*f+r[1]*y+i[1]*C+n[1]*F,t[2]=e[2]*f+r[2]*y+i[2]*C+n[2]*F,t}function Ki(t,e,r,i,n,o){var h=1-o,f=h*h,y=o*o,C=f*h,F=3*o*f,j=3*y*h,Z=y*o;return t[0]=e[0]*C+r[0]*F+i[0]*j+n[0]*Z,t[1]=e[1]*C+r[1]*F+i[1]*j+n[1]*Z,t[2]=e[2]*C+r[2]*F+i[2]*j+n[2]*Z,t}function Zi(t,e){e=e||1;var r=2*R()*Math.PI,i=2*R()-1,n=Math.sqrt(1-i*i)*e;return t[0]=Math.cos(r)*n,t[1]=Math.sin(r)*n,t[2]=i*e,t}function Qi(t,e,r){var i=e[0],n=e[1],o=e[2],h=r[3]*i+r[7]*n+r[11]*o+r[15];return t[0]=(r[0]*i+r[4]*n+r[8]*o+r[12])/(h=h||1),t[1]=(r[1]*i+r[5]*n+r[9]*o+r[13])/h,t[2]=(r[2]*i+r[6]*n+r[10]*o+r[14])/h,t}function $i(t,e,r){var i=e[0],n=e[1],o=e[2];return t[0]=i*r[0]+n*r[3]+o*r[6],t[1]=i*r[1]+n*r[4]+o*r[7],t[2]=i*r[2]+n*r[5]+o*r[8],t}function ki(t,e,r){var i=r[0],n=r[1],o=r[2],f=e[0],y=e[1],C=e[2],F=n*C-o*y,j=o*f-i*C,Z=i*y-n*f,K=n*Z-o*j,q=o*F-i*Z,et=i*j-n*F,J=2*r[3];return j*=J,Z*=J,q*=2,et*=2,t[0]=f+(F*=J)+(K*=2),t[1]=y+j+q,t[2]=C+Z+et,t}function Ji(t,e,r,i){var n=[],o=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],o[0]=n[0],o[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),o[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t}function qi(t,e,r,i){var n=[],o=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],o[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),o[1]=n[1],o[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t}function tn(t,e,r,i){var n=[],o=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],o[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),o[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),o[2]=n[2],t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t}function en(t,e){var r=t[0],i=t[1],n=t[2],o=e[0],h=e[1],f=e[2],F=Math.sqrt(r*r+i*i+n*n)*Math.sqrt(o*o+h*h+f*f),j=F&&dr(t,e)/F;return Math.acos(Math.min(Math.max(j,-1),1))}function rn(t){return t[0]=0,t[1]=0,t[2]=0,t}function nn(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function sn(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function an(t,e){var r=t[0],i=t[1],n=t[2],o=e[0],h=e[1],f=e[2];return Math.abs(r-o)<=d*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-h)<=d*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(n-f)<=d*Math.max(1,Math.abs(n),Math.abs(f))}var t,on=Tr,hn=Sr,ln=Cr,cn=Pr,vn=Lr,Ir=Er,fn=zr,un=(t=fr(),function(e,r,i,n,o,h){var f,y;for(r||(r=3),i||(i=0),y=n?Math.min(n*r+i,e.length):e.length,f=i;f<y;f+=r)t[0]=e[f],t[1]=e[f+1],t[2]=e[f+2],o(t,t,h),e[f]=t[0],e[f+1]=t[1],e[f+2]=t[2];return e});function Or(){var t=new x(4);return x!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function br(t){var e=new x(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Rr(t,e,r,i){var n=new x(4);return n[0]=t,n[1]=e,n[2]=r,n[3]=i,n}function Dr(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Hr(t,e,r,i,n){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t}function Fr(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function Br(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function Nr(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function Vr(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function dn(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function pn(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function mn(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t}function yn(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t}function _n(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function Wr(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function gn(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t}function Yr(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function Ur(t,e){var r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2],o=e[3]-t[3];return r*r+i*i+n*n+o*o}function pr(t){return Math.hypot(t[0],t[1],t[2],t[3])}function mr(t){var e=t[0],r=t[1],i=t[2],n=t[3];return e*e+r*r+i*i+n*n}function xn(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function wn(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function Xr(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],h=r*r+i*i+n*n+o*o;return h>0&&(h=1/Math.sqrt(h)),t[0]=r*h,t[1]=i*h,t[2]=n*h,t[3]=o*h,t}function Gr(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function Mn(t,e,r,i){var n=r[0]*i[1]-r[1]*i[0],o=r[0]*i[2]-r[2]*i[0],h=r[0]*i[3]-r[3]*i[0],f=r[1]*i[2]-r[2]*i[1],y=r[1]*i[3]-r[3]*i[1],C=r[2]*i[3]-r[3]*i[2],F=e[0],j=e[1],Z=e[2],K=e[3];return t[0]=j*C-Z*y+K*f,t[1]=-F*C+Z*h-K*o,t[2]=F*y-j*h+K*n,t[3]=-F*f+j*o-Z*n,t}function jr(t,e,r,i){var n=e[0],o=e[1],h=e[2],f=e[3];return t[0]=n+i*(r[0]-n),t[1]=o+i*(r[1]-o),t[2]=h+i*(r[2]-h),t[3]=f+i*(r[3]-f),t}function En(t,e){var r,i,n,o,h,f;e=e||1;do{h=(r=2*R()-1)*r+(i=2*R()-1)*i}while(h>=1);do{f=(n=2*R()-1)*n+(o=2*R()-1)*o}while(f>=1);var y=Math.sqrt((1-h)/f);return t[0]=e*r,t[1]=e*i,t[2]=e*n*y,t[3]=e*o*y,t}function Tn(t,e,r){var i=e[0],n=e[1],o=e[2],h=e[3];return t[0]=r[0]*i+r[4]*n+r[8]*o+r[12]*h,t[1]=r[1]*i+r[5]*n+r[9]*o+r[13]*h,t[2]=r[2]*i+r[6]*n+r[10]*o+r[14]*h,t[3]=r[3]*i+r[7]*n+r[11]*o+r[15]*h,t}function Sn(t,e,r){var i=e[0],n=e[1],o=e[2],h=r[0],f=r[1],y=r[2],C=r[3],F=C*i+f*o-y*n,j=C*n+y*i-h*o,Z=C*o+h*n-f*i,K=-h*i-f*n-y*o;return t[0]=F*C+K*-h+j*-y-Z*-f,t[1]=j*C+K*-f+Z*-h-F*-y,t[2]=Z*C+K*-y+F*-f-j*-h,t[3]=e[3],t}function Cn(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function Pn(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function Kr(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function Zr(t,e){var r=t[0],i=t[1],n=t[2],o=t[3],h=e[0],f=e[1],y=e[2],C=e[3];return Math.abs(r-h)<=d*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(i-f)<=d*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(n-y)<=d*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(o-C)<=d*Math.max(1,Math.abs(o),Math.abs(C))}var Ln=Br,zn=Nr,An=Vr,In=Yr,On=Ur,bn=pr,Rn=mr,Dn=function(){var t=Or();return function(e,r,i,n,o,h){var f,y;for(r||(r=4),i||(i=0),y=n?Math.min(n*r+i,e.length):e.length,f=i;f<y;f+=r)t[0]=e[f],t[1]=e[f+1],t[2]=e[f+2],t[3]=e[f+3],o(t,t,h),e[f]=t[0],e[f+1]=t[1],e[f+2]=t[2],e[f+3]=t[3];return e}}();function Ye(){var t=new x(4);return x!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Hn(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Qr(t,e,r){r*=.5;var i=Math.sin(r);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(r),t}function Fn(t,e){var r=2*Math.acos(e[3]),i=Math.sin(r/2);return i>d?(t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i):(t[0]=1,t[1]=0,t[2]=0),r}function Bn(t,e){var r=_r(t,e);return Math.acos(2*r*r-1)}function $r(t,e,r){var i=e[0],n=e[1],o=e[2],h=e[3],f=r[0],y=r[1],C=r[2],F=r[3];return t[0]=i*F+h*f+n*C-o*y,t[1]=n*F+h*y+o*f-i*C,t[2]=o*F+h*C+i*y-n*f,t[3]=h*F-i*f-n*y-o*C,t}function kr(t,e,r){r*=.5;var i=e[0],n=e[1],o=e[2],h=e[3],f=Math.sin(r),y=Math.cos(r);return t[0]=i*y+h*f,t[1]=n*y+o*f,t[2]=o*y-n*f,t[3]=h*y-i*f,t}function Jr(t,e,r){r*=.5;var i=e[0],n=e[1],o=e[2],h=e[3],f=Math.sin(r),y=Math.cos(r);return t[0]=i*y-o*f,t[1]=n*y+h*f,t[2]=o*y+i*f,t[3]=h*y-n*f,t}function qr(t,e,r){r*=.5;var i=e[0],n=e[1],o=e[2],h=e[3],f=Math.sin(r),y=Math.cos(r);return t[0]=i*y+n*f,t[1]=n*y-i*f,t[2]=o*y+h*f,t[3]=h*y-o*f,t}function Nn(t,e){var r=e[0],i=e[1],n=e[2];return t[0]=r,t[1]=i,t[2]=n,t[3]=Math.sqrt(Math.abs(1-r*r-i*i-n*n)),t}function ti(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],h=Math.sqrt(r*r+i*i+n*n),f=Math.exp(o),y=h>0?f*Math.sin(h)/h:0;return t[0]=r*y,t[1]=i*y,t[2]=n*y,t[3]=f*Math.cos(h),t}function ei(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],h=Math.sqrt(r*r+i*i+n*n),f=h>0?Math.atan2(h,o)/h:0;return t[0]=r*f,t[1]=i*f,t[2]=n*f,t[3]=.5*Math.log(r*r+i*i+n*n+o*o),t}function Vn(t,e,r){return ei(t,e),ii(t,t,r),ti(t,t),t}function Ue(t,e,r,i){var Z,K,q,et,J,n=e[0],o=e[1],h=e[2],f=e[3],y=r[0],C=r[1],F=r[2],j=r[3];return(K=n*y+o*C+h*F+f*j)<0&&(K=-K,y=-y,C=-C,F=-F,j=-j),1-K>d?(Z=Math.acos(K),q=Math.sin(Z),et=Math.sin((1-i)*Z)/q,J=Math.sin(i*Z)/q):(et=1-i,J=i),t[0]=et*n+J*y,t[1]=et*o+J*C,t[2]=et*h+J*F,t[3]=et*f+J*j,t}function Wn(t){var e=R(),r=R(),i=R(),n=Math.sqrt(1-e),o=Math.sqrt(e);return t[0]=n*Math.sin(2*Math.PI*r),t[1]=n*Math.cos(2*Math.PI*r),t[2]=o*Math.sin(2*Math.PI*i),t[3]=o*Math.cos(2*Math.PI*i),t}function Yn(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],h=r*r+i*i+n*n+o*o,f=h?1/h:0;return t[0]=-r*f,t[1]=-i*f,t[2]=-n*f,t[3]=o*f,t}function Un(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function ri(t,e){var i,r=e[0]+e[4]+e[8];if(r>0)i=Math.sqrt(r+1),t[3]=.5*i,t[0]=(e[5]-e[7])*(i=.5/i),t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{var n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);var o=(n+1)%3,h=(n+2)%3;i=Math.sqrt(e[3*n+n]-e[3*o+o]-e[3*h+h]+1),t[n]=.5*i,t[3]=(e[3*o+h]-e[3*h+o])*(i=.5/i),t[o]=(e[3*o+n]+e[3*n+o])*i,t[h]=(e[3*h+n]+e[3*n+h])*i}return t}function Xn(t,e,r,i){var n=.5*Math.PI/180;e*=n,r*=n,i*=n;var o=Math.sin(e),h=Math.cos(e),f=Math.sin(r),y=Math.cos(r),C=Math.sin(i),F=Math.cos(i);return t[0]=o*y*F-h*f*C,t[1]=h*f*F+o*y*C,t[2]=h*y*C-o*f*F,t[3]=h*y*F+o*f*C,t}function Gn(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}var jn=br,Kn=Rr,yr=Dr,Zn=Hr,Qn=Fr,$n=$r,ii=Wr,_r=Gr,kn=jr,gr=pr,Jn=gr,xr=mr,qn=xr,wr=Xr,ts=Kr,es=Zr,rs=function(){var t=fr(),e=ur(1,0,0),r=ur(0,1,0);return function(i,n,o){var h=dr(n,o);return h<-.999999?(We(t,e,n),Ir(t)<1e-6&&We(t,r,n),Ar(t,t),Qr(i,t,Math.PI),i):h>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(We(t,n,o),i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=1+h,wr(i,i))}}(),is=function(){var t=Ye(),e=Ye();return function(r,i,n,o,h,f){return Ue(t,i,h,f),Ue(e,n,o,f),Ue(r,t,e,2*f*(1-f)),r}}(),ns=function(){var t=ze();return function(e,r,i,n){return t[0]=i[0],t[3]=i[1],t[6]=i[2],t[1]=n[0],t[4]=n[1],t[7]=n[2],t[2]=-r[0],t[5]=-r[1],t[8]=-r[2],wr(e,ri(e,t))}}();function ss(){var t=new x(8);return x!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t}function as(t){var e=new x(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function os(t,e,r,i,n,o,h,f){var y=new x(8);return y[0]=t,y[1]=e,y[2]=r,y[3]=i,y[4]=n,y[5]=o,y[6]=h,y[7]=f,y}function hs(t,e,r,i,n,o,h){var f=new x(8);f[0]=t,f[1]=e,f[2]=r,f[3]=i;var y=.5*n,C=.5*o,F=.5*h;return f[4]=y*i+C*r-F*e,f[5]=C*i+F*t-y*r,f[6]=F*i+y*e-C*t,f[7]=-y*t-C*e-F*r,f}function ni(t,e,r){var i=.5*r[0],n=.5*r[1],o=.5*r[2],h=e[0],f=e[1],y=e[2],C=e[3];return t[0]=h,t[1]=f,t[2]=y,t[3]=C,t[4]=i*C+n*y-o*f,t[5]=n*C+o*h-i*y,t[6]=o*C+i*f-n*h,t[7]=-i*h-n*f-o*y,t}function ls(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t}function cs(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function vs(t,e){var r=Ye();ft(r,e);var i=new x(3);return tt(i,e),ni(t,r,i),t}function si(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function fs(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function us(t,e,r,i,n,o,h,f,y){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=o,t[5]=h,t[6]=f,t[7]=y,t}var ds=yr;function ps(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t}var ms=yr;function ys(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t}function _s(t,e){var r=e[4],i=e[5],n=e[6],o=e[7],h=-e[0],f=-e[1],y=-e[2],C=e[3];return t[0]=2*(r*C+o*h+i*y-n*f),t[1]=2*(i*C+o*f+n*h-r*y),t[2]=2*(n*C+o*y+r*f-i*h),t}function gs(t,e,r){var i=e[0],n=e[1],o=e[2],h=e[3],f=.5*r[0],y=.5*r[1],C=.5*r[2],F=e[4],j=e[5],Z=e[6],K=e[7];return t[0]=i,t[1]=n,t[2]=o,t[3]=h,t[4]=h*f+n*C-o*y+F,t[5]=h*y+o*f-i*C+j,t[6]=h*C+i*y-n*f+Z,t[7]=-i*f-n*y-o*C+K,t}function xs(t,e,r){var i=-e[0],n=-e[1],o=-e[2],h=e[3],f=e[4],y=e[5],C=e[6],F=e[7],j=f*h+F*i+y*o-C*n,Z=y*h+F*n+C*i-f*o,K=C*h+F*o+f*n-y*i,q=F*h-f*i-y*n-C*o;return kr(t,e,r),t[4]=j*(h=t[3])+q*(i=t[0])+Z*(o=t[2])-K*(n=t[1]),t[5]=Z*h+q*n+K*i-j*o,t[6]=K*h+q*o+j*n-Z*i,t[7]=q*h-j*i-Z*n-K*o,t}function ws(t,e,r){var i=-e[0],n=-e[1],o=-e[2],h=e[3],f=e[4],y=e[5],C=e[6],F=e[7],j=f*h+F*i+y*o-C*n,Z=y*h+F*n+C*i-f*o,K=C*h+F*o+f*n-y*i,q=F*h-f*i-y*n-C*o;return Jr(t,e,r),t[4]=j*(h=t[3])+q*(i=t[0])+Z*(o=t[2])-K*(n=t[1]),t[5]=Z*h+q*n+K*i-j*o,t[6]=K*h+q*o+j*n-Z*i,t[7]=q*h-j*i-Z*n-K*o,t}function Ms(t,e,r){var i=-e[0],n=-e[1],o=-e[2],h=e[3],f=e[4],y=e[5],C=e[6],F=e[7],j=f*h+F*i+y*o-C*n,Z=y*h+F*n+C*i-f*o,K=C*h+F*o+f*n-y*i,q=F*h-f*i-y*n-C*o;return qr(t,e,r),t[4]=j*(h=t[3])+q*(i=t[0])+Z*(o=t[2])-K*(n=t[1]),t[5]=Z*h+q*n+K*i-j*o,t[6]=K*h+q*o+j*n-Z*i,t[7]=q*h-j*i-Z*n-K*o,t}function Es(t,e,r){var i=r[0],n=r[1],o=r[2],h=r[3],f=e[0],y=e[1],C=e[2],F=e[3];return t[0]=f*h+F*i+y*o-C*n,t[1]=y*h+F*n+C*i-f*o,t[2]=C*h+F*o+f*n-y*i,t[3]=F*h-f*i-y*n-C*o,t[4]=(f=e[4])*h+(F=e[7])*i+(y=e[5])*o-(C=e[6])*n,t[5]=y*h+F*n+C*i-f*o,t[6]=C*h+F*o+f*n-y*i,t[7]=F*h-f*i-y*n-C*o,t}function Ts(t,e,r){var i=e[0],n=e[1],o=e[2],h=e[3],f=r[0],y=r[1],C=r[2],F=r[3];return t[0]=i*F+h*f+n*C-o*y,t[1]=n*F+h*y+o*f-i*C,t[2]=o*F+h*C+i*y-n*f,t[3]=h*F-i*f-n*y-o*C,t[4]=i*(F=r[7])+h*(f=r[4])+n*(C=r[6])-o*(y=r[5]),t[5]=n*F+h*y+o*f-i*C,t[6]=o*F+h*C+i*y-n*f,t[7]=h*F-i*f-n*y-o*C,t}function Ss(t,e,r,i){if(Math.abs(i)<d)return si(t,e);var n=Math.hypot(r[0],r[1],r[2]);i*=.5;var o=Math.sin(i),h=o*r[0]/n,f=o*r[1]/n,y=o*r[2]/n,C=Math.cos(i),F=e[0],j=e[1],Z=e[2],K=e[3];t[0]=F*C+K*h+j*y-Z*f,t[1]=j*C+K*f+Z*h-F*y,t[2]=Z*C+K*y+F*f-j*h,t[3]=K*C-F*h-j*f-Z*y;var q=e[4],et=e[5],J=e[6],nt=e[7];return t[4]=q*C+nt*h+et*y-J*f,t[5]=et*C+nt*f+J*h-q*y,t[6]=J*C+nt*y+q*f-et*h,t[7]=nt*C-q*h-et*f-J*y,t}function Cs(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t}function ai(t,e,r){var i=e[0],n=e[1],o=e[2],h=e[3],f=r[4],y=r[5],C=r[6],F=r[7],j=e[4],Z=e[5],K=e[6],q=e[7],et=r[0],J=r[1],nt=r[2],vt=r[3];return t[0]=i*vt+h*et+n*nt-o*J,t[1]=n*vt+h*J+o*et-i*nt,t[2]=o*vt+h*nt+i*J-n*et,t[3]=h*vt-i*et-n*J-o*nt,t[4]=i*F+h*f+n*C-o*y+j*vt+q*et+Z*nt-K*J,t[5]=n*F+h*y+o*f-i*C+Z*vt+q*J+K*et-j*nt,t[6]=o*F+h*C+i*y-n*f+K*vt+q*nt+j*J-Z*et,t[7]=h*F-i*f-n*y-o*C+q*vt-j*et-Z*J-K*nt,t}var Ps=ai;function Ls(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t}var oi=_r;function zs(t,e,r,i){var n=1-i;return oi(e,r)<0&&(i=-i),t[0]=e[0]*n+r[0]*i,t[1]=e[1]*n+r[1]*i,t[2]=e[2]*n+r[2]*i,t[3]=e[3]*n+r[3]*i,t[4]=e[4]*n+r[4]*i,t[5]=e[5]*n+r[5]*i,t[6]=e[6]*n+r[6]*i,t[7]=e[7]*n+r[7]*i,t}function As(t,e){var r=Xe(e);return t[0]=-e[0]/r,t[1]=-e[1]/r,t[2]=-e[2]/r,t[3]=e[3]/r,t[4]=-e[4]/r,t[5]=-e[5]/r,t[6]=-e[6]/r,t[7]=e[7]/r,t}function Is(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t}var hi=gr,Os=hi,Xe=xr,bs=Xe;function Rs(t,e){var r=Xe(e);if(r>0){r=Math.sqrt(r);var i=e[0]/r,n=e[1]/r,o=e[2]/r,h=e[3]/r,f=e[4],y=e[5],C=e[6],F=e[7],j=i*f+n*y+o*C+h*F;t[0]=i,t[1]=n,t[2]=o,t[3]=h,t[4]=(f-i*j)/r,t[5]=(y-n*j)/r,t[6]=(C-o*j)/r,t[7]=(F-h*j)/r}return t}function Ds(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"}function Hs(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]}function Fs(t,e){var r=t[0],i=t[1],n=t[2],o=t[3],h=t[4],f=t[5],y=t[6],C=t[7],F=e[0],j=e[1],Z=e[2],K=e[3],q=e[4],et=e[5],J=e[6],nt=e[7];return Math.abs(r-F)<=d*Math.max(1,Math.abs(r),Math.abs(F))&&Math.abs(i-j)<=d*Math.max(1,Math.abs(i),Math.abs(j))&&Math.abs(n-Z)<=d*Math.max(1,Math.abs(n),Math.abs(Z))&&Math.abs(o-K)<=d*Math.max(1,Math.abs(o),Math.abs(K))&&Math.abs(h-q)<=d*Math.max(1,Math.abs(h),Math.abs(q))&&Math.abs(f-et)<=d*Math.max(1,Math.abs(f),Math.abs(et))&&Math.abs(y-J)<=d*Math.max(1,Math.abs(y),Math.abs(J))&&Math.abs(C-nt)<=d*Math.max(1,Math.abs(C),Math.abs(nt))}function li(){var t=new x(2);return x!=Float32Array&&(t[0]=0,t[1]=0),t}function Bs(t){var e=new x(2);return e[0]=t[0],e[1]=t[1],e}function Ns(t,e){var r=new x(2);return r[0]=t,r[1]=e,r}function Vs(t,e){return t[0]=e[0],t[1]=e[1],t}function Ws(t,e,r){return t[0]=e,t[1]=r,t}function Ys(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function ci(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function vi(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function fi(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function Us(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function Xs(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function Gs(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t}function js(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t}function Ks(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function Zs(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function Qs(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t}function ui(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function di(t,e){var r=e[0]-t[0],i=e[1]-t[1];return r*r+i*i}function pi(t){return Math.hypot(t[0],t[1])}function mi(t){var e=t[0],r=t[1];return e*e+r*r}function $s(t,e){return t[0]=-e[0],t[1]=-e[1],t}function ks(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function Js(t,e){var r=e[0],i=e[1],n=r*r+i*i;return n>0&&(n=1/Math.sqrt(n)),t[0]=e[0]*n,t[1]=e[1]*n,t}function qs(t,e){return t[0]*e[0]+t[1]*e[1]}function ta(t,e,r){var i=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=i,t}function ea(t,e,r,i){var n=e[0],o=e[1];return t[0]=n+i*(r[0]-n),t[1]=o+i*(r[1]-o),t}function ra(t,e){e=e||1;var r=2*R()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t}function ia(t,e,r){var i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n,t[1]=r[1]*i+r[3]*n,t}function na(t,e,r){var i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n+r[4],t[1]=r[1]*i+r[3]*n+r[5],t}function sa(t,e,r){var i=e[0],n=e[1];return t[0]=r[0]*i+r[3]*n+r[6],t[1]=r[1]*i+r[4]*n+r[7],t}function aa(t,e,r){var i=e[0],n=e[1];return t[0]=r[0]*i+r[4]*n+r[12],t[1]=r[1]*i+r[5]*n+r[13],t}function oa(t,e,r,i){var n=e[0]-r[0],o=e[1]-r[1],h=Math.sin(i),f=Math.cos(i);return t[0]=n*f-o*h+r[0],t[1]=n*h+o*f+r[1],t}function ha(t,e){var r=t[0],i=t[1],n=e[0],o=e[1],h=Math.sqrt(r*r+i*i)*Math.sqrt(n*n+o*o);return Math.acos(Math.min(Math.max(h&&(r*n+i*o)/h,-1),1))}function la(t){return t[0]=0,t[1]=0,t}function ca(t){return"vec2("+t[0]+", "+t[1]+")"}function va(t,e){return t[0]===e[0]&&t[1]===e[1]}function fa(t,e){var r=t[0],i=t[1],n=e[0],o=e[1];return Math.abs(r-n)<=d*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-o)<=d*Math.max(1,Math.abs(i),Math.abs(o))}var ua=pi,da=ci,pa=vi,ma=fi,ya=ui,_a=di,ga=mi,xa=function(){var t=li();return function(e,r,i,n,o,h){var f,y;for(r||(r=2),i||(i=0),y=n?Math.min(n*r+i,e.length):e.length,f=i;f<y;f+=r)t[0]=e[f],t[1]=e[f+1],o(t,t,h),e[f]=t[0],e[f+1]=t[1];return e}}()},1524:(X,k,s)=>{var c;!function(A,E,p,v){"use strict";var l=["","webkit","moz","MS","ms","o"],m=E.createElement("div"),S=Math.round,_=Math.abs,d=Date.now;function x(M,I,G){return setTimeout(W(M,G),I)}function R(M,I,G){return!!Array.isArray(M)&&(z(M,G[I],G),!0)}function z(M,I,G){var tt;if(M)if(M.forEach)M.forEach(I,G);else if(M.length!==v)for(tt=0;tt<M.length;)I.call(G,M[tt],tt,M),tt++;else for(tt in M)M.hasOwnProperty(tt)&&I.call(G,M[tt],tt,M)}function Y(M,I,G){for(var tt=Object.keys(I),st=0;st<tt.length;)(!G||G&&M[tt[st]]===v)&&(M[tt[st]]=I[tt[st]]),st++;return M}function O(M,I){return Y(M,I,!0)}function u(M,I,G){var st,tt=I.prototype;(st=M.prototype=Object.create(tt)).constructor=M,st._super=tt,G&&Y(st,G)}function W(M,I){return function(){return M.apply(I,arguments)}}function H(M,I){return"function"==typeof M?M.apply(I&&I[0]||v,I):M}function P(M,I){return M===v?I:M}function w(M,I,G){z(b(I),function(tt){M.addEventListener(tt,G,!1)})}function B(M,I,G){z(b(I),function(tt){M.removeEventListener(tt,G,!1)})}function D(M,I){for(;M;){if(M==I)return!0;M=M.parentNode}return!1}function Q(M,I){return M.indexOf(I)>-1}function b(M){return M.trim().split(/\s+/g)}function U(M,I,G){if(M.indexOf&&!G)return M.indexOf(I);for(var tt=0;tt<M.length;){if(G&&M[tt][G]==I||!G&&M[tt]===I)return tt;tt++}return-1}function $(M){return Array.prototype.slice.call(M,0)}function N(M,I,G){for(var tt=[],st=[],ft=0;ft<M.length;){var gt=I?M[ft][I]:M[ft];U(st,gt)<0&&tt.push(M[ft]),st[ft]=gt,ft++}return G&&(tt=I?tt.sort(function(Ht,jt){return Ht[I]>jt[I]}):tt.sort()),tt}function a(M,I){for(var G,tt,st=I[0].toUpperCase()+I.slice(1),ft=0;ft<l.length;){if((tt=(G=l[ft])?G+st:I)in M)return tt;ft++}return v}var g=1;function T(M){var I=M.ownerDocument;return I.defaultView||I.parentWindow}var rt="ontouchstart"in A,ot=a(A,"PointerEvent")!==v,at=rt&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),ht="touch",_t="mouse",re=["x","y"],kt=["clientX","clientY"];function Dt(M,I){var G=this;this.manager=M,this.callback=I,this.element=M.element,this.target=M.options.inputTarget,this.domHandler=function(tt){H(M.options.enable,[M])&&G.handler(tt)},this.init()}function Ge(M,I,G){var tt=G.pointers.length,st=G.changedPointers.length,ft=1&I&&tt-st==0,gt=12&I&&tt-st==0;G.isFirst=!!ft,G.isFinal=!!gt,ft&&(M.session={}),G.eventType=I,function je(M,I){var G=M.session,tt=I.pointers,st=tt.length;G.firstInput||(G.firstInput=de(I)),st>1&&!G.firstMultiple?G.firstMultiple=de(I):1===st&&(G.firstMultiple=!1);var ft=G.firstInput,gt=G.firstMultiple,Rt=gt?gt.center:ft.center,Ht=I.center=Pe(tt);I.timeStamp=d(),I.deltaTime=I.timeStamp-ft.timeStamp,I.angle=pe(Rt,Ht),I.distance=he(Rt,Ht),function Ke(M,I){var G=I.center,tt=M.offsetDelta||{},st=M.prevDelta||{},ft=M.prevInput||{};(1===I.eventType||4===ft.eventType)&&(st=M.prevDelta={x:ft.deltaX||0,y:ft.deltaY||0},tt=M.offsetDelta={x:G.x,y:G.y}),I.deltaX=st.x+(G.x-tt.x),I.deltaY=st.y+(G.y-tt.y)}(G,I),I.offsetDirection=Le(I.deltaX,I.deltaY),I.scale=gt?function ze(M,I){return he(I[0],I[1],kt)/he(M[0],M[1],kt)}(gt.pointers,tt):1,I.rotation=gt?function $e(M,I){return pe(I[1],I[0],kt)-pe(M[1],M[0],kt)}(gt.pointers,tt):0,function Ze(M,I){var st,ft,gt,Rt,G=M.lastInterval||I,tt=I.timeStamp-G.timeStamp;if(8!=I.eventType&&(tt>25||G.velocity===v)){var Ht=G.deltaX-I.deltaX,jt=G.deltaY-I.deltaY,te=function Qe(M,I,G){return{x:I/M||0,y:G/M||0}}(tt,Ht,jt);ft=te.x,gt=te.y,st=_(te.x)>_(te.y)?te.x:te.y,Rt=Le(Ht,jt),M.lastInterval=I}else st=G.velocity,ft=G.velocityX,gt=G.velocityY,Rt=G.direction;I.velocity=st,I.velocityX=ft,I.velocityY=gt,I.direction=Rt}(G,I);var jt=M.element;D(I.srcEvent.target,jt)&&(jt=I.srcEvent.target),I.target=jt}(M,G),M.emit("hammer.input",G),M.recognize(G),M.session.prevInput=G}function de(M){for(var I=[],G=0;G<M.pointers.length;)I[G]={clientX:S(M.pointers[G].clientX),clientY:S(M.pointers[G].clientY)},G++;return{timeStamp:d(),pointers:I,center:Pe(I),deltaX:M.deltaX,deltaY:M.deltaY}}function Pe(M){var I=M.length;if(1===I)return{x:S(M[0].clientX),y:S(M[0].clientY)};for(var G=0,tt=0,st=0;st<I;)G+=M[st].clientX,tt+=M[st].clientY,st++;return{x:S(G/I),y:S(tt/I)}}function Le(M,I){return M===I?1:_(M)>=_(I)?M>0?2:4:I>0?8:16}function he(M,I,G){G||(G=re);var tt=I[G[0]]-M[G[0]],st=I[G[1]]-M[G[1]];return Math.sqrt(tt*tt+st*st)}function pe(M,I,G){return G||(G=re),180*Math.atan2(I[G[1]]-M[G[1]],I[G[0]]-M[G[0]])/Math.PI}Dt.prototype={handler:function(){},init:function(){this.evEl&&w(this.element,this.evEl,this.domHandler),this.evTarget&&w(this.target,this.evTarget,this.domHandler),this.evWin&&w(T(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&B(this.element,this.evEl,this.domHandler),this.evTarget&&B(this.target,this.evTarget,this.domHandler),this.evWin&&B(T(this.element),this.evWin,this.domHandler)}};var ke={mousedown:1,mousemove:2,mouseup:4},Je="mousedown",qe="mousemove mouseup";function le(){this.evEl=Je,this.evWin=qe,this.allow=!0,this.pressed=!1,Dt.apply(this,arguments)}u(le,Dt,{handler:function(I){var G=ke[I.type];1&G&&0===I.button&&(this.pressed=!0),2&G&&1!==I.which&&(G=4),this.pressed&&this.allow&&(4&G&&(this.pressed=!1),this.callback(this.manager,G,{pointers:[I],changedPointers:[I],pointerType:_t,srcEvent:I}))}});var tr={pointerdown:1,pointermove:2,pointerup:4,pointercancel:8,pointerout:8},er={2:ht,3:"pen",4:_t,5:"kinect"},Ae="pointerdown",Ie="pointermove pointerup pointercancel";function me(){this.evEl=Ae,this.evWin=Ie,Dt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}A.MSPointerEvent&&(Ae="MSPointerDown",Ie="MSPointerMove MSPointerUp MSPointerCancel"),u(me,Dt,{handler:function(I){var G=this.store,tt=!1,st=I.type.toLowerCase().replace("ms",""),ft=tr[st],gt=er[I.pointerType]||I.pointerType,Rt=gt==ht,Ht=U(G,I.pointerId,"pointerId");1&ft&&(0===I.button||Rt)?Ht<0&&(G.push(I),Ht=G.length-1):12&ft&&(tt=!0),!(Ht<0)&&(G[Ht]=I,this.callback(this.manager,ft,{pointers:G,changedPointers:[I],pointerType:gt,srcEvent:I}),tt&&G.splice(Ht,1))}});var rr={touchstart:1,touchmove:2,touchend:4,touchcancel:8},Oe="touchstart",ir="touchstart touchmove touchend touchcancel";function be(){this.evTarget=Oe,this.evWin=ir,this.started=!1,Dt.apply(this,arguments)}function nr(M,I){var G=$(M.touches),tt=$(M.changedTouches);return 12&I&&(G=N(G.concat(tt),"identifier",!0)),[G,tt]}u(be,Dt,{handler:function(I){var G=rr[I.type];if(1===G&&(this.started=!0),this.started){var tt=nr.call(this,I,G);12&G&&tt[0].length-tt[1].length==0&&(this.started=!1),this.callback(this.manager,G,{pointers:tt[0],changedPointers:tt[1],pointerType:ht,srcEvent:I})}}});var sr={touchstart:1,touchmove:2,touchend:4,touchcancel:8},ar="touchstart touchmove touchend touchcancel";function ce(){this.evTarget=ar,this.targetIds={},Dt.apply(this,arguments)}function or(M,I){var G=$(M.touches),tt=this.targetIds;if(3&I&&1===G.length)return tt[G[0].identifier]=!0,[G,G];var st,ft,gt=$(M.changedTouches),Rt=[],Ht=this.target;if(ft=G.filter(function(jt){return D(jt.target,Ht)}),1===I)for(st=0;st<ft.length;)tt[ft[st].identifier]=!0,st++;for(st=0;st<gt.length;)tt[gt[st].identifier]&&Rt.push(gt[st]),12&I&&delete tt[gt[st].identifier],st++;return Rt.length?[N(ft.concat(Rt),"identifier",!0),Rt]:void 0}function ye(){Dt.apply(this,arguments);var M=W(this.handler,this);this.touch=new ce(this.manager,M),this.mouse=new le(this.manager,M)}u(ce,Dt,{handler:function(I){var G=sr[I.type],tt=or.call(this,I,G);!tt||this.callback(this.manager,G,{pointers:tt[0],changedPointers:tt[1],pointerType:ht,srcEvent:I})}}),u(ye,Dt,{handler:function(I,G,tt){var ft=tt.pointerType==_t;if(tt.pointerType==ht)this.mouse.allow=!1;else if(ft&&!this.mouse.allow)return;12&G&&(this.mouse.allow=!0),this.callback(I,G,tt)},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Re=a(m.style,"touchAction"),De=Re!==v,He="compute",_e="manipulation",Jt="none",ie="pan-x",ne="pan-y";function ge(M,I){this.manager=M,this.set(I)}function Gt(M){this.id=function V(){return g++}(),this.manager=null,this.options=O(M||{},this.defaults),this.options.enable=P(this.options.enable,!0),this.state=1,this.simultaneous={},this.requireFail=[]}function Be(M){return 16==M?"down":8==M?"up":2==M?"left":4==M?"right":""}function fe(M,I){var G=I.manager;return G?G.get(M):M}function Yt(){Gt.apply(this,arguments)}function ae(){Yt.apply(this,arguments),this.pX=null,this.pY=null}function xe(){Yt.apply(this,arguments)}function we(){Gt.apply(this,arguments),this._timer=null,this._input=null}function Me(){Yt.apply(this,arguments)}function Ee(){Yt.apply(this,arguments)}function ue(){Gt.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function $t(M,I){return(I=I||{}).recognizers=P(I.recognizers,$t.defaults.preset),new Te(M,I)}function Te(M,I){this.options=O(I=I||{},$t.defaults),this.options.inputTarget=this.options.inputTarget||M,this.handlers={},this.session={},this.recognizers=[],this.element=M,this.input=function oe(M){return new(M.options.inputClass||(ot?me:at?ce:rt?ye:le))(M,Ge)}(this),this.touchAction=new ge(this,this.options.touchAction),Ve(this,!0),z(I.recognizers,function(G){var tt=this.add(new G[0](G[1]));G[2]&&tt.recognizeWith(G[2]),G[3]&&tt.requireFailure(G[3])},this)}function Ve(M,I){var G=M.element;z(M.options.cssProps,function(tt,st){G.style[a(G.style,st)]=I?tt:""})}ge.prototype={set:function(M){M==He&&(M=this.compute()),De&&(this.manager.element.style[Re]=M),this.actions=M.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var M=[];return z(this.manager.recognizers,function(I){H(I.options.enable,[I])&&(M=M.concat(I.getTouchAction()))}),function hr(M){if(Q(M,Jt))return Jt;var I=Q(M,ie),G=Q(M,ne);return I&&G?ie+" "+ne:I||G?I?ie:ne:Q(M,_e)?_e:"auto"}(M.join(" "))},preventDefaults:function(M){if(!De){var I=M.srcEvent,G=M.offsetDirection;if(this.manager.session.prevented)return void I.preventDefault();var tt=this.actions,st=Q(tt,Jt),ft=Q(tt,ne),gt=Q(tt,ie);if(st||ft&&6&G||gt&&24&G)return this.preventSrc(I)}},preventSrc:function(M){this.manager.session.prevented=!0,M.preventDefault()}},Gt.prototype={defaults:{},set:function(M){return Y(this.options,M),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(M){if(R(M,"recognizeWith",this))return this;var I=this.simultaneous;return I[(M=fe(M,this)).id]||(I[M.id]=M,M.recognizeWith(this)),this},dropRecognizeWith:function(M){return R(M,"dropRecognizeWith",this)||(M=fe(M,this),delete this.simultaneous[M.id]),this},requireFailure:function(M){if(R(M,"requireFailure",this))return this;var I=this.requireFail;return-1===U(I,M=fe(M,this))&&(I.push(M),M.requireFailure(this)),this},dropRequireFailure:function(M){if(R(M,"dropRequireFailure",this))return this;M=fe(M,this);var I=U(this.requireFail,M);return I>-1&&this.requireFail.splice(I,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(M){return!!this.simultaneous[M.id]},emit:function(M){var I=this,G=this.state;function tt(st){I.manager.emit(I.options.event+(st?function lr(M){return 16&M?"cancel":8&M?"end":4&M?"move":2&M?"start":""}(G):""),M)}G<8&&tt(!0),tt(),G>=8&&tt(!0)},tryEmit:function(M){if(this.canEmit())return this.emit(M);this.state=32},canEmit:function(){for(var M=0;M<this.requireFail.length;){if(!(33&this.requireFail[M].state))return!1;M++}return!0},recognize:function(M){var I=Y({},M);if(!H(this.options.enable,[this,I]))return this.reset(),void(this.state=32);56&this.state&&(this.state=1),this.state=this.process(I),30&this.state&&this.tryEmit(I)},process:function(M){},getTouchAction:function(){},reset:function(){}},u(Yt,Gt,{defaults:{pointers:1},attrTest:function(M){var I=this.options.pointers;return 0===I||M.pointers.length===I},process:function(M){var I=this.state,G=M.eventType,tt=6&I,st=this.attrTest(M);return tt&&(8&G||!st)?16|I:tt||st?4&G?8|I:2&I?4|I:2:32}}),u(ae,Yt,{defaults:{event:"pan",threshold:10,pointers:1,direction:30},getTouchAction:function(){var M=this.options.direction,I=[];return 6&M&&I.push(ne),24&M&&I.push(ie),I},directionTest:function(M){var I=this.options,G=!0,tt=M.distance,st=M.direction,ft=M.deltaX,gt=M.deltaY;return st&I.direction||(6&I.direction?(st=0===ft?1:ft<0?2:4,G=ft!=this.pX,tt=Math.abs(M.deltaX)):(st=0===gt?1:gt<0?8:16,G=gt!=this.pY,tt=Math.abs(M.deltaY))),M.direction=st,G&&tt>I.threshold&&st&I.direction},attrTest:function(M){return Yt.prototype.attrTest.call(this,M)&&(2&this.state||!(2&this.state)&&this.directionTest(M))},emit:function(M){this.pX=M.deltaX,this.pY=M.deltaY;var I=Be(M.direction);I&&this.manager.emit(this.options.event+I,M),this._super.emit.call(this,M)}}),u(xe,Yt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Jt]},attrTest:function(M){return this._super.attrTest.call(this,M)&&(Math.abs(M.scale-1)>this.options.threshold||2&this.state)},emit:function(M){this._super.emit.call(this,M),1!==M.scale&&this.manager.emit(this.options.event+(M.scale<1?"in":"out"),M)}}),u(we,Gt,{defaults:{event:"press",pointers:1,time:500,threshold:5},getTouchAction:function(){return["auto"]},process:function(M){var I=this.options,G=M.pointers.length===I.pointers,tt=M.distance<I.threshold,st=M.deltaTime>I.time;if(this._input=M,!tt||!G||12&M.eventType&&!st)this.reset();else if(1&M.eventType)this.reset(),this._timer=x(function(){this.state=8,this.tryEmit()},I.time,this);else if(4&M.eventType)return 8;return 32},reset:function(){clearTimeout(this._timer)},emit:function(M){8===this.state&&(M&&4&M.eventType?this.manager.emit(this.options.event+"up",M):(this._input.timeStamp=d(),this.manager.emit(this.options.event,this._input)))}}),u(Me,Yt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Jt]},attrTest:function(M){return this._super.attrTest.call(this,M)&&(Math.abs(M.rotation)>this.options.threshold||2&this.state)}}),u(Ee,Yt,{defaults:{event:"swipe",threshold:10,velocity:.65,direction:30,pointers:1},getTouchAction:function(){return ae.prototype.getTouchAction.call(this)},attrTest:function(M){var G,I=this.options.direction;return 30&I?G=M.velocity:6&I?G=M.velocityX:24&I&&(G=M.velocityY),this._super.attrTest.call(this,M)&&I&M.direction&&M.distance>this.options.threshold&&_(G)>this.options.velocity&&4&M.eventType},emit:function(M){var I=Be(M.direction);I&&this.manager.emit(this.options.event+I,M),this.manager.emit(this.options.event,M)}}),u(ue,Gt,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:2,posThreshold:10},getTouchAction:function(){return[_e]},process:function(M){var I=this.options,G=M.pointers.length===I.pointers,tt=M.distance<I.threshold,st=M.deltaTime<I.time;if(this.reset(),1&M.eventType&&0===this.count)return this.failTimeout();if(tt&&st&&G){if(4!=M.eventType)return this.failTimeout();var ft=!this.pTime||M.timeStamp-this.pTime<I.interval,gt=!this.pCenter||he(this.pCenter,M.center)<I.posThreshold;if(this.pTime=M.timeStamp,this.pCenter=M.center,gt&&ft?this.count+=1:this.count=1,this._input=M,0==this.count%I.taps)return this.hasRequireFailures()?(this._timer=x(function(){this.state=8,this.tryEmit()},I.interval,this),2):8}return 32},failTimeout:function(){return this._timer=x(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),$t.VERSION="2.0.4",$t.defaults={domEvents:!1,touchAction:He,enable:!0,inputTarget:null,inputClass:null,preset:[[Me,{enable:!1}],[xe,{enable:!1},["rotate"]],[Ee,{direction:6}],[ae,{direction:6},["swipe"]],[ue],[ue,{event:"doubletap",taps:2},["tap"]],[we]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},Te.prototype={set:function(M){return Y(this.options,M),M.touchAction&&this.touchAction.update(),M.inputTarget&&(this.input.destroy(),this.input.target=M.inputTarget,this.input.init()),this},stop:function(M){this.session.stopped=M?2:1},recognize:function(M){var I=this.session;if(!I.stopped){this.touchAction.preventDefaults(M);var G,tt=this.recognizers,st=I.curRecognizer;(!st||st&&8&st.state)&&(st=I.curRecognizer=null);for(var ft=0;ft<tt.length;)G=tt[ft],2===I.stopped||st&&G!=st&&!G.canRecognizeWith(st)?G.reset():G.recognize(M),!st&&14&G.state&&(st=I.curRecognizer=G),ft++}},get:function(M){if(M instanceof Gt)return M;for(var I=this.recognizers,G=0;G<I.length;G++)if(I[G].options.event==M)return I[G];return null},add:function(M){if(R(M,"add",this))return this;var I=this.get(M.options.event);return I&&this.remove(I),this.recognizers.push(M),M.manager=this,this.touchAction.update(),M},remove:function(M){if(R(M,"remove",this))return this;var I=this.recognizers;return M=this.get(M),I.splice(U(I,M),1),this.touchAction.update(),this},on:function(M,I){var G=this.handlers;return z(b(M),function(tt){G[tt]=G[tt]||[],G[tt].push(I)}),this},off:function(M,I){var G=this.handlers;return z(b(M),function(tt){I?G[tt].splice(U(G[tt],I),1):delete G[tt]}),this},emit:function(M,I){this.options.domEvents&&function vr(M,I){var G=E.createEvent("Event");G.initEvent(M,!0,!0),G.gesture=I,I.target.dispatchEvent(G)}(M,I);var G=this.handlers[M]&&this.handlers[M].slice();if(G&&G.length){I.type=M,I.preventDefault=function(){I.srcEvent.preventDefault()};for(var tt=0;tt<G.length;)G[tt](I),tt++}},destroy:function(){this.element&&Ve(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},Y($t,{INPUT_START:1,INPUT_MOVE:2,INPUT_END:4,INPUT_CANCEL:8,STATE_POSSIBLE:1,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:32,DIRECTION_NONE:1,DIRECTION_LEFT:2,DIRECTION_RIGHT:4,DIRECTION_UP:8,DIRECTION_DOWN:16,DIRECTION_HORIZONTAL:6,DIRECTION_VERTICAL:24,DIRECTION_ALL:30,Manager:Te,Input:Dt,TouchAction:ge,TouchInput:ce,MouseInput:le,PointerEventInput:me,TouchMouseInput:ye,SingleTouchInput:be,Recognizer:Gt,AttrRecognizer:Yt,Tap:ue,Pan:ae,Swipe:Ee,Pinch:xe,Rotate:Me,Press:we,on:w,off:B,each:z,merge:O,extend:Y,inherit:u,bindFn:W,prefixed:a}),s.amdO?(c=function(){return $t}.call(k,s,k,X))!==v&&(X.exports=c):X.exports?X.exports=$t:A.Hammer=$t}(window,document)},195:(X,k,s)=>{"use strict";var c=s(8843),A=s(6873);function E(p,v,l){var m=this;l=l||{},m._source=p,m._stage=v,m._asset=null,m._texture=null,v.loadImage(p,null,function(L,S){L||v.createTexture(null,S,function(_,d,x,R){_||(m._asset=x,m._texture=R)})})}c(E),E.prototype.destroy=function(){var p=this._asset,v=this._texture;p&&p.destroy(),v&&v.destroy(),A(this)},E.prototype.stage=function(){return this._stage},E.prototype.source=function(){return this._source},E.prototype.asset=function(){return this._asset},E.prototype.texture=function(){return this._texture},X.exports=E},2513:(X,k,s)=>{"use strict";var c=s(8843),A=s(4576),E=s(1936).setTransform,p=s(6873);function v(l,m,L,S,_){(_=_||{}).perspective=_.perspective||{},_.perspective.extraTransforms=null!=_.perspective.extraTransforms?_.perspective.extraTransforms:"",this._domElement=l,this._parentDomElement=m,this._view=L,this._coords={},this._perspective={},this.setPosition(S),this._parentDomElement.appendChild(this._domElement),this.setPerspective(_.perspective),this._visible=!0,this._position={x:0,y:0}}c(v),v.prototype.destroy=function(){this._parentDomElement.removeChild(this._domElement),p(this)},v.prototype.domElement=function(){return this._domElement},v.prototype.position=function(){return this._coords},v.prototype.setPosition=function(l){for(var m in l)this._coords[m]=l[m];this._update()},v.prototype.perspective=function(){return this._perspective},v.prototype.setPerspective=function(l){for(var m in l)this._perspective[m]=l[m];this._update()},v.prototype.show=function(){this._visible||(this._visible=!0,this._update())},v.prototype.hide=function(){this._visible&&(this._visible=!1,this._update())},v.prototype._update=function(){var S,_,l=this._domElement,m=this._coords,L=this._position,d=!1;if(this._visible){var x=this._view;this._perspective.radius?(d=!0,this._setEmbeddedPosition(x,m)):(x.coordinatesToScreen(m,L),_=L.y,null!=(S=L.x)&&null!=_&&(d=!0,this._setPosition(S,_)))}d?(l.style.display="block",l.style.position="absolute"):(l.style.display="none",l.style.position="")},v.prototype._setEmbeddedPosition=function(l,m){var L=l.coordinatesToPerspectiveTransform(m,this._perspective.radius,this._perspective.extraTransforms);E(this._domElement,L)},v.prototype._setPosition=function(l,m){A(this._domElement,l,m,this._perspective.extraTransforms)},X.exports=v},2523:(X,k,s)=>{"use strict";var c=s(8843),A=s(2513),E=s(1045),p=s(4576),v=s(1936).setAbsolute,l=s(1936).setOverflowHidden,m=s(1936).setOverflowVisible,L=s(1936).setNullSize,S=s(1936).setPixelSize,_=s(1936).setWithVendorPrefix("pointer-events"),d=s(6873);function x(R,z,Y,O,u){u=u||{},this._parentDomElement=R,this._stage=z,this._view=Y,this._renderLoop=O,this._hotspots=[],this._visible=!0,this._rect=u.rect,this._visibilityOrRectChanged=!0,this._stageWidth=null,this._stageHeight=null,this._tmpRect={},this._hotspotContainerWrapper=document.createElement("div"),v(this._hotspotContainerWrapper),_(this._hotspotContainerWrapper,"none"),this._parentDomElement.appendChild(this._hotspotContainerWrapper),this._hotspotContainer=document.createElement("div"),v(this._hotspotContainer),_(this._hotspotContainer,"all"),this._hotspotContainerWrapper.appendChild(this._hotspotContainer),this._updateHandler=this._update.bind(this),this._renderLoop.addEventListener("afterRender",this._updateHandler)}c(x),x.prototype.destroy=function(){for(;this._hotspots.length;)this.destroyHotspot(this._hotspots[0]);this._parentDomElement.removeChild(this._hotspotContainerWrapper),this._renderLoop.removeEventListener("afterRender",this._updateHandler),d(this)},x.prototype.domElement=function(){return this._hotspotContainer},x.prototype.setRect=function(R){this._rect=R,this._visibilityOrRectChanged=!0},x.prototype.rect=function(){return this._rect},x.prototype.createHotspot=function(R,z,Y){var O=new A(R,this._hotspotContainer,this._view,z=z||{},Y);return this._hotspots.push(O),O._update(),this.emit("hotspotsChange"),O},x.prototype.hasHotspot=function(R){return this._hotspots.indexOf(R)>=0},x.prototype.listHotspots=function(){return[].concat(this._hotspots)},x.prototype.destroyHotspot=function(R){var z=this._hotspots.indexOf(R);if(z<0)throw new Error("No such hotspot");this._hotspots.splice(z,1),R.destroy(),this.emit("hotspotsChange")},x.prototype.hide=function(){this._visible&&(this._visible=!1,this._visibilityOrRectChanged=!0,this._update())},x.prototype.show=function(){this._visible||(this._visible=!0,this._visibilityOrRectChanged=!0,this._update())},x.prototype._update=function(){var R=this._hotspotContainerWrapper,z=this._stage.width(),Y=this._stage.height(),O=this._tmpRect;if(this._visibilityOrRectChanged||this._rect&&(z!==this._stageWidth||Y!==this._stageHeight)){var u=this._visible;R.style.display=u?"block":"none",u&&(this._rect?(E(z,Y,this._rect,O),p(R,z*O.x,Y*O.y),S(R,z*O.width,Y*O.height),l(R)):(p(R,0,0),L(R),m(R))),this._stageWidth=z,this._stageHeight=Y,this._visibilityOrRectChanged=!1}for(var W=0;W<this._hotspots.length;W++)this._hotspots[W]._update()},X.exports=x},3268:(X,k,s)=>{"use strict";var c=s(8843),A=s(2544),E=s(6873);function p(v,l,m,L,S,_,d){d=d||{};var x=this;this._source=v,this._geometry=l,this._depthmap=m,this._view=L,this._textureStore=S,this._depthmapStore=_,this._effects=d.effects||{},this._fixedLevelIndex=null,this._viewChangeHandler=function(){x.emit("viewChange",x.view())},this._view.addEventListener("change",this._viewChangeHandler),this._textureStoreChangeHandler=function(){x.emit("textureStoreChange",x.textureStore())},this._textureStore.addEventListener("textureLoad",this._textureStoreChangeHandler),this._textureStore.addEventListener("textureError",this._textureStoreChangeHandler),this._textureStore.addEventListener("textureInvalid",this._textureStoreChangeHandler)}c(p),p.prototype.destroy=function(){this._view.removeEventListener("change",this._viewChangeHandler),this._textureStore.removeEventListener("textureLoad",this._textureStoreChangeHandler),this._textureStore.removeEventListener("textureError",this._textureStoreChangeHandler),this._textureStore.removeEventListener("textureInvalid",this._textureStoreChangeHandler),E(this)},p.prototype.source=function(){return this._source},p.prototype.depthmap=function(){return this._depthmap},p.prototype.geometry=function(){return this._geometry},p.prototype.view=function(){return this._view},p.prototype.textureStore=function(){return this._textureStore},p.prototype.depthmapStore=function(){return this._depthmapStore},p.prototype.effects=function(){return this._effects},p.prototype.setEffects=function(v){this._effects=v,this.emit("effectsChange",this._effects)},p.prototype.mergeEffects=function(v){A(this._effects,v),this.emit("effectsChange",this._effects)},p.prototype.fixedLevel=function(){return this._fixedLevelIndex},p.prototype.setFixedLevel=function(v){if(v!==this._fixedLevelIndex){if(null!=v&&(v>=this._geometry.levelList.length||v<0))throw new Error("Level index out of range: "+v);this._fixedLevelIndex=v,this.emit("fixedLevelChange",this._fixedLevelIndex)}},p.prototype._selectLevel=function(){return null!=this._fixedLevelIndex?this._geometry.levelList[this._fixedLevelIndex]:this._view.selectLevel(this._geometry.selectableLevelList)},p.prototype.visibleTiles=function(v){var l=this._selectLevel();return this._geometry.visibleTiles(this._view,l,v)},p.prototype.pinLevel=function(v){for(var m=this._geometry.levelTiles(this._geometry.levelList[v]),L=0;L<m.length;L++)this._textureStore.pin(m[L])},p.prototype.unpinLevel=function(v){for(var m=this._geometry.levelTiles(this._geometry.levelList[v]),L=0;L<m.length;L++)this._textureStore.unpin(m[L])},p.prototype.pinFirstLevel=function(){return this.pinLevel(0)},p.prototype.unpinFirstLevel=function(){return this.unpinLevel(0)},X.exports=p},1608:(X,k,s)=>{"use strict";function A(E){this.constructor.super_.apply(this,arguments),this.message=E}s(5946)(A,Error),X.exports=A},3340:(X,k,s)=>{"use strict";var c=s(8843),A=s(6873);function E(p){var v=this;this._stage=p,this._running=!1,this._rendering=!1,this._requestHandle=null,this._boundLoop=this._loop.bind(this),this._renderInvalidHandler=function(){v._rendering||v.renderOnNextFrame()},this._stage.addEventListener("renderInvalid",this._renderInvalidHandler)}c(E),E.prototype.destroy=function(){this.stop(),this._stage.removeEventListener("renderInvalid",this._renderInvalidHandler),A(this)},E.prototype.stage=function(){return this._stage},E.prototype.start=function(){this._running=!0,this.renderOnNextFrame()},E.prototype.stop=function(){this._requestHandle&&(window.cancelAnimationFrame(this._requestHandle),this._requestHandle=null),this._running=!1},E.prototype.renderOnNextFrame=function(){this._running&&!this._requestHandle&&(this._requestHandle=window.requestAnimationFrame(this._boundLoop))},E.prototype._loop=function(){if(!this._running)throw new Error("Render loop running while in stopped state");this._requestHandle=null,this._rendering=!0,this.emit("beforeRender"),this._rendering=!1,this._stage.render(),this.emit("afterRender")},X.exports=E},8393:(X,k,s)=>{"use strict";var c=s(3268),A=s(522),E=s(195),p=s(2523),v=s(8843),l=s(242),m=s(6158),L=s(4699),S=s(7802),_=s(6873);function d(x,R){this._viewer=x,this._view=R,this._layers=[],this._hotspotContainer=new p(x._controlContainer,x.stage(),this._view,x.renderLoop()),this._movement=null,this._movementStartTime=null,this._movementStep=null,this._movementParams=null,this._movementCallback=null,this._updateMovementHandler=this._updateMovement.bind(this),this._updateHotspotContainerHandler=this._updateHotspotContainer.bind(this),this._viewer.addEventListener("sceneChange",this._updateHotspotContainerHandler),this._viewChangeHandler=this.emit.bind(this,"viewChange"),this._view.addEventListener("change",this._viewChangeHandler),this._updateHotspotContainer()}v(d),d.prototype.destroy=function(){this._view.removeEventListener("change",this._viewChangeHandler),this._viewer.removeEventListener("sceneChange",this._updateHotspotContainerHandler),this._movement&&this.stopMovement(),this._hotspotContainer.destroy(),this.destroyAllLayers(),_(this)},d.prototype.hotspotContainer=function(){return this._hotspotContainer},d.prototype.layer=function(){return this._layers[0]},d.prototype.listLayers=function(){return[].concat(this._layers)},d.prototype.view=function(){return this._view},d.prototype.viewer=function(){return this._viewer},d.prototype.visible=function(){return this._viewer.scene()===this},d.prototype.createLayer=function(x){var R=(x=x||{}).textureStoreOpts||{},z=x.depthmapStoreOpts||{},Y=x.layerOpts||{},O=x.source,u=x.geometry,W=x.depthmap,H=this._view,P=this._viewer.stage(),w=new A(O,P,R),B=W&&new E(W,P,z),D=new c(O,u,W,H,w,B,Y);return this._layers.push(D),x.pinFirstLevel&&D.pinFirstLevel(),this.emit("layerChange"),D},d.prototype.destroyLayer=function(x){var R=this._layers.indexOf(x);if(R<0)throw new Error("No such layer in scene");this._layers.splice(R,1),this.emit("layerChange"),x.textureStore().destroy(),x.destroy()},d.prototype.destroyAllLayers=function(){for(;this._layers.length>0;)this.destroyLayer(this._layers[0])},d.prototype.switchTo=function(x,R){return this._viewer.switchScene(this,x,R)},d.prototype.lookTo=function(x,R,z){var Y=this;if(R=R||{},z=z||m,"object"!==L(x))throw new Error("Target view parameters must be an object");var u=null!=R.ease?R.ease:function(U){return(U*=2)<1?.5*U*U:-.5*(--U*(U-2)-1)},W=null!=R.controlsInterrupt&&R.controlsInterrupt,H=null!=R.transitionDuration?R.transitionDuration:1e3,P=null==R.shortest||R.shortest,w=this._view,B=w.parameters(),D={};S(D,x),S(D,B),P&&w.normalizeToClosest&&w.normalizeToClosest(D,D);var b=this._viewer.controls().enabled();W||this._viewer.controls().disable(),this.startMovement(function(){var U=!1;return function($,N){if(N>=H&&U)return null;var a=Math.min(N/H,1);for(var g in $){var V=B[g],T=D[g];$[g]=V+u(a)*(T-V)}return U=N>=H,$}},function(){b&&Y._viewer.controls().enable(),z()})},d.prototype.startMovement=function(x,R){var z=this._viewer.renderLoop();this._movement&&this.stopMovement();var Y=x();if("function"!=typeof Y)throw new Error("Bad movement");this._movement=x,this._movementStep=Y,this._movementStartTime=l(),this._movementParams={},this._movementCallback=R,z.addEventListener("beforeRender",this._updateMovementHandler),z.renderOnNextFrame()},d.prototype.stopMovement=function(){var x=this._movementCallback,R=this._viewer.renderLoop();!this._movement||(this._movement=null,this._movementStep=null,this._movementStartTime=null,this._movementParams=null,this._movementCallback=null,R.removeEventListener("beforeRender",this._updateMovementHandler),x&&x())},d.prototype.movement=function(){return this._movement},d.prototype._updateMovement=function(){if(!this._movement)throw new Error("Should not call update");var x=this._viewer.renderLoop(),R=this._view,z=l()-this._movementStartTime,O=this._movementParams;null==(O=(0,this._movementStep)(O=R.parameters(O),z))?this.stopMovement():(R.setParameters(O),x.renderOnNextFrame())},d.prototype._updateHotspotContainer=function(){this.visible()?this._hotspotContainer.show():this._hotspotContainer.hide()},X.exports=d},522:(X,k,s)=>{"use strict";var c=s(5242),A=s(1114),E=s(47),p=s(8843),v=s(7802),l=s(1687),m=s(3559),L=s(5946),S=s(6873),_=typeof MARZIPANODEBUG<"u"&&MARZIPANODEBUG.textureStore,x={previouslyVisibleCacheSize:512},R=0;function z(){}function Y(u,W){var H=this,P=R++;H._id=P,H._store=u,H._tile=W,H._asset=null,H._texture=null,H._changeHandler=function(){u.emit("textureInvalid",W)};var w=u.source(),B=u.stage(),D=w.loadAsset.bind(w),Q=B.createTexture.bind(B),b=m(l(D),Q);u.emit("textureStartLoad",W),_&&console.log("loading",P,W),H._cancel=b(B,W,function(U,$,N,a){if(H._cancel=null,U)return N&&N.destroy(),a&&a.destroy(),void(U instanceof z?(u.emit("textureCancel",W),_&&console.log("cancel",P,W)):(u.emit("textureError",W,U),_&&console.log("error",P,W)));H._texture=a,N.isDynamic()?(H._asset=N,N.addEventListener("change",H._changeHandler)):N.destroy(),u.emit("textureLoad",W),_&&console.log("load",P,W)})}function O(u,W,H){H=v(H||{},x),this._source=u,this._stage=W,this._state=0,this._delimCount=0,this._itemMap=new c,this._visible=new A,this._previouslyVisible=new E(H.previouslyVisibleCacheSize),this._pinMap=new c,this._newVisible=new A,this._noLongerVisible=[],this._visibleAgain=[],this._evicted=[]}L(z,Error),Y.prototype.asset=function(){return this._asset},Y.prototype.texture=function(){return this._texture},Y.prototype.destroy=function(){var u=this._id,W=this._store,H=this._tile,P=this._asset,w=this._texture,B=this._cancel;B?B(new z("Texture load cancelled")):(P&&(P.removeEventListener("change",this._changeHandler),P.destroy()),w&&w.destroy(),W.emit("textureUnload",H),_&&console.log("unload",u,H),S(this))},p(Y),p(O),O.prototype.destroy=function(){this.clear(),S(this)},O.prototype.stage=function(){return this._stage},O.prototype.source=function(){return this._source},O.prototype.clear=function(){var u=this;u._evicted.length=0,u._itemMap.forEach(function(W){u._evicted.push(W)}),u._evicted.forEach(function(W){u._unloadTile(W)}),u._itemMap.clear(),u._visible.clear(),u._previouslyVisible.clear(),u._pinMap.clear(),u._newVisible.clear(),u._noLongerVisible.length=0,u._visibleAgain.length=0,u._evicted.length=0},O.prototype.clearNotPinned=function(){var u=this;u._evicted.length=0,u._itemMap.forEach(function(W){u._pinMap.has(W)||u._evicted.push(W)}),u._evicted.forEach(function(W){u._unloadTile(W)}),u._visible.clear(),u._previouslyVisible.clear(),u._evicted.length=0},O.prototype.startFrame=function(){if(0!==this._state&&1!==this._state)throw new Error("TextureStore: startFrame called out of sequence");this._state=1,this._delimCount++},O.prototype.markTile=function(u){if(1!==this._state&&2!==this._state)throw new Error("TextureStore: markTile called out of sequence");this._state=2;var W=this._itemMap.get(u),H=W&&W.texture(),P=W&&W.asset();H&&P&&H.refresh(u,P),this._newVisible.add(u)},O.prototype.endFrame=function(){if(1!==this._state&&2!==this._state&&3!==this._state)throw new Error("TextureStore: endFrame called out of sequence");this._state=3,this._delimCount--,this._delimCount||(this._update(),this._state=0)},O.prototype._update=function(){var u=this;u._noLongerVisible.length=0,u._visible.forEach(function(H){u._newVisible.has(H)||u._noLongerVisible.push(H)}),u._visibleAgain.length=0,u._newVisible.forEach(function(H){u._previouslyVisible.has(H)&&u._visibleAgain.push(H)}),u._visibleAgain.forEach(function(H){u._previouslyVisible.remove(H)}),u._evicted.length=0,u._noLongerVisible.forEach(function(H){var P=u._itemMap.get(H);if(P&&P.texture()){var B=u._previouslyVisible.add(H);null!=B&&u._evicted.push(B)}else P&&u._unloadTile(H)}),u._evicted.forEach(function(H){u._pinMap.has(H)||u._unloadTile(H)}),u._newVisible.forEach(function(H){u._itemMap.get(H)||u._loadTile(H)});var W=u._visible;u._visible=u._newVisible,u._newVisible=W,u._newVisible.clear(),u._noLongerVisible.length=0,u._visibleAgain.length=0,u._evicted.length=0},O.prototype._loadTile=function(u){if(this._itemMap.has(u))throw new Error("TextureStore: loading texture already in cache");var W=new Y(this,u);this._itemMap.set(u,W)},O.prototype._unloadTile=function(u){var W=this._itemMap.del(u);if(!W)throw new Error("TextureStore: unloading texture not in cache");W.destroy()},O.prototype.asset=function(u){var W=this._itemMap.get(u);return W?W.asset():null},O.prototype.texture=function(u){var W=this._itemMap.get(u);return W?W.texture():null},O.prototype.pin=function(u){var W=(this._pinMap.get(u)||0)+1;return this._pinMap.set(u,W),this._itemMap.has(u)||this._loadTile(u),W},O.prototype.unpin=function(u){var W=this._pinMap.get(u);if(!W)throw new Error("TextureStore: unpin when not pinned");return--W>0?this._pinMap.set(u,W):(this._pinMap.del(u),!this._visible.has(u)&&!this._previouslyVisible.has(u)&&this._unloadTile(u)),W},O.prototype.query=function(u){var W=this._itemMap.get(u),H=this._pinMap.get(u)||0;return{visible:this._visible.has(u),previouslyVisible:this._previouslyVisible.has(u),hasAsset:null!=W&&null!=W.asset(),hasTexture:null!=W&&null!=W.texture(),pinned:0!==H,pinCount:H}},X.exports=O},9799:(X,k,s)=>{"use strict";var c=s(1114);function A(){this._stack=[],this._visited=new c,this._vertices=null}A.prototype.search=function(E,p,v){var l=this._stack,m=this._visited,L=this._vertices,S=0;for(this._clear(),l.push(p);l.length>0;){var _=l.pop();if(!m.has(_)&&E.intersects(_.vertices(L))){m.add(_);for(var d=_.neighbors(),x=0;x<d.length;x++)l.push(d[x]);v.push(_),S++}}return this._vertices=L,this._clear(),S},A.prototype._clear=function(){this._stack.length=0,this._visited.clear()},X.exports=A},6613:(X,k,s)=>{"use strict";var c=s(8843),A=s(7802),E=s(242),p={duration:1/0};function v(l){l=A(l||{},p),this._duration=l.duration,this._startTime=null,this._handle=null,this._check=this._check.bind(this)}c(v),v.prototype.start=function(){this._startTime=E(),null==this._handle&&this._duration<1/0&&this._setup(this._duration)},v.prototype.started=function(){return null!=this._startTime},v.prototype.stop=function(){this._startTime=null,null!=this._handle&&(clearTimeout(this._handle),this._handle=null)},v.prototype._setup=function(l){this._handle=setTimeout(this._check,l)},v.prototype._teardown=function(){clearTimeout(this._handle),this._handle=null},v.prototype._check=function(){var l=E(),L=this._duration-(l-this._startTime);this._teardown(),L<=0?(this.emit("timeout"),this._startTime=null):L<1/0&&this._setup(L)},v.prototype.duration=function(){return this._duration},v.prototype.setDuration=function(l){this._duration=l,null!=this._startTime&&this._check()},X.exports=v},2025:(X,k,s)=>{"use strict";var c=s(8843),A=s(3340),E=s(7708),p=s(8393),v=s(6613),l=s(5),m=s(444),L=s(7516),S=s(9512),_=s(133),d=s(1936).setOverflowHidden,x=s(1936).setAbsolute,R=s(1936).setFullSize,z=s(58),Y=s(6158),O=s(6873);function u(P,w){w=w||{},this._domElement=P,d(P),this._stage=new l(w.stage),_(this._stage),this._domElement.appendChild(this._stage.domElement()),this._controlContainer=document.createElement("div"),x(this._controlContainer),R(this._controlContainer),P.appendChild(this._controlContainer),this._size={},this.updateSize(),this._updateSizeListener=this.updateSize.bind(this),window.addEventListener("resize",this._updateSizeListener),this._renderLoop=new A(this._stage),this._controls=new E,this._controlMethods=S(this._controls,this._controlContainer,w.controls),this._controls.attach(this._renderLoop),this._hammerManagerTouch=L.get(this._controlContainer,"touch"),this._hammerManagerMouse=L.get(this._controlContainer,"mouse"),this._dragCursor=new m(this._controls,"mouseViewDrag",P,w.cursors&&w.cursors.drag||{}),this._renderLoop.start(),this._scenes=[],this._currentScene=null,this._replacedScene=null,this._cancelCurrentTween=null,this._layerChangeHandler=this._updateSceneLayers.bind(this),this._viewChangeHandler=this.emit.bind(this,"viewChange"),this._idleTimer=new v,this._idleTimer.start(),this._resetIdleTimerHandler=this._resetIdleTimer.bind(this),this.addEventListener("viewChange",this._resetIdleTimerHandler),this._triggerIdleTimerHandler=this._triggerIdleTimer.bind(this),this._idleTimer.addEventListener("timeout",this._triggerIdleTimerHandler),this._stopMovementHandler=this.stopMovement.bind(this),this._controls.addEventListener("active",this._stopMovementHandler),this.addEventListener("sceneChange",this._stopMovementHandler),this._idleMovement=null}function H(P,w,B){w.listLayers().forEach(function(Q){Q.mergeEffects({opacity:P})}),w._hotspotContainer.domElement().style.opacity=P}c(u),u.prototype.destroy=function(){for(var P in window.removeEventListener("resize",this._updateSizeListener),this._currentScene&&this._removeSceneEventListeners(this._currentScene),this._replacedScene&&this._removeSceneEventListeners(this._replacedScene),this._dragCursor.destroy(),this._controlMethods)this._controlMethods[P].destroy();for(;this._scenes.length;)this.destroyScene(this._scenes[0]);this._domElement.removeChild(this._stage.domElement()),this._stage.destroy(),this._renderLoop.destroy(),this._controls.destroy(),this._controls=null,this._cancelCurrentTween&&this._cancelCurrentTween(),O(this)},u.prototype.updateSize=function(){var P=this._size;P.width=this._domElement.clientWidth,P.height=this._domElement.clientHeight,this._stage.setSize(P)},u.prototype.stage=function(){return this._stage},u.prototype.renderLoop=function(){return this._renderLoop},u.prototype.controls=function(){return this._controls},u.prototype.domElement=function(){return this._domElement},u.prototype.createScene=function(P){var w=this.createEmptyScene({view:(P=P||{}).view});return w.createLayer({source:P.source,geometry:P.geometry,depthmap:P.depthmap,pinFirstLevel:P.pinFirstLevel,textureStoreOpts:P.textureStoreOpts,layerOpts:P.layerOpts}),w},u.prototype.createEmptyScene=function(P){var w=new p(this,(P=P||{}).view);return this._scenes.push(w),w},u.prototype._updateSceneLayers=function(){var P,w,D=this._currentScene,Q=this._replacedScene,b=this._stage.listLayers(),U=[];if(Q&&(U=U.concat(Q.listLayers())),D&&(U=U.concat(D.listLayers())),1!==Math.abs(b.length-U.length))throw new Error("Stage and scene out of sync");if(U.length<b.length)for(P=0;P<b.length;P++)if(U.indexOf(w=b[P])<0){this._removeLayerFromStage(w);break}if(U.length>b.length)for(P=0;P<U.length;P++)b.indexOf(w=U[P])<0&&this._addLayerToStage(w,P)},u.prototype._addLayerToStage=function(P,w){P.pinFirstLevel(),this._stage.addLayer(P,w)},u.prototype._removeLayerFromStage=function(P){this._stage.removeLayer(P),P.unpinFirstLevel(),P.textureStore().clearNotPinned()},u.prototype._addSceneEventListeners=function(P){P.addEventListener("layerChange",this._layerChangeHandler),P.addEventListener("viewChange",this._viewChangeHandler)},u.prototype._removeSceneEventListeners=function(P){P.removeEventListener("layerChange",this._layerChangeHandler),P.removeEventListener("viewChange",this._viewChangeHandler)},u.prototype.destroyScene=function(P){var B,D,w=this._scenes.indexOf(P);if(w<0)throw new Error("No such scene in viewer");if(this._currentScene===P){for(this._removeSceneEventListeners(P),D=P.listLayers(),B=0;B<D.length;B++)this._removeLayerFromStage(D[B]);this._cancelCurrentTween&&(this._cancelCurrentTween(),this._cancelCurrentTween=null),this._currentScene=null,this.emit("sceneChange")}if(this._replacedScene===P){for(this._removeSceneEventListeners(P),D=P.listLayers(),B=0;B<D.length;B++)this._removeLayerFromStage(D[B]);this._replacedScene=null}this._scenes.splice(w,1),P.destroy()},u.prototype.destroyAllScenes=function(){for(;this._scenes.length>0;)this.destroyScene(this._scenes[0])},u.prototype.hasScene=function(P){return this._scenes.indexOf(P)>=0},u.prototype.listScenes=function(){return[].concat(this._scenes)},u.prototype.scene=function(){return this._currentScene},u.prototype.view=function(){var P=this._currentScene;return P?P.view():null},u.prototype.lookTo=function(P,w,B){var D=this._currentScene;D&&D.lookTo(P,w,B)},u.prototype.startMovement=function(P,w){var B=this._currentScene;!B||B.startMovement(P,w)},u.prototype.stopMovement=function(){var P=this._currentScene;!P||P.stopMovement()},u.prototype.movement=function(){var P=this._currentScene;if(P)return P.movement()},u.prototype.setIdleMovement=function(P,w){this._idleTimer.setDuration(P),this._idleMovement=w},u.prototype.breakIdleMovement=function(){this.stopMovement(),this._resetIdleTimer()},u.prototype._resetIdleTimer=function(){this._idleTimer.start()},u.prototype._triggerIdleTimer=function(){var P=this._idleMovement;!P||this.startMovement(P)},u.prototype.switchScene=function(P,w,B){var D=this;w=w||{},B=B||Y;var Q=this._stage,b=this._currentScene;if(b!==P){if(this._scenes.indexOf(P)<0)throw new Error("No such scene in viewer");this._cancelCurrentTween&&(this._cancelCurrentTween(),this._cancelCurrentTween=null);var U=b?b.listLayers():[],$=P.listLayers(),N=Q.listLayers();if(b&&(N.length!==U.length||N.length>1&&N[0]!=U[0]))throw new Error("Stage not in sync with viewer");for(var a=null!=w.transitionDuration?w.transitionDuration:1e3,g=null!=w.transitionUpdate?w.transitionUpdate:H,V=0;V<$.length;V++)this._addLayerToStage($[V]);this._cancelCurrentTween=z(a,function T(rt){g(rt,P,b)},function it(){if(D._replacedScene){D._removeSceneEventListeners(D._replacedScene),U=D._replacedScene.listLayers();for(var rt=0;rt<U.length;rt++)D._removeLayerFromStage(U[rt]);D._replacedScene=null}D._cancelCurrentTween=null,B()}),this._currentScene=P,this._replacedScene=b,this.emit("sceneChange"),this.emit("viewChange"),this._addSceneEventListeners(P)}else B()},X.exports=u},3587:(X,k,s)=>{"use strict";var c=s(2120),A=s(5946),E=s(8843),p=s(6873);function v(l){this.constructor.super_.call(this,l),this._timestamp=0}A(v,c),E(v),v.prototype.destroy=function(){p(this)},v.prototype.timestamp=function(){return this._timestamp},v.prototype.isDynamic=function(){return!0},v.prototype.markDirty=function(){this._timestamp++,this.emit("change")},X.exports=v},2120:(X,k,s)=>{"use strict";var c=s(3573),A=s(8843),E=s(6873),p={HTMLImageElement:["naturalWidth","naturalHeight"],HTMLCanvasElement:["width","height"],ImageBitmap:["width","height"]};function v(l){var m=!1;for(var L in p)if(c[L]&&l instanceof c[L]){m=!0,this._widthProp=p[L][0],this._heightProp=p[L][1];break}if(!m)throw new Error("Unsupported pixel source");this._element=l}A(v),v.prototype.destroy=function(){E(this)},v.prototype.element=function(){return this._element},v.prototype.width=function(){return this._element[this._widthProp]},v.prototype.height=function(){return this._element[this._heightProp]},v.prototype.timestamp=function(){return 0},v.prototype.isDynamic=function(){return!1},X.exports=v},2847:(X,k,s)=>{"use strict";var c=s(7802),E=.01,p={yawSpeed:.1,pitchSpeed:.1,fovSpeed:.1,yawAccel:E,pitchAccel:E,fovAccel:E,targetPitch:0,targetFov:null};X.exports=function v(l){var m=(l=c(l||{},p)).yawSpeed,L=l.pitchSpeed,S=l.fovSpeed,_=l.yawAccel,d=l.pitchAccel,x=l.fovAccel,R=l.targetPitch,z=l.targetFov;return function(){var D,b,U,O=0,u=0,W=0,H=0,P=0,w=0,B=0;return function(N,a){if(D=(a-O)/1e3,P=Math.min(u+D*_,m),N.yaw=N.yaw+P*D,null!=R&&N.pitch!==R){var g=.5*W*W/d;w=Math.abs(R-N.pitch)>g?Math.min(W+D*d,L):Math.max(W-D*d,0),b=w*D,R<N.pitch&&(N.pitch=Math.max(R,N.pitch-b)),R>N.pitch&&(N.pitch=Math.min(R,N.pitch+b))}if(null!=z&&N.fov!==R){var V=.5*H*H/x;B=Math.abs(z-N.fov)>V?Math.min(H+D*x,S):Math.max(H-D*x,0),U=B*D,z<N.fov&&(N.fov=Math.max(z,N.fov-U)),z>N.fov&&(N.fov=Math.min(z,N.fov+U))}return O=a,u=P,W=w,H=B,N}}}},7299:(X,k,s)=>{"use strict";var c=s(4501);function A(E){if(!isFinite(E)||Math.floor(E)!==E||E<0)throw new Error("LruMap: invalid capacity");this._capacity=E,this._keys=new Array(this._capacity),this._values=new Array(this._capacity),this._start=0,this._size=0}A.prototype._index=function(E){return c(this._start+E,this._capacity)},A.prototype.get=function(E){for(var p=0;p<this._size;p++){var v=this._keys[this._index(p)];if(E.equals(v))return this._values[this._index(p)]}return null},A.prototype.set=function(E,p){if(0===this._capacity)return E;this.del(E);var v=this._size===this._capacity?this._keys[this._index(0)]:null;return this._keys[this._index(this._size)]=E,this._values[this._index(this._size)]=p,this._size<this._capacity?this._size++:this._start=this._index(1),v},A.prototype.del=function(E){for(var p=0;p<this._size;p++)if(E.equals(this._keys[this._index(p)])){for(var v=this._values[this._index(p)],l=p;l<this._size-1;l++)this._keys[this._index(l)]=this._keys[this._index(l+1)],this._values[this._index(l)]=this._values[this._index(l+1)];return this._size--,v}return null},A.prototype.has=function(E){for(var p=0;p<this._size;p++)if(E.equals(this._keys[this._index(p)]))return!0;return!1},A.prototype.size=function(){return this._size},A.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._start=0,this._size=0},A.prototype.forEach=function(E){for(var p=0,v=0;v<this._size;v++)E(this._keys[this._index(v)],this._values[this._index(v)]),p+=1;return p},X.exports=A},47:(X,k,s)=>{"use strict";var c=s(4501);function A(E){if(!isFinite(E)||Math.floor(E)!==E||E<0)throw new Error("LruSet: invalid capacity");this._capacity=E,this._elements=new Array(this._capacity),this._start=0,this._size=0}A.prototype._index=function(E){return c(this._start+E,this._capacity)},A.prototype.add=function(E){if(0===this._capacity)return E;this.remove(E);var p=this._size===this._capacity?this._elements[this._index(0)]:null;return this._elements[this._index(this._size)]=E,this._size<this._capacity?this._size++:this._start=this._index(1),p},A.prototype.remove=function(E){for(var p=0;p<this._size;p++){var v=this._elements[this._index(p)];if(E.equals(v)){for(var l=p;l<this._size-1;l++)this._elements[this._index(l)]=this._elements[this._index(l+1)];return this._size--,v}}return null},A.prototype.has=function(E){for(var p=0;p<this._size;p++)if(E.equals(this._elements[this._index(p)]))return!0;return!1},A.prototype.size=function(){return this._size},A.prototype.clear=function(){this._elements.length=0,this._start=0,this._size=0},A.prototype.forEach=function(E){for(var p=0,v=0;v<this._size;v++)E(this._elements[this._index(v)]),p+=1;return p},X.exports=A},5242:(X,k,s)=>{"use strict";var c=s(4501);function E(p){if(null!=p&&(!isFinite(p)||Math.floor(p)!==p||p<1))throw new Error("Map: invalid capacity");this._capacity=p||64,this._keyBuckets=[],this._valBuckets=[];for(var v=0;v<this._capacity;v++)this._keyBuckets.push([]),this._valBuckets.push([]);this._size=0}E.prototype.get=function(p){for(var v=c(p.hash(),this._capacity),l=this._keyBuckets[v],m=0;m<l.length;m++)if(p.equals(l[m]))return this._valBuckets[v][m];return null},E.prototype.set=function(p,v){for(var l=c(p.hash(),this._capacity),m=this._keyBuckets[l],L=this._valBuckets[l],S=0;S<m.length;S++)if(p.equals(m[S])){var d=L[S];return m[S]=p,L[S]=v,d}return m.push(p),L.push(v),this._size++,null},E.prototype.del=function(p){for(var v=c(p.hash(),this._capacity),l=this._keyBuckets[v],m=this._valBuckets[v],L=0;L<l.length;L++)if(p.equals(l[L])){for(var _=m[L],d=L;d<l.length-1;d++)l[d]=l[d+1],m[d]=m[d+1];return l.length=l.length-1,m.length=m.length-1,this._size--,_}return null},E.prototype.has=function(p){for(var v=c(p.hash(),this._capacity),l=this._keyBuckets[v],m=0;m<l.length;m++)if(p.equals(l[m]))return!0;return!1},E.prototype.size=function(){return this._size},E.prototype.clear=function(){for(var p=0;p<this._capacity;p++)this._keyBuckets[p].length=0,this._valBuckets[p].length=0;this._size=0},E.prototype.forEach=function(p){for(var v=0,l=0;l<this._capacity;l++)for(var m=this._keyBuckets[l],L=this._valBuckets[l],S=0;S<m.length;S++)p(m[S],L[S]),v+=1;return v},X.exports=E},1114:(X,k,s)=>{"use strict";var c=s(4501);function E(p){if(null!=p&&(!isFinite(p)||Math.floor(p)!==p||p<1))throw new Error("Set: invalid capacity");this._capacity=this._capacity||64,this._buckets=[];for(var v=0;v<this._capacity;v++)this._buckets.push([]);this._size=0}E.prototype.add=function(p){for(var v=c(p.hash(),this._capacity),l=this._buckets[v],m=0;m<l.length;m++){var L=l[m];if(p.equals(L))return l[m]=p,L}return l.push(p),this._size++,null},E.prototype.remove=function(p){for(var v=c(p.hash(),this._capacity),l=this._buckets[v],m=0;m<l.length;m++){var L=l[m];if(p.equals(L)){for(var S=m;S<l.length-1;S++)l[S]=l[S+1];return l.length=l.length-1,this._size--,L}}return null},E.prototype.has=function(p){for(var v=c(p.hash(),this._capacity),l=this._buckets[v],m=0;m<l.length;m++)if(p.equals(l[m]))return!0;return!1},E.prototype.size=function(){return this._size},E.prototype.clear=function(){for(var p=0;p<this._capacity;p++)this._buckets[p].length=0;this._size=0},E.prototype.forEach=function(p){for(var v=0,l=0;l<this._capacity;l++)for(var m=this._buckets[l],L=0;L<m.length;L++)p(m[L]),v+=1;return v},X.exports=E},2412:(X,k,s)=>{"use strict";var c=s(5169),A=s(4501);function E(p){this._concurrency=p&&p.concurrency||1,this._paused=p&&!!p.paused||!1,this._pool=[];for(var v=0;v<this._concurrency;v++)this._pool.push(new c(p));this._next=0}E.prototype.length=function(){for(var p=0,v=0;v<this._pool.length;v++)p+=this._pool[v].length();return p},E.prototype.push=function(p,v){var m=this._pool[this._next].push(p,v);return this._next=A(this._next+1,this._concurrency),m},E.prototype.pause=function(){if(!this._paused){this._paused=!0;for(var p=0;p<this._concurrency;p++)this._pool[p].pause()}},E.prototype.resume=function(){if(this._paused){this._paused=!1;for(var p=0;p<this._concurrency;p++)this._pool[p].resume()}},X.exports=E},5169:(X,k,s)=>{"use strict";var c=s(242);function A(p,v){this.fn=p,this.cb=v,this.cfn=null}function E(p){this._queue=[],this._delay=p&&p.delay||0,this._paused=p&&!!p.paused||!1,this._currentTask=null,this._lastFinished=null}E.prototype.length=function(){return this._queue.length},E.prototype.push=function(p,v){var l=new A(p,v),m=this._cancel.bind(this,l);return this._queue.push(l),this._next(),m},E.prototype.pause=function(){this._paused||(this._paused=!0)},E.prototype.resume=function(){this._paused&&(this._paused=!1,this._next())},E.prototype._start=function(p){if(this._currentTask)throw new Error("WorkQueue: called start while running task");this._currentTask=p;var v=this._finish.bind(this,p);if(p.cfn=p.fn(v),"function"!=typeof p.cfn)throw new Error("WorkQueue: function is not cancellable")},E.prototype._finish=function(p){var v=Array.prototype.slice.call(arguments,1);if(this._currentTask!==p)throw new Error("WorkQueue: called finish on wrong task");p.cb.apply(null,v),this._currentTask=null,this._lastFinished=c(),this._next()},E.prototype._cancel=function(p){var v=Array.prototype.slice.call(arguments,1);if(this._currentTask===p)p.cfn.apply(null,v);else{var l=this._queue.indexOf(p);l>=0&&(this._queue.splice(l,1),p.cb.apply(null,v))}},E.prototype._next=function(){if(!this._paused&&this._queue.length&&!this._currentTask){if(null!=this._lastFinished){var p=c()-this._lastFinished,v=this._delay-p;if(v>0)return void setTimeout(this._next.bind(this),v)}var l=this._queue.shift();this._start(l)}},X.exports=E},3247:(X,k,s)=>{"use strict";var c=s(335).vec4,A=s(335).mat4;function p(L,S,_){(function v(L,S,_){var d=S[0],x=S[1],R=S[2],z=S[3];L[0]=_[0]*d+_[1]*x+_[2]*R+_[3]*z,L[1]=_[4]*d+_[5]*x+_[6]*R+_[7]*z,L[2]=_[8]*d+_[9]*x+_[10]*R+_[11]*z,L[3]=_[12]*d+_[13]*x+_[14]*R+_[15]*z})(_,L,S.colorMatrix),c.add(_,_,S.colorOffset)}var l=c.create();X.exports={identity:function E(L){var S=L||{};return S.colorOffset=S.colorOffset||c.create(),S.colorMatrix=S.colorMatrix||A.create(),S},applyToPixel:p,applyToImageData:function m(L,S){for(var _=L.width,d=L.height,x=L.data,R=0;R<_*d;R++)c.set(l,x[4*R+0]/255,x[4*R+1]/255,x[4*R+2]/255,x[4*R+3]/255),p(l,S,l),x[4*R+0]=255*l[0],x[4*R+1]=255*l[1],x[4*R+2]=255*l[2],x[4*R+3]=255*l[3]}}},1453:(X,k,s)=>{"use strict";var c=s(8843),A=s(4809),E=s(242),p=s(6873);function v(l){l=l||{},this._methods=[],this._parameters=["x","y","axisScaledX","axisScaledY","zoom","yaw","pitch","roll"],this._now=l.nowForTesting||E,this._composedOffsets={},this._composeReturn={offsets:this._composedOffsets,changing:null}}c(v),v.prototype.add=function(l){if(!this.has(l)){var m={};this._parameters.forEach(function(_){m[_]={dynamics:new A,time:null}});var L=this._updateDynamics.bind(this,m),S={instance:l,dynamics:m,parameterDynamicsHandler:L};l.addEventListener("parameterDynamics",L),this._methods.push(S)}},v.prototype.remove=function(l){var m=this._indexOfInstance(l);if(m>=0){var L=this._methods.splice(m,1)[0];L.instance.removeEventListener("parameterDynamics",L.parameterDynamicsHandler)}},v.prototype.has=function(l){return this._indexOfInstance(l)>=0},v.prototype._indexOfInstance=function(l){for(var m=0;m<this._methods.length;m++)if(this._methods[m].instance===l)return m;return-1},v.prototype.list=function(){for(var l=[],m=0;m<this._methods.length;m++)l.push(this._methods[m].instance);return l},v.prototype._updateDynamics=function(l,m,L){var S=l[m];if(!S)throw new Error("Unknown control parameter "+m);var _=this._now();S.dynamics.update(L,(_-S.time)/1e3),S.time=_,this.emit("change")},v.prototype._resetComposedOffsets=function(){for(var l=0;l<this._parameters.length;l++)this._composedOffsets[this._parameters[l]]=0},v.prototype.offsets=function(){var l,m=!1,L=this._now();this._resetComposedOffsets();for(var S=0;S<this._methods.length;S++)for(var _=this._methods[S].dynamics,d=0;d<this._parameters.length;d++){var x=_[l=this._parameters[d]],R=x.dynamics;null!=R.offset&&(this._composedOffsets[l]+=R.offset,R.offset=null);var z=(L-x.time)/1e3,Y=R.offsetFromVelocity(z);Y&&(this._composedOffsets[l]+=Y);var O=R.velocityAfter(z);R.velocity=O,O&&(m=!0),x.time=L}return this._composeReturn.changing=m,this._composeReturn},v.prototype.destroy=function(){for(var l=this.list(),m=0;m<l.length;m++)this.remove(l[m]);p(this)},X.exports=v},444:(X,k,s)=>{"use strict";var c=s(7802),A=s(6873),E={active:"move",inactive:"default",disabled:"default"};function p(v,l,m,L){L=c(L||{},E),this._element=m,this._controls=v,this._id=l,this._attached=!1,this._setActiveCursor=this._setCursor.bind(this,L.active),this._setInactiveCursor=this._setCursor.bind(this,L.inactive),this._setDisabledCursor=this._setCursor.bind(this,L.disabled),this._setOriginalCursor=this._setCursor.bind(this,this._element.style.cursor),this._updateAttachmentHandler=this._updateAttachment.bind(this),v.addEventListener("methodEnabled",this._updateAttachmentHandler),v.addEventListener("methodDisabled",this._updateAttachmentHandler),v.addEventListener("enabled",this._updateAttachmentHandler),v.addEventListener("disabled",this._updateAttachmentHandler),this._updateAttachment()}p.prototype.destroy=function(){this._detachFromControlMethod(this._controls.method(this._id)),this._setOriginalCursor(),this._controls.removeEventListener("methodEnabled",this._updateAttachmentHandler),this._controls.removeEventListener("methodDisabled",this._updateAttachmentHandler),this._controls.removeEventListener("enabled",this._updateAttachmentHandler),this._controls.removeEventListener("disabled",this._updateAttachmentHandler),A(this)},p.prototype._updateAttachment=function(){var v=this._controls,l=this._id;v.enabled()&&v.method(l).enabled?this._attachToControlMethod(v.method(l)):this._detachFromControlMethod(v.method(l))},p.prototype._attachToControlMethod=function(v){this._attached||(v.instance.addEventListener("active",this._setActiveCursor),v.instance.addEventListener("inactive",this._setInactiveCursor),v.active?this._setActiveCursor():this._setInactiveCursor(),this._attached=!0)},p.prototype._detachFromControlMethod=function(v){this._attached&&(v.instance.removeEventListener("active",this._setActiveCursor),v.instance.removeEventListener("inactive",this._setInactiveCursor),this._setDisabledCursor(),this._attached=!1)},p.prototype._setCursor=function(v){this._element.style.cursor=v},X.exports=p},7708:(X,k,s)=>{"use strict";var c=s(8843),A=s(1453),E=s(6873),p=typeof MARZIPANODEBUG<"u"&&MARZIPANODEBUG.controls;function v(l){l=l||{},this._methods={},this._methodGroups={},this._composer=new A,this._enabled=!l||!l.enabled||!!l.enabled,this._activeCount=0,this.updatedViews_=[],this._attachedRenderLoop=null}c(v),v.prototype.destroy=function(){this.detach(),this._composer.destroy(),E(this)},v.prototype.methods=function(){var l={};for(var m in this._methods)l[m]=this._methods[m];return l},v.prototype.method=function(l){return this._methods[l]},v.prototype.registerMethod=function(l,m,L){if(this._methods[l])throw new Error("Control method already registered with id "+l);this._methods[l]={instance:m,enabled:!1,active:!1,activeHandler:this._handleActive.bind(this,l),inactiveHandler:this._handleInactive.bind(this,l)},L&&this.enableMethod(l,m)},v.prototype.unregisterMethod=function(l){var m=this._methods[l];if(!m)throw new Error("No control method registered with id "+l);m.enabled&&this.disableMethod(l),delete this._methods[l]},v.prototype.enableMethod=function(l){var m=this._methods[l];if(!m)throw new Error("No control method registered with id "+l);m.enabled||(m.enabled=!0,m.active&&this._incrementActiveCount(),this._listen(l),this._updateComposer(),this.emit("methodEnabled",l))},v.prototype.disableMethod=function(l){var m=this._methods[l];if(!m)throw new Error("No control method registered with id "+l);!m.enabled||(m.enabled=!1,m.active&&this._decrementActiveCount(),this._unlisten(l),this._updateComposer(),this.emit("methodDisabled",l))},v.prototype.addMethodGroup=function(l,m){this._methodGroups[l]=m},v.prototype.removeMethodGroup=function(l){delete this._methodGroups[l]},v.prototype.methodGroups=function(){var l={};for(var m in this._methodGroups)l[m]=this._methodGroups[m];return l},v.prototype.enableMethodGroup=function(l){var m=this;m._methodGroups[l].forEach(function(L){m.enableMethod(L)})},v.prototype.disableMethodGroup=function(l){var m=this;m._methodGroups[l].forEach(function(L){m.disableMethod(L)})},v.prototype.enabled=function(){return this._enabled},v.prototype.enable=function(){this._enabled||(this._enabled=!0,this._activeCount>0&&this.emit("active"),this.emit("enabled"),this._updateComposer())},v.prototype.disable=function(){!this._enabled||(this._enabled=!1,this._activeCount>0&&this.emit("inactive"),this.emit("disabled"),this._updateComposer())},v.prototype.attach=function(l){this._attachedRenderLoop&&this.detach(),this._attachedRenderLoop=l,this._beforeRenderHandler=this._updateViewsWithControls.bind(this),this._changeHandler=l.renderOnNextFrame.bind(l),this._attachedRenderLoop.addEventListener("beforeRender",this._beforeRenderHandler),this._composer.addEventListener("change",this._changeHandler)},v.prototype.detach=function(){!this._attachedRenderLoop||(this._attachedRenderLoop.removeEventListener("beforeRender",this._beforeRenderHandler),this._composer.removeEventListener("change",this._changeHandler),this._beforeRenderHandler=null,this._changeHandler=null,this._attachedRenderLoop=null)},v.prototype.attached=function(){return null!=this._attachedRenderLoop},v.prototype._listen=function(l){var m=this._methods[l];if(!m)throw new Error("Bad method id");m.instance.addEventListener("active",m.activeHandler),m.instance.addEventListener("inactive",m.inactiveHandler)},v.prototype._unlisten=function(l){var m=this._methods[l];if(!m)throw new Error("Bad method id");m.instance.removeEventListener("active",m.activeHandler),m.instance.removeEventListener("inactive",m.inactiveHandler)},v.prototype._handleActive=function(l){var m=this._methods[l];if(!m)throw new Error("Bad method id");if(!m.enabled)throw new Error("Should not receive event from disabled control method");m.active||(m.active=!0,this._incrementActiveCount())},v.prototype._handleInactive=function(l){var m=this._methods[l];if(!m)throw new Error("Bad method id");if(!m.enabled)throw new Error("Should not receive event from disabled control method");m.active&&(m.active=!1,this._decrementActiveCount())},v.prototype._incrementActiveCount=function(){this._activeCount++,p&&this._checkActiveCount(),this._enabled&&1===this._activeCount&&this.emit("active")},v.prototype._decrementActiveCount=function(){this._activeCount--,p&&this._checkActiveCount(),this._enabled&&0===this._activeCount&&this.emit("inactive")},v.prototype._checkActiveCount=function(){var l=0;for(var m in this._methods){var L=this._methods[m];L.enabled&&L.active&&l++}if(l!=this._activeCount)throw new Error("Bad control state")},v.prototype._updateComposer=function(){var l=this._composer;for(var m in this._methods){var L=this._methods[m],S=this._enabled&&L.enabled;S&&!l.has(L.instance)&&l.add(L.instance),!S&&l.has(L.instance)&&l.remove(L.instance)}},v.prototype._updateViewsWithControls=function(){var l=this._composer.offsets();l.changing&&this._attachedRenderLoop.renderOnNextFrame(),this.updatedViews_.length=0;for(var m=this._attachedRenderLoop.stage().listLayers(),L=0;L<m.length;L++){var S=m[L].view();this.updatedViews_.indexOf(S)<0&&(m[L].view().updateWithControlParameters(l.offsets),this.updatedViews_.push(S))}},X.exports=v},2074:(X,k,s)=>{"use strict";var c=s(8843),A=s(4809),E=s(7516),p=s(7802),v=s(1230).maxFriction,l=s(6873),m={friction:6,maxFrictionTime:.3,hammerEvent:"pan"},L=typeof MARZIPANODEBUG<"u"&&MARZIPANODEBUG.controls;function S(d,x,R){if(this._element=d,this._opts=p(R||{},m),this._startEvent=null,this._lastEvent=null,this._active=!1,this._dynamics={x:new A,y:new A},this._hammer=E.get(d,x),this._hammer.on("hammer.input",this._handleHammerEvent.bind(this)),"pan"!=this._opts.hammerEvent&&"pinch"!=this._opts.hammerEvent)throw new Error(this._opts.hammerEvent+" is not a hammerEvent managed in DragControlMethod");this._hammer.on(this._opts.hammerEvent+"start",this._handleStart.bind(this)),this._hammer.on(this._opts.hammerEvent+"move",this._handleMove.bind(this)),this._hammer.on(this._opts.hammerEvent+"end",this._handleEnd.bind(this)),this._hammer.on(this._opts.hammerEvent+"cancel",this._handleEnd.bind(this))}c(S),S.prototype.destroy=function(){this._hammer.release(),l(this)},S.prototype._handleHammerEvent=function(d){if(d.isFirst){if(L&&this._active)throw new Error("DragControlMethod active detected when already active");this._active=!0,this.emit("active")}if(d.isFinal){if(L&&!this._active)throw new Error("DragControlMethod inactive detected when already inactive");this._active=!1,this.emit("inactive")}},S.prototype._handleStart=function(d){d.preventDefault(),this._startEvent=d},S.prototype._handleMove=function(d){d.preventDefault(),this._startEvent&&(this._updateDynamicsMove(d),this.emit("parameterDynamics","axisScaledX",this._dynamics.x),this.emit("parameterDynamics","axisScaledY",this._dynamics.y))},S.prototype._handleEnd=function(d){d.preventDefault(),this._startEvent&&(this._updateDynamicsRelease(d),this.emit("parameterDynamics","axisScaledX",this._dynamics.x),this.emit("parameterDynamics","axisScaledY",this._dynamics.y)),this._startEvent=!1,this._lastEvent=!1},S.prototype._updateDynamicsMove=function(d){var x=d.deltaX,R=d.deltaY,z=this._lastEvent||this._startEvent;z&&(x-=z.deltaX,R-=z.deltaY);var Y=this._element.getBoundingClientRect();x/=Y.right-Y.left,R/=Y.bottom-Y.top,this._dynamics.x.reset(),this._dynamics.y.reset(),this._dynamics.x.offset=-x,this._dynamics.y.offset=-R,this._lastEvent=d};var _=[null,null];S.prototype._updateDynamicsRelease=function(d){var x=this._element.getBoundingClientRect(),Y=1e3*d.velocityX/(x.right-x.left),O=1e3*d.velocityY/(x.bottom-x.top);this._dynamics.x.reset(),this._dynamics.y.reset(),this._dynamics.x.velocity=Y,this._dynamics.y.velocity=O,v(this._opts.friction,this._dynamics.x.velocity,this._dynamics.y.velocity,this._opts.maxFrictionTime,_),this._dynamics.x.friction=_[0],this._dynamics.y.friction=_[1]},X.exports=S},4809:X=>{"use strict";function k(){this.velocity=null,this.friction=null,this.offset=null}k.equals=function(c,A){return c.velocity===A.velocity&&c.friction===A.friction&&c.offset===A.offset},k.prototype.equals=function(c){return k.equals(this,c)},k.prototype.update=function(c,A){c.offset&&(this.offset=this.offset||0,this.offset+=c.offset);var E=this.offsetFromVelocity(A);E&&(this.offset=this.offset||0,this.offset+=E),this.velocity=c.velocity,this.friction=c.friction},k.prototype.reset=function(){this.velocity=null,this.friction=null,this.offset=null},k.prototype.velocityAfter=function(c){return this.velocity?this.friction?function s(c,A){return c<0?Math.min(0,c+A):c>0?Math.max(0,c-A):0}(this.velocity,this.friction*c):this.velocity:null},k.prototype.offsetFromVelocity=function(c){c=Math.min(c,this.nullVelocityTime());var A=this.velocityAfter(c);return(this.velocity+A)/2*c},k.prototype.nullVelocityTime=function(){return null==this.velocity?0:this.velocity&&!this.friction?1/0:Math.abs(this.velocity/this.friction)},X.exports=k},9041:(X,k,s)=>{"use strict";var c=s(8843),A=s(4809),E=s(6873);function p(v,l,m,L){if(!v)throw new Error("ElementPressControlMethod: element must be defined");if(!l)throw new Error("ElementPressControlMethod: parameter must be defined");if(!m)throw new Error("ElementPressControlMethod: velocity must be defined");if(!L)throw new Error("ElementPressControlMethod: friction must be defined");this._element=v,this._pressHandler=this._handlePress.bind(this),this._releaseHandler=this._handleRelease.bind(this),v.addEventListener("mousedown",this._pressHandler),v.addEventListener("mouseup",this._releaseHandler),v.addEventListener("mouseleave",this._releaseHandler),v.addEventListener("touchstart",this._pressHandler),v.addEventListener("touchmove",this._releaseHandler),v.addEventListener("touchend",this._releaseHandler),this._parameter=l,this._velocity=m,this._friction=L,this._dynamics=new A,this._pressing=!1}c(p),p.prototype.destroy=function(){this._element.removeEventListener("mousedown",this._pressHandler),this._element.removeEventListener("mouseup",this._releaseHandler),this._element.removeEventListener("mouseleave",this._releaseHandler),this._element.removeEventListener("touchstart",this._pressHandler),this._element.removeEventListener("touchmove",this._releaseHandler),this._element.removeEventListener("touchend",this._releaseHandler),E(this)},p.prototype._handlePress=function(){this._pressing=!0,this._dynamics.velocity=this._velocity,this._dynamics.friction=0,this.emit("parameterDynamics",this._parameter,this._dynamics),this.emit("active")},p.prototype._handleRelease=function(){this._pressing&&(this._dynamics.friction=this._friction,this.emit("parameterDynamics",this._parameter,this._dynamics),this.emit("inactive")),this._pressing=!1},X.exports=p},7516:(X,k,s)=>{"use strict";var c=s(1524),A=1,E="MarzipanoHammerElementId";function p(m,L){return m[E]||(m[E]=A++),L+m[E]}function v(){this._managers={},this._refCount={}}function l(m,L,S,_){this._manager=L,this._element=S,this._type=_,this._hammerGestures=m,this._eventHandlers=[]}v.prototype.get=function(m,L){var S=p(m,L);return this._managers[S]||(this._managers[S]=this._createManager(m,L),this._refCount[S]=0),this._refCount[S]++,new l(this,this._managers[S],m,L)},v.prototype._createManager=function(m,L){var S=new c.Manager(m);return"mouse"===L?S.add(new c.Pan({direction:c.DIRECTION_ALL,threshold:0})):("touch"===L||"pen"===L||"kinect"===L)&&(S.add(new c.Pan({direction:c.DIRECTION_ALL,threshold:20,pointers:1})),S.add(new c.Pinch)),S},v.prototype._releaseHandle=function(m,L){var S=p(m,L);this._refCount[S]&&(this._refCount[S]--,this._refCount[S]||(this._managers[S].destroy(),delete this._managers[S],delete this._refCount[S]))},l.prototype.on=function(m,L){var S=this._type,_=function(d){S===d.pointerType&&L(d)};this._eventHandlers.push({events:m,handler:_}),this._manager.on(m,_)},l.prototype.release=function(){for(var m=0;m<this._eventHandlers.length;m++){var L=this._eventHandlers[m];this._manager.off(L.events,L.handler)}this._hammerGestures._releaseHandle(this._element,this._type),this._manager=null,this._element=null,this._type=null,this._hammerGestures=null},l.prototype.manager=function(){return this._manager},X.exports=new v},1174:(X,k,s)=>{"use strict";var c=s(8843),A=s(4809),E=s(6873);function p(v,l,m,L,S){if(!v)throw new Error("KeyControlMethod: keyCode must be defined");if(!l)throw new Error("KeyControlMethod: parameter must be defined");if(!m)throw new Error("KeyControlMethod: velocity must be defined");if(!L)throw new Error("KeyControlMethod: friction must be defined");S=S||document,this._keyCode=v,this._parameter=l,this._velocity=m,this._friction=L,this._element=S,this._keydownHandler=this._handlePress.bind(this),this._keyupHandler=this._handleRelease.bind(this),this._blurHandler=this._handleBlur.bind(this),this._element.addEventListener("keydown",this._keydownHandler),this._element.addEventListener("keyup",this._keyupHandler),window.addEventListener("blur",this._blurHandler),this._dynamics=new A,this._pressing=!1}c(p),p.prototype.destroy=function(){this._element.removeEventListener("keydown",this._keydownHandler),this._element.removeEventListener("keyup",this._keyupHandler),window.removeEventListener("blur",this._blurHandler),E(this)},p.prototype._handlePress=function(v){v.keyCode===this._keyCode&&(this._pressing=!0,this._dynamics.velocity=this._velocity,this._dynamics.friction=0,this.emit("parameterDynamics",this._parameter,this._dynamics),this.emit("active"))},p.prototype._handleRelease=function(v){v.keyCode===this._keyCode&&(this._pressing&&(this._dynamics.friction=this._friction,this.emit("parameterDynamics",this._parameter,this._dynamics),this.emit("inactive")),this._pressing=!1)},p.prototype._handleBlur=function(){this._dynamics.velocity=0,this.emit("parameterDynamics",this._parameter,this._dynamics),this.emit("inactive"),this._pressing=!1},X.exports=p},131:(X,k,s)=>{"use strict";var c=s(8843),A=s(4809),E=s(7516),p=s(6873);function v(l,m,L){this._hammer=E.get(l,m),this._lastEvent=null,this._active=!1,this._dynamics=new A,this._hammer.on("pinchstart",this._handleStart.bind(this)),this._hammer.on("pinch",this._handleEvent.bind(this)),this._hammer.on("pinchend",this._handleEnd.bind(this)),this._hammer.on("pinchcancel",this._handleEnd.bind(this))}c(v),v.prototype.destroy=function(){this._hammer.release(),p(this)},v.prototype._handleStart=function(){this._active||(this._active=!0,this.emit("active"))},v.prototype._handleEnd=function(){this._lastEvent=null,this._active&&(this._active=!1,this.emit("inactive"))},v.prototype._handleEvent=function(l){var m=l.scale;this._lastEvent&&(m/=this._lastEvent.scale),this._dynamics.offset=-1*(m-1),this.emit("parameterDynamics","zoom",this._dynamics),this._lastEvent=l},X.exports=v},4016:(X,k,s)=>{"use strict";var c=s(8843),A=s(4809),E=s(7516),p=s(7802),v=s(1230).maxFriction,l=s(6873),m={speed:8,friction:6,maxFrictionTime:.3};function L(_,d,x){this._element=_,this._opts=p(x||{},m),this._active=!1,this._hammer=E.get(_,d),this._dynamics={x:new A,y:new A},this._hammer.on("panstart",this._handleStart.bind(this)),this._hammer.on("panmove",this._handleMove.bind(this)),this._hammer.on("panend",this._handleRelease.bind(this)),this._hammer.on("pancancel",this._handleRelease.bind(this))}c(L),L.prototype.destroy=function(){this._hammer.release(),l(this)},L.prototype._handleStart=function(_){_.preventDefault(),this._active||(this._active=!0,this.emit("active"))},L.prototype._handleMove=function(_){_.preventDefault(),this._updateDynamics(_,!1)},L.prototype._handleRelease=function(_){_.preventDefault(),this._updateDynamics(_,!0),this._active&&(this._active=!1,this.emit("inactive"))};var S=[null,null];L.prototype._updateDynamics=function(_,d){var x=this._element.getBoundingClientRect(),Y=Math.max(x.right-x.left,x.bottom-x.top),O=_.deltaX/Y*this._opts.speed,u=_.deltaY/Y*this._opts.speed;this._dynamics.x.reset(),this._dynamics.y.reset(),this._dynamics.x.velocity=O,this._dynamics.y.velocity=u,d&&(v(this._opts.friction,this._dynamics.x.velocity,this._dynamics.y.velocity,this._opts.maxFrictionTime,S),this._dynamics.x.friction=S[0],this._dynamics.y.friction=S[1]),this.emit("parameterDynamics","x",this._dynamics.x),this.emit("parameterDynamics","y",this._dynamics.y)},X.exports=L},130:(X,k,s)=>{"use strict";var c=s(8843),A=s(4809),E=s(7802),p=s(6873),v={frictionTime:.2,zoomDelta:.001};function l(L,S){this._element=L,this._opts=E(S||{},v),this._dynamics=new A,this._eventList=[],this._wheelListener=(this._opts.frictionTime?this.withSmoothing:this.withoutSmoothing).bind(this),L.addEventListener("wheel",this._wheelListener)}function m(L){return L.deltaY*(1==L.deltaMode?20:1)}c(l),l.prototype.destroy=function(){this._element.removeEventListener("wheel",this._wheelListener),p(this)},l.prototype.withoutSmoothing=function(L){this._dynamics.offset=m(L)*this._opts.zoomDelta,this.emit("parameterDynamics","zoom",this._dynamics),L.preventDefault(),this.emit("active"),this.emit("inactive")},l.prototype.withSmoothing=function(L){var S=L.timeStamp;for(this._eventList.push(L);this._eventList[0].timeStamp<S-1e3*this._opts.frictionTime;)this._eventList.shift(0);for(var _=0,d=0;d<this._eventList.length;d++)_+=m(this._eventList[d])*this._opts.zoomDelta/this._opts.frictionTime;this._dynamics.velocity=_,this._dynamics.friction=Math.abs(_)/this._opts.frictionTime,this.emit("parameterDynamics","zoom",this._dynamics),L.preventDefault(),this.emit("active"),this.emit("inactive")},X.exports=l},9752:(X,k,s)=>{"use strict";var c=s(8843),A=s(4809),E=s(6873);function p(v){if(!v)throw new Error("VelocityControlMethod: parameter must be defined");this._parameter=v,this._dynamics=new A}c(p),p.prototype.destroy=function(){E(this)},p.prototype.setVelocity=function(v){this._dynamics.velocity=v,this.emit("parameterDynamics",this._parameter,this._dynamics)},p.prototype.setFriction=function(v){this._dynamics.friction=v,this.emit("parameterDynamics",this._parameter,this._dynamics)},X.exports=p},9512:(X,k,s)=>{"use strict";var c=s(7802),A=s(2074),E=s(4016),p=s(130),v=s(131),l=s(1174),m={mouseViewMode:"drag",dragMode:"pan"};X.exports=function L(S,_,d){d=c(d||{},m);var x={mouseViewDrag:new A(_,"mouse"),mouseViewQtvr:new E(_,"mouse"),leftArrowKey:new l(37,"x",-.7,3),rightArrowKey:new l(39,"x",.7,3),upArrowKey:new l(38,"y",-.7,3),downArrowKey:new l(40,"y",.7,3),plusKey:new l(107,"zoom",-.7,3),minusKey:new l(109,"zoom",.7,3),wKey:new l(87,"y",-.7,3),aKey:new l(65,"x",-.7,3),sKey:new l(83,"y",.7,3),dKey:new l(68,"x",.7,3),qKey:new l(81,"roll",.7,3),eKey:new l(69,"roll",-.7,3)},R=["scrollZoom","touchView","pinch"];!1!==d.scrollZoom&&(x.scrollZoom=new p(_));var z={arrowKeys:["leftArrowKey","rightArrowKey","upArrowKey","downArrowKey"],plusMinusKeys:["plusKey","minusKey"],wasdKeys:["wKey","aKey","sKey","dKey"],qeKeys:["qKey","eKey"]};switch(d.dragMode){case"pinch":x.pinch=new A(_,"touch",{hammerEvent:"pinch"});break;case"pan":x.touchView=new A(_,"touch"),x.pinch=new v(_,"touch");break;default:throw new Error("Unknown drag mode: "+d.dragMode)}switch(d.mouseViewMode){case"drag":R.push("mouseViewDrag");break;case"qtvr":R.push("mouseViewQtvr");break;default:throw new Error("Unknown mouse view mode: "+d.mouseViewMode)}for(var Y in x)S.registerMethod(Y,x[Y]),R.indexOf(Y)>=0&&S.enableMethod(Y);for(var u in z)S.addMethodGroup(u,z[u]);return x}},1230:X=>{"use strict";function s(c,A,E,p){var v=Math.atan(A/c);p[0]=E*Math.cos(v),p[1]=E*Math.sin(v)}X.exports={maxFriction:function k(c,A,E,p,v){var l=Math.sqrt(Math.pow(A,2)+Math.pow(E,2));s(A,E,c=Math.max(c,l/p),v),v[0]=Math.abs(v[0]),v[1]=Math.abs(v[1])},changeVectorNorm:s}},2363:(X,k,s)=>{"use strict";var c=s(5946),A=s(3864),E=s(9799),p=s(7299),v=s(9868),l=s(8279).makeLevelList,m=s(8279).makeSelectableLevelList,L=s(6438),S=s(5593),_=s(4699),d=s(335).vec3,x=s(335).vec4,R=s(335).mat4,Y="fudlrb",O={f:{x:0,y:0},b:{x:0,y:Math.PI},l:{x:0,y:Math.PI/2},r:{x:0,y:-Math.PI/2},u:{x:Math.PI/2,y:0},d:{x:-Math.PI/2,y:0}},u=d.create();function W(a,g,V,T){g&&d.rotateZ(a,a,u,g),V&&d.rotateX(a,a,u,V),T&&d.rotateY(a,a,u,T)}for(var H={},P=0;P<Y.length;P++){var w=Y[P],B=O[w],D=d.fromValues(0,0,-1);W(D,0,B.x,B.y),H[w]=D}var Q={f:["l","r","u","d"],b:["r","l","u","d"],l:["b","f","u","d"],r:["f","b","u","d"],u:["l","r","b","f"],d:["l","r","f","b"]},b=[[0,1],[1,0],[0,-1],[-1,0]];function U(a,g,V,T,it){this.face=a,this.x=g,this.y=V,this.z=T,this._geometry=it,this._level=it.levelList[T]}function $(a){if(this.constructor.super_.call(this,a),this._size=a.size,this._tileSize=a.tileSize,this._size%this._tileSize!=0)throw new Error("Level size is not multiple of tile size: "+this._size+" "+this._tileSize)}function N(a){if("array"!==_(a))throw new Error("Level list must be an array");this.levelList=l(a,$),this.selectableLevelList=m(this.levelList);for(var g=1;g<this.levelList.length;g++)this.levelList[g]._validateWithParentLevel(this.levelList[g-1]);this._tileSearcher=new E(this),this._neighborsCache=new p(64),this._vec=x.create(),this._viewSize={}}U.prototype.rotX=function(){return O[this.face].x},U.prototype.rotY=function(){return O[this.face].y},U.prototype.centerX=function(){return(this.x+.5)/this._level.numHorizontalTiles()-.5},U.prototype.centerY=function(){return.5-(this.y+.5)/this._level.numVerticalTiles()},U.prototype.scaleX=function(){return 1/this._level.numHorizontalTiles()},U.prototype.scaleY=function(){return 1/this._level.numVerticalTiles()},U.prototype.vertices=function(a){a||(a=[d.create(),d.create(),d.create(),d.create()]);var g=O[this.face];function V(at,ht,pt){d.set(at,ht,pt,-.5),W(at,0,g.x,g.y)}var T=this.centerX()-this.scaleX()/2,it=this.centerX()+this.scaleX()/2,rt=this.centerY()-this.scaleY()/2,ot=this.centerY()+this.scaleY()/2;return V(a[0],T,ot),V(a[1],it,ot),V(a[2],it,rt),V(a[3],T,rt),a},U.prototype.parent=function(){if(0===this.z)return null;var g=this.z,T=this.y,it=this._geometry,rt=it.levelList[g],ot=it.levelList[g-1];return new U(this.face,Math.floor(this.x/rt.numHorizontalTiles()*ot.numHorizontalTiles()),Math.floor(T/rt.numVerticalTiles()*ot.numVerticalTiles()),g-1,it)},U.prototype.children=function(a){if(this.z===this._geometry.levelList.length-1)return null;var g=this.face,V=this.z,T=this.x,it=this.y,rt=this._geometry,ot=rt.levelList[V],at=rt.levelList[V+1],ht=at.numHorizontalTiles()/ot.numHorizontalTiles(),pt=at.numVerticalTiles()/ot.numVerticalTiles();a=a||[];for(var _t=0;_t<ht;_t++)for(var Et=0;Et<pt;Et++)a.push(new U(g,ht*T+_t,pt*it+Et,V+1,rt));return a},U.prototype.neighbors=function(){var a=this._geometry,g=a._neighborsCache,V=g.get(this);if(V)return V;for(var T=a._vec,it=this.face,rt=this.x,ot=this.y,at=this.z,ht=this._level,pt=ht.numHorizontalTiles(),_t=ht.numVerticalTiles(),Et=[],It=0;It<b.length;It++){var yt=rt+b[It][0],wt=ot+b[It][1],Ut=at,Ot=it;if(yt<0||yt>=pt||wt<0||wt>=_t){var bt,Bt=this.centerX(),Nt=this.centerY();yt<0?(d.set(T,-.5,Nt,-.5),Ot=Q[it][0]):yt>=pt?(d.set(T,.5,Nt,-.5),Ot=Q[it][1]):wt<0?(d.set(T,Bt,.5,-.5),Ot=Q[it][2]):wt>=_t&&(d.set(T,Bt,-.5,-.5),Ot=Q[it][3]),W(T,0,(bt=O[it]).x,bt.y),W(T,0,-(bt=O[Ot]).x,-bt.y),yt=L(Math.floor((.5+T[0])*pt),0,pt-1),wt=L(Math.floor((.5-T[1])*_t),0,_t-1)}Et.push(new U(Ot,yt,wt,Ut,a))}return g.set(this,Et),Et},U.prototype.hash=function(){return A(Y.indexOf(this.face),this.z,this.y,this.x)},U.prototype.equals=function(a){return this._geometry===a._geometry&&this.face===a.face&&this.z===a.z&&this.y===a.y&&this.x===a.x},U.prototype.cmp=function(a){return S(this.z,a.z)||S(Y.indexOf(this.face),Y.indexOf(a.face))||S(this.y,a.y)||S(this.x,a.x)},U.prototype.str=function(){return"CubeTile("+tile.face+", "+tile.x+", "+tile.y+", "+tile.z+")"},c($,v),$.prototype.width=function(){return this._size},$.prototype.height=function(){return this._size},$.prototype.tileWidth=function(){return this._tileSize},$.prototype.tileHeight=function(){return this._tileSize},$.prototype._validateWithParentLevel=function(a){var g=this.width(),V=this.height(),T=this.tileWidth(),it=this.tileHeight(),rt=this.numHorizontalTiles(),ot=this.numVerticalTiles(),at=a.width(),ht=a.height(),pt=a.tileWidth(),_t=a.tileHeight(),Et=a.numHorizontalTiles(),It=a.numVerticalTiles();if(g%at!=0)throw new Error("Level width must be multiple of parent level: "+g+" vs. "+at);if(V%ht!=0)throw new Error("Level height must be multiple of parent level: "+V+" vs. "+ht);if(rt%Et!=0)throw new Error("Number of horizontal tiles must be multiple of parent level: "+rt+" ("+g+"/"+T+") vs. "+Et+" ("+at+"/"+pt+")");if(ot%It!=0)throw new Error("Number of vertical tiles must be multiple of parent level: "+ot+" ("+V+"/"+it+") vs. "+It+" ("+ht+"/"+_t+")")},N.prototype.maxTileSize=function(){for(var a=0,g=0;g<this.levelList.length;g++){var V=this.levelList[g];a=Math.max(a,V.tileWidth,V.tileHeight)}return a},N.prototype.levelTiles=function(a,g){var V=this.levelList.indexOf(a),T=a.numHorizontalTiles()-1,it=a.numVerticalTiles()-1;g=g||[];for(var rt=0;rt<Y.length;rt++)for(var ot=Y[rt],at=0;at<=T;at++)for(var ht=0;ht<=it;ht++)g.push(new U(ot,at,ht,V,this));return g},N.prototype._closestTile=function(a,g){var V=this._vec;x.set(V,0,0,0,1);var T=R.create();R.multiply(T,a.inverseViewMatrix(),a.inverseProjection()),x.transformMat4(V,V,T);var it=1/0,rt=null;for(var ot in H){var ht=1-d.dot(H[ot],V);ht<it&&(it=ht,rt=ot)}for(var pt=Math.max(Math.abs(V[0]),Math.abs(V[1]),Math.abs(V[2]))/.5,_t=0;_t<3;_t++)V[_t]=V[_t]/pt;var Et=O[rt];W(V,0,-Et.x,-Et.y);var It=this.levelList.indexOf(g),xt=g.numHorizontalTiles(),Tt=g.numVerticalTiles();return new U(rt,L(Math.floor((.5+V[0])*xt),0,xt-1),L(Math.floor((.5-V[1])*Tt),0,Tt-1),It,this)},N.prototype.visibleTiles=function(a,g,V){var T=this._viewSize,it=this._tileSearcher;if(V=V||[],a.size(T),0===T.width||0===T.height)return V;var rt=this._closestTile(a,g);return it.search(a,rt,V),V},N.Tile=N.prototype.Tile=U,N.type=N.prototype.type="cube",U.type=U.prototype.type="cube",X.exports=N},7216:(X,k,s)=>{"use strict";var c=s(5946),A=s(3864),E=s(5593),p=s(8279),v=s(9868),l=s(4699);function m(_,d){this.z=_,this._geometry=d,this._level=d.levelList[_]}function L(_){this.constructor.super_.call(this,_),this._width=_.width}function S(_){if("array"!==l(_))throw new Error("Level list must be an array");this.levelList=p.makeLevelList(_,L),this.selectableLevelList=p.makeSelectableLevelList(this.levelList)}m.prototype.rotX=function(){return 0},m.prototype.rotY=function(){return 0},m.prototype.centerX=function(){return.5},m.prototype.centerY=function(){return.5},m.prototype.scaleX=function(){return 1},m.prototype.scaleY=function(){return 1},m.prototype.parent=function(){return 0===this.z?null:new m(this.z-1,this._geometry)},m.prototype.children=function(_){return this.z===this._geometry.levelList.length-1?null:((_=_||[]).push(new m(this.z+1,this._geometry)),_)},m.prototype.neighbors=function(){return[]},m.prototype.hash=function(){return A(this.z)},m.prototype.equals=function(_){return this._geometry===_._geometry&&this.z===_.z},m.prototype.cmp=function(_){return E(this.z,_.z)},m.prototype.str=function(){return"EquirectTile("+tile.z+")"},c(L,v),L.prototype.width=function(){return this._width},L.prototype.height=function(){return this._width/2},L.prototype.tileWidth=function(){return this._width},L.prototype.tileHeight=function(){return this._width/2},S.prototype.maxTileSize=function(){for(var _=0,d=0;d<this.levelList.length;d++){var x=this.levelList[d];_=Math.max(_,x.tileWidth,x.tileHeight)}return _},S.prototype.levelTiles=function(_,d){var x=this.levelList.indexOf(_);return(d=d||[]).push(new m(x,this)),d},S.prototype.visibleTiles=function(_,d,x){var R=new m(this.levelList.indexOf(d),this);(x=x||[]).length=0,x.push(R)},S.Tile=S.prototype.Tile=m,S.type=S.prototype.type="equirect",m.type=m.prototype.type="equirect",X.exports=S},4040:(X,k,s)=>{"use strict";var c=s(5946),A=s(3864),E=s(9799),p=s(7299),v=s(9868),l=s(8279).makeLevelList,m=s(8279).makeSelectableLevelList,L=s(6438),S=s(4501),_=s(5593),d=s(4699),x=s(335).vec2,R=s(335).vec4,Y=[[0,1],[1,0],[0,-1],[-1,0]];function O(H,P,w,B){this.x=H,this.y=P,this.z=w,this._geometry=B,this._level=B.levelList[w]}function u(H){this.constructor.super_.call(this,H),this._width=H.width,this._height=H.height,this._tileWidth=H.tileWidth,this._tileHeight=H.tileHeight}function W(H){if("array"!==d(H))throw new Error("Level list must be an array");this.levelList=l(H,u),this.selectableLevelList=m(this.levelList);for(var P=1;P<this.levelList.length;P++)this.levelList[P]._validateWithParentLevel(this.levelList[P-1]);this._tileSearcher=new E(this),this._neighborsCache=new p(64),this._vec=R.create(),this._viewSize={}}O.prototype.rotX=function(){return 0},O.prototype.rotY=function(){return 0},O.prototype.centerX=function(){var H=this._level.width(),P=this._level.tileWidth();return(this.x*P+.5*this.width())/H-.5},O.prototype.centerY=function(){var H=this._level.height(),P=this._level.tileHeight();return.5-(this.y*P+.5*this.height())/H},O.prototype.scaleX=function(){var H=this._level.width();return this.width()/H},O.prototype.scaleY=function(){var H=this._level.height();return this.height()/H},O.prototype.width=function(){var H=this._level.width(),P=this._level.tileWidth();return this.x===this._level.numHorizontalTiles()-1&&S(H,P)||P},O.prototype.height=function(){var H=this._level.height(),P=this._level.tileHeight();return this.y===this._level.numVerticalTiles()-1&&S(H,P)||P},O.prototype.levelWidth=function(){return this._level.width()},O.prototype.levelHeight=function(){return this._level.height()},O.prototype.vertices=function(H){H||(H=[x.create(),x.create(),x.create(),x.create()]);var P=this.centerX()-this.scaleX()/2,w=this.centerX()+this.scaleX()/2,B=this.centerY()-this.scaleY()/2,D=this.centerY()+this.scaleY()/2;return x.set(H[0],P,D),x.set(H[1],w,D),x.set(H[2],w,B),x.set(H[3],P,B),H},O.prototype.parent=function(){if(0===this.z)return null;var H=this._geometry,P=this.z-1;return new O(Math.floor(this.x/2),Math.floor(this.y/2),P,H)},O.prototype.children=function(H){if(this.z===this._geometry.levelList.length-1)return null;var P=this._geometry,w=this.z+1;return(H=H||[]).push(new O(2*this.x,2*this.y,w,P)),H.push(new O(2*this.x,2*this.y+1,w,P)),H.push(new O(2*this.x+1,2*this.y,w,P)),H.push(new O(2*this.x+1,2*this.y+1,w,P)),H},O.prototype.neighbors=function(){var H=this._geometry,P=H._neighborsCache,w=P.get(this);if(w)return w;for(var B=this.x,D=this.y,Q=this.z,b=this._level,U=b.numHorizontalTiles()-1,$=b.numVerticalTiles()-1,N=[],a=0;a<Y.length;a++){var T=B+Y[a][0],it=D+Y[a][1];0<=T&&T<=U&&0<=it&&it<=$&&N.push(new O(T,it,Q,H))}return P.set(this,N),N},O.prototype.hash=function(){return A(this.z,this.y,this.x)},O.prototype.equals=function(H){return this._geometry===H._geometry&&this.z===H.z&&this.y===H.y&&this.x===H.x},O.prototype.cmp=function(H){return _(this.z,H.z)||_(this.y,H.y)||_(this.x,H.x)},O.prototype.str=function(){return"FlatTile("+tile.x+", "+tile.y+", "+tile.z+")"},c(u,v),u.prototype.width=function(){return this._width},u.prototype.height=function(){return this._height},u.prototype.tileWidth=function(){return this._tileWidth},u.prototype.tileHeight=function(){return this._tileHeight},u.prototype._validateWithParentLevel=function(H){var P=this.width(),w=this.height(),B=this.tileWidth(),D=this.tileHeight(),Q=H.width(),b=H.height(),U=H.tileWidth(),$=H.tileHeight();return P%Q!=0?new Error("Level width must be multiple of parent level: "+P+" vs. "+Q):w%b!=0?new Error("Level height must be multiple of parent level: "+w+" vs. "+b):B%U!=0?new Error("Level tile width must be multiple of parent level: "+B+" vs. "+U):D%$!=0?new Error("Level tile height must be multiple of parent level: "+D+" vs. "+$):void 0},W.prototype.maxTileSize=function(){for(var H=0,P=0;P<this.levelList.length;P++){var w=this.levelList[P];H=Math.max(H,w.tileWidth,w.tileHeight)}return H},W.prototype.levelTiles=function(H,P){var w=this.levelList.indexOf(H),B=H.numHorizontalTiles()-1,D=H.numVerticalTiles()-1;P||(P=[]);for(var Q=0;Q<=B;Q++)for(var b=0;b<=D;b++)P.push(new O(Q,b,w,this));return P},W.prototype._closestTile=function(H,P){var w=this._vec;R.set(w,0,0,1,1),R.transformMat4(w,w,H.inverseProjection());var B=.5+w[0],D=.5-w[1],Q=this.levelList.indexOf(P),b=P.width(),U=P.height(),$=P.tileWidth(),N=P.tileHeight(),a=P.numHorizontalTiles(),g=P.numVerticalTiles();return new O(L(Math.floor(B*b/$),0,a-1),L(Math.floor(D*U/N),0,g-1),Q,this)},W.prototype.visibleTiles=function(H,P,w){var B=this._viewSize,D=this._tileSearcher;if(w=w||[],H.size(B),0===B.width||0===B.height)return w;var Q=this._closestTile(H,P);if(!D.search(H,Q,w))throw new Error("Starting tile is not visible");return w},W.Tile=W.prototype.Tile=O,W.type=W.prototype.type="flat",O.type=O.prototype.type="flat",X.exports=W},9868:X=>{"use strict";function k(s){this._fallbackOnly=!!s.fallbackOnly}k.prototype.numHorizontalTiles=function(){return Math.ceil(this.width()/this.tileWidth())},k.prototype.numVerticalTiles=function(){return Math.ceil(this.height()/this.tileHeight())},k.prototype.fallbackOnly=function(){return this._fallbackOnly},X.exports=k},8279:(X,k,s)=>{"use strict";var c=s(5593);X.exports={makeLevelList:function A(p,v){for(var l=[],m=0;m<p.length;m++)l.push(new v(p[m]));return l.sort(function(L,S){return c(L.width(),S.width())}),l},makeSelectableLevelList:function E(p){for(var v=[],l=0;l<p.length;l++)p[l]._fallbackOnly||v.push(p[l]);if(!v.length)throw new Error("No selectable levels in list");return v}}},7609:(X,k,s)=>{"use strict";X.exports={WebGlStage:s(5),WebGlCubeRenderer:s(7081),WebGlFlatRenderer:s(5391),WebGlEquirectRenderer:s(4299),registerDefaultRenderers:s(133),CubeGeometry:s(2363),FlatGeometry:s(4040),EquirectGeometry:s(7216),RectilinearView:s(9421),FlatView:s(5675),ImageUrlSource:s(2581),SingleAssetSource:s(6169),StaticAsset:s(2120),DynamicAsset:s(3587),TextureStore:s(522),Layer:s(3268),RenderLoop:s(3340),KeyControlMethod:s(1174),DragControlMethod:s(2074),QtvrControlMethod:s(4016),ScrollZoomControlMethod:s(130),PinchZoomControlMethod:s(131),VelocityControlMethod:s(9752),ElementPressControlMethod:s(9041),Controls:s(7708),Dynamics:s(4809),Viewer:s(2025),Scene:s(8393),Hotspot:s(2513),HotspotContainer:s(2523),colorEffects:s(3247),registerDefaultControls:s(9512),autorotate:s(2847),util:{async:s(3594),cancelize:s(779),chain:s(3559),clamp:s(6438),clearOwnProperties:s(6873),cmp:s(5593),compose:s(2800),convertFov:s(4224),decimal:s(3716),defaults:s(7802),defer:s(8792),degToRad:s(9155),delay:s(645),dom:s(1936),extend:s(2544),hash:s(3864),inherits:s(5946),mod:s(4501),noop:s(6158),now:s(242),once:s(9364),pixelRatio:s(3367),radToDeg:s(2731),real:s(1097),retry:s(1687),tween:s(58),type:s(4699)},dependencies:{bowser:s(358),glMatrix:s(335),eventEmitter:s(8843),hammerjs:s(1524)}}},6737:(X,k,s)=>{"use strict";var c=s(2120),A=s(1608),p=(s(358),s(3573)),v=s(9364),l=!!p.createImageBitmap,m={imageOrientation:"flipY",premultiplyAlpha:"premultiply"};function L(S){this._stage=S}L.prototype.loadImage=function(S,_,d){var x=this,R=new Image;R.crossOrigin="anonymous";var z=_&&_.x||0,Y=_&&_.y||0,O=_&&_.width||1,u=_&&_.height||1;return d=v(d),R.onload=function(){x._handleLoad(R,z,Y,O,u,d)},R.onerror=function(){x._handleError(S,d)},R.src=S,function W(){R.onload=R.onerror=null,R.src="",d.apply(null,arguments)}},L.prototype._handleLoad=function(S,_,d,x,R,z){if(0!==_||0!==d||1!==x||1!==R)if(_*=S.naturalWidth,d*=S.naturalHeight,x*=S.naturalWidth,R*=S.naturalHeight,l)p.createImageBitmap(S,_,d,x,R,m).then(function(u){z(null,new c(u))});else{var Y=document.createElement("canvas");Y.width=x,Y.height=R,Y.getContext("2d").drawImage(S,_,d,x,R,0,0,x,R),z(null,new c(Y))}else z(null,new c(S))},L.prototype._handleError=function(S,_){_(new A("Network error: "+S))},X.exports=L},4159:(X,k,s)=>{"use strict";var c=s(335).mat4,A=s(335).vec3,E=s(6873),p=s(7666),v=p.createConstantBuffers,l=p.destroyConstantBuffers,m=p.createShaderProgram,L=p.destroyShaderProgram,S=p.enableAttributes,_=p.disableAttributes,d=p.setViewport,x=p.setupPixelEffectUniforms,R=p.setDepth,z=p.setTexture,Y=s(4448),O=s(4278),u=[0,1,2,0,2,3],W=[-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0],H=[0,0,1,0,1,1,0,1],P=["aVertexPosition","aTextureCoord"],w=["uDepth","uOpacity","uSampler","uProjMatrix","uViewMatrix","uModelMatrix","uViewportMatrix","uColorOffset","uColorMatrix"];function B(D){this.gl=D,this.projMatrix=c.create(),this.viewMatrix=c.create(),this.viewportMatrix=c.create(),this.translateVector=A.create(),this.scaleVector=A.create(),this.constantBuffers=v(D,u,W,H),this.shaderProgram=m(D,Y,O,P,w)}B.prototype.destroy=function(){l(this.gl,this.constantBuffers),L(this.gl,this.shaderProgram),E(this)},B.prototype.startLayer=function(D,Q){var b=this.gl,U=this.shaderProgram,$=this.constantBuffers,N=this.viewportMatrix;b.useProgram(U),S(b,U),d(b,D,Q,N),b.uniformMatrix4fv(U.uViewportMatrix,!1,N),b.bindBuffer(b.ARRAY_BUFFER,$.vertexPositions),b.vertexAttribPointer(U.aVertexPosition,3,b.FLOAT,b.FALSE,0,0),b.bindBuffer(b.ARRAY_BUFFER,$.textureCoords),b.vertexAttribPointer(U.aTextureCoord,2,b.FLOAT,b.FALSE,0,0),x(b,D.effects(),{opacity:U.uOpacity,colorOffset:U.uColorOffset,colorMatrix:U.uColorMatrix})},B.prototype.endLayer=function(D,Q){_(this.gl,this.shaderProgram)},B.prototype.renderTile=function(D,Q,b,U){var $=this.gl,N=this.shaderProgram,a=this.constantBuffers,g=this.projMatrix,V=this.viewMatrix,T=this.translateVector,it=this.scaleVector;c.copy(g,b.view().projection()),$.uniformMatrix4fv(N.uProjMatrix,!1,g),c.copy(V,b.view().viewMatrix()),$.uniformMatrix4fv(N.uViewMatrix,!1,V),T[0]=D.centerX(),T[1]=D.centerY(),T[2]=-.5,it[0]=D.scaleX(),it[1]=D.scaleY(),it[2]=1;var rt=c.create();c.rotateX(rt,rt,D.rotX()),c.rotateY(rt,rt,D.rotY()),c.translate(rt,rt,T),c.scale(rt,rt,it),$.uniformMatrix4fv(N.uModelMatrix,!1,rt),R($,N,U,D.z),z($,N,Q),$.bindBuffer($.ELEMENT_ARRAY_BUFFER,a.vertexIndices),$.drawElements($.TRIANGLES,u.length,$.UNSIGNED_SHORT,0)},X.exports=B},7666:(X,k,s)=>{"use strict";var E=s(6438),p=s(335).vec4,v=s(335).vec3,l=s(335).mat4;function m(b,U,$){var N=b.createShader(U);if(b.shaderSource(N,$),b.compileShader(N),!b.getShaderParameter(N,b.COMPILE_STATUS))throw b.getShaderInfoLog(N);return N}function _(b,U,$,N){var a=b.createBuffer();return b.bindBuffer(U,a),b.bufferData(U,N,$),a}var H=p.create(),P=l.create();l.identity(P);var B=v.create(),D=v.create();X.exports={createShaderProgram:function L(b,U,$,N,a){var g=m(b,b.VERTEX_SHADER,U),V=m(b,b.FRAGMENT_SHADER,$),T=b.createProgram();if(b.attachShader(T,g),b.attachShader(T,V),b.linkProgram(T),!b.getProgramParameter(T,b.LINK_STATUS))throw b.getProgramInfoLog(T);for(var it=0;it<N.length;it++){var rt=N[it];if(T[rt]=b.getAttribLocation(T,rt),-1===T[rt])throw new Error("Shader program has no "+rt+" attribute")}for(var ot=0;ot<a.length;ot++){var at=a[ot];if(T[at]=b.getUniformLocation(T,at),-1===T[at])throw new Error("Shader program has no "+at+" uniform")}return T},destroyShaderProgram:function S(b,U){for(var $=b.getAttachedShaders(U),N=0;N<$.length;N++){var a=$[N];b.detachShader(U,a),b.deleteShader(a)}b.deleteProgram(U)},createConstantBuffers:function d(b,U,$,N){return{vertexIndices:_(b,b.ELEMENT_ARRAY_BUFFER,b.STATIC_DRAW,new Uint16Array(U)),vertexPositions:_(b,b.ARRAY_BUFFER,b.STATIC_DRAW,new Float32Array($)),textureCoords:_(b,b.ARRAY_BUFFER,b.STATIC_DRAW,new Float32Array(N))}},destroyConstantBuffers:function x(b,U){b.deleteBuffer(U.vertexIndices),b.deleteBuffer(U.vertexPositions),b.deleteBuffer(U.textureCoords)},enableAttributes:function R(b,U){for(var $=b.getProgramParameter(U,b.ACTIVE_ATTRIBUTES),N=0;N<$;N++)b.enableVertexAttribArray(N)},disableAttributes:function z(b,U){for(var $=b.getProgramParameter(U,b.ACTIVE_ATTRIBUTES),N=0;N<$;N++)b.disableVertexAttribArray(N)},setTexture:function Y(b,U,$){b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,$._texture),b.uniform1i(U.uSampler,0)},setDepthmapTexture:function O(b,U,$){b.activeTexture(b.TEXTURE1),b.bindTexture(b.TEXTURE_2D,$._texture),b.uniform1i(U.uDepthmap,1)},setDepth:function u(b,U,$,N){b.uniform1f(U.uDepth,(256*($+1)-N)/65536)},setViewport:function Q(b,U,$,N){if(0===$.x&&1===$.width&&0===$.y&&1===$.height)return b.viewport(0,0,b.drawingBufferWidth,b.drawingBufferHeight),void l.identity(N);var a=$.x,g=E(a,0,1),V=g-a,it=E($.width-V,0,1-g),rt=$.width-it,ot=1-$.height-$.y,at=E(ot,0,1),ht=at-ot,_t=E($.height-ht,0,1-at),Et=$.height-_t;v.set(D,$.width/it,$.height/_t,1),v.set(B,(rt-V)/it,(Et-ht)/_t,0),l.identity(N),l.translate(N,N,B),l.scale(N,N,D),b.viewport(b.drawingBufferWidth*g,b.drawingBufferHeight*at,b.drawingBufferWidth*it,b.drawingBufferHeight*_t)},setupPixelEffectUniforms:function w(b,U,$){var N=1;U&&null!=U.opacity&&(N=U.opacity),b.uniform1f($.opacity,N);var a=H;U&&U.colorOffset&&(a=U.colorOffset),b.uniform4fv($.colorOffset,a);var g=P;U&&U.colorMatrix&&(g=U.colorMatrix),b.uniformMatrix4fv($.colorMatrix,!1,g)}}},7081:(X,k,s)=>{"use strict";var c=s(4159);function E(){this.constructor.super_.apply(this,arguments)}s(5946)(E,c),X.exports=E},6964:(X,k,s)=>{"use strict";var c=s(335).mat4,A=s(335).vec3,E=s(6873),p=s(7666),v=p.createConstantBuffers,l=p.destroyConstantBuffers,m=p.createShaderProgram,L=p.destroyShaderProgram,S=p.enableAttributes,_=p.disableAttributes,d=p.setViewport,x=p.setupPixelEffectUniforms,R=p.setDepth,z=p.setTexture,Y=p.setDepthmapTexture,O=s(1099),u=s(4401),W=[],H=[],P=[],Q=["aVertexPosition","aTextureCoord"],b=["uDepth","uOpacity","uSampler","uDepthmap","uProjMatrix","uViewMatrix","uModelMatrix","uViewportMatrix","uColorOffset","uColorMatrix"];function U($,N){this.gl=$,this.projMatrix=c.create(),this.viewMatrix=c.create(),this.viewportMatrix=c.create(),this.translateVector=A.create(),this.scaleVector=A.create(),function D($,N){for(var a=0;a<=N;a++)for(var g=a/N,V=0;V<=$;V++){var T=V/$;if(H.push(T-.5,g-.5,0),P.push(T,g),a<N&&V<$){var at=a*($+1)+V,ht=at+1,pt=(a+1)*($+1)+V;W.push(at,ht,pt,ht,pt+1,pt)}}}(N&&N.widthSegments?N.widthSegments:40,N&&N.heightSegments?N.heightSegments:40),this.constantBuffers=v($,W,H,P),this.shaderProgram=m($,O,u,Q,b)}U.prototype.destroy=function(){l(this.gl,this.constantBuffers),L(this.gl,this.shaderProgram),E(this)},U.prototype.startLayer=function($,N){var a=this.gl,g=this.shaderProgram,V=this.constantBuffers,T=this.viewportMatrix;a.useProgram(g),S(a,g),d(a,$,N,T),a.uniformMatrix4fv(g.uViewportMatrix,!1,T),a.bindBuffer(a.ARRAY_BUFFER,V.vertexPositions),a.vertexAttribPointer(g.aVertexPosition,3,a.FLOAT,a.FALSE,0,0),a.bindBuffer(a.ARRAY_BUFFER,V.textureCoords),a.vertexAttribPointer(g.aTextureCoord,2,a.FLOAT,a.FALSE,0,0),x(a,$.effects(),{opacity:g.uOpacity,colorOffset:g.uColorOffset,colorMatrix:g.uColorMatrix})},U.prototype.endLayer=function($,N){_(this.gl,this.shaderProgram)},U.prototype.renderTile=function($,N,a,g){var V=this.gl,T=this.shaderProgram,it=this.constantBuffers,rt=this.projMatrix,ot=this.viewMatrix,at=this.translateVector,ht=this.scaleVector;c.copy(rt,a.view().projection()),V.uniformMatrix4fv(T.uProjMatrix,!1,rt),c.copy(ot,a.view().viewMatrix()),V.uniformMatrix4fv(T.uViewMatrix,!1,ot),at[0]=$.centerX(),at[1]=$.centerY(),at[2]=-.5,ht[0]=$.scaleX(),ht[1]=$.scaleY(),ht[2]=1;var pt=c.create();c.rotateY(pt,pt,-Math.PI/2),c.rotateX(pt,pt,$.rotX()),c.rotateY(pt,pt,$.rotY()),c.translate(pt,pt,at),c.scale(pt,pt,ht),V.uniformMatrix4fv(T.uModelMatrix,!1,pt),R(V,T,g,$.z),z(V,T,N),Y(V,T,a.depthmapStore().texture()),V.bindBuffer(V.ELEMENT_ARRAY_BUFFER,it.vertexIndices),V.drawElements(V.TRIANGLES,W.length,V.UNSIGNED_SHORT,0)},X.exports=U},4299:(X,k,s)=>{"use strict";var c=s(335).mat4,A=s(6873),E=s(7666),p=E.createConstantBuffers,v=E.destroyConstantBuffers,l=E.createShaderProgram,m=E.destroyShaderProgram,L=E.enableAttributes,S=E.disableAttributes,_=E.setViewport,d=E.setupPixelEffectUniforms,x=E.setDepth,R=E.setTexture,z=s(3378),Y=s(243),O=[0,1,2,0,2,3],u=[-1,-1,0,1,-1,0,1,1,0,-1,1,0],W=[0,0,1,0,1,1,0,1],H=["aVertexPosition"],P=["uDepth","uOpacity","uSampler","uInvProjMatrix","uViewportMatrix","uColorOffset","uColorMatrix","uTextureX","uTextureY","uTextureWidth","uTextureHeight"];function w(B){this.gl=B,this.invProjMatrix=c.create(),this.viewportMatrix=c.create(),this.constantBuffers=p(B,O,u,W),this.shaderProgram=l(B,z,Y,H,P)}w.prototype.destroy=function(){v(this.gl,this.constantBuffers),m(this.gl,this.shaderProgram),A(this)},w.prototype.startLayer=function(B,D){var Q=this.gl,b=this.shaderProgram,U=this.constantBuffers,$=this.invProjMatrix,N=this.viewportMatrix;Q.useProgram(b),L(Q,b),_(Q,B,D,N),Q.uniformMatrix4fv(b.uViewportMatrix,!1,N),Q.bindBuffer(Q.ARRAY_BUFFER,U.vertexPositions),Q.vertexAttribPointer(b.aVertexPosition,3,Q.FLOAT,Q.FALSE,0,0),Q.bindBuffer(Q.ARRAY_BUFFER,U.textureCoords),c.copy($,B.view().projection()),c.invert($,$),Q.uniformMatrix4fv(b.uInvProjMatrix,!1,$);var a=B.effects().textureCrop||{},V=null!=a.y?a.y:0,T=null!=a.width?a.width:1,it=null!=a.height?a.height:1;Q.uniform1f(b.uTextureX,null!=a.x?a.x:0),Q.uniform1f(b.uTextureY,V),Q.uniform1f(b.uTextureWidth,T),Q.uniform1f(b.uTextureHeight,it),d(Q,B.effects(),{opacity:b.uOpacity,colorOffset:b.uColorOffset,colorMatrix:b.uColorMatrix})},w.prototype.endLayer=function(B,D){S(this.gl,this.shaderProgram)},w.prototype.renderTile=function(B,D,Q,b){var U=this.gl,$=this.shaderProgram,N=this.constantBuffers;x(U,$,b,B.z),R(U,$,D),U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,N.vertexIndices),U.drawElements(U.TRIANGLES,O.length,U.UNSIGNED_SHORT,0)},X.exports=w},5391:(X,k,s)=>{"use strict";var c=s(4159);function E(){this.constructor.super_.apply(this,arguments)}s(5946)(E,c),X.exports=E},133:(X,k,s)=>{"use strict";var c=s(5391),A=s(7081),E=s(6964),p=s(4299);X.exports=function v(l){if("webgl"!==l.type)throw new Error("Unknown stage type: "+l.type);l.registerRenderer("flat","flat",c),l.registerRenderer("cube","rectilinear",A),l.registerRenderer("cube+depth","rectilinear",E),l.registerRenderer("equirect","rectilinear",p)}},4401:X=>{"use strict";X.exports=["#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","#else","precision mediump float;","#endif","uniform sampler2D uSampler;","uniform float uOpacity;","uniform vec4 uColorOffset;","uniform mat4 uColorMatrix;","varying vec2 vTextureCoord;","\n  void main(void) {\n    if (!gl_FrontFacing) {\n      discard; // Discard the front-facing triangles\n    } else {\n      vec4 color = texture2D(uSampler, vTextureCoord) * uColorMatrix + uColorOffset;\n      gl_FragColor = vec4(color.rgba * uOpacity);\n    }\n  }\n  "].join("\n")},243:X=>{"use strict";X.exports=["#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","#else","precision mediump float","#endif","uniform sampler2D uSampler;","uniform float uOpacity;","uniform float uTextureX;","uniform float uTextureY;","uniform float uTextureWidth;","uniform float uTextureHeight;","uniform vec4 uColorOffset;","uniform mat4 uColorMatrix;","varying vec4 vRay;","const float PI = 3.14159265358979323846264;","void main(void) {","  float r = inversesqrt(vRay.x * vRay.x + vRay.y * vRay.y + vRay.z * vRay.z);","  float phi  = acos(vRay.y * r);","  float theta = atan(vRay.x, -1.0*vRay.z);","  float s = 0.5 + 0.5 * theta / PI;","  float t = 1.0 - phi / PI;","  s = s * uTextureWidth + uTextureX;","  t = t * uTextureHeight + uTextureY;","  vec4 color = texture2D(uSampler, vec2(s, t)) * uColorMatrix + uColorOffset;","  gl_FragColor = vec4(color.rgba * uOpacity);","}"].join("\n")},4278:X=>{"use strict";X.exports=["#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","#else","precision mediump float;","#endif","uniform sampler2D uSampler;","uniform float uOpacity;","uniform vec4 uColorOffset;","uniform mat4 uColorMatrix;","varying vec2 vTextureCoord;","void main(void) {","\nif (!gl_FrontFacing) {\n  discard; // Discard the front-facing triangles\n} else {\n  vec4 color = texture2D(uSampler, vTextureCoord) * uColorMatrix + uColorOffset;\n  gl_FragColor = vec4(color.rgba * uOpacity);\n}\n","}"].join("\n")},1099:X=>{"use strict";X.exports=["attribute vec3 aVertexPosition;","attribute vec2 aTextureCoord;","uniform sampler2D uDepthmap;","uniform float uDepth;","uniform mat4 uViewportMatrix;","uniform mat4 uProjMatrix;","uniform mat4 uViewMatrix;","uniform mat4 uModelMatrix;","varying vec2 vTextureCoord;","\n  float i(in float a, in float b) {\n    return b == 0.0 ? sign(a)*1.570796 : atan(a, b);\n  }\n\n  void main(void) {\n    vec3 c = normalize(vec3(uModelMatrix * vec4(aVertexPosition, 1.0)));\n\n    float x = (1.0 - i(-c.z, c.x)/3.141593)*0.5;\n    float y = 0.5 - i(-c.y, sqrt(c.x*c.x + c.z*c.z))/3.141593;\n    vec4 f = texture2D(uDepthmap, vec2(x, y));\n\n    float j = (f.r*65536.0 + f.g*256.0 + f.b)/65793.0;\n    vec3 b = c*(1.0 - j);\n    vec3 a = vec3(uViewMatrix * vec4(b.z, b.y, -b.x, 1));\n\n    gl_Position = uViewportMatrix * uProjMatrix * vec4(a, 1.0);\n    gl_Position.z = uDepth * gl_Position.w;\n    vTextureCoord = aTextureCoord;\n  }\n  "].join("\n")},3378:X=>{"use strict";X.exports=["attribute vec3 aVertexPosition;","uniform float uDepth;","uniform mat4 uViewportMatrix;","uniform mat4 uInvProjMatrix;","varying vec4 vRay;","void main(void) {","  vRay = uInvProjMatrix * vec4(aVertexPosition.xy, 1.0, 1.0);","  gl_Position = uViewportMatrix * vec4(aVertexPosition.xy, uDepth, 1.0);","}"].join("\n")},4448:X=>{"use strict";X.exports=["attribute vec3 aVertexPosition;","attribute vec2 aTextureCoord;","uniform float uDepth;","uniform mat4 uViewportMatrix;","uniform mat4 uProjMatrix;","uniform mat4 uViewMatrix;","uniform mat4 uModelMatrix;","varying vec2 vTextureCoord;","void main(void) {","  gl_Position = uViewportMatrix * uProjMatrix * uViewMatrix * uModelMatrix * vec4(aVertexPosition, 1.0);","  gl_Position.z = uDepth * gl_Position.w;","  vTextureCoord = aTextureCoord;","}"].join("\n")},2581:(X,k,s)=>{"use strict";var c=s(8843),A=s(1608),E=s(2412),p=s(3559),v=s(645),l=s(242),m={x:"x",y:"y",z:"z",f:"face"};function d(R,z){this._loadPool=new E({concurrency:(z=z||{}).concurrency||4}),this._retryDelay=z.retryDelay||1e4,this._retryMap={},this._sourceFromTile=R}function x(R){return new RegExp("\\{("+R+")\\}","g")}c(d),d.prototype.loadAsset=function(R,z,Y){var Q,O=this,u=this._retryDelay,W=this._retryMap,H=this._sourceFromTile(z),P=H.url,B=R.loadImage.bind(R,P,H.rect),b=W[P];if(null!=b){var $=l()-b;$<u?Q=u-$:(Q=0,delete W[P])}var N=v.bind(null,Q);return p(N,function(a){return O._loadPool.push(B,function(g,V){g?(g instanceof A&&(W[P]=l(),O.emit("networkError",g,z)),a(g,z)):(delete W[P],a(null,z,V))})})(Y)},d.fromString=function(R,z){var Y=(z=z||{})&&z.cubeMapPreviewFaceOrder||"bdflru";return new d(z.cubeMapPreviewUrl?function W(P){return 0===P.z?function H(P){var w=Y.indexOf(P.face)/6;return{url:z.cubeMapPreviewUrl,rect:{x:0,y:w,width:1,height:1/6}}}(P):u(P)}:u,z);function u(P){var w=R;for(var B in m){var D=m[B],Q=x(B),b=P.hasOwnProperty(D)?P[D]:"";w=w.replace(Q,b)}return{url:w}}},X.exports=d},6169:X=>{"use strict";function k(s){this._asset=s}k.prototype.asset=function(){return this._asset},k.prototype.loadAsset=function(s,c,A){var E=this,p=setTimeout(function(){A(null,c,E._asset)},0);return function v(){clearTimeout(p),A.apply(null,arguments)}},X.exports=k},3205:X=>{"use strict";function k(){this._renderers={}}k.prototype.set=function(s,c,A){this._renderers[s]||(this._renderers[s]={}),this._renderers[s][c]=A},k.prototype.get=function(s,c){return this._renderers[s]&&this._renderers[s][c]||null},X.exports=k},2419:(X,k,s)=>{"use strict";var c=s(8843),A=s(5169),E=s(1045),p=s(3594),v=s(779),l=s(6873),m=s(3205);function L(d,x){return d.cmp(x)}function S(d,x){return-d.cmp(x)}function _(d){this._progressive=!(!d||!d.progressive),this._layers=[],this._renderers=[],this._tilesToLoad=[],this._tilesToRender=[],this._tmpVisible=[],this._tmpChildren=[],this._width=0,this._height=0,this._tmpRect={},this._tmpSize={},this._createTextureWorkQueue=new A,this._emitRenderInvalid=this._emitRenderInvalid.bind(this),this._rendererRegistry=new m}c(_),_.prototype.destroy=function(){this.removeAllLayers(),l(this)},_.prototype.registerRenderer=function(d,x,R){return this._rendererRegistry.set(d,x,R)},_.prototype.domElement=function(){throw new Error("Stage implementation must override domElement")},_.prototype.width=function(){return this._width},_.prototype.height=function(){return this._height},_.prototype.size=function(d){return(d=d||{}).width=this._width,d.height=this._height,d},_.prototype.setSize=function(d){this._width=d.width,this._height=d.height,this.setSizeForType(),this.emit("resize"),this._emitRenderInvalid()},_.prototype.setSizeForType=function(d){throw new Error("Stage implementation must override setSizeForType")},_.prototype.loadImage=function(){throw new Error("Stage implementation must override loadImage")},_.prototype._emitRenderInvalid=function(){this.emit("renderInvalid")},_.prototype.validateLayer=function(d){throw new Error("Stage implementation must override validateLayer")},_.prototype.listLayers=function(){return[].concat(this._layers)},_.prototype.hasLayer=function(d){return this._layers.indexOf(d)>=0},_.prototype.addLayer=function(d,x){if(this._layers.indexOf(d)>=0)throw new Error("Layer already in stage");if(null==x&&(x=this._layers.length),x<0||x>this._layers.length)throw new Error("Invalid layer position");this.validateLayer(d);var R=d.geometry().type;d.depthmap()&&(R+="+depth");var z=d.view().type,Y=this._rendererRegistry.get(R,z);if(!Y)throw new Error("No "+this.type+" renderer avaiable for "+R+" geometry and "+z+" view");var O=this.createRenderer(Y);this._layers.splice(x,0,d),this._renderers.splice(x,0,O),d.addEventListener("viewChange",this._emitRenderInvalid),d.addEventListener("effectsChange",this._emitRenderInvalid),d.addEventListener("fixedLevelChange",this._emitRenderInvalid),d.addEventListener("textureStoreChange",this._emitRenderInvalid),this._emitRenderInvalid()},_.prototype.moveLayer=function(d,x){var R=this._layers.indexOf(d);if(R<0)throw new Error("No such layer in stage");if(x<0||x>=this._layers.length)throw new Error("Invalid layer position");d=this._layers.splice(R,1)[0];var z=this._renderers.splice(R,1)[0];this._layers.splice(x,0,d),this._renderers.splice(x,0,z),this._emitRenderInvalid()},_.prototype.removeLayer=function(d){var x=this._layers.indexOf(d);if(x<0)throw new Error("No such layer in stage");var R=this._layers.splice(x,1)[0],z=this._renderers.splice(x,1)[0];this.destroyRenderer(z),R.removeEventListener("viewChange",this._emitRenderInvalid),R.removeEventListener("effectsChange",this._emitRenderInvalid),R.removeEventListener("fixedLevelChange",this._emitRenderInvalid),R.removeEventListener("textureStoreChange",this._emitRenderInvalid),this._emitRenderInvalid()},_.prototype.removeAllLayers=function(){for(;this._layers.length>0;)this.removeLayer(this._layers[0])},_.prototype.startFrame=function(){throw new Error("Stage implementation must override startFrame")},_.prototype.endFrame=function(){throw new Error("Stage implementation must override endFrame")},_.prototype.render=function(){var d,x,O,R=this._tilesToLoad,z=this._tilesToRender,Y=!0,u=this._width,W=this._height,H=this._tmpRect,P=this._tmpSize;if(!(u<=0||W<=0)){for(this.startFrame(),d=0;d<this._layers.length;d++)this._layers[d].textureStore().startFrame();for(d=0;d<this._layers.length;d++){var $,N,w=this._layers[d],B=w.effects(),D=w.view(),Q=w.textureStore(),b=this._renderers[d],U=this._layers.length-d;if(E(u,W,B&&B.rect,H),!(H.width<=0||H.height<=0)){for(P.width=H.width*this._width,P.height=H.height*this._height,D.setSize(P),b.startLayer(w,H),O=this._collectTiles(w,Q),x=0;x<R.length;x++)Q.markTile($=R[x]);for(x=0;x<z.length;x++)N=Q.texture($=z[x]),b.renderTile($,N,w,U);w.emit("renderComplete",O),O||(Y=!1),b.endLayer(w,H)}}for(d=0;d<this._layers.length;d++)this._layers[d].textureStore().endFrame();this.endFrame(),this.emit("renderComplete",Y)}},_.prototype._collectTiles=function(d,x){var R=this._tilesToLoad,z=this._tilesToRender,Y=this._tmpVisible;R.length=0,z.length=0,Y.length=0,d.visibleTiles(Y);for(var O=!0,u=0;u<Y.length;u++){var H,W=Y[u];this._collectTileToLoad(W),x.texture(W)?(H=!1,this._collectTileToRender(W)):(H=this._collectChildren(W,x),O=!1),this._collectParents(W,x,H)}return R.sort(L),z.sort(S),O},_.prototype._collectChildren=function(d,x){var R=this._tmpChildren,z=!0;do{if(R.length=0,!d.children(R))break;z=!1;for(var Y=0;Y<R.length;Y++)x.texture(d=R[Y])?(this._collectTileToLoad(d),this._collectTileToRender(d)):z=!0}while(z&&1===R.length);return z},_.prototype._collectParents=function(d,x,R){for(var z=this._progressive;(z||R)&&null!=(d=d.parent());){if(R)if(x.texture(d))this._collectTileToRender(d),R=!1;else if(!this._progressive)continue;this._collectTileToLoad(d)||(z=!1)}return R},_.prototype._collectTileToLoad=function(d){return this._collectTileIntoList(d,this._tilesToLoad)},_.prototype._collectTileToRender=function(d){return this._collectTileIntoList(d,this._tilesToRender)},_.prototype._collectTileIntoList=function(d,x){for(var R=!1,z=0;z<x.length;z++)if(d.equals(x[z])){R=!0;break}return R||x.push(d),!R},_.prototype.createTexture=function(d,x,R){var z=this,O=v(p(function Y(){return new z.TextureClass(z,d,x)}));return this._createTextureWorkQueue.push(O,function(u,W){R(u,d,x,W)})},X.exports=_},5:(X,k,s)=>{"use strict";var c=s(2419),A=s(6737),E=s(358),p=s(5946),v=s(3367),l=s(1020),m=s(1936).setAbsolute,L=s(1936).setFullSize,S=s(6873),__videoUseTexImage2D=E.chrome;function x(z){var Y=this;this.constructor.super_.call(this,z=z||{}),this._generateMipmaps=null!=z.generateMipmaps&&z.generateMipmaps,this._loader=new A(this),this._domElement=document.createElement("canvas"),m(this._domElement),L(this._domElement),this._gl=function d(z,Y){var O={alpha:!0,premultipliedAlpha:!0,antialias:!(!Y||!Y.antialias),preserveDrawingBuffer:!(!Y||!Y.preserveDrawingBuffer)},u=z.getContext&&(z.getContext("webgl",O)||z.getContext("experimental-webgl",O));if(!u)throw new Error("Could not get WebGL context");return Y.wrapContext&&(u=Y.wrapContext(u)),u}(this._domElement,z),this._handleContextLoss=function(){Y.emit("webglcontextlost"),Y._gl=null},this._domElement.addEventListener("webglcontextlost",this._handleContextLoss),this._rendererInstances=[],this._widthSegments=z.widthSegments?z.widthSegments:void 0,this._heightSegments=z.heightSegments?z.heightSegments:void 0}function R(z,Y,O){this._stage=z,this._gl=z._gl,this._texture=null,this._timestamp=null,this._width=this._height=null,this.refresh(Y,O)}p(x,c),x.prototype.destroy=function(){this._domElement.removeEventListener("webglcontextlost",this._handleContextLoss),this.constructor.super_.prototype.destroy.call(this)},x.prototype.domElement=function(){return this._domElement},x.prototype.webGlContext=function(){return this._gl},x.prototype.setSizeForType=function(){var z=v();this._domElement.width=z*this._width,this._domElement.height=z*this._height},x.prototype.loadImage=function(z,Y,O){return this._loader.loadImage(z,Y,O)},x.prototype.maxTextureSize=function(){return this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE)},x.prototype.validateLayer=function(z){var Y=z.geometry().maxTileSize(),O=this.maxTextureSize();if(Y>O)throw new Error("Layer has level with tile size larger than maximum texture size ("+Y+" vs. "+O+")")},x.prototype.createRenderer=function(z){for(var Y=this._rendererInstances,O=0;O<Y.length;O++)if(Y[O]instanceof z)return Y[O];var u=new z(this._gl,{widthSegments:this._widthSegments,heightSegments:this._heightSegments});return Y.push(u),u},x.prototype.destroyRenderer=function(z){var Y=this._rendererInstances;if(this._renderers.indexOf(z)<0){z.destroy();var O=Y.indexOf(z);O>=0&&Y.splice(O,1)}},x.prototype.startFrame=function(){var z=this._gl;if(!z)throw new Error("Bad WebGL context - maybe context was lost?");z.viewport(0,0,z.drawingBufferWidth,z.drawingBufferHeight),z.clearColor(0,0,0,0),z.clear(z.COLOR_BUFFER_BIT|z.DEPTH_BUFFER_BIT),z.enable(z.DEPTH_TEST),z.enable(z.BLEND),z.blendFunc(z.ONE,z.ONE_MINUS_SRC_ALPHA)},x.prototype.endFrame=function(){},x.prototype.takeSnapshot=function(z){("object"!=typeof z||null==z)&&(z={});var Y=z.quality;if(typeof Y>"u"&&(Y=75),"number"!=typeof Y||Y<0||Y>100)throw new Error("WebGLStage: Snapshot quality needs to be a number between 0 and 100");return this.render(),this._domElement.toDataURL("image/jpeg",Y/100)},x.type=x.prototype.type="webgl",R.prototype.refresh=function(z,Y){var W,O=this._gl,u=this._stage,H=Y.timestamp();if(H!==this._timestamp){var P=Y.element(),w=Y.width(),B=Y.height();if(w!==this._width||B!==this._height){var D=u.maxTextureSize();if(w>D)throw new Error("Texture width larger than max size ("+w+" vs. "+D+")");if(B>D)throw new Error("Texture height larger than max size ("+B+" vs. "+D+")");this._texture&&O.deleteTexture(W),W=this._texture=O.createTexture(),O.bindTexture(O.TEXTURE_2D,W),O.pixelStorei(O.UNPACK_FLIP_Y_WEBGL,!0),O.pixelStorei(O.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),O.texImage2D(O.TEXTURE_2D,0,O.RGBA,O.RGBA,O.UNSIGNED_BYTE,P)}else O.bindTexture(O.TEXTURE_2D,W=this._texture),O.pixelStorei(O.UNPACK_FLIP_Y_WEBGL,!0),O.pixelStorei(O.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),P instanceof HTMLVideoElement&&__videoUseTexImage2D?O.texImage2D(O.TEXTURE_2D,0,O.RGBA,O.RGBA,O.UNSIGNED_BYTE,P):O.texSubImage2D(O.TEXTURE_2D,0,0,0,O.RGBA,O.UNSIGNED_BYTE,P);u._generateMipmaps&&l(w)&&l(B)?(O.texParameteri(O.TEXTURE_2D,O.TEXTURE_MAG_FILTER,O.LINEAR),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_MIN_FILTER,O.LINEAR_MIPMAP_LINEAR),O.generateMipmap(O.TEXTURE_2D)):(O.texParameteri(O.TEXTURE_2D,O.TEXTURE_MAG_FILTER,O.LINEAR),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_MIN_FILTER,O.LINEAR)),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_WRAP_S,O.CLAMP_TO_EDGE),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_WRAP_T,O.CLAMP_TO_EDGE),O.bindTexture(O.TEXTURE_2D,null),this._timestamp=H,this._width=w,this._height=B}},R.prototype.destroy=function(){this._texture&&this._gl.deleteTexture(this._texture),S(this)},x.TextureClass=x.prototype.TextureClass=R,X.exports=x},3594:X=>{"use strict";X.exports=function k(s){return function(A){var E,p;try{p=s()}catch(v){E=v}finally{E?A(E):A(null,p)}}}},1045:X=>{"use strict";X.exports=function k(s,c,A,E){var p,v,m;return p=null!=A&&null!=A.absoluteWidth?A.absoluteWidth/s:null!=A&&null!=A.relativeWidth?A.relativeWidth:1,v=A&&null!=A.absoluteHeight?A.absoluteHeight/c:null!=A&&null!=A.relativeHeight?A.relativeHeight:1,m=null!=A&&null!=A.absoluteY?A.absoluteY/c:null!=A&&null!=A.relativeY?A.relativeY:0,(E=E||{}).x=null!=A&&null!=A.absoluteX?A.absoluteX/s:null!=A&&null!=A.relativeX?A.relativeX:0,E.y=m,E.width=p,E.height=v,E}},779:(X,k,s)=>{"use strict";var c=s(9364);X.exports=function A(E){return function(){if(!arguments.length)throw new Error("cancelized: expected at least one argument");var v=Array.prototype.slice.call(arguments,0),l=v[v.length-1]=c(v[v.length-1]);function m(){l.apply(null,arguments)}return E.apply(null,v),m}}},3559:(X,k,s)=>{"use strict";var c=s(6158);X.exports=function A(){var E=Array.prototype.slice.call(arguments,0);return function(){var v=E.slice(0),l=null,m=null,L=arguments.length?Array.prototype.slice.call(arguments,0,arguments.length-1):[],S=arguments.length?arguments[arguments.length-1]:c;function _(){var x=arguments[0];if(x)return l=m=null,void S.apply(null,arguments);if(!v.length)return l=m=null,void S.apply(null,arguments);var R=l=v.shift(),z=Array.prototype.slice.call(arguments,1);z.push(_);var Y=l.apply(null,z);if(R===l){if("function"!=typeof Y)throw new Error("chain: chaining on non-cancellable function");m=Y}}function d(){m&&m.apply(null,arguments)}return L.unshift(null),_.apply(null,L),d}}},6438:X=>{"use strict";X.exports=function k(s,c,A){return Math.min(Math.max(s,c),A)}},6873:X=>{"use strict";X.exports=function k(s){for(var c in s)s.hasOwnProperty(c)&&(s[c]=void 0)}},5593:X=>{"use strict";X.exports=function k(s,c){return s<c?-1:s>c?1:0}},2800:X=>{"use strict";X.exports=function k(){var s=arguments;return function(A){for(var E=A,p=0;p<s.length;p++)E=s[p].call(null,E);return E}}},4224:X=>{"use strict";function k(l,m,L){return 2*Math.atan(L*Math.tan(l/2)/m)}X.exports={convert:k,htov:function s(l,m,L){return k(l,m,L)},htod:function c(l,m,L){return k(l,m,Math.sqrt(m*m+L*L))},vtoh:function A(l,m,L){return k(l,L,m)},vtod:function E(l,m,L){return k(l,L,Math.sqrt(m*m+L*L))},dtoh:function p(l,m,L){return k(l,Math.sqrt(m*m+L*L),m)},dtov:function v(l,m,L){return k(l,Math.sqrt(m*m+L*L),L)}}},3716:X=>{"use strict";X.exports=function k(s){return s.toPrecision(15)}},7802:X=>{"use strict";X.exports=function k(s,c){for(var A in c)A in s||(s[A]=c[A]);return s}},8792:X=>{"use strict";X.exports=function k(s,c){setTimeout(function A(){c&&c.length>0?s.apply(null,c):s()},0)}},9155:X=>{"use strict";X.exports=function k(s){return s*Math.PI/180}},645:X=>{"use strict";X.exports=function k(s,c){var A=null;return A=setTimeout(function E(){null!=A&&(A=null,c(null))},s),function p(){null!=A&&(clearTimeout(A),A=null,c.apply(null,arguments))}}},1936:X=>{"use strict";function k(z){for(var Y=document.documentElement.style,O=["Moz","Webkit","Khtml","O","ms"],u=0;u<O.length;u++){var P=O[u]+(z[0].toUpperCase()+z.slice(1));if(P in Y)return P}return z}function c(z){var Y=k(z);return function(u,W){return u.style[Y]=W}}var A=c("transform"),E=c("transformOrigin");X.exports={prefixProperty:k,getWithVendorPrefix:function s(z){var Y=k(z);return function(u){return u.style[Y]}},setWithVendorPrefix:c,setTransform:A,setTransformOrigin:E,setNullTransform:function p(z){A(z,"translateZ(0)")},setNullTransformOrigin:function v(z){E(z,"0 0 0")},setAbsolute:function l(z){z.style.position="absolute"},setPixelPosition:function m(z,Y,O){z.style.left=Y+"px",z.style.top=O+"px"},setPixelSize:function L(z,Y,O){z.style.width=Y+"px",z.style.height=O+"px"},setNullSize:function S(z){z.style.width=z.style.height=0},setFullSize:function _(z){z.style.width=z.style.height="100%"},setOverflowHidden:function d(z){z.style.overflow="hidden"},setOverflowVisible:function x(z){z.style.overflow="visible"},setNoPointerEvents:function R(z){z.style.pointerEvents="none"}}},2544:X=>{"use strict";X.exports=function k(s,c){for(var A in c)s[A]=c[A];return s}},3573:X=>{"use strict";var k=typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:null;X.exports=k},3864:X=>{"use strict";X.exports=function k(){for(var s=0,c=0;c<arguments.length;c++){var A=arguments[c];s+=A,s+=A<<10,s^=A>>6}return s+=s<<3,s^=s>>11,(s+=s<<15)>=0?s:-s}},5946:X=>{"use strict";X.exports=function k(s,c){s.super_=c;var A=function(){};A.prototype=c.prototype,s.prototype=new A,s.prototype.constructor=s}},1020:X=>{"use strict";X.exports=function k(s){return 0==(s&s-1)}},4501:X=>{"use strict";X.exports=function k(s,c){return(+s%(c=+c)+c)%c}},6158:X=>{"use strict";X.exports=function k(){}},242:X=>{"use strict";X.exports=function k(){return typeof performance<"u"&&performance.now?function(){return performance.now()}:function(){return Date.now()}}()},9364:X=>{"use strict";X.exports=function k(s){var A,c=!1;return function(){return c||(c=!0,A=s.apply(null,arguments)),A}}},3367:X=>{"use strict";X.exports=function s(){if(typeof window<"u"){if(window.devicePixelRatio)return window.devicePixelRatio;var c=window.screen;if(c&&c.deviceXDPI&&c.logicalXDPI)return c.deviceXDPI/c.logicalXDPI;if(c&&c.systemXDPI&&c.logicalXDPI)return c.systemXDPI/c.logicalXDPI}return 1}},4576:(X,k,s)=>{"use strict";var c=s(1936).setTransform,A=s(3716);X.exports=function E(p,v,l,m){m=m||"";var L="translateX("+A(v)+"px) translateY("+A(l)+"px) translateZ(0) "+m;c(p,L)}},2731:X=>{"use strict";X.exports=function k(s){return 180*s/Math.PI}},1097:X=>{"use strict";X.exports=function k(s){return"number"==typeof s&&isFinite(s)}},1687:(X,k,s)=>{"use strict";var c=s(6158);X.exports=function A(E){return function(){var v=arguments.length?Array.prototype.slice.call(arguments,0,arguments.length-1):[],l=arguments.length?arguments[arguments.length-1]:c,m=null,L=!1;function S(){var _=arguments[0];!_||L?l.apply(null,arguments):m=E.apply(null,v)}return v.push(S),S(!0),function(){L=!0,m.apply(null,arguments)}}}},58:(X,k,s)=>{"use strict";var c=s(242);X.exports=function A(E,p,v){var l=!1,m=c();return p(0),requestAnimationFrame(function L(){if(!l){var S=(c()-m)/E;S<1?(p(S),requestAnimationFrame(L)):(p(1),v())}}),function(){l=!0,v.apply(null,arguments)}}},4699:X=>{"use strict";X.exports=function k(s){var c=typeof s;if("object"===c){if(null===s)return"null";if("[object Array]"===Object.prototype.toString.call(s))return"array";if("[object RegExp]"===Object.prototype.toString.call(s))return"regexp"}return c}},5675:(X,k,s)=>{"use strict";var c=s(8843),A=s(335).mat4,E=s(335).vec4,p=s(3367),v=s(1097),l=s(6438),m=s(6873),R=[1,0,1,0],z=[-1,-1,1,1];function O(u,W){if(!u||null==u.mediaAspectRatio)throw new Error("mediaAspectRatio must be defined");this._x=u&&null!=u.x?u.x:.5,this._y=u&&null!=u.y?u.y:.5,this._zoom=u&&null!=u.zoom?u.zoom:1,this._mediaAspectRatio=u.mediaAspectRatio,this._width=u&&null!=u.width?u.width:0,this._height=u&&null!=u.height?u.height:0,this._limiter=W||null,this._projMatrix=A.create(),this._invProjMatrix=A.create(),this._frustum=[0,0,0,0],this._projectionChanged=!0,this._params={},this._vec=E.create(),this._update()}c(O),O.prototype.destroy=function(){m(this)},O.prototype.x=function(){return this._x},O.prototype.y=function(){return this._y},O.prototype.zoom=function(){return this._zoom},O.prototype.mediaAspectRatio=function(){return this._mediaAspectRatio},O.prototype.width=function(){return this._width},O.prototype.height=function(){return this._height},O.prototype.size=function(u){return(u=u||{}).width=this._width,u.height=this._height,u},O.prototype.parameters=function(u){return(u=u||{}).x=this._x,u.y=this._y,u.zoom=this._zoom,u.mediaAspectRatio=this._mediaAspectRatio,u},O.prototype.limiter=function(){return this._limiter},O.prototype.setX=function(u){this._resetParams(),this._params.x=u,this._update(this._params)},O.prototype.setY=function(u){this._resetParams(),this._params.y=u,this._update(this._params)},O.prototype.setZoom=function(u){this._resetParams(),this._params.zoom=u,this._update(this._params)},O.prototype.offsetX=function(u){this.setX(this._x+u)},O.prototype.offsetY=function(u){this.setY(this._y+u)},O.prototype.offsetZoom=function(u){this.setZoom(this._zoom+u)},O.prototype.setMediaAspectRatio=function(u){this._resetParams(),this._params.mediaAspectRatio=u,this._update(this._params)},O.prototype.setSize=function(u){this._resetParams(),this._params.width=u.width,this._params.height=u.height,this._update(this._params)},O.prototype.setParameters=function(u){this._resetParams(),this._params.x=u.x,this._params.y=u.y,this._params.zoom=u.zoom,this._params.mediaAspectRatio=u.mediaAspectRatio,this._update(this._params)},O.prototype.setLimiter=function(u){this._limiter=u||null,this._update()},O.prototype._resetParams=function(){var u=this._params;u.x=null,u.y=null,u.zoom=null,u.mediaAspectRatio=null,u.width=null,u.height=null},O.prototype._update=function(u){null==u&&(this._resetParams(),u=this._params);var W=this._x,H=this._y,P=this._zoom,w=this._mediaAspectRatio,B=this._width,D=this._height;if(u.x=null!=u.x?u.x:W,u.y=null!=u.y?u.y:H,u.zoom=null!=u.zoom?u.zoom:P,u.mediaAspectRatio=null!=u.mediaAspectRatio?u.mediaAspectRatio:w,u.width=null!=u.width?u.width:B,u.height=null!=u.height?u.height:D,this._limiter&&!(u=this._limiter(u)))throw new Error("Bad view limiter");var Q=u.x,b=u.y,U=u.zoom,$=u.mediaAspectRatio,N=u.width,a=u.height;if(!(v(Q)&&v(b)&&v(U)&&v($)&&v(N)&&v(a)))throw new Error("Bad view - suspect a broken limiter");U=l(U,1e-6,1/0),this._x=Q,this._y=b,this._zoom=U,this._mediaAspectRatio=$,this._width=N,this._height=a,(Q!==W||b!==H||U!==P||$!==w||N!==B||a!==D)&&(this._projectionChanged=!0,this.emit("change")),(N!==B||a!==D)&&this.emit("resize")},O.prototype._zoomX=function(){return this._zoom},O.prototype._zoomY=function(){var H=this._zoom,P=H*this._mediaAspectRatio/(this._width/this._height);return isNaN(P)&&(P=H),P},O.prototype.updateWithControlParameters=function(u){var W=this.zoom(),H=this._zoomX(),P=this._zoomY();this.offsetX(u.axisScaledX*H+u.x*W),this.offsetY(u.axisScaledY*P+u.y*W),this.offsetZoom(u.zoom*W)},O.prototype._updateProjection=function(){var u=this._projMatrix,W=this._invProjMatrix,H=this._frustum;if(this._projectionChanged){var P=this._x,w=this._y,B=this._zoomX(),D=this._zoomY(),Q=H[0]=.5-w+.5*D,b=H[1]=P-.5+.5*B,U=H[2]=.5-w-.5*D,$=H[3]=P-.5-.5*B;A.ortho(u,$,b,U,Q,-1,1),A.invert(W,u),this._projectionChanged=!1}},O.prototype.projection=function(){return this._updateProjection(),this._projMatrix},O.prototype.inverseProjection=function(){return this._updateProjection(),this._invProjMatrix},O.prototype.intersects=function(u){this._updateProjection();for(var W=this._frustum,H=0;H<W.length;H++){for(var P=W[H],w=R[H],B=z[H],D=!1,Q=0;Q<u.length;Q++){var b=u[Q];if(B<0&&b[w]<P||B>0&&b[w]>P){D=!0;break}}if(!D)return!1}return!0},O.prototype.selectLevel=function(u){for(var W=p()*this.width(),H=this._zoom,P=0;P<u.length;P++){var w=u[P];if(H*w.width()>=W)return w}return u[u.length-1]},O.prototype.coordinatesToScreen=function(u,W){var H=this._vec;W||(W={});var P=this._width,w=this._height;if(P<=0||w<=0)return W.x=null,W.y=null,null;E.set(H,(u&&null!=u.x?u.x:.5)-.5,.5-(u&&null!=u.y?u.y:.5),-1,1),E.transformMat4(H,H,this.projection());for(var Q=0;Q<3;Q++)H[Q]/=H[3];return W.x=P*(H[0]+1)/2,W.y=w*(1-H[1])/2,W},O.prototype.screenToCoordinates=function(u,W){var H=this._vec;return W||(W={}),E.set(H,2*u.x/this._width-1,1-2*u.y/this._height,1,1),E.transformMat4(H,H,this.inverseProjection()),W.x=.5+H[0],W.y=.5-H[1],W},O.limit={x:function(u,W){return function(P){return P.x=l(P.x,u,W),P}},y:function(u,W){return function(P){return P.y=l(P.y,u,W),P}},zoom:function(u,W){return function(P){return P.zoom=l(P.zoom,u,W),P}},resolution:function(u){return function(H){if(H.width<=0||H.height<=0)return H;var P=H.width,w=p()*P/u;return H.zoom=l(H.zoom,w,1/0),H}},visibleX:function(u,W){return function(P){var w=W-u;return P.zoom>w&&(P.zoom=w),P.x=l(P.x,u+.5*P.zoom,W-.5*P.zoom),P}},visibleY:function(u,W){return function(P){if(P.width<=0||P.height<=0)return P;var B=P.width/P.height/P.mediaAspectRatio,D=(W-u)*B;return P.zoom>D&&(P.zoom=D),P.y=l(P.y,u+.5*P.zoom/B,W-.5*P.zoom/B),P}},letterbox:function(){return function(W){if(W.width<=0||W.height<=0)return W;var B,D,Q,b,H=W.width/W.height,w=H/W.mediaAspectRatio;return W.mediaAspectRatio>=H&&(W.zoom=Math.min(W.zoom,1)),W.mediaAspectRatio<=H&&(W.zoom=Math.min(W.zoom,w)),W.zoom>1?B=D=.5:(B=0+.5*W.zoom/1,D=1-.5*W.zoom/1),W.zoom>w?Q=b=.5:(Q=0+.5*W.zoom/w,b=1-.5*W.zoom/w),W.x=l(W.x,B,D),W.y=l(W.y,Q,b),W}}},O.type=O.prototype.type="flat",X.exports=O},9421:(X,k,s)=>{"use strict";var c=s(8843),A=s(335).mat4,E=s(335).vec4,p=s(335).vec3,v=s(3367),l=s(4224),m=s(4501),L=s(1097),S=s(6438),_=s(3716),d=s(2800),x=s(6873),W=Math.PI/4,$=1e-6;function N(a,g){this._yaw=a&&null!=a.yaw?a.yaw:0,this._pitch=a&&null!=a.pitch?a.pitch:0,this._roll=a&&null!=a.roll?a.roll:0,this._fov=a&&null!=a.fov?a.fov:W,this._width=a&&null!=a.width?a.width:0,this._height=a&&null!=a.height?a.height:0,this._projectionCenterX=a&&null!=a.projectionCenterX?a.projectionCenterX:0,this._projectionCenterY=a&&null!=a.projectionCenterY?a.projectionCenterY:0,this._tx=a&&null!=a.tx?a.tx:0,this._ty=a&&null!=a.ty?a.ty:0,this._tz=a&&null!=a.tz?a.tz:0,this._ox=a&&null!=a.ox?a.ox:0,this._oy=a&&null!=a.oy?a.oy:0,this._oz=a&&null!=a.oz?a.oz:0,this._invertControl=!(!a||null==a.invertControl)&&a.invertControl,this._limiter=g||null,this._projMatrix=A.create(),this._invProjMatrix=A.create(),this._viewMatrix=A.create(),this._invViewMatrix=A.create(),this._frustum=[E.create(),E.create(),E.create(),E.create(),E.create()],this._matrixChanged=!0,this._params={},this._fovs={},this._tmpVec=E.create(),this._update()}c(N),N.prototype.destroy=function(){x(this)},N.prototype.yaw=function(){return this._yaw},N.prototype.pitch=function(){return this._pitch},N.prototype.roll=function(){return this._roll},N.prototype.projectionCenterX=function(){return this._projectionCenterX},N.prototype.projectionCenterY=function(){return this._projectionCenterY},N.prototype.fov=function(){return this._fov},N.prototype.width=function(){return this._width},N.prototype.height=function(){return this._height},N.prototype.tx=function(){return this._tx},N.prototype.ty=function(){return this._ty},N.prototype.tz=function(){return this._tz},N.prototype.ox=function(){return this._ox},N.prototype.oy=function(){return this._oy},N.prototype.oz=function(){return this._oz},N.prototype.invertControl=function(){return this._invertControl},N.prototype.size=function(a){return(a=a||{}).width=this._width,a.height=this._height,a},N.prototype.parameters=function(a){return(a=a||{}).yaw=this._yaw,a.pitch=this._pitch,a.roll=this._roll,a.fov=this._fov,a},N.prototype.limiter=function(){return this._limiter},N.prototype.setYaw=function(a){this._resetParams(),this._params.yaw=a,this._update(this._params)},N.prototype.setPitch=function(a){this._resetParams(),this._params.pitch=a,this._update(this._params)},N.prototype.setRoll=function(a){this._resetParams(),this._params.roll=a,this._update(this._params)},N.prototype.setFov=function(a){this._resetParams(),this._params.fov=a,this._update(this._params)},N.prototype.setProjectionCenterX=function(a){this._resetParams(),this._params.projectionCenterX=a,this._update(this._params)},N.prototype.setProjectionCenterY=function(a){this._resetParams(),this._params.projectionCenterY=a,this._update(this._params)},N.prototype.offsetYaw=function(a){this.setYaw(this._yaw+a)},N.prototype.offsetPitch=function(a){this.setPitch(this._pitch+a)},N.prototype.offsetRoll=function(a){this.setRoll(this._roll+a)},N.prototype.offsetFov=function(a){this.setFov(this._fov+a)},N.prototype.setSize=function(a){this._resetParams(),this._params.width=a.width,this._params.height=a.height,this._update(this._params)},N.prototype.setTx=function(a){this._resetParams(),this._params.tx=a,this._update(this._params)},N.prototype.setTy=function(a){this._resetParams(),this._params.ty=a,this._update(this._params)},N.prototype.setTz=function(a){this._resetParams(),this._params.tz=a,this._update(this._params)},N.prototype.setOx=function(a){this._resetParams(),this._params.ox=a,this._update(this._params)},N.prototype.setOy=function(a){this._resetParams(),this._params.oy=a,this._update(this._params)},N.prototype.setOz=function(a){this._resetParams(),this._params.oz=a,this._update(this._params)},N.prototype.setInvertControl=function(a){this._invertControl=a},N.prototype.setParameters=function(a){this._resetParams(),this._params.yaw=a.yaw,this._params.pitch=a.pitch,this._params.roll=a.roll,this._params.fov=a.fov,this._params.projectionCenterX=a.projectionCenterX,this._params.projectionCenterY=a.projectionCenterY,this._update(this._params)},N.prototype.setLimiter=function(a){this._limiter=a||null,this._update()},N.prototype._resetParams=function(){var a=this._params;a.yaw=null,a.pitch=null,a.roll=null,a.fov=null,a.width=null,a.height=null,a.position=null},N.prototype._update=function(a){null==a&&(this._resetParams(),a=this._params);var g=this._yaw,V=this._pitch,T=this._roll,it=this._fov,rt=this._projectionCenterX,ot=this._projectionCenterY,at=this._width,ht=this._height,pt=this._tx,_t=this._ty,Et=this._tz,It=this._ox,xt=this._oy,Tt=this._oz;if(a.yaw=null!=a.yaw?a.yaw:g,a.pitch=null!=a.pitch?a.pitch:V,a.roll=null!=a.roll?a.roll:T,a.fov=null!=a.fov?a.fov:it,a.width=null!=a.width?a.width:at,a.height=null!=a.height?a.height:ht,a.projectionCenterX=null!=a.projectionCenterX?a.projectionCenterX:rt,a.projectionCenterY=null!=a.projectionCenterY?a.projectionCenterY:ot,a.tx=null!=a.tx?a.tx:pt,a.ty=null!=a.ty?a.ty:_t,a.tz=null!=a.tz?a.tz:Et,a.ox=null!=a.ox?a.ox:It,a.oy=null!=a.oy?a.oy:xt,a.oz=null!=a.oz?a.oz:Tt,this._limiter&&!(a=this._limiter(a)))throw new Error("Bad view limiter");var yt=(a=this._normalize(a)).yaw,wt=a.pitch,Ut=a.roll,Ot=a.fov,Bt=a.width,Nt=a.height,bt=a.projectionCenterX,Ft=a.projectionCenterY,Wt=a.tx,ee=a.ty,re=a.tz,kt=a.ox,Dt=a.oy,oe=a.oz;if(!(L(yt)&&L(wt)&&L(Ut)&&L(Ot)&&L(Bt)&&L(Nt)&&L(bt)&&L(Ft)))throw new Error("Bad view - suspect a broken limiter");this._yaw=yt,this._pitch=wt,this._roll=Ut,this._fov=Ot,this._width=Bt,this._height=Nt,this._projectionCenterX=bt,this._projectionCenterY=Ft,this._tx=Wt,this._ty=ee,this._tz=re,this._ox=kt,this._oy=Dt,this._oz=oe,(yt!==g||wt!==V||Ut!==T||Ot!==it||Bt!==at||Nt!==ht||bt!==rt||Ft!==ot||Wt!==pt||ee!==_t||re!==Et||kt!==It||Dt!==xt||oe!==Tt)&&(this._matrixChanged=!0,this.emit("change")),(Bt!==at||Nt!==ht)&&this.emit("resize")},N.prototype._normalize=function(a){this._normalizeCoordinates(a);var g=l.htov(Math.PI,a.width,a.height),V=isNaN(g)?Math.PI:Math.min(Math.PI,g);return a.fov=S(a.fov,$,V-$),a},N.prototype._normalizeCoordinates=function(a){return"yaw"in a&&(a.yaw=m(a.yaw-Math.PI,-2*Math.PI)+Math.PI),"pitch"in a&&(a.pitch=m(a.pitch-Math.PI,-2*Math.PI)+Math.PI),"roll"in a&&(a.roll=m(a.roll-Math.PI,-2*Math.PI)+Math.PI),a},N.prototype.normalizeToClosest=function(a,g){var V=this._yaw,T=this._pitch,it=a.yaw,rt=a.pitch,ot=it-2*Math.PI,at=it+2*Math.PI;Math.abs(ot-V)<Math.abs(it-V)?it=ot:Math.abs(at-V)<Math.abs(it-V)&&(it=at);var ht=rt-2*Math.PI,pt=rt+2*Math.PI;return Math.abs(ht-T)<Math.abs(rt-T)?rt=ht:Math.abs(ht-T)<Math.abs(rt-T)&&(rt=pt),(g=g||{}).yaw=it,g.pitch=rt,g},N.prototype.updateWithControlParameters=function(a){var g=this._fov,V=l.vtoh(g,this._width,this._height);isNaN(V)&&(V=g),this.offsetYaw(a.axisScaledX*V+2*a.x*V+a.yaw),this.offsetPitch(a.axisScaledY*g+2*a.y*V+a.pitch),this.offsetRoll(-a.roll),this.offsetFov(a.zoom*g)},N.prototype._updateMatrix=function(){var a=this._projMatrix,g=this._invProjMatrix,it=this._frustum;if(this._matrixChanged){var rt=this._width,ot=this._height,at=this._fov,ht=l.vtoh(at,rt,ot),pt=rt/ot,_t=this._projectionCenterX,Et=this._projectionCenterY;if(0!==_t||0!==Et){var It=Math.atan(2*_t*Math.tan(ht/2)),xt=Math.atan(2*Et*Math.tan(at/2)),Tt=this._fovs;Tt.leftDegrees=180*(ht/2+It)/Math.PI,Tt.rightDegrees=180*(ht/2-It)/Math.PI,Tt.upDegrees=180*(at/2+xt)/Math.PI,Tt.downDegrees=180*(at/2-xt)/Math.PI,A.perspectiveFromFieldOfView(a,Tt,-1,1)}else A.perspective(a,at,pt,-1,1);A.rotateZ(a,a,this._roll),A.rotateX(a,a,this._pitch),A.rotateY(a,a,this._yaw),A.translate(a,a,p.negate(p.create(),[this._tx,this._ty,this._tz])),A.invert(g,a),this._matrixToFrustum(a,it),this._matrixChanged=!1}},N.prototype._matrixToFrustum=function(a,g){E.set(g[0],a[3]+a[0],a[7]+a[4],a[11]+a[8],a[15]+a[12]),E.set(g[1],a[3]-a[0],a[7]-a[4],a[11]-a[8],a[15]-a[12]),E.set(g[2],a[3]+a[1],a[7]+a[5],a[11]+a[9],a[15]+a[13]),E.set(g[3],a[3]-a[1],a[7]-a[5],a[11]-a[9],a[15]-a[13]),E.set(g[4],a[3]+a[2],a[7]+a[6],a[11]+a[10],a[15]+a[14])},N.prototype.projection=function(){return this._updateMatrix(),this._projMatrix},N.prototype.inverseProjection=function(){return this._updateMatrix(),this._invProjMatrix},N.prototype.viewMatrix=function(){return this._updateMatrix(),this._viewMatrix},N.prototype.inverseViewMatrix=function(){return this._updateMatrix(),this._invViewMatrix},N.prototype.intersects=function(a){this._updateMatrix();for(var g=this._frustum,V=this._tmpVec,T=0;T<g.length;T++){for(var it=g[T],rt=!1,ot=0;ot<a.length;ot++){var at=a[ot];E.set(V,at[0],at[1],at[2],1),E.dot(it,V)>=0&&(rt=!0)}if(!rt)return!1}return!0},N.prototype.selectLevel=function(a){for(var g=v()*this._height,V=Math.tan(.5*this._fov),T=0;T<a.length;T++){var it=a[T];if(V*it.height()>=g)return it}return a[a.length-1]},N.prototype.coordinatesToScreen=function(a,g){var V=this._tmpVec;g||(g={});var T=this._width,it=this._height;if(T<=0||it<=0)return g.x=null,g.y=null,null;var rt=a.yaw,ot=a.pitch,at=Math.sin(rt)*Math.cos(ot),ht=-Math.sin(ot),pt=-Math.cos(rt)*Math.cos(ot);return E.set(V,at,ht,pt,1),E.transformMat4(V,V,this.projection()),V[3]>=0?(g.x=T*(V[0]/V[3]+1)/2,g.y=it*(1-V[1]/V[3])/2,g):(g.x=null,g.y=null,null)},N.prototype.screenToCoordinates=function(a,g){var V=this._tmpVec;g||(g={}),E.set(V,2*a.x/this._width-1,1-2*a.y/this._height,1,1),E.transformMat4(V,V,this.inverseProjection());var at=Math.sqrt(V[0]*V[0]+V[1]*V[1]+V[2]*V[2]);return g.yaw=Math.atan2(V[0],-V[2]),g.pitch=Math.acos(V[1]/at)-Math.PI/2,this._normalizeCoordinates(g),g},N.prototype.coordinatesToPerspectiveTransform=function(a,g,V){V=V||"";var T=this._height,it=this._width,ot=.5*T/Math.tan(this._fov/2),at="";return at+="translateX("+_(it/2)+"px) ",at+="translateY("+_(T/2)+"px) ",at+="translateX(-50%) translateY(-50%) ",at+="perspective("+_(ot)+"px) ",at+="translateZ("+_(ot)+"px) ",at+="rotateZ("+_(-this._roll)+"rad) ",at+="rotateX("+_(-this._pitch)+"rad) ",at+="rotateY("+_(this._yaw)+"rad) ",at+="rotateY("+_(-a.yaw)+"rad) ",at+="rotateX("+_(a.pitch)+"rad) ",(at+="translateZ("+_(-g)+"px) ")+(V+" ")},N.limit={yaw:function(a,g){return function(T){return T.yaw=S(T.yaw,a,g),T}},pitch:function(a,g){return function(T){return T.pitch=S(T.pitch,a,g),T}},roll:function(a,g){return function(T){return T.roll=S(T.roll,a,g),T}},hfov:function(a,g){return function(T){var it=T.width,rt=T.height;if(it>0&&rt>0){var ot=l.htov(a,it,rt),at=l.htov(g,it,rt);T.fov=S(T.fov,ot,at)}return T}},vfov:function(a,g){return function(T){return T.fov=S(T.fov,a,g),T}},resolution:function(a){return function(V){var T=V.height;if(T){var it=v()*T,rt=2*Math.atan(it/a);V.fov=S(V.fov,rt,1/0)}return V}},traditional:function(a,g,V){return V=V??g,d(N.limit.resolution(a),N.limit.vfov(0,g),N.limit.hfov(0,V),N.limit.pitch(-Math.PI/2,Math.PI/2))}},N.type=N.prototype.type="rectilinear",X.exports=N},8843:X=>{"use strict";function k(){}k.prototype.addEventListener=function(c,A){var E=this.__events=this.__events||{},p=E[c]=E[c]||[];p.indexOf(A)<0&&p.push(A)},k.prototype.removeEventListener=function(c,A){var p=(this.__events=this.__events||{})[c];if(p){var v=p.indexOf(A);v>=0&&p.splice(v,1)}},k.prototype.emit=function(c,A){var E=this.__events=this.__events||{},p=E[c],v=Array.prototype.slice.call(arguments,1);if(p)for(var l=0;l<p.length;l++){var m=p[l];m.apply(this,v)}},X.exports=function s(c){for(var A in k.prototype)k.prototype.hasOwnProperty(A)&&(c.prototype[A]=k.prototype[A])}},7493:(X,k,s)=>{"use strict";s.d(k,{G:()=>m});var c=s(4537),A=s(8692),E=s(5732),p=s(8066),v=s(5056),l=s(7343);let m=(()=>{class L{constructor(_,d,x,R,z){this.http=_,this.windowRef=d,this.viewerDataService=x,this.panoService=R,this.platformId=z,this.session_id=""}send(_){if((0,A.PM)(this.platformId)||this.viewerDataService.editor||!this.panoService.moderationUrl)return;this.session_id||(this.session_id=window.crypto.randomUUID());let d=this._getStats();0!=d.host.indexOf("localhost")&&(null!=_.type&&(d.type=_.type),null!=_.plugin&&(d.plugin=_.plugin),null!=_.details&&(d.details=_.details),this.http.post("https://apiw.gothru.co/tours/stats",d).subscribe())}getWidget(_){let x=[{name:"Berlin Menu",component:"MenuHopenkeComponent"},{name:"Side Menu",component:"MenuKavftigComponent"},{name:"Top Menu",component:"MenuLekprogComponent"},{name:"Real Estate Menu",component:"MenuLoppitteComponent"},{name:"Berlin Map",component:"SchemeHopenkeComponent"},{name:"Floor Map",component:"SchemeKavftigComponent"},{name:"Mapbox",component:"SchemeGvesjodComponent"},{name:"Berlin Hotspot",component:"HotspotHopenkeComponent"},{name:"Hotspot",component:"HotspotKavftigComponent"},{name:"Pano link",component:"HotspotHolmlackComponent"},{name:"Berlin Control",component:"ControlHopenkeComponent"},{name:"Control Bar",component:"ControlKavftigComponent"},{name:"Real Estate Control",component:"ControlLoppitteComponent"},{name:"Carousel",component:"OtherCarouselComponent"},{name:"Language",component:"OtherLanguageComponent"},{name:"Logo",component:"OtherLogoComponent"},{name:"Code",component:"OtherCodeComponent"},{name:"Password",component:"OtherPasswordComponent"},{name:"Pano Label",component:"OtherTitleComponent"}].filter(R=>R.component==_).pop();return x?{name:x.name,key:x.name.toLowerCase().replace(" ","_")}:{name:"",key:""}}_getStats(){let _={ip:null,action:null,returning:null,user_type:null,time:null,m_key:null,user_id:this.panoService.user_id,session_id:this.session_id,browser:this.windowRef.nativeWindow.navigator.userAgent,height:this.windowRef.nativeWindow.innerHeight,language:this.windowRef.nativeWindow.navigator.language,location:this.windowRef.nativeWindow.location.href,moderation_id:this.viewerDataService.active.t_id,pano_id:this.viewerDataService.active.id,referer:document.referrer,site:this.panoService.moderationUrl.substr(2),local_time:Math.floor(Date.now()/1e3),width:this.windowRef.nativeWindow.innerWidth,device:null,host:null,tour_type:null,plugin:null,type:null,details:null};return this.panoService.googleApiKey&&(_.m_key=this.panoService.googleApiKey),_.device=this.windowRef.nativeWindow.innerWidth<600?"mobile":this.windowRef.nativeWindow.innerWidth>=600&&this.windowRef.nativeWindow.innerWidth<1e3?"tablet":"desktop",_.host=_.location.split("/")[2],_.tour_type=0==this.panoService.moderationUrl.indexOf("G")?"google":"hosted",_}}return L.\u0275fac=function(_){return new(_||L)(c.LFG(E.eN),c.LFG(p.X),c.LFG(v.m),c.LFG(l.X),c.LFG(c.Lbi))},L.\u0275prov=c.Yz7({token:L,factory:L.\u0275fac,providedIn:"root"}),L})()},3272:(X,k,s)=>{"use strict";s.d(k,{m:()=>x});var c=s(4537),A=s(7343),E=s(7267),p=s(2001),v=s(7493),l=s(6101),m=s(8692);function L(R,z){if(1&R&&(c.TgZ(0,"span",2),c._uU(1),c.qZA()),2&R){const Y=c.oxw();c.Udp("background",Y.getBgcStyles(Y.otherTitleComponentBg))("color",Y.otherTitleComponentColor?Y.otherTitleComponentColor.color:"")("left",Y.panoTitlePos.x,"px")("top",Y.panoTitlePos.y,"px"),c.xp6(1),c.Oqu(Y.panoTitle)}}function S(R,z){if(1&R&&(c.O4$(),c._UZ(0,"path",7)),2&R){const Y=z.$implicit,O=c.oxw().$implicit,u=c.oxw(2);c.Q6J("ngClass",Y.class),c.uIk("d",Y.d)("transform",u.transform(O.angle,Y.class))}}function _(R,z){if(1&R){const Y=c.EpF();c.O4$(),c.TgZ(0,"g",4,5),c.NdJ("mouseenter",function(){const W=c.CHM(Y).$implicit,H=c.MAs(1),P=c.oxw(2);return c.KtG(P.mouseEnter(W.id,H))})("mouseleave",function(){c.CHM(Y);const u=c.oxw(2);return c.KtG(u.mouseLeave())})("click",function(){const W=c.CHM(Y).$implicit,H=c.oxw(2);return c.KtG(H.goToPano(W.id))}),c.YNc(2,S,1,3,"path",6),c.qZA()}if(2&R){const Y=c.oxw(2);c.xp6(2),c.Q6J("ngForOf",Y.shapes)}}function d(R,z){if(1&R&&(c.O4$(),c.TgZ(0,"svg"),c.YNc(1,_,3,1,"g",3),c.qZA()),2&R){const Y=c.oxw();c.xp6(1),c.Q6J("ngForOf",Y.activePano.links)}}let x=(()=>{class R{constructor(Y,O,u,W,H){this.panoData=Y,this.otherService=O,this.viewerService=u,this.statsService=W,this.i18n=H,this.shapes=[{class:"shadow",d:"M 0 -100 L 40 -60 L 30 -50 L 0 -82 L -30 -50 L -40 -60"},{class:"arrow",d:"M 0 -100 L 40 -60 L 30 -50 L 0 -82 L -30 -50 L -40 -60"},{class:"placeholder",d:"M 0 -120 L 60 -60 L 40 -30 L -40 -30 L -60 -60 L 0 -120"}],this.panoTitle=null,this.panoTitlePos={x:0,y:0}}get viewerReady(){return this.viewerService.viewerReady}goToPano(Y){this.panoTitle=null,this.viewerService.goToPanoWithAnimations(Y),this.statsService.send({type:"arrow",details:Y})}toFloat(Y){return parseFloat(Y.toFixed(2))}transform(Y,O){let u=-1*this.viewerService.viewer.scene().view().pitch()*180/Math.PI,W=this.toFloat(this.viewerService.viewer._size.width/2),H=this.toFloat(this.viewerService.viewer._size.height*(78+u)/100);"shadow"==O&&(H+=3);let P=this.toFloat(1-(.667+.262*u/90));return u<=0&&(P=this.toFloat(.333+.667*u/-90)),`translate(${W}, ${H}) scale(1, ${P}) rotate(${this.toFloat(Y-this.viewerService.angle+this.activePano.north_angle)})`}get otherTitleComponentShow(){if(!this.otherService.getWidget("OtherTitleComponent"))return!1;let Y=this.otherService.getWidgetOption("OtherTitleComponent","tooltip_show");return!!Y&&Y.value}get otherTitleComponentBg(){if(!this.otherService.getWidget("OtherTitleComponent"))return null;let Y=this.otherService.getWidgetOption("OtherTitleComponent","tooltip_background");return Y?Y.value:null}get otherTitleComponentColor(){if(!this.otherService.getWidget("OtherTitleComponent"))return null;let Y=this.otherService.getWidgetOption("OtherTitleComponent","tooltip_color");return Y?Y.value:null}getBgcStyles(Y){return Y?"gradient"==Y.type?"radial"!=Y.align?`-webkit-linear-gradient(${Y.align}, ${Y.color} 0%, ${Y.color2} 100%)`:`radial-gradient(at center center, ${Y.color} 0%, ${Y.color2} 100%)`:Y.color:null}mouseEnter(Y,O){if(!this.otherService.getWidget("OtherTitleComponent"))return;let u=this.otherService.getWidgetOption("OtherTitleComponent","list");if(!u)return;let W=u.value.filter(w=>w.pano.id===Y).pop();if(!W)return;let H=O.getBoundingClientRect(),P=document.getElementById("panorama").getBoundingClientRect();this.panoTitlePos.x=Math.floor(H.left-P.left+H.width/2),this.panoTitlePos.y=Math.floor(H.top-P.top-H.height),this.panoTitle=this.i18n.t(W.name)||null}mouseLeave(){this.panoTitle=null}ngOnChanges(Y){void 0!==Y.activeId&&(this.activePano=this.panoData.getPanoById(this.activeId))}}return R.\u0275fac=function(Y){return new(Y||R)(c.Y36(A.X),c.Y36(E.m),c.Y36(p.a),c.Y36(v.G),c.Y36(l.T))},R.\u0275cmp=c.Xpm({type:R,selectors:[["vwr-arrows"]],inputs:{activeId:"activeId"},features:[c.TTD],decls:2,vars:2,consts:[["class","tooltip",3,"background","color","left","top",4,"ngIf"],[4,"ngIf"],[1,"tooltip"],[3,"mouseenter","mouseleave","click",4,"ngFor","ngForOf"],[3,"mouseenter","mouseleave","click"],["arrow",""],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"]],template:function(Y,O){1&Y&&(c.YNc(0,L,2,9,"span",0),c.YNc(1,d,2,1,"svg",1)),2&Y&&(c.Q6J("ngIf",O.otherTitleComponentShow&&O.panoTitle),c.xp6(1),c.Q6J("ngIf",O.viewerReady&&O.activePano))},dependencies:[m.mk,m.sg,m.O5],styles:["span.tooltip[_ngcontent-%COMP%]{position:absolute;top:0;left:0;transform:translate(-50%,-50%);background-color:#fff;border-radius:2px;padding:2px 10px;font-size:14px;color:#5c6b75;z-index:3}svg[_ngcontent-%COMP%]{width:100%;height:100%;position:absolute;left:0;top:0;pointer-events:none;z-index:4}svg[_ngcontent-%COMP%]   g[_ngcontent-%COMP%]{cursor:pointer}svg[_ngcontent-%COMP%]   g[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{pointer-events:all;stroke-width:0;fill-rule:evenodd}svg[_ngcontent-%COMP%]   g[_ngcontent-%COMP%]   path.shadow[_ngcontent-%COMP%]{fill:#00000080;margin-top:3px}svg[_ngcontent-%COMP%]   g[_ngcontent-%COMP%]   path.arrow[_ngcontent-%COMP%]{fill:#fff}svg[_ngcontent-%COMP%]   g[_ngcontent-%COMP%]   path.placeholder[_ngcontent-%COMP%]{opacity:0}svg[_ngcontent-%COMP%]   g[_ngcontent-%COMP%]:hover   path.arrow[_ngcontent-%COMP%]{fill:#cff}"]}),R})()},1148:(X,k,s)=>{"use strict";function c(){this._dynamics={yaw:new Marzipano.Dynamics,pitch:new Marzipano.Dynamics},this._deviceOrientationHandler=this._handleData.bind(this),window.DeviceOrientationEvent&&window.addEventListener("deviceorientation",this._deviceOrientationHandler),this._previous={},this._current={},this._tmp={},this._getPitchCallbacks=[]}s.d(k,{z:()=>c}),Marzipano.dependencies.eventEmitter(c),c.prototype.destroy=function(){this._dynamics=null,window.DeviceOrientationEvent&&window.removeEventListener("deviceorientation",this._deviceOrientationHandler),this._deviceOrientationHandler=null,this._previous=null,this._current=null,this._tmp=null,this._getPitchCallbacks=null},c.prototype.getPitch=function(E){this._getPitchCallbacks.push(E)},c.prototype._handleData=function(E){var p=this._previous,v=this._current,l=this._tmp;l.yaw=Marzipano.util.degToRad(E.alpha),l.pitch=Marzipano.util.degToRad(E.beta),l.roll=Marzipano.util.degToRad(E.gamma),function A(E,p){var v,l,m,L=Math.cos(E.yaw),S=Math.sin(E.yaw),_=Math.cos(E.pitch),d=Math.sin(E.pitch),x=Math.cos(E.roll),R=Math.sin(E.roll),z=[S*R-L*d*x,-L*_,L*d*R+S*x,_*x,-d,-_*R,S*d*x+L*R,S*_,-S*d*R+L*x];z[3]>.9999?(v=Math.atan2(z[2],z[8]),m=Math.PI/2,l=0):z[3]<-.9999?(v=Math.atan2(z[2],z[8]),m=-Math.PI/2,l=0):(v=Math.atan2(-z[6],z[0]),l=Math.atan2(-z[5],z[4]),m=Math.asin(z[3])),p.yaw=v,p.pitch=m,p.roll=l}(l,v),this._getPitchCallbacks.forEach(function(m){m(null,v.pitch)}),this._getPitchCallbacks.length=0,null!=p.yaw&&null!=p.pitch&&null!=p.roll&&(this._dynamics.yaw.offset=-(v.yaw-p.yaw),this._dynamics.pitch.offset=v.pitch-p.pitch,this.emit("parameterDynamics","yaw",this._dynamics.yaw),this.emit("parameterDynamics","pitch",this._dynamics.pitch)),p.yaw=v.yaw,p.pitch=v.pitch,p.roll=v.roll}},8550:(X,k,s)=>{"use strict";s.d(k,{e:()=>S});var c=s(4537),A=s(5617),E=s(2001),p=s(7343),v=s(8692),l=s(3272);const m=["viewer"];function L(_,d){if(1&_&&c._UZ(0,"vwr-arrows",3),2&_){const x=c.oxw();c.Q6J("activeId",x.active.id)}}let S=(()=>{class _{constructor(x,R,z){this.marzipanoService=x,this.viewerService=R,this.panoService=z,this.clicked=!1}ngOnInit(){this.viewerService.viewerService=this.marzipanoService,this.viewerService.viewerDataService.viewer=this.viewerElm,this.viewerService.viewerWidthObs.subscribe(x=>{this.viewerService.viewer&&setTimeout(()=>this.viewerService.viewer._updateSizeListener())})}get active(){return this.viewerService.active}get show_arrows(){return this.panoService.hosted_arrows}ngAfterViewInit(){this.viewerService.initViewer(this.viewerElm.nativeElement),this.regWindowTouchEvents()}onMouseDown(){this.mouseDown()}onMouseUp(){this.mouseUp()}onMouseMove(){this.mouseMove()}keyDown(x){let R=document.activeElement,z=document.getElementById("overlay");if((z==R||z?.contains(R))&&(!R||-1===["input","select","textarea"].indexOf(R.tagName.toLowerCase()))&&!x.ctrlKey&&!x.metaKey)switch(x.which){case 87:case 38:this.interactStart(),this.viewerService.goNorth(),this.interactEnd();break;case 83:case 40:this.interactStart(),this.viewerService.goSouth(),this.interactEnd()}}interactStart(){this.viewerService.interaction||(this.viewerService.interaction=!0,this.viewerService.viewerDataService.slideInterval.angle&&this.viewerService.slidePause()),this.interactTimer&&clearTimeout(this.interactTimer)}interactEnd(x=2e3){this.interactTimer&&clearTimeout(this.interactTimer),this.interactTimer=setTimeout(()=>{this.viewerService.interaction&&(this.viewerService.interaction=!1,this.viewerService.viewerDataService.slideInterval.angle&&this.viewerService.slideResume())},x)}mouseDown(){this.clicked||(this.clicked=!0),this.interactStart()}mouseUp(){this.clicked&&(this.clicked=!1),this.interactEnd()}mouseMove(){!this.viewerService.viewerDataService.canInteract||(this.interactStart(),this.clicked||this.interactEnd())}regWindowTouchEvents(){window.addEventListener("touchstart",()=>{this.mouseDown()},{passive:!0}),window.addEventListener("touchsmove",()=>{this.mouseMove()},{passive:!0})}}return _.\u0275fac=function(x){return new(x||_)(c.Y36(A.l),c.Y36(E.a),c.Y36(p.X))},_.\u0275cmp=c.Xpm({type:_,selectors:[["vwr-marzipano"]],viewQuery:function(x,R){if(1&x&&c.Gf(m,7,c.SBq),2&x){let z;c.iGM(z=c.CRH())&&(R.viewerElm=z.first)}},hostBindings:function(x,R){1&x&&c.NdJ("mousedown",function(){return R.onMouseDown()})("mouseup",function(){return R.onMouseUp()})("touchend",function(){return R.onMouseUp()})("mousemove",function(){return R.onMouseMove()})("keydown",function(Y){return R.keyDown(Y)},!1,c.Jf7)},decls:3,vars:1,consts:[["id","viewer"],["viewer",""],[3,"activeId",4,"ngIf"],[3,"activeId"]],template:function(x,R){1&x&&(c._UZ(0,"div",0,1),c.YNc(2,L,1,1,"vwr-arrows",2)),2&x&&(c.xp6(2),c.Q6J("ngIf",R.show_arrows))},dependencies:[v.O5,l.m],styles:["#viewer[_ngcontent-%COMP%]{height:100%}"]}),_})()},2709:(X,k,s)=>{"use strict";s.r(k),s.d(k,{MarzipanoModule:()=>v});var c=s(8692),A=s(5617),E=s(8550),p=s(4537);let v=(()=>{class l{}return l.\u0275fac=function(L){return new(L||l)},l.\u0275mod=p.oAB({type:l,bootstrap:[E.e]}),l.\u0275inj=p.cJS({providers:[A.l],imports:[c.ez]}),l})()},5617:(X,k,s)=>{"use strict";s.d(k,{l:()=>W});var c=s(8239),A=s(5775),E=s(6215),p=s(9911),v=s(7609),l=s(4395),m=s(4537);let L=(()=>{class H{constructor(w){this.zone=w,this.allowedEvents=["panoChange"],this.subscriptions={},this.allowedEvents.forEach(B=>{this.subscriptions[B]=[]}),window.fireAngularEvent=(B,D)=>{if(!this.subscriptions[B])throw new Error("Event has to be defined in the event list.");w.run(()=>{this.fireEvent(B,D)})},window.subscribeToAngularEvent=(B,D)=>{this.subscribe(B,D)}}subscribe(w,B){if(!this.subscriptions[w])throw new Error("Event has to be defined in the event list.");this.subscriptions[w].push(B)}fireEvent(w,B){if(!this.subscriptions[w])throw new Error("Event has to be defined in the event list.");this.subscriptions[w].forEach(D=>{D.apply(null,B)})}}return H.\u0275fac=function(w){return new(w||H)(m.LFG(m.R0b))},H.\u0275prov=m.Yz7({token:H,factory:H.\u0275fac,providedIn:"root"}),H})();var S=s(2001),_=s(2281),d=s(8692),x=s(7343),R=s(4445),z=s(6883),Y=s(7267),O=s(5732);v.KeyControlMethod.prototype._handlePress=function(H){if(H.keyCode!==this._keyCode)return;let P=document.activeElement,w=document.getElementById("overlay");w!=P&&!w?.contains(P)||P&&-1!==["input","select","textarea"].indexOf(P.tagName.toLowerCase())||(this._pressing=!0,this._dynamics.velocity=this._velocity,this._dynamics.friction=0,this.emit("parameterDynamics",this._parameter,this._dynamics),this.emit("active"))};var u=window||u;u.Marzipano=v;let W=(()=>{class H{constructor(w,B,D,Q,b,U,$,N,a){this.globalPubService=w,this.viewerService=B,this.content=D,this.location=Q,this.panoService=b,this.hotspotService=U,this.controlService=$,this.otherService=N,this.http=a,this.viewerReady=!1,this.scenes=[],this.scenes2=[],this.imgHost="https://img.gothru.org/",this.locationSubject=new A.xQ,this.changing_pano=!1,this.yaw=0,this.pitch=0,this.fov=this.panoService.fov||180,this.changing=!1,this.activePanoObs=new E.X(this.viewerService.viewerDataService.active),this.imgRes={full:"4096x2048",preview:"1024x512",thumb:"150x75"},this.gyroscope=!1,this.getAngleBetweenPoints=(g,V)=>Math.atan2(V.lng-g.lng,V.lat-g.lat)*(180/Math.PI),this.transitionFunctions={opacity:function(g){return function(V,T){V=g(V),T.layer().setEffects({opacity:V})}},fromRight:function(g){return function(V,T){V=g(V),T.layer().setEffects({rect:{relativeX:1-V}})}},fromTop:function(g){return function(V,T){V=g(V),T.layer().setEffects({rect:{relativeY:-1+V}})}},fromBottom:function(g){return function(V,T){V=g(V),T.layer().setEffects({rect:{relativeY:1-V}})}},width:function(g){return function(V,T){V=g(V),T.layer().setEffects({rect:{relativeWidth:V}})}},fromCenter:function(g){return function(V,T){V=g(V),T.layer().setEffects({rect:{relativeWidth:V,relativeHeight:V,relativeX:.5-V/2,relativeY:.5-V/2}})}},fromCenterAndOpacity:function(g){return function(V,T){var it=g(V);T.layer().setEffects({rect:{relativeWidth:it,relativeHeight:it,relativeX:.5-it/2,relativeY:.5-it/2},opacity:V})}},fromTopAndOpacity:function(g){return function(V,T){var it=g(V);T.layer().setEffects({opacity:V,rect:{relativeY:-1+it}})}},fromWhite:function(g){return function(V,T){T.layer().setEffects({colorOffset:[1-V,1-V,1-V,0]})}},throughBlack:function(g){return function(V,T,it){var ot,rt=g(V);rt<.5?(ot=2*rt,T.layer().setEffects({opacity:0}),it.layer().setEffects({colorOffset:[-ot,-ot,-ot,0]})):(ot=1-2*(rt-.5),T.layer().setEffects({opacity:1,colorOffset:[-ot,-ot,-ot,0]}))}}},this.easingFunctions={linear:g=>g,easeInQuad:g=>Math.pow(g,2),easeOutQuad:g=>-(Math.pow(g-1,2)-1),easeInOutQuad:g=>(g/=.5)<1?.5*Math.pow(g,2):-.5*((g-=2)*g-2),easeInCubic:g=>Math.pow(g,3),easeOutCubic:g=>Math.pow(g-1,3)+1,easeInOutCubic:g=>(g/=.5)<1?.5*Math.pow(g,3):.5*(Math.pow(g-2,3)+2),easeInQuart:g=>Math.pow(g,4),easeOutQuart:g=>-(Math.pow(g-1,4)-1),easeInOutQuart:g=>(g/=.5)<1?.5*Math.pow(g,4):-.5*((g-=2)*Math.pow(g,3)-2),easeInQuint:g=>Math.pow(g,5),easeOutQuint:g=>Math.pow(g-1,5)+1,easeInOutQuint:g=>(g/=.5)<1?.5*Math.pow(g,5):.5*(Math.pow(g-2,5)+2),easeInSine:g=>1-Math.cos(g*(Math.PI/2)),easeOutSine:g=>Math.sin(g*(Math.PI/2)),easeInOutSine:g=>-.5*(Math.cos(Math.PI*g)-1),easeInExpo:g=>0===g?0:Math.pow(2,10*(g-1)),easeOutExpo:g=>1===g?1:1-Math.pow(2,-10*g),easeInOutExpo:g=>0===g?0:1===g?1:(g/=.5)<1?.5*Math.pow(2,10*(g-1)):.5*(2-Math.pow(2,-10*--g)),easeInCirc:g=>-(Math.sqrt(1-g*g)-1),easeOutCirc:g=>Math.sqrt(1-Math.pow(g-1,2)),easeInOutCirc:g=>(g/=.5)<1?-.5*(Math.sqrt(1-g*g)-1):.5*(Math.sqrt(1-(g-=2)*g)+1),easeOutBounce:g=>g<1/2.75?7.5625*g*g:g<2/2.75?7.5625*(g-=1.5/2.75)*g+.75:g<2.5/2.75?7.5625*(g-=2.25/2.75)*g+.9375:7.5625*(g-=2.625/2.75)*g+.984375,easeInBack:g=>{let V=1.70158;return g*g*((V+1)*g-V)},easeOutBack:g=>{let V=1.70158;return(g-=1)*g*((V+1)*g+V)+1},easeInOutBack:g=>{let V=1.70158;return(g/=.5)<1?g*g*((1+(V*=1.525))*g-V)*.5:.5*((g-=2)*g*((1+(V*=1.525))*g+V)+2)},elastic:g=>-1*Math.pow(4,-8*g)*Math.sin((6*g-1)*(2*Math.PI)/2)+1,swingFromTo:g=>{let V=1.70158;return(g/=.5)<1?g*g*((1+(V*=1.525))*g-V)*.5:.5*((g-=2)*g*((1+(V*=1.525))*g+V)+2)},swingFrom:g=>{let V=1.70158;return g*g*((V+1)*g-V)},swingTo:g=>{let V=1.70158;return(g-=1)*g*((V+1)*g+V)+1},bounce:g=>g<1/2.75?7.5625*g*g:g<2/2.75?7.5625*(g-=1.5/2.75)*g+.75:g<2.5/2.75?7.5625*(g-=2.25/2.75)*g+.9375:7.5625*(g-=2.625/2.75)*g+.984375,bouncePast:g=>g<1/2.75?7.5625*g*g:g<2/2.75?2-(7.5625*(g-=1.5/2.75)*g+.75):g<2.5/2.75?2-(7.5625*(g-=2.25/2.75)*g+.9375):2-(7.5625*(g-=2.625/2.75)*g+.984375),easeFromTo:g=>(g/=.5)<1?.5*Math.pow(g,4):-.5*((g-=2)*Math.pow(g,3)-2),easeFrom:g=>Math.pow(g,4),easeTo:g=>Math.pow(g,.25)},this.viewerService.viewerService=this}getFirstLoad(w){let B={panoId:this.panoService.first.pano.id,position:{theta:this.panoService.first.theta,phi:this.panoService.first.phi,fov:this.panoService.fov},thetaDetected:!1},D=p.v.paramsStringToObj(w);return D.p&&(B.panoId=D.p),D.h&&(B.position.theta=D.h,B.thetaDetected=!0),D.t&&(B.position.phi=D.t-90),D.room&&(this.panoService.callRoom=D.room),B}initViewer(w){this.viewer=new v.Viewer(w,{stage:{progressive:!0},controls:{scrollZoom:this.viewerService.viewerDataService.canScroll}}),this.viewer.__events.sceneChange.push(()=>{this.viewerReady=!0}),["aKey","dKey","leftArrowKey","rightArrowKey"].forEach(D=>{this.viewer.controls().enableMethod(D),this.viewer.controls().method(D).instance._velocity/=2}),this.locateControl(),this.angleControl(),this.panoControl(),this.gyroscopeInit();let B=this.getFirstLoad(this.panoService.moderationUrlOptions);setTimeout(()=>this.viewer._updateSizeListener()),this.loadPano(B.panoId).then(D=>{!D||(B.thetaDetected&&(B.position.theta-=D.north_angle),this.goToPano(B.panoId,B.position))})}_tileUrl(w,B,D,Q,b,U,$){let g,a=6144*$/3;switch(w){case"f":g={x1:0*a,y1:0*a,x2:1*a,y2:1*a};break;case"b":g={x1:1*a,y1:0*a,x2:2*a,y2:1*a};break;case"u":g={x1:2*a,y1:0*a,x2:3*a,y2:1*a};break;case"d":g={x1:0*a,y1:1*a,x2:1*a,y2:2*a};break;case"l":g={x1:1*a,y1:1*a,x2:2*a,y2:2*a};break;case"r":g={x1:2*a,y1:1*a,x2:3*a,y2:2*a}}let T=a/Math.pow(2,B-1);return this.panoService.res_16k&&(U+="&pad=bg:000016"),`${b}?crop=${g.x1+T*(D-1)}x${g.y1+T*(Q-1)}x${g.x1+T*D}x${g.y1+T*Q}&resize=512x512&${U}`}source(w){let B=w.url.split("?"),D=B[0],Q=parseInt(B[1].split(":")[1]),b=this.panoService.res_16k?2:1,U=`save=optimize,progressive,qual:${this.panoService.jpeg_quality}`;return new v.ImageUrlSource($=>{if(0===$.z){var N="lfrbud".indexOf($.face)/6;return{url:`${this.imgHost}cube/${D.replace(".jpg",`_thumb_${Q}.jpg`)}?${U}`,rect:{x:0,y:N,width:1,height:1/6}}}return{url:this._tileUrl($.face,$.z,$.x+1,$.y+1,`${this.imgHost}cube/${D.replace(".jpg",`_${Q}.jpg`)}`,U,b)}},{concurrency:10})}createCubeMapScene(w,B=!1){let D=this.source(w),Q=[{tileSize:256,size:256,fallbackOnly:!0},{tileSize:512,size:512},{tileSize:512,size:1024},{tileSize:512,size:2048}];this.panoService.res_16k&&Q.push({tileSize:512,size:4096});let b=new v.CubeGeometry(Q),U={yaw:0*Math.PI/180,pitch:0*Math.PI/180,fov:this.fov*Math.PI/180},$=v.RectilinearView.limit.traditional(8192,120*Math.PI/180),N=new v.RectilinearView(U,$);return B?this.viewer2.createScene({source:D,geometry:b,view:N,pinFirstLevel:!0}):this.viewer.createScene({source:D,geometry:b,view:N,pinFirstLevel:!0})}loadScene(w,B=!1){if(B&&this.scenes2[w.id])return this.scenes2[w.id];if(this.scenes[w.id])return this.scenes[w.id];let D=this.createCubeMapScene(w,B);return B?this.scenes2[w.id]=D:this.scenes[w.id]=D,D}locateControl(){this.locationSubject.pipe((0,l.b)(100)).subscribe(()=>{const[w,B,D]=[this.viewerService.viewerDataService.active.id,this._angleCorrector(parseFloat(this.viewerService.viewerDataService.angle.toFixed(2))),this._angleCorrector(parseFloat((-1*this.pitch+90).toFixed(2)))];let Q=`${w}p&${B}h&${D}t`;this.panoService.callRoom&&(Q+="&room:"+this.panoService.callRoom),this.panoService.moderationUrl&&(Q=`${this.panoService.moderationUrl}/${Q}`),this.location.replaceState(Q)})}_angleCorrector(w){return-14210854715202004e-30==w&&(w=0),w>=360&&(w%=360),w<0&&(w+=360),w}angleControl(){this.viewer.__events.viewChange.push(()=>{this.changing_pano?this.changing_pano=!1:(this.panoService.fov_lock&&this.viewer.scene().view().setFov(9e4*Math.PI/180),this.panoService.lock_pitch&&this.viewer.scene().view().setPitch(0),this.yaw=180*this.viewer.scene().view().yaw()/Math.PI,this.pitch=180*this.viewer.scene().view().pitch()/Math.PI,this.fov=180*this.viewer.scene().view().fov()/Math.PI,this.viewerService.viewerDataService.angle=this._angleCorrector(this.yaw+this.panoService.getPanoById(this.viewerService.viewerDataService.active.id).north_angle),this.viewerService.viewerDataService.editor||this.locationSubject.next())})}panoControl(){this.viewer.__events.sceneChange.push(()=>{this.globalPubService.fireEvent("panoChange",[this.viewerService.viewerDataService.active.id]),this.viewer._updateSizeListener();let w=this.panoService.getPanoById(this.viewerService.viewerDataService.active.id);if(this.activePanoObs.next(this.viewerService.viewerDataService.active),this.changing_pano=!0,this.viewer.scene().view().setYaw(this._angleCorrector(this.viewerService.viewerDataService.angle-w.north_angle)*Math.PI/180),this.viewer.scene().view().setPitch(this.pitch*Math.PI/180),this.viewer.scene().view().setFov(this.fov*Math.PI/180),this.loadPano(w.next_pano).then(D=>this.loadScene(D)),this.loadPano(w.prev_pano).then(D=>this.loadScene(D)),w.links.forEach(D=>{this.loadPano(D.id).then(Q=>this.loadScene(Q))}),this.hotspotControl(),1==this.viewerService.viewerDataService.slideInterval.angle&&!this.viewerService.interaction){var B=v.autorotate({yawSpeed:.1,targetPitch:0,targetFov:Math.PI/2});this.viewer.setIdleMovement(1e3,B),this.viewer.startMovement(B)}this.viewerService.viewerDataService.editor||this.locationSubject.next()})}_addAllHotspotsOfCurrentPano(){!this.content.hotspotsContainer||(this.content.hotspotsContainer.clear(),this.hotspotService.hotspots.filter(w=>w.pano.id==this.viewerService.viewerDataService.active.id).forEach(w=>{this.content.addHotspot(w.widget,w),w.pano_link?.pano?.id&&this.loadPano(w.pano_link.pano.id)}))}hotspotControl(){this.hotspotService.close(),this.removeHotspots(),this._addAllHotspotsOfCurrentPano()}addHotspot(w,B){let D=this.hotspotService.getHotspotById(w);if(!D||D.pano.id!=this.viewerService.viewerDataService.active.id)return;let Q=this.hotspotService.doc.getElementById(D.id),b={yaw:this.viewer.scene().view().yaw(),pitch:this.viewer.scene().view().pitch()};D.position?b={yaw:D.position.theta*Math.PI/180,pitch:-1*D.position.phi*Math.PI/180}:D.position={theta:180*b.yaw/Math.PI,phi:-1*b.pitch*180/Math.PI,radius:1};let U={};return D.perspective&&(U={perspective:{radius:340}}),this.viewer.scene().hotspotContainer().createHotspot(Q,b,U),D}removeHotspot(w){let B=this.viewer.scene().hotspotContainer().listHotspots().filter(Q=>Q.domElement().id==w).pop(),D=this.viewer.scene().hotspotContainer().listHotspots().indexOf(B);B&&this.viewer.scene().hotspotContainer().destroyHotspot(B),this.hotspotService.deleteHotspotById(w),-1!==D&&this.content.hotspotsContainer.remove(D)}removeHotspots(){this.viewer.scene().hotspotContainer().listHotspots().map(w=>{this.viewer.scene().hotspotContainer().destroyHotspot(w)})}ifSlidingPauseIt(){1==this.viewerService.viewerDataService.slideInterval.angle&&(this.viewer.setIdleMovement(1/0),this.viewer.stopMovement())}panoWalk(){if(!this.viewerService.viewerDataService.slideInterval.angle&&this.viewerService.interaction)return;let w=this.panoService.getPanoById(this.viewerService.viewerDataService.active.id);if(!w)return;let B=this.loadPano(w.next_pano),D=this.viewerService.viewerDataService.angle,Q=this.viewerService.viewerDataService.angle-360;if(w.links.length){let a=[];w.links.forEach(V=>{let T=Math.round((V.angle+w.north_angle)%360),it=Math.round((T-Q)%360);it>180&&(it-=360),a.push(Math.abs(it))});let g=w.links[a.indexOf(Math.min(...a))];D=Math.round((g.angle+w.north_angle)%360),B=this.loadPano(g.id)}let b=this._angleCorrector(D-w.north_angle);Q=this.viewerService.viewerDataService.angle-(b+w.north_angle),Q<0&&(Q*=-1),Q>180&&(Q-=180);let N=Q/10;N<6&&(N=6),this.viewer.lookTo({yaw:b*Math.PI/180,pitch:0*Math.PI/180},{transitionDuration:1e3*N},()=>{this.viewerService.viewerDataService.slideInterval.angle&&!this.viewerService.interaction&&B.then(a=>{this.goToPano(a.id),this.panoWalk()})})}slidePano(){if(this.viewer.scene().view().setFov(this.fov*Math.PI/180),this.viewerService.viewerDataService.slideInterval.angle=!0,!this.viewerService.interaction)if(this.controlService.control.tools&&this.controlService.control.tools.filter(w=>"slider"==w.key).pop().pano_walk)this.viewerService.viewerDataService.slideInterval.angle=2,this.panoWalk();else{let w={slide_speed:10,slide_toggle:5,slide_pano_change:!0},B=this.controlService.control?.tools?.find(Q=>"slider"===Q.key);B&&(w=B),this.viewerService.viewerDataService.slideInterval.angle=1,w.slide_pano_change&&(this.viewerService.viewerDataService.slideInterval.pano=setInterval(()=>{this.nextPano()},1e3*w.slide_toggle));let D=v.autorotate({yawSpeed:.1,targetPitch:0,targetFov:Math.PI/2});this.viewer.setIdleMovement(1e3,D),this.viewer.startMovement(D)}}slideStop(){this.viewerService.viewerDataService.slideInterval.pano&&clearInterval(this.viewerService.viewerDataService.slideInterval.pano),this.viewerService.viewerDataService.slideInterval.angle=0,this.viewerService.viewerDataService.slideInterval.pano=null,this.viewer.setIdleMovement(1/0),this.viewer.stopMovement()}slidePause(){this.viewerService.viewerDataService.slideInterval.pano&&clearInterval(this.viewerService.viewerDataService.slideInterval.pano),this.viewerService.viewerDataService.slideInterval.pano=null,this.viewer.setIdleMovement(1/0),this.viewer.stopMovement()}slideResume(){this.slidePano()}nextPano(){this.ifSlidingPauseIt();let D,w=this.panoService.getPanoById(this.viewerService.viewerDataService.active.id).next_pano,B=this.panoService.panoramas.filter(b=>b.id==w).pop();if(this.controlService.control.tools){var Q=this.controlService.control.tools.filter(b=>"slider"===b.key).pop();Q&&(D=Q)}if(D.slide_pano_on_chosed){if(D.slide_pano_arr.length>0){let b=D.slide_pano_arr.filter(U=>U.pano.id==this.viewerService.viewerDataService.active.id).pop();if(b){let U=D.slide_pano_arr.indexOf(b);b=D.slide_pano_arr[U+1]?D.slide_pano_arr[U+1]:D.slide_pano_arr[0]}else b=D.slide_pano_arr[0];return void(b&&this.goToPano(b.pano.id))}}else if(!B)return void this.panoService.panoLoading[w].then(()=>{B=this.panoService.panoramas.filter(b=>b.id==w).pop(),this.goToPano(B.id)});this.goToPano(B.id)}previousPano(){this.ifSlidingPauseIt();let D,w=this.panoService.getPanoById(this.viewerService.viewerDataService.active.id).prev_pano,B=this.panoService.panoramas.filter(b=>b.id==w).pop();if(this.controlService.control.tools){var Q=this.controlService.control.tools.filter(b=>"slider"===b.key).pop();Q&&(D=Q)}if(D.slide_pano_on_chosed){if(D.slide_pano_arr.length>0){let b=D.slide_pano_arr.filter(U=>U.pano.id==this.viewerService.viewerDataService.active.id).pop();if(b){let U=D.slide_pano_arr.indexOf(b);b=D.slide_pano_arr[U-1]?D.slide_pano_arr[U-1]:D.slide_pano_arr[D.slide_pano_arr.length-1]}else b=D.slide_pano_arr[D.slide_pano_arr.length-1];return void(b&&this.goToPano(b.pano.id))}}else if(!B)return void this.panoService.panoLoading[w].then(()=>{B=this.panoService.panoramas.filter(b=>b.id==w).pop(),this.goToPano(B.id)});this.goToPano(B.id)}hotspotMoveControlMousemove(w,B){w.preventDefault(),this.viewer._controlMethods.mouseViewDrag._startEvent=!1;let D=this.viewer.scene().hotspotContainer().listHotspots().filter($=>$.domElement().id==B).pop(),Q=180*D._coords.yaw/Math.PI+w.movementX/10,b=180*D._coords.pitch/Math.PI+w.movementY/10;D.setPosition({yaw:Q*Math.PI/180,pitch:b*Math.PI/180}),Q=this._angleCorrector(Q);let U=this.hotspotService.getHotspotById(B);U.position.theta=Q,U.position.phi=-1*b}panoramaUrl(w){return`/panorama/${this.panoService.user_id}/${this.panoService.folder_id}/${this.panoService.tour_id}/${w}`}loadPano(w){return this.panoService.panoLoading[w]||(this.panoService.panoLoading[w]=new Promise(B=>{let D=this.panoService.panoramas.filter(Q=>Q.id==w).pop();if(D)B(D);else try{this.http.get(this.panoramaUrl(w)).toPromise().then(Q=>{if(Q){let b=this.panoService.addPano(Q,this.imgRes);b.hotspots?.map(U=>{this.hotspotService.getHotspotById(U.id)||(this.hotspotService.addHotspot(U),U.pano_link?.pano?.id&&!this.panoService.panoLoading[U.pano_link.pano.id]&&this.loadPano(U.pano_link.pano.id))}),B(b)}})}catch{}})),this.panoService.panoLoading[w]}changeActivePano(w,B,D,Q){this.viewerService.viewerDataService.active.id!=w.id&&(this.viewerService.viewerDataService.prevActive=Object.assign({},this.viewerService.viewerDataService.active),this.viewerService.viewerDataService.active.id=w.id,this.viewerService.viewerDataService.active.t_id=w.moderation_id,this.loadScene(w).switchTo(Q)),B&&this.viewer.lookTo({yaw:null!=B.theta?B.theta*Math.PI/180:this.viewer.scene().view().yaw(),pitch:null!=B.phi?-1*B.phi*Math.PI/180:this.viewer.scene().view().pitch(),fov:null!=B.fov?B.fov*Math.PI/180:this.viewer.scene().view().fov()},{transitionDuration:D?1e3:0})}goToPano(w,B,D,Q){this.ifSlidingPauseIt();let b=this.panoService.getPanoById(w);b?this.changeActivePano(b,B,D,Q):this.loadPano(w).then(U=>{!U||this.changeActivePano(U,B,D,Q)})}gyroscopeEnable(){if(window.DeviceOrientationEvent){let w=window.DeviceOrientationEvent;"function"==typeof w.requestPermission?w.requestPermission().then(B=>{"granted"===B&&this.enableDeviceOrientation()}).catch(B=>{console.error(B)}):this.enableDeviceOrientation()}}gyroscopeDisable(){this.viewer.controls().disableMethod("deviceOrientation"),this.gyroscope=!1}enableDeviceOrientation(){var w=this.viewer.controls();this.deviceOrientationControlMethod.getPitch((B,D)=>{B||this.viewer.scene().view().setPitch(D)}),w.enableMethod("deviceOrientation"),this.gyroscope=!0}gyroscopeInit(){var w=this;return(0,c.Z)(function*(){let B=yield s(1148).z;w.deviceOrientationControlMethod=new B,w.viewer.controls().registerMethod("deviceOrientation",w.deviceOrientationControlMethod)})()}gyroscopeToggle(){this.gyroscope?this.gyroscopeDisable():this.gyroscopeEnable()}changeViewPosition(w,{tx:B,ty:D,tz:Q}){w._resetParams(),w._params.tx=B,w._params.ty=D,w._params.tz=Q,w._update()}animateViewPosition(w,{x:B,y:D,z:Q},b,U=!1){const $={tx:0,ty:0,tz:0};let N={...$},a={tx:B,ty:D,tz:Q};U&&(a={tx:-a.tx,ty:-a.ty,tz:-a.tz},[N,a]=[a,N]),this.changeViewPosition(w,N);const g=w.tx(),V=w.ty(),T=w.tz(),it_tx=a.tx-g,it_ty=a.ty-V,it_tz=a.tz-T;v.util.tween(b,rt=>{this.changeViewPosition(w,{tx:g+it_tx*rt,ty:V+it_ty*rt,tz:T+it_tz*rt})},()=>{this.changeViewPosition(w,$)})}getPositionFromAngle(w,B){const D=w*Math.PI/180;return{x:B*Math.cos(D),y:0,z:B*Math.sin(D)}}moveCameraForward(w,B,D,Q){if(!w||!B||w.id===B.id)return;const b=this.getAngleBetweenPoints(w.latlong,B.latlong)-90,$=b-B.north_angle,N=this.getPositionFromAngle(b-w.north_angle,D/10),a=this.getPositionFromAngle($,D/10),g=this.scenes[w.id].view(),V=this.scenes[B.id].view();this.animateViewPosition(g,N,Q),this.animateViewPosition(V,a,Q,!0)}hidePancakeUntil(w){const B=this.viewerService.viewer.domElement();clearTimeout(this.hidePancakeTimeout),B.style.setProperty("--pancake-visibility","hidden"),this.hidePancakeTimeout=setTimeout(()=>{B.style.setProperty("--pancake-visibility","visible")},w)}blurEffect(w,B){const D=1*B;this._cancelBlurAnimation&&this._cancelBlurAnimation(),this._cancelBlurAnimation=this._requestAnimation(w/2,Q=>{let U=Math.max(parseFloat(this.viewer._controlContainer.style.backdropFilter.match(/[-+]?[0-9]*\.?[0-9]+/)),Q*D/100);this.viewer._controlContainer.style.backdropFilter=`blur(${U}px)`}),this._blurRevereseTimeout&&clearTimeout(this._blurRevereseTimeout),this._blurRevereseTimeout=setTimeout(()=>{this._cancelBlurAnimation&&this._cancelBlurAnimation(),this._cancelBlurAnimation=this._requestAnimation(w/2,Q=>{this.viewer._controlContainer.style.backdropFilter=`blur(${D-Q*D/100}px)`})},w/2)}_requestAnimation(w,B){let b,D=null,Q=!1;const U=$=>{D||(D=$);const N=Math.min(w,$-D);B(N/w*100),!Q&&N<w&&requestAnimationFrame(U)};return b&&b(),b=()=>{Q=!0},requestAnimationFrame(U),b}goToPanoWithAnimations(w){const B=this.otherService.getWidget("OtherNavigationComponent"),D=$=>B?.options.find(N=>N.key===$)?.value,b=D("list")?.find($=>$.pano?.id===this.viewerService.active.id&&$.pano_link?.id===w)?.pano_animation||{scene_animation:D("scene-animation"),scene_animation_transition:D("scene-animation-transition"),scene_animation_easing:D("scene-animation-easing"),scene_animation_blur:D("scene-animation-blur"),scene_animation_duration:D("scene-animation-duration"),camera_animation:D("camera-animation"),camera_animation_distance:D("camera-animation-distance"),camera_animation_duration:D("camera-animation-duration")};let U;if(b.scene_animation){const $="blurAndOpacity"===b.scene_animation_transition?(()=>(this.blurEffect(b.scene_animation_duration,b.scene_animation_blur),this.transitionFunctions.opacity))():this.transitionFunctions[b.scene_animation_transition],N=this.easingFunctions[b.scene_animation_easing];U=$&&{transitionDuration:b.scene_animation_duration,transitionUpdate:$(N)}}if(this.goToPano(w,void 0,void 0,U),b.camera_animation){const $=this.panoService.getPanoById(this.viewerService.prevActive.id),N=this.panoService.getPanoById(this.viewerService.active.id);this.moveCameraForward($,N,b.camera_animation_distance,b.camera_animation_duration),"pancake"==D("navigation")&&this.hidePancakeUntil(b.camera_animation_duration)}}}return H.\u0275fac=function(w){return new(w||H)(m.LFG(L),m.LFG(S.a),m.LFG(_.x),m.LFG(d.Ye),m.LFG(x.X),m.LFG(R.N),m.LFG(z.B),m.LFG(Y.m),m.LFG(O.eN))},H.\u0275prov=m.Yz7({token:H,factory:H.\u0275fac,providedIn:"root"}),H})()},8239:(X,k,s)=>{"use strict";function c(E,p,v,l,m,L,S){try{var _=E[L](S),d=_.value}catch(x){return void v(x)}_.done?p(d):Promise.resolve(d).then(l,m)}function A(E){return function(){var p=this,v=arguments;return new Promise(function(l,m){var L=E.apply(p,v);function S(d){c(L,l,m,S,_,"next",d)}function _(d){c(L,l,m,S,_,"throw",d)}S(void 0)})}}s.d(k,{Z:()=>A})}}]);