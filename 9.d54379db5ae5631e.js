"use strict";(self.webpackChunktourmkr_download=self.webpackChunktourmkr_download||[]).push([[9],{945:(M,b,a)=>{a.d(b,{F:()=>y});var m=a(2409),d=a(3637),C=a(6561);function y(l=0,f=d.P){return(!(0,C.k)(l)||l<0)&&(l=0),(!f||"function"!=typeof f.schedule)&&(f=d.P),new m.y(p=>(p.add(f.schedule(c,l,{subscriber:p,counter:0,period:l})),p))}function c(l){const{subscriber:f,counter:p,period:g}=l;f.next(p),this.schedule({subscriber:f,counter:p+1,period:g},g)}},354:(M,b,a)=>{a.d(b,{o:()=>y});var m=a(8692),d=a(4537);function C(c,l){if(1&c&&(d.O4$(),d.TgZ(0,"svg",1),d._UZ(1,"path",2),d.qZA()),2&c){const f=d.oxw();d.uIk("data-prefix",f.icon.prefix)("data-icon",f.icon.iconName)("viewBox","0 0 "+f.icon.icon[0]+" "+f.icon.icon[1]),d.xp6(1),d.uIk("d",f.icon.icon[4])}}let y=(()=>{class c{constructor(f,p){this.elRef=f,this.platformId=p}iconTransform(){!(0,m.NF)(this.platformId)||this.elRef.nativeElement.style.setProperty("--transform",this.icon&&this.icon.icon&&this.icon.icon[0]!=this.icon.icon[1]&&this.icon.icon[0]/this.icon.icon[1]>.8?"scale("+this.icon.icon[0]/this.icon.icon[1]+")":null)}ngOnInit(){this.iconTransform()}ngOnChanges(f){void 0!==f.icon&&this.iconTransform()}}return c.\u0275fac=function(f){return new(f||c)(d.Y36(d.SBq),d.Y36(d.Lbi))},c.\u0275cmp=d.Xpm({type:c,selectors:[["sh-icon"]],inputs:{icon:"icon"},features:[d.TTD],decls:1,vars:1,consts:[["role","img","aria-hidden","true","focusable","false","xmlns","http://www.w3.org/2000/svg",4,"ngIf"],["role","img","aria-hidden","true","focusable","false","xmlns","http://www.w3.org/2000/svg"],["fill","currentColor"]],template:function(f,p){1&f&&d.YNc(0,C,2,4,"svg",0),2&f&&d.Q6J("ngIf",p.icon&&p.icon.icon)},dependencies:[m.O5],styles:["[_nghost-%COMP%]{width:14px;height:14px;display:inline-block;line-height:0;transform:var(--transform)}svg[_ngcontent-%COMP%]{max-width:100%;max-height:100%;width:100%;height:100%}"]}),c})()},6031:(M,b,a)=>{a.d(b,{Q:()=>C});var m=a(8692),d=a(4537);let C=(()=>{class y{}return y.\u0275fac=function(l){return new(l||y)},y.\u0275mod=d.oAB({type:y}),y.\u0275inj=d.cJS({imports:[m.ez]}),y})()},7591:(M,b,a)=>{a.d(b,{I:()=>y});var m=a(4537),d=a(8692);const C=["ref"];let y=(()=>{class c{constructor(){this.standart=!0,this.pos={left:0,top:0}}}return c.\u0275fac=function(f){return new(f||c)},c.\u0275cmp=m.Xpm({type:c,selectors:[["sh-tool-tip"]],viewQuery:function(f,p){if(1&f&&m.Gf(C,5,m.SBq),2&f){let g;m.iGM(g=m.CRH())&&(p.ref=g.first)}},inputs:{position:"position",standart:"standart"},decls:3,vars:10,consts:[[1,"sh-tooltip",3,"ngClass"],["ref",""]],template:function(f,p){1&f&&(m.TgZ(0,"span",0,1),m._uU(2),m.qZA()),2&f&&(m.Udp("left",p.pos.left,"px")("top",p.pos.top,"px"),m.ekj("show",p.show)("standart",p.standart),m.Q6J("ngClass",p.position),m.xp6(2),m.Oqu(p.text))},dependencies:[d.mk],styles:["span[_ngcontent-%COMP%]{position:absolute;top:0;font-size:12px;left:0;padding:2px 8px;background:inherit;color:inherit;border-radius:3px;white-space:nowrap;visibility:hidden;opacity:0;z-index:999;cursor:default}span.show[_ngcontent-%COMP%]{visibility:visible;opacity:1}span.standart[_ngcontent-%COMP%]{background:rgba(0,0,0,.5);color:#fff}span.above[_ngcontent-%COMP%]{transform:translate(-50%,-100%)}span.below[_ngcontent-%COMP%]{transform:translate(-50%)}span.before[_ngcontent-%COMP%]{transform:translate(-100%,-50%)}span.after[_ngcontent-%COMP%]{transform:translateY(-50%)}  #overlay.mobile span.sh-tooltip{display:none}"]}),c})()},563:(M,b,a)=>{a.d(b,{h:()=>d});var m=a(4537);let d=(()=>{class C{constructor(c){this._elementRef=c,this.showToolTip=!0,this.margin=5,this._position="above"}click(){setTimeout(()=>{this.shToolTipComponent.text=this.text,(!this.text||!Object.values(this._elementRef.nativeElement.getBoundingClientRect().toJSON()).find(c=>0!=c))&&(this.shToolTipComponent.show=!1)})}show(){!this.text||(this.shToolTipComponent.text=this.text,this.shToolTipPosition?(this._position=this.shToolTipPosition,this.shToolTipComponent.position=this._position):this.shToolTipComponent.position?this._position=this.shToolTipComponent.position:this.shToolTipComponent.position=this._position,this.shToolTipComponent.pos=this._getPos(),this.shToolTipComponent.show=!0)}hide(){this.shToolTipComponent.text=void 0,this.shToolTipComponent.show=!1}_getPos(){let c=this._elementRef.nativeElement.getBoundingClientRect(),l={left:c.left,top:c.top,width:c.width,height:c.height},f=document.getElementById("overlay").getBoundingClientRect();l.left-=f.left,l.top-=f.top;let p=this.shToolTipComponent.ref.nativeElement,g={left:0,top:0};return"above"==this._position||"below"==this._position?(g.left=l.left+l.width/2,g.left-p.offsetWidth/2<0?g.left=p.offsetWidth/2:g.left+p.offsetWidth/2>document.body.clientWidth&&(g.left=document.body.clientWidth-p.offsetWidth/2),"above"==this._position?(g.top=l.top-this.margin,g.top-p.offsetHeight<0&&(g.top=p.offsetHeight)):"below"==this._position&&(g.top=l.top+l.height+this.margin,g.top+p.offsetHeight>document.body.clientHeight&&(g.top=document.body.clientHeight-p.offsetHeight))):("before"==this._position||"after"==this._position)&&(g.top=l.top+l.height/2,g.top-p.offsetHeight/2<0?g.top=p.offsetHeight/2:g.top+p.offsetHeight/2>document.body.clientHeight&&(g.top=document.body.clientHeight-p.offsetHeight/2),"before"==this._position?(g.left=l.left-this.margin,g.left-p.offsetWidth<0&&(g.left=p.offsetWidth)):"after"==this._position&&(g.left=l.left+l.width+this.margin,g.left+p.offsetWidth>document.body.clientWidth&&(g.left=document.body.clientWidth-p.offsetWidth))),g}}return C.\u0275fac=function(c){return new(c||C)(m.Y36(m.SBq))},C.\u0275dir=m.lG2({type:C,selectors:[["","shToolTip",""]],hostBindings:function(c,l){1&c&&m.NdJ("click",function(){return l.click()})("mouseenter",function(){return l.show()})("mouseleave",function(){return l.hide()})},inputs:{showToolTip:"showToolTip",text:["shToolTip","text"],shToolTipComponent:"shToolTipComponent",shToolTipPosition:"shToolTipPosition"}}),C})()},9488:(M,b,a)=>{a.d(b,{y:()=>C});var m=a(8692),d=a(4537);let C=(()=>{class y{}return y.\u0275fac=function(l){return new(l||y)},y.\u0275mod=d.oAB({type:y}),y.\u0275inj=d.cJS({imports:[m.ez]}),y})()},5009:(M,b,a)=>{a.r(b),a.d(b,{OtherVideocallModule:()=>Me});var m={};a.r(m),a.d(m,{Decoder:()=>q,Encoder:()=>ne,PacketType:()=>u,protocol:()=>ee});var d=a(8692),C=a(8041);const y=JSON.parse('{"widget":"OtherVideocallComponent","options":[{"key":"notification","label":"Notification","type":"text","category":"content","value":{"en":"Link copied to clipboard, share it"},"font":{"family":"Exo","align":"center","size":16,"line_height":24,"italic":false,"bold":false,"underline":false,"color":""}},{"key":"size","label":"Size","type":"slider","category":"appearance","help":"px","max":500,"min":0,"value":136},{"key":"border_radius","label":"Border radius","type":"border-radius","category":"appearance","value":{"topLeft":20,"topRight":20,"bottomLeft":20,"bottomRight":20}},{"key":"margin","label":"Margin","type":"slider","category":"appearance","help":"px","value":10},{"key":"area","label":"Area","areas":["top","bottom","left","right","top-left","top-right","bottom-left","bottom-right"],"type":"area","category":"appearance","value":"top-left"},{"key":"vertical","label":"Vertical","type":"toggle","category":"appearance","value":false},{"key":"colors","type":"color-bundle","category":"colors","value":{"common_color":false,"background":{"type":"native","color":"rgb(241 196 15)"},"active_color":{"type":"native","color":"rgb(234,67,53)"},"text_color":{"color":"rgb(0,0,0)"}}},{"key":"styles","label":"Styles","type":"css","category":"styles","value":""}]}'),c=Object.create(null);c.open="0",c.close="1",c.ping="2",c.pong="3",c.message="4",c.upgrade="5",c.noop="6";const l=Object.create(null);Object.keys(c).forEach(o=>{l[c[o]]=o});const f={type:"error",data:"parser error"},p="function"==typeof Blob||typeof Blob<"u"&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),g="function"==typeof ArrayBuffer,Y=(o,e)=>{const t=new FileReader;return t.onload=function(){const n=t.result.split(",")[1];e("b"+n)},t.readAsDataURL(o)},j=({type:o,data:e},t,n)=>p&&e instanceof Blob?t?n(e):Y(e,n):g&&(e instanceof ArrayBuffer||(o=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(o):o&&o.buffer instanceof ArrayBuffer)(e))?t?n(e):Y(new Blob([e]),n):n(c[o]+(e||"")),P="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",R=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let o=0;o<P.length;o++)R[P.charCodeAt(o)]=o;const Ot="function"==typeof ArrayBuffer,xt=(o,e)=>{if(Ot){const t=(o=>{let n,r,h,v,O,e=.75*o.length,t=o.length,s=0;"="===o[o.length-1]&&(e--,"="===o[o.length-2]&&e--);const N=new ArrayBuffer(e),E=new Uint8Array(N);for(n=0;n<t;n+=4)r=R[o.charCodeAt(n)],h=R[o.charCodeAt(n+1)],v=R[o.charCodeAt(n+2)],O=R[o.charCodeAt(n+3)],E[s++]=r<<2|h>>4,E[s++]=(15&h)<<4|v>>2,E[s++]=(3&v)<<6|63&O;return N})(o);return G(t,e)}return{base64:!0,data:o}},G=(o,e)=>"blob"===e&&o instanceof ArrayBuffer?new Blob([o]):o,X=(o,e)=>{if("string"!=typeof o)return{type:"message",data:G(o,e)};const t=o.charAt(0);return"b"===t?{type:"message",data:xt(o.substring(1),e)}:l[t]?o.length>1?{type:l[t],data:o.substring(1)}:{type:l[t]}:f},$=String.fromCharCode(30);function _(o){if(o)return function kt(o){for(var e in _.prototype)o[e]=_.prototype[e];return o}(o)}_.prototype.on=_.prototype.addEventListener=function(o,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+o]=this._callbacks["$"+o]||[]).push(e),this},_.prototype.once=function(o,e){function t(){this.off(o,t),e.apply(this,arguments)}return t.fn=e,this.on(o,t),this},_.prototype.off=_.prototype.removeListener=_.prototype.removeAllListeners=_.prototype.removeEventListener=function(o,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var t=this._callbacks["$"+o];if(!t)return this;if(1==arguments.length)return delete this._callbacks["$"+o],this;for(var n,s=0;s<t.length;s++)if((n=t[s])===e||n.fn===e){t.splice(s,1);break}return 0===t.length&&delete this._callbacks["$"+o],this},_.prototype.emitReserved=_.prototype.emit=function(o){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+o],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(t){n=0;for(var s=(t=t.slice(0)).length;n<s;++n)t[n].apply(this,e)}return this},_.prototype.listeners=function(o){return this._callbacks=this._callbacks||{},this._callbacks["$"+o]||[]},_.prototype.hasListeners=function(o){return!!this.listeners(o).length};const w=typeof self<"u"?self:typeof window<"u"?window:Function("return this")();function et(o,...e){return e.reduce((t,n)=>(o.hasOwnProperty(n)&&(t[n]=o[n]),t),{})}const Et=setTimeout,At=clearTimeout;function L(o,e){e.useNativeTimers?(o.setTimeoutFn=Et.bind(w),o.clearTimeoutFn=At.bind(w)):(o.setTimeoutFn=setTimeout.bind(w),o.clearTimeoutFn=clearTimeout.bind(w))}function St(o){return"string"==typeof o?function Nt(o){let e=0,t=0;for(let n=0,s=o.length;n<s;n++)e=o.charCodeAt(n),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(n++,t+=4);return t}(o):Math.ceil(1.33*(o.byteLength||o.size))}class Bt extends Error{constructor(e,t,n){super(e),this.description=t,this.context=n,this.type="TransportError"}}class nt extends _{constructor(e){super(),this.writable=!1,L(this,e),this.opts=e,this.query=e.query,this.readyState="",this.socket=e.socket}onError(e,t,n){return super.emitReserved("error",new Bt(e,t,n)),this}open(){return("closed"===this.readyState||""===this.readyState)&&(this.readyState="opening",this.doOpen()),this}close(){return("opening"===this.readyState||"open"===this.readyState)&&(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=X(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}}const ot="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),it={};let rt,st=0,x=0;function ct(o){let e="";do{e=ot[o%64]+e,o=Math.floor(o/64)}while(o>0);return e}function at(){const o=ct(+new Date);return o!==rt?(st=0,rt=o):o+"."+ct(st++)}for(;x<64;x++)it[ot[x]]=x;function lt(o){let e="";for(let t in o)o.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(o[t]));return e}let ht=!1;try{ht=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const Vt=ht;function pt(o){const e=o.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||Vt))return new XMLHttpRequest}catch{}if(!e)try{return new(w[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch{}}function It(){}const Dt=null!=new pt({xdomain:!1}).responseType;let I=(()=>{class o extends _{constructor(t,n){super(),L(this,n),this.opts=n,this.method=n.method||"GET",this.uri=t,this.async=!1!==n.async,this.data=void 0!==n.data?n.data:null,this.create()}create(){const t=et(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd,t.xscheme=!!this.opts.xs;const n=this.xhr=new pt(t);try{n.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let s in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(s)&&n.setRequestHeader(s,this.opts.extraHeaders[s])}}catch{}if("POST"===this.method)try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{n.setRequestHeader("Accept","*/*")}catch{}"withCredentials"in n&&(n.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(n.timeout=this.opts.requestTimeout),n.onreadystatechange=()=>{4===n.readyState&&(200===n.status||1223===n.status?this.onLoad():this.setTimeoutFn(()=>{this.onError("number"==typeof n.status?n.status:0)},0))},n.send(this.data)}catch(s){return void this.setTimeoutFn(()=>{this.onError(s)},0)}typeof document<"u"&&(this.index=o.requestsCount++,o.requests[this.index]=this)}onError(t){this.emitReserved("error",t,this.xhr),this.cleanup(!0)}cleanup(t){if(!(typeof this.xhr>"u"||null===this.xhr)){if(this.xhr.onreadystatechange=It,t)try{this.xhr.abort()}catch{}typeof document<"u"&&delete o.requests[this.index],this.xhr=null}}onLoad(){const t=this.xhr.responseText;null!==t&&(this.emitReserved("data",t),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}return o.requestsCount=0,o.requests={},o})();function ft(){for(let o in I.requests)I.requests.hasOwnProperty(o)&&I.requests[o].abort()}typeof document<"u"&&("function"==typeof attachEvent?attachEvent("onunload",ft):"function"==typeof addEventListener&&addEventListener("onpagehide"in w?"pagehide":"unload",ft,!1));const zt="function"==typeof Promise&&"function"==typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),D=w.WebSocket||w.MozWebSocket,dt=typeof navigator<"u"&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),Jt={websocket:class Ft extends nt{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,n=dt?{}:et(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=dt?new D(e,t,n):t?new D(e,t):new D(e)}catch(s){return this.emitReserved("error",s)}this.ws.binaryType=this.socket.binaryType||"arraybuffer",this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const s=t===e.length-1;j(e[t],this.supportsBinary,r=>{try{this.ws.send(r)}catch{}s&&zt(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{};const t=this.opts.secure?"wss":"ws";let n="";this.opts.port&&("wss"===t&&443!==Number(this.opts.port)||"ws"===t&&80!==Number(this.opts.port))&&(n=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=at()),this.supportsBinary||(e.b64=1);const s=lt(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(s.length?"?"+s:"")}check(){return!!D}},polling:class Ht extends nt{constructor(e){if(super(e),this.polling=!1,typeof location<"u"){const n="https:"===location.protocol;let s=location.port;s||(s=n?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||s!==e.port,this.xs=e.secure!==n}this.supportsBinary=Dt&&!(e&&e.forceBase64)}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let n=0;this.polling&&(n++,this.once("pollComplete",function(){--n||t()})),this.writable||(n++,this.once("drain",function(){--n||t()}))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){((o,e)=>{const t=o.split($),n=[];for(let s=0;s<t.length;s++){const r=X(t[s],e);if(n.push(r),"error"===r.type)break}return n})(e,this.socket.binaryType).forEach(n=>{if("opening"===this.readyState&&"open"===n.type&&this.onOpen(),"close"===n.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(n)}),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};"open"===this.readyState?e():this.once("open",e)}write(e){this.writable=!1,((o,e)=>{const t=o.length,n=new Array(t);let s=0;o.forEach((r,h)=>{j(r,!1,v=>{n[h]=v,++s===t&&e(n.join($))})})})(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let e=this.query||{};const t=this.opts.secure?"https":"http";let n="";!1!==this.opts.timestampRequests&&(e[this.opts.timestampParam]=at()),!this.supportsBinary&&!e.sid&&(e.b64=1),this.opts.port&&("https"===t&&443!==Number(this.opts.port)||"http"===t&&80!==Number(this.opts.port))&&(n=":"+this.opts.port);const s=lt(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(s.length?"?"+s:"")}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new I(this.uri(),e)}doWrite(e,t){const n=this.request({method:"POST",data:e});n.on("success",t),n.on("error",(s,r)=>{this.onError("xhr post error",s,r)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,n)=>{this.onError("xhr poll error",t,n)}),this.pollXhr=e}}},Zt=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Qt=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function F(o){const e=o,t=o.indexOf("["),n=o.indexOf("]");-1!=t&&-1!=n&&(o=o.substring(0,t)+o.substring(t,n).replace(/:/g,";")+o.substring(n,o.length));let s=Zt.exec(o||""),r={},h=14;for(;h--;)r[Qt[h]]=s[h]||"";return-1!=t&&-1!=n&&(r.source=e,r.host=r.host.substring(1,r.host.length-1).replace(/;/g,":"),r.authority=r.authority.replace("[","").replace("]","").replace(/;/g,":"),r.ipv6uri=!0),r.pathNames=function qt(o,e){const n=e.replace(/\/{2,9}/g,"/").split("/");return("/"==e.substr(0,1)||0===e.length)&&n.splice(0,1),"/"==e.substr(e.length-1,1)&&n.splice(n.length-1,1),n}(0,r.path),r.queryKey=function Wt(o,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(n,s,r){s&&(t[s]=r)}),t}(0,r.query),r}let ut=(()=>{class o extends _{constructor(t,n={}){super(),t&&"object"==typeof t&&(n=t,t=null),t?(t=F(t),n.hostname=t.host,n.secure="https"===t.protocol||"wss"===t.protocol,n.port=t.port,t.query&&(n.query=t.query)):n.host&&(n.hostname=F(n.host).host),L(this,n),this.secure=null!=n.secure?n.secure:typeof location<"u"&&"https:"===location.protocol,n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.hostname=n.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=n.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=n.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},n),this.opts.path=this.opts.path.replace(/\/$/,"")+"/","string"==typeof this.opts.query&&(this.opts.query=function Lt(o){let e={},t=o.split("&");for(let n=0,s=t.length;n<s;n++){let r=t[n].split("=");e[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}return e}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&addEventListener("beforeunload",()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},!1),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(t){const n=Object.assign({},this.opts.query);n.EIO=4,n.transport=t,this.id&&(n.sid=this.id);const s=Object.assign({},this.opts.transportOptions[t],this.opts,{query:n,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new Jt[t](s)}open(){let t;if(this.opts.rememberUpgrade&&o.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))t="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch{return this.transports.shift(),void this.open()}t.open(),this.setTransport(t)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",n=>this.onClose("transport close",n))}probe(t){let n=this.createTransport(t),s=!1;o.priorWebsocketSuccess=!1;const r=()=>{s||(n.send([{type:"ping",data:"probe"}]),n.once("packet",A=>{if(!s)if("pong"===A.type&&"probe"===A.data){if(this.upgrading=!0,this.emitReserved("upgrading",n),!n)return;o.priorWebsocketSuccess="websocket"===n.name,this.transport.pause(()=>{s||"closed"!==this.readyState&&(vt(),this.setTransport(n),n.send([{type:"upgrade"}]),this.emitReserved("upgrade",n),n=null,this.upgrading=!1,this.flush())})}else{const B=new Error("probe error");B.transport=n.name,this.emitReserved("upgradeError",B)}}))};function h(){s||(s=!0,vt(),n.close(),n=null)}const v=A=>{const B=new Error("probe error: "+A);B.transport=n.name,h(),this.emitReserved("upgradeError",B)};function O(){v("transport closed")}function N(){v("socket closed")}function E(A){n&&A.name!==n.name&&h()}const vt=()=>{n.removeListener("open",r),n.removeListener("error",v),n.removeListener("close",O),this.off("close",N),this.off("upgrading",E)};n.once("open",r),n.once("error",v),n.once("close",O),this.once("close",N),this.once("upgrading",E),n.open()}onOpen(){if(this.readyState="open",o.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade&&this.transport.pause){let t=0;const n=this.upgrades.length;for(;t<n;t++)this.probe(this.upgrades[t])}}onPacket(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const n=new Error("server error");n.code=t.data,this.onError(n);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data)}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.maxPayload=t.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this.getWritablePackets();this.transport.send(t),this.prevBufferLen=t.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let n=1;for(let s=0;s<this.writeBuffer.length;s++){const r=this.writeBuffer[s].data;if(r&&(n+=St(r)),s>0&&n>this.maxPayload)return this.writeBuffer.slice(0,s);n+=2}return this.writeBuffer}write(t,n,s){return this.sendPacket("message",t,n,s),this}send(t,n,s){return this.sendPacket("message",t,n,s),this}sendPacket(t,n,s,r){if("function"==typeof n&&(r=n,n=void 0),"function"==typeof s&&(r=s,s=null),"closing"===this.readyState||"closed"===this.readyState)return;(s=s||{}).compress=!1!==s.compress;const h={type:t,data:n,options:s};this.emitReserved("packetCreate",h),this.writeBuffer.push(h),r&&this.once("flush",r),this.flush()}close(){const t=()=>{this.onClose("forced close"),this.transport.close()},n=()=>{this.off("upgrade",n),this.off("upgradeError",n),t()},s=()=>{this.once("upgrade",n),this.once("upgradeError",n)};return("opening"===this.readyState||"open"===this.readyState)&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?s():t()}):this.upgrading?s():t()),this}onError(t){o.priorWebsocketSuccess=!1,this.emitReserved("error",t),this.onClose("transport error",t)}onClose(t,n){("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&removeEventListener("offline",this.offlineEventListener,!1),this.readyState="closed",this.id=null,this.emitReserved("close",t,n),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(t){const n=[];let s=0;const r=t.length;for(;s<r;s++)~this.transports.indexOf(t[s])&&n.push(t[s]);return n}}return o.protocol=4,o})();const Yt="function"==typeof ArrayBuffer,mt=Object.prototype.toString,Gt="function"==typeof Blob||typeof Blob<"u"&&"[object BlobConstructor]"===mt.call(Blob),Xt="function"==typeof File||typeof File<"u"&&"[object FileConstructor]"===mt.call(File);function J(o){return Yt&&(o instanceof ArrayBuffer||(o=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(o):o.buffer instanceof ArrayBuffer)(o))||Gt&&o instanceof Blob||Xt&&o instanceof File}function H(o,e){if(!o||"object"!=typeof o)return!1;if(Array.isArray(o)){for(let t=0,n=o.length;t<n;t++)if(H(o[t]))return!0;return!1}if(J(o))return!0;if(o.toJSON&&"function"==typeof o.toJSON&&1===arguments.length)return H(o.toJSON(),!0);for(const t in o)if(Object.prototype.hasOwnProperty.call(o,t)&&H(o[t]))return!0;return!1}function $t(o){const e=[],n=o;return n.data=Z(o.data,e),n.attachments=e.length,{packet:n,buffers:e}}function Z(o,e){if(!o)return o;if(J(o)){const t={_placeholder:!0,num:e.length};return e.push(o),t}if(Array.isArray(o)){const t=new Array(o.length);for(let n=0;n<o.length;n++)t[n]=Z(o[n],e);return t}if("object"==typeof o&&!(o instanceof Date)){const t={};for(const n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=Z(o[n],e));return t}return o}function te(o,e){return o.data=Q(o.data,e),o.attachments=void 0,o}function Q(o,e){if(!o)return o;if(o&&!0===o._placeholder){if("number"==typeof o.num&&o.num>=0&&o.num<e.length)return e[o.num];throw new Error("illegal attachments")}if(Array.isArray(o))for(let t=0;t<o.length;t++)o[t]=Q(o[t],e);else if("object"==typeof o)for(const t in o)Object.prototype.hasOwnProperty.call(o,t)&&(o[t]=Q(o[t],e));return o}const ee=5;var u=(()=>{return(o=u||(u={}))[o.CONNECT=0]="CONNECT",o[o.DISCONNECT=1]="DISCONNECT",o[o.EVENT=2]="EVENT",o[o.ACK=3]="ACK",o[o.CONNECT_ERROR=4]="CONNECT_ERROR",o[o.BINARY_EVENT=5]="BINARY_EVENT",o[o.BINARY_ACK=6]="BINARY_ACK",u;var o})();class ne{constructor(e){this.replacer=e}encode(e){return e.type!==u.EVENT&&e.type!==u.ACK||!H(e)?[this.encodeAsString(e)]:(e.type=e.type===u.EVENT?u.BINARY_EVENT:u.BINARY_ACK,this.encodeAsBinary(e))}encodeAsString(e){let t=""+e.type;return(e.type===u.BINARY_EVENT||e.type===u.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=$t(e),n=this.encodeAsString(t.packet),s=t.buffers;return s.unshift(n),s}}class q extends _{constructor(e){super(),this.reviver=e}add(e){let t;if("string"==typeof e){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e),t.type===u.BINARY_EVENT||t.type===u.BINARY_ACK?(this.reconstructor=new oe(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else{if(!J(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(e){let t=0;const n={type:Number(e.charAt(0))};if(void 0===u[n.type])throw new Error("unknown packet type "+n.type);if(n.type===u.BINARY_EVENT||n.type===u.BINARY_ACK){const r=t+1;for(;"-"!==e.charAt(++t)&&t!=e.length;);const h=e.substring(r,t);if(h!=Number(h)||"-"!==e.charAt(t))throw new Error("Illegal attachments");n.attachments=Number(h)}if("/"===e.charAt(t+1)){const r=t+1;for(;++t&&","!==e.charAt(t)&&t!==e.length;);n.nsp=e.substring(r,t)}else n.nsp="/";const s=e.charAt(t+1);if(""!==s&&Number(s)==s){const r=t+1;for(;++t;){const h=e.charAt(t);if(null==h||Number(h)!=h){--t;break}if(t===e.length)break}n.id=Number(e.substring(r,t+1))}if(e.charAt(++t)){const r=this.tryParse(e.substr(t));if(!q.isPayloadValid(n.type,r))throw new Error("invalid payload");n.data=r}return n}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,t){switch(e){case u.CONNECT:return"object"==typeof t;case u.DISCONNECT:return void 0===t;case u.CONNECT_ERROR:return"string"==typeof t||"object"==typeof t;case u.EVENT:case u.BINARY_EVENT:return Array.isArray(t)&&t.length>0;case u.ACK:case u.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}class oe{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=te(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function T(o,e,t){return o.on(e,t),function(){o.off(e,t)}}const ie=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class gt extends _{constructor(e,t,n){super(),this.connected=!1,this.receiveBuffer=[],this.sendBuffer=[],this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,n&&n.auth&&(this.auth=n.auth),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[T(e,"open",this.onopen.bind(this)),T(e,"packet",this.onpacket.bind(this)),T(e,"error",this.onerror.bind(this)),T(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(ie.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');t.unshift(e);const n={type:u.EVENT,data:t,options:{}};if(n.options.compress=!1!==this.flags.compress,"function"==typeof t[t.length-1]){const h=this.ids++,v=t.pop();this._registerAckCallback(h,v),n.id=h}return this.flags.volatile&&(!(this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable)||!this.connected)||(this.connected?(this.notifyOutgoingListeners(n),this.packet(n)):this.sendBuffer.push(n)),this.flags={},this}_registerAckCallback(e,t){const n=this.flags.timeout;if(void 0===n)return void(this.acks[e]=t);const s=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let r=0;r<this.sendBuffer.length;r++)this.sendBuffer[r].id===e&&this.sendBuffer.splice(r,1);t.call(this,new Error("operation has timed out"))},n);this.acks[e]=(...r)=>{this.io.clearTimeoutFn(s),t.apply(this,[null,...r])}}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){"function"==typeof this.auth?this.auth(e=>{this.packet({type:u.CONNECT,data:e})}):this.packet({type:u.CONNECT,data:this.auth})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case u.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case u.EVENT:case u.BINARY_EVENT:this.onevent(e);break;case u.ACK:case u.BINARY_ACK:this.onack(e);break;case u.DISCONNECT:this.ondisconnect();break;case u.CONNECT_ERROR:this.destroy();const n=new Error(e.data.message);n.data=e.data.data,this.emitReserved("connect_error",n)}}onevent(e){const t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const n of t)n.apply(this,e)}super.emit.apply(this,e)}ack(e){const t=this;let n=!1;return function(...s){n||(n=!0,t.packet({type:u.ACK,id:e,data:s}))}}onack(e){const t=this.acks[e.id];"function"==typeof t&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e){this.id=e,this.connected=!0,this.emitBuffered(),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:u.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const n of t)n.apply(this,e.data)}}}function k(o){this.ms=(o=o||{}).min||100,this.max=o.max||1e4,this.factor=o.factor||2,this.jitter=o.jitter>0&&o.jitter<=1?o.jitter:0,this.attempts=0}k.prototype.duration=function(){var o=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*o);o=0==(1&Math.floor(10*e))?o-t:o+t}return 0|Math.min(o,this.max)},k.prototype.reset=function(){this.attempts=0},k.prototype.setMin=function(o){this.ms=o},k.prototype.setMax=function(o){this.max=o},k.prototype.setJitter=function(o){this.jitter=o};class W extends _{constructor(e,t){var n;super(),this.nsps={},this.subs=[],e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.opts=t,L(this,t),this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(n=t.randomizationFactor)&&void 0!==n?n:.5),this.backoff=new k({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout??2e4),this._readyState="closed",this.uri=e;const s=t.parser||m;this.encoder=new s.Encoder,this.decoder=new s.Decoder,this._autoConnect=!1!==t.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new ut(this.uri,this.opts);const t=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const s=T(t,"open",function(){n.onopen(),e&&e()}),r=T(t,"error",h=>{n.cleanup(),n._readyState="closed",this.emitReserved("error",h),e?e(h):n.maybeReconnectOnOpen()});if(!1!==this._timeout){const h=this._timeout;0===h&&s();const v=this.setTimeoutFn(()=>{s(),t.close(),t.emit("error",new Error("timeout"))},h);this.opts.autoUnref&&v.unref(),this.subs.push(function(){clearTimeout(v)})}return this.subs.push(s),this.subs.push(r),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(T(e,"ping",this.onping.bind(this)),T(e,"data",this.ondata.bind(this)),T(e,"error",this.onerror.bind(this)),T(e,"close",this.onclose.bind(this)),T(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch{this.onclose("parse error")}}ondecoded(e){this.emitReserved("packet",e)}onerror(e){this.emitReserved("error",e)}socket(e,t){let n=this.nsps[e];return n||(n=new gt(this,e,t),this.nsps[e]=n),n}_destroy(e){const t=Object.keys(this.nsps);for(const n of t)if(this.nsps[n].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let n=0;n<t.length;n++)this.engine.write(t[n],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(s=>{s?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",s)):e.onreconnect()}))},t);this.opts.autoUnref&&n.unref(),this.subs.push(function(){clearTimeout(n)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const S={};function z(o,e){"object"==typeof o&&(e=o,o=void 0);const t=function Kt(o,e="",t){let n=o;t=t||typeof location<"u"&&location,null==o&&(o=t.protocol+"//"+t.host),"string"==typeof o&&("/"===o.charAt(0)&&(o="/"===o.charAt(1)?t.protocol+o:t.host+o),/^(https?|wss?):\/\//.test(o)||(o=typeof t<"u"?t.protocol+"//"+o:"https://"+o),n=F(o)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const r=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+r+":"+n.port+e,n.href=n.protocol+"://"+r+(t&&t.port===n.port?"":":"+n.port),n}(o,(e=e||{}).path||"/socket.io"),n=t.source,s=t.id;let O;return e.forceNew||e["force new connection"]||!1===e.multiplex||S[s]&&t.path in S[s].nsps?O=new W(n,e):(S[s]||(S[s]=new W(n,e)),O=S[s]),t.query&&!e.query&&(e.query=t.queryKey),O.socket(t.path,e)}Object.assign(z,{Manager:W,Socket:gt,io:z,connect:z});var se=a(945),i=a(4537),re=a(2001),yt=a(354),K=a(9638),ce=a(7591),_t=a(563);const ae=["video"];function le(o,e){if(1&o){const t=i.EpF();i.TgZ(0,"button",7),i.NdJ("click",function(){i.CHM(t);const s=i.oxw();return i.KtG(s.muteUser())}),i._UZ(1,"sh-icon",8),i.qZA()}if(2&o){const t=i.oxw();i.Q6J("shToolTip",t.muted?"Unmute":"Mute")("shToolTipComponent",t.tooltip),i.xp6(1),i.Q6J("icon",t.muted?t.icons[1]:t.icons[0])}}function he(o,e){if(1&o&&i._UZ(0,"sh-icon",8),2&o){const t=i.oxw();i.Q6J("icon",t.icons[2])}}function pe(o,e){if(1&o&&i._UZ(0,"sh-icon",8),2&o){const t=i.oxw();i.Q6J("icon",t.icons[1])}}let fe=(()=>{class o{constructor(){this.local=!1,this.icons=[{prefix:"fas",iconName:"microphone-lines",icon:[384,512,[127897,"microphone-alt"],"f3c9","M192 352c53.03 0 96-42.97 96-96h-80C199.2 256 192 248.8 192 240S199.2 224 208 224H288V192h-80C199.2 192 192 184.8 192 176S199.2 160 208 160H288V127.1h-80c-8.836 0-16-7.164-16-16s7.164-16 16-16L288 96c0-53.03-42.97-96-96-96s-96 42.97-96 96v160C96 309 138.1 352 192 352zM344 192C330.7 192 320 202.7 320 215.1V256c0 73.33-61.97 132.4-136.3 127.7c-66.08-4.169-119.7-66.59-119.7-132.8L64 215.1C64 202.7 53.25 192 40 192S16 202.7 16 215.1v32.15c0 89.66 63.97 169.6 152 181.7V464H128c-18.19 0-32.84 15.18-31.96 33.57C96.43 505.8 103.8 512 112 512h160c8.222 0 15.57-6.216 15.96-14.43C288.8 479.2 274.2 464 256 464h-40v-33.77C301.7 418.5 368 344.9 368 256V215.1C368 202.7 357.3 192 344 192z"]},{prefix:"fas",iconName:"microphone-lines-slash",icon:[640,512,["microphone-alt-slash"],"f539","M383.1 464l-39.1-.0001v-33.77c20.6-2.824 39.99-9.402 57.69-18.72l-43.26-33.91c-14.66 4.65-30.28 7.179-46.68 6.144C245.7 379.6 191.1 317.1 191.1 250.9v-3.777L143.1 209.5l.0001 38.61c0 89.65 63.97 169.6 151.1 181.7v34.15l-40 .0001c-17.67 0-31.1 14.33-31.1 31.1C223.1 504.8 231.2 512 239.1 512h159.1c8.838 0 15.1-7.164 15.1-15.1C415.1 478.3 401.7 464 383.1 464zM630.8 469.1l-159.3-124.9c15.37-25.94 24.53-55.91 24.53-88.21V216c0-13.25-10.75-24-23.1-24c-13.25 0-24 10.75-24 24l-.0001 39.1c0 21.12-5.557 40.77-14.77 58.24l-25.73-20.16c5.234-11.68 8.493-24.42 8.493-38.08l-57.07 .0006l-34.45-27c2.914-3.055 6.969-4.999 11.52-4.999h79.1V192L335.1 192c-8.836 0-15.1-7.164-15.1-15.1s7.164-16 15.1-16l79.1 .0013V128l-79.1-.0015c-8.836 0-15.1-7.164-15.1-15.1s7.164-15.1 15.1-15.1l80-.0003c0-54-44.56-97.57-98.93-95.95C264.5 1.614 223.1 47.45 223.1 100l.0006 50.23L38.81 5.111C34.41 1.673 29.19 0 24.03 0C16.91 0 9.84 3.158 5.121 9.189C-3.067 19.63-1.249 34.72 9.189 42.89l591.1 463.1c10.5 8.203 25.57 6.328 33.69-4.078C643.1 492.4 641.2 477.3 630.8 469.1z"]},{prefix:"fas",iconName:"display",icon:[576,512,[],"e163","M528 0h-480C21.5 0 0 21.5 0 48v320C0 394.5 21.5 416 48 416h192L224 464H152C138.8 464 128 474.8 128 488S138.8 512 152 512h272c13.25 0 24-10.75 24-24s-10.75-24-24-24H352L336 416h192c26.5 0 48-21.5 48-48v-320C576 21.5 554.5 0 528 0zM512 352H64V64h448V352z"]}],this.muted=!1}ngAfterViewInit(){let t=this.video?.nativeElement;!t||(t.muted=this.local,this.peer.stream.id&&(t.srcObject=this.peer.stream),t.addEventListener("loadedmetadata",()=>{t.pause(),setTimeout(()=>{t.play(),t.muted=this.local})}))}muteUser(){this.muted=!this.muted,this.peer.stream.getAudioTracks&&this.peer.stream.getAudioTracks().forEach(t=>{t.enabled=!this.muted})}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=i.Xpm({type:o,selectors:[["wdg-other-videocall-user"]],viewQuery:function(t,n){if(1&t&&i.Gf(ae,5),2&t){let s;i.iGM(s=i.CRH())&&(n.video=s.first)}},inputs:{peer:"peer",local:"local",tooltip:"tooltip",host:"host"},decls:8,vars:5,consts:[[1,"videocall-user-wrapper"],["muted","","playsinline",""],["video",""],[1,"user"],["mat-mini-fab","",3,"shToolTip","shToolTipComponent","click",4,"ngIf"],[1,"status"],[3,"icon",4,"ngIf"],["mat-mini-fab","",3,"shToolTip","shToolTipComponent","click"],[3,"icon"]],template:function(t,n){1&t&&(i.TgZ(0,"div",0),i._UZ(1,"video",1,2),i.qZA(),i._UZ(3,"div",3),i.YNc(4,le,2,3,"button",4),i.TgZ(5,"div",5),i.YNc(6,he,1,1,"sh-icon",6),i.YNc(7,pe,1,1,"sh-icon",6),i.qZA()),2&t&&(i.xp6(3),i.Udp("opacity",n.peer.volumeActive?1:0),i.xp6(1),i.Q6J("ngIf",!n.local),i.xp6(2),i.Q6J("ngIf",n.host==n.peer.peer),i.xp6(1),i.Q6J("ngIf",n.muted))},dependencies:[d.O5,yt.o,K.lW,_t.h],styles:['[_nghost-%COMP%]{--border-size: 2px;position:relative;box-sizing:border-box;padding:var(--border-size)}[_nghost-%COMP%]:after{content:"";display:block;padding-bottom:100%}[_nghost-%COMP%]:hover   button[_ngcontent-%COMP%]{opacity:1}[_nghost-%COMP%]   button[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;margin:2px;transform:translate(-50%,-50%);opacity:0;color:var(--text-color);background:var(--background)}[_nghost-%COMP%]   button.active[_ngcontent-%COMP%]{background:var(--active-color)}.videocall-user-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;overflow:hidden;-webkit-mask-image:-webkit-radial-gradient(white,black);position:absolute;width:100%;height:100%;border-radius:inherit}.videocall-user-wrapper[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;background-color:#000;transform:rotateY(180deg)}.user[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;border-radius:inherit;border:var(--border-size) solid #2ecc71}.status[_ngcontent-%COMP%]{position:absolute;gap:5px;display:flex;bottom:0;right:0;margin:5px;color:#fff}']}),o})();var de=a(7239);function ue(o,e){if(1&o&&(i._UZ(0,"code",4),i.ALo(1,"safe")),2&o){const t=i.oxw();i.Q6J("innerHTML",i.xi3(1,1,t.styles,"html"),i.oJD)}}function me(o,e){if(1&o&&i._UZ(0,"wdg-other-videocall-user",12),2&o){const t=i.oxw(3);i.Q6J("peer",t.myPeer)("local",!0)("host",t.hostPeer)}}function ge(o,e){if(1&o&&i._UZ(0,"wdg-other-videocall-user",14),2&o){const t=i.oxw().$implicit,n=i.oxw(3),s=i.MAs(3);i.Q6J("peer",t)("host",n.hostPeer)("tooltip",s)}}function ye(o,e){if(1&o&&(i.ynx(0),i.YNc(1,ge,1,3,"wdg-other-videocall-user",13),i.BQk()),2&o){const t=e.$implicit;i.xp6(1),i.Q6J("ngIf",t.stream)}}function _e(o,e){if(1&o&&(i.TgZ(0,"div",9),i.YNc(1,me,1,3,"wdg-other-videocall-user",10),i.YNc(2,ye,2,1,"ng-container",11),i.qZA()),2&o){const t=i.oxw(2);i.xp6(1),i.Q6J("ngIf",t.myPeer.stream),i.xp6(1),i.Q6J("ngForOf",t.peerConnections)}}function ve(o,e){if(1&o){const t=i.EpF();i.TgZ(0,"button",15),i.NdJ("click",function(){i.CHM(t);const s=i.oxw(2);return i.KtG(s.connect())}),i._UZ(1,"sh-icon",16),i.qZA()}if(2&o){const t=i.oxw(2),n=i.MAs(3);i.Q6J("disabled",!t.peerJsReady)("shToolTipComponent",n),i.xp6(1),i.Q6J("icon",t.icons[0])}}function Ce(o,e){if(1&o){const t=i.EpF();i.ynx(0),i.TgZ(1,"div",17)(2,"button",18),i.NdJ("click",function(){i.CHM(t);const s=i.oxw(2);return i.KtG(s.toggleCamera())}),i._UZ(3,"sh-icon",16),i.qZA(),i.TgZ(4,"button",18),i.NdJ("click",function(){i.CHM(t);const s=i.oxw(2);return i.KtG(s.toggleMicrophone())}),i._UZ(5,"sh-icon",16),i.qZA(),i.TgZ(6,"button",19),i.NdJ("click",function(){i.CHM(t);const s=i.oxw(2);return i.KtG(s.toggleHost())}),i._UZ(7,"sh-icon",16),i.qZA(),i.TgZ(8,"button",20),i.NdJ("click",function(){i.CHM(t);const s=i.oxw(2);return i.KtG(s.disconnect())}),i._UZ(9,"sh-icon",16),i.qZA(),i.TgZ(10,"button",21),i.NdJ("click",function(){i.CHM(t);const s=i.oxw(2);return i.KtG(s.toggle())}),i._UZ(11,"sh-icon",16),i.qZA()(),i.TgZ(12,"div",22),i._uU(13),i.qZA(),i.BQk()}if(2&o){const t=i.oxw(2),n=i.MAs(3);i.xp6(2),i.ekj("active",!t.cameraOn),i.Q6J("shToolTip",t.cameraOn?"Turn off camera":"Turn on camera")("shToolTipComponent",n),i.xp6(1),i.Q6J("icon",t.cameraOn?t.icons[4]:t.icons[5]),i.xp6(1),i.ekj("active",!t.microphoneOn),i.Q6J("shToolTip",t.microphoneOn?"Mute":"Unmute")("shToolTipComponent",n),i.xp6(1),i.Q6J("icon",t.microphoneOn?t.icons[2]:t.icons[3]),i.xp6(1),i.ekj("active",t.isHost),i.Q6J("disabled",t.hostPeer&&!t.isHost)("shToolTip",t.isHost?"Stop hosting":"Host")("shToolTipComponent",n),i.xp6(1),i.Q6J("icon",t.isHost?t.icons[7]:t.icons[6]),i.xp6(1),i.Q6J("shToolTipComponent",n),i.xp6(1),i.Q6J("icon",t.icons[1]),i.xp6(1),i.Q6J("shToolTipComponent",n),i.xp6(1),i.Q6J("icon",t.minimized?t.icons[0]:t.icons[8]),i.xp6(1),i.Udp("visibility",t.showNotification||t.editorMode?"visible":"hidden"),i.xp6(1),i.hij(" ",t.i18n.t(t.options.notification.value)," ")}}function be(o,e){if(1&o&&(i.TgZ(0,"div",5),i.YNc(1,_e,3,2,"div",6),i.YNc(2,ve,2,3,"button",7),i.YNc(3,Ce,14,23,"ng-container",8),i.qZA()),2&o){const t=i.oxw();i.ekj("vertical",t.options.vertical.value)("minimized",t.minimized),i.Q6J("ngClass",t.options.area.value),i.xp6(1),i.Q6J("ngIf",t.myPeer),i.xp6(1),i.Q6J("ngIf",!t.connected),i.xp6(1),i.Q6J("ngIf",t.connected)}}let Te=(()=>{class o extends C.P{constructor(t,n){super(t),this.viewerService=n,this.default_options=y,this.peerJsReady=!1,this.icons=[{prefix:"fas",iconName:"video-plus",icon:[576,512,[],"f4e1","M336 64h-288C21.49 64 0 85.49 0 112v288C0 426.5 21.49 448 48 448h288c26.51 0 48-21.49 48-48v-288C384 85.49 362.5 64 336 64zM272 279.1H215.1v56C215.1 349.3 205.3 360 192 360c-13.27 0-23.1-10.74-23.1-23.1V279.1H111.1C98.73 279.1 88 269.3 88 256c0-13.26 10.74-23.1 23.1-23.1H168V175.1C168 162.7 178.7 152 192 152s23.1 10.74 23.1 23.1V232H272C285.3 232 296 242.7 296 256S285.3 279.1 272 279.1zM525.6 101.7L416 177.3v157.4l109.6 75.49C546.8 424.8 576 409.9 576 384.4V127.5C576 102.1 546.9 87.13 525.6 101.7z"]},{prefix:"fas",iconName:"phone-hangup",icon:[640,512,[],"e225","M635.4 293.6l-52.73 84.25c-7.631 12.2-23.09 17.35-36.63 11.98l-105.4-42.1c-12.45-4.925-20.14-17.65-18.71-30.87l6.64-66.46C358.3 226.5 281.8 226.5 211.6 250.4l6.621 66.51c1.338 13.27-6.28 25.86-18.67 30.85l-105.5 42.13c-13.6 5.307-29.04 .2437-36.72-12.04l-52.71-84.22C-2.861 281.8-1.118 266.5 8.85 256.5C180.4 85.16 459.6 85.17 631.1 256.5C641.1 266.5 642.9 281.8 635.4 293.6z"]},{prefix:"fas",iconName:"microphone-lines",icon:[384,512,[127897,"microphone-alt"],"f3c9","M192 352c53.03 0 96-42.97 96-96h-80C199.2 256 192 248.8 192 240S199.2 224 208 224H288V192h-80C199.2 192 192 184.8 192 176S199.2 160 208 160H288V127.1h-80c-8.836 0-16-7.164-16-16s7.164-16 16-16L288 96c0-53.03-42.97-96-96-96s-96 42.97-96 96v160C96 309 138.1 352 192 352zM344 192C330.7 192 320 202.7 320 215.1V256c0 73.33-61.97 132.4-136.3 127.7c-66.08-4.169-119.7-66.59-119.7-132.8L64 215.1C64 202.7 53.25 192 40 192S16 202.7 16 215.1v32.15c0 89.66 63.97 169.6 152 181.7V464H128c-18.19 0-32.84 15.18-31.96 33.57C96.43 505.8 103.8 512 112 512h160c8.222 0 15.57-6.216 15.96-14.43C288.8 479.2 274.2 464 256 464h-40v-33.77C301.7 418.5 368 344.9 368 256V215.1C368 202.7 357.3 192 344 192z"]},{prefix:"fas",iconName:"microphone-lines-slash",icon:[640,512,["microphone-alt-slash"],"f539","M383.1 464l-39.1-.0001v-33.77c20.6-2.824 39.99-9.402 57.69-18.72l-43.26-33.91c-14.66 4.65-30.28 7.179-46.68 6.144C245.7 379.6 191.1 317.1 191.1 250.9v-3.777L143.1 209.5l.0001 38.61c0 89.65 63.97 169.6 151.1 181.7v34.15l-40 .0001c-17.67 0-31.1 14.33-31.1 31.1C223.1 504.8 231.2 512 239.1 512h159.1c8.838 0 15.1-7.164 15.1-15.1C415.1 478.3 401.7 464 383.1 464zM630.8 469.1l-159.3-124.9c15.37-25.94 24.53-55.91 24.53-88.21V216c0-13.25-10.75-24-23.1-24c-13.25 0-24 10.75-24 24l-.0001 39.1c0 21.12-5.557 40.77-14.77 58.24l-25.73-20.16c5.234-11.68 8.493-24.42 8.493-38.08l-57.07 .0006l-34.45-27c2.914-3.055 6.969-4.999 11.52-4.999h79.1V192L335.1 192c-8.836 0-15.1-7.164-15.1-15.1s7.164-16 15.1-16l79.1 .0013V128l-79.1-.0015c-8.836 0-15.1-7.164-15.1-15.1s7.164-15.1 15.1-15.1l80-.0003c0-54-44.56-97.57-98.93-95.95C264.5 1.614 223.1 47.45 223.1 100l.0006 50.23L38.81 5.111C34.41 1.673 29.19 0 24.03 0C16.91 0 9.84 3.158 5.121 9.189C-3.067 19.63-1.249 34.72 9.189 42.89l591.1 463.1c10.5 8.203 25.57 6.328 33.69-4.078C643.1 492.4 641.2 477.3 630.8 469.1z"]},{prefix:"fas",iconName:"camera-web",icon:[448,512,["webcam"],"f832","M400.9 438.6l-49.12-30.75C409.9 367.4 448 300.3 448 224c0-123.8-100.4-224-224-224c-123.8 0-224 100.3-224 224c0 76.25 38.13 143.4 96.13 183.9L47 438.6C37.63 444.5 32 454.8 32 465.8v14.25c0 17.62 14.48 31.1 32.11 31.1L384 512c17.62 0 32-14.38 32-32V465.8C416 454.8 410.3 444.5 400.9 438.6zM224 384c-88.37 0-160.1-71.62-160.1-159.1s71.63-160 159.1-160s160 71.62 160 160S312.3 384 224 384zM224 96C153.4 96 95.92 153.2 95.92 224s57.38 128 128 128c70.75 0 128-57.25 128-128C351.9 153.4 294.6 96 224 96zM223.9 176c-26.5 0-47.87 21.5-48 48c0 8.875-7.125 16-16 16c-8.75 0-16-7.125-16-16c.125-44.12 35.92-80 80.04-80c8.875 0 15.96 7.125 15.96 16S232.8 176 223.9 176z"]},{prefix:"fas",iconName:"camera-web-slash",icon:[640,512,["webcam-slash"],"f833","M319.1 383.1c-88.37 0-160.1-71.63-160.1-159.1c0-.6406 .1816-1.234 .1895-1.871L101.3 176C97.89 191.5 95.1 207.5 95.1 223.1c0 76.25 38.12 143.4 96.12 183.9l-49.12 30.75c-9.375 5.875-14.1 16.12-14.1 27.12v14.25c0 17.62 14.48 32 32.11 32l319.9-.0053c12.21 0 22.52-7.136 27.91-17.23l-148.4-116.3C346.8 381.7 333.7 383.1 319.1 383.1zM630.8 469.1l-135.7-106.4c30.42-38.12 48.92-86.1 48.92-138.7c0-123.7-100.4-223.1-223.1-223.1c-72.02 0-135.7 34.24-176.6 87.04L38.81 5.113C34.41 1.676 29.19 .0042 24.03 .0042c-7.125 0-14.19 3.156-18.91 9.187c-8.187 10.44-6.37 25.53 4.068 33.7l591.1 463.1c10.5 8.203 25.57 6.328 33.69-4.078C643.1 492.4 641.3 477.3 630.8 469.1zM319.9 175.1c-15.75 0-29.04 8.086-37.72 19.84l-25.66-20.11c14.55-19.23 37.47-31.72 63.42-31.72c8.875 0 15.96 7.124 15.96 15.1S328.7 175.1 319.9 175.1zM444.6 323.2L419.4 303.4c17.62-21.78 28.5-49.16 28.5-79.41c0-70.62-57.29-127.1-127.9-127.1c-41.28 0-77.63 19.93-100.9 50.38L193.9 126.6C223 88.71 268.3 63.1 319.9 63.1c88.37 0 159.1 71.62 159.1 159.1C479.9 261.7 466.5 295.9 444.6 323.2z"]},{prefix:"fas",iconName:"display",icon:[576,512,[],"e163","M528 0h-480C21.5 0 0 21.5 0 48v320C0 394.5 21.5 416 48 416h192L224 464H152C138.8 464 128 474.8 128 488S138.8 512 152 512h272c13.25 0 24-10.75 24-24s-10.75-24-24-24H352L336 416h192c26.5 0 48-21.5 48-48v-320C576 21.5 554.5 0 528 0zM512 352H64V64h448V352z"]},{prefix:"fas",iconName:"display-slash",icon:[640,512,["desktop-slash"],"e2fa","M455.1 464h-72l-16-48h39.99l-81.65-64H95.1L95.1 171.5L31.1 121.3V368c0 26.5 21.5 48 47.1 48h191.1l-16 48H183.1c-13.25 0-24 10.75-24 24s10.75 24 24 24h271.1c13.25 0 24-10.75 24-24S469.2 464 455.1 464zM630.8 469.1l-68.1-53.38c25.21-1.434 45.29-22.16 45.29-47.73v-320c0-26.5-21.5-48-48-48l-479.1 0c-12.3 0-23.41 4.77-31.9 12.38L38.81 5.113C34.41 1.676 29.19 0 24.03 0c-7.125 0-14.19 3.16-18.91 9.191c-8.187 10.44-6.37 25.53 4.068 33.7L601.2 506.9c10.5 8.203 25.57 6.328 33.69-4.078C643.1 492.4 641.2 477.3 630.8 469.1zM543.1 352h-62.59l-367.5-288h430L543.1 352z"]},{prefix:"fas",iconName:"xmark-large",icon:[448,512,[],"e59b","M393.4 41.37C405.9 28.88 426.1 28.88 438.6 41.37C451.1 53.87 451.1 74.13 438.6 86.63L269.3 255.1L438.6 425.4C451.1 437.9 451.1 458.1 438.6 470.6C426.1 483.1 405.9 483.1 393.4 470.6L223.1 301.3L54.63 470.6C42.13 483.1 21.87 483.1 9.372 470.6C-3.124 458.1-3.124 437.9 9.372 425.4L178.7 255.1L9.372 86.63C-3.124 74.13-3.124 53.87 9.372 41.37C21.87 28.88 42.13 28.88 54.63 41.37L223.1 210.7L393.4 41.37z"]}],this.peerConnections=[],this.showNotification=!1,this.cameraOn=!0,this.microphoneOn=!0,this.minimized=!1,(0,d.NF)(this.panoService.platformId)&&this.loadPeerjs()}loadPeerjs(){let t=document.createElement("script");t.type="text/javascript",t.src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js",t.onload=()=>{this.peerJsReady=!0},document.body.append(t)}get connected(){return this.socket?.connected}get editorMode(){return this.viewerService.editor}connect(){this.editorMode?(this.myPeer={peer:"test",stream:{},volumeActive:!1},this.socket={connected:!0,disconnect:function(){this.connected=!1}},this.peerConnections=[this.myPeer,this.myPeer]):navigator.mediaDevices.getUserMedia({video:!0,audio:{echoCancellation:!0}}).then(t=>{this.panoService.callRoom||(this.panoService.callRoom=(Math.random()+1).toString(36).substring(3),this.viewerService.viewerService.locationSubject.next(),setTimeout(()=>{navigator.clipboard.writeText(document.location.href).then(()=>{this.showNotification=!0,setTimeout(()=>{this.showNotification=!1},3e3)})},100)),this.peer=new Peer,this.socket=z("https://socket.gothru.co",{secure:!0,transports:["websocket"]}),this.peer.on("call",n=>{this._addPeer({peer:n.peer,call:n}),n.answer(t)}),this.peer.on("open",n=>{this.socket.emit("newUser",n,this.panoService.tourKey+this.panoService.callRoom),this.myPeer={peer:n,stream:t},this._setAnalyzer(this.myPeer),this.microMeterStart()}),this.peer.on("error",n=>{console.error(n.type)}),this.socket.on("userJoined",n=>{this._addPeer({peer:n,call:this.peer.call(n,this.myPeer?.stream)})}),this.socket.on("userDisconnect",n=>{this.peerConnections.find(s=>s.peer==n)?.call.close()}),this.socket.on("userHosting",n=>{this.hostPeer=n}),this.socket.on("hostChangingView",n=>{this.viewerService.goToPano(n.pano,n.position)}),this.socket.on("connect_error",n=>{console.log(n.message)})}).catch(t=>{console.error(t.message)})}disconnect(){this.socket.disconnect(),this.peer?.disconnect(),this.peer?.destroy(),this.cameraOn=!0,this.microphoneOn=!0,this.peerConnections=[],this._clearStream(this.myPeer),this.microMeterStop()}_addPeer(t){t.call.on("error",n=>{console.error(n)}),t.call.on("stream",n=>{t.stream||(t.stream=n,this._setAnalyzer(t))}),t.call.on("close",()=>{this._clearStream(t),this.peerConnections=this.peerConnections.filter(n=>n.peer!=t.peer)}),this.peerConnections.push(t)}_clearStream(t){t.stream?.id&&t.stream?.getTracks().forEach(n=>n.stop()),t.stream=void 0}toggleCamera(){this.cameraOn=!this.cameraOn,this.myPeer?.stream?.getVideoTracks&&this.myPeer.stream.getVideoTracks().forEach(t=>{t.enabled=this.cameraOn})}toggleMicrophone(){this.microphoneOn=!this.microphoneOn,this.myPeer?.stream?.getAudioTracks&&this.myPeer.stream.getAudioTracks().forEach(t=>{t.enabled=this.microphoneOn})}_setAnalyzer(t){const n=new AudioContext,s=n.createMediaStreamSource(t.stream),r=n.createAnalyser();r.fftSize=1024,r.smoothingTimeConstant=.8,s.connect(r),t.analyser=r}_detectActiveMicro(t){if(!t.analyser)return;const n=new Uint8Array(t.analyser.frequencyBinCount);t.analyser.getByteFrequencyData(n);let s=0;for(const h of n)s+=h;t.stream&&(t.volumeActive=Math.round(s/n.length)>10)}microMeterStart(){this.microMeter=(0,se.F)(100).subscribe(()=>{this._detectActiveMicro(this.myPeer),this.peerConnections.forEach(t=>{this._detectActiveMicro(t)})})}microMeterStop(){this.microMeter?.unsubscribe()}ngOnDestroy(){this.microMeterStop()}get isHost(){return this.myPeer?.peer==this.hostPeer}toggleHost(){this.editorMode||(this.isHost?(this.hostPeer=void 0,this.socket.emit("stopHost"),this.viewerService.viewer.__events.viewChange.pop()):this.hostPeer||(this.hostPeer=this.myPeer.peer,this.socket.emit("startHost"),this.viewerService.viewer.__events.viewChange.push((t,n,s)=>{let r=this.viewerService.viewer.scene().view();this.socket.emit("changeView",{pano:this.viewerService.active.id,position:{theta:180*r.yaw()/Math.PI,phi:-1*r.pitch()*180/Math.PI,fov:180*r.fov()/Math.PI}})})))}toggle(){this.minimized=!this.minimized}addObservableFunc(){this.observableFunc.size=t=>this.onSizeChange(t),this.observableFunc.margin=t=>this.onMarginChange(t),this.observableFunc.border_radius=t=>this.onBorderRadiusChange(t),this.observableFunc.notification_font=t=>this.onNotificationFontChange(t)}onSizeChange(t){this.elRef.nativeElement.style.setProperty("--size",t+"px")}onMarginChange(t){this.elRef.nativeElement.style.setProperty("--margin",t+"px")}onBorderRadiusChange(t){this.elRef.nativeElement.style.setProperty("--border-radius-top-left",t?t.topLeft+"px":null),this.elRef.nativeElement.style.setProperty("--border-radius-top-right",t?t.topRight+"px":null),this.elRef.nativeElement.style.setProperty("--border-radius-bottom-left",t?t.bottomLeft+"px":null),this.elRef.nativeElement.style.setProperty("--border-radius-bottom-right",t?t.bottomRight+"px":null)}onNotificationFontChange(t){this.setFontStyle(t,"--notification-style-")}initData(){this.addObservableFunc(),super.initData()}}return o.\u0275fac=function(t){return new(t||o)(i.Y36(i.zs3),i.Y36(re.a))},o.\u0275cmp=i.Xpm({type:o,selectors:[["wdg-other-videocall"]],features:[i.qOj],decls:4,vars:2,consts:[[3,"innerHTML",4,"ngIf"],["class","videocall",3,"ngClass","vertical","minimized",4,"ngIf"],["position","above"],["tooltip",""],[3,"innerHTML"],[1,"videocall",3,"ngClass"],["class","list",4,"ngIf"],["mat-mini-fab","","shToolTip","Connect",3,"disabled","shToolTipComponent","click",4,"ngIf"],[4,"ngIf"],[1,"list"],[3,"peer","local","host",4,"ngIf"],[4,"ngFor","ngForOf"],[3,"peer","local","host"],[3,"peer","host","tooltip",4,"ngIf"],[3,"peer","host","tooltip"],["mat-mini-fab","","shToolTip","Connect",3,"disabled","shToolTipComponent","click"],[3,"icon"],[1,"buttons"],["mat-mini-fab","",3,"shToolTip","shToolTipComponent","click"],["mat-mini-fab","",3,"disabled","shToolTip","shToolTipComponent","click"],["mat-mini-fab","","shToolTip","Disconnect",1,"active",3,"shToolTipComponent","click"],["mat-mini-fab","","shToolTip","Toggle",1,"toggle",3,"shToolTipComponent","click"],[1,"share-notification"]],template:function(t,n){1&t&&(i.YNc(0,ue,2,4,"code",0),i.YNc(1,be,4,8,"div",1),i._UZ(2,"sh-tool-tip",2,3)),2&t&&(i.Q6J("ngIf",n.styles),i.xp6(1),i.Q6J("ngIf",n.widgetInit&&n.widget))},dependencies:[d.mk,d.sg,d.O5,yt.o,K.lW,ce.I,_t.h,fe,de.y],styles:[".videocall[_ngcontent-%COMP%]{z-index:11;position:absolute;color:var(--text-color);margin:var(--margin);display:flex;align-items:center;flex-direction:column}.videocall[_ngcontent-%COMP%]   .share-notification[_ngcontent-%COMP%]{background:var(--background);padding:10px 20px;border-radius:5px;z-index:11;white-space:nowrap;position:absolute;visibility:hidden;font-style:var(--notification-style-font-style);font-weight:var(--notification-style-font-weight);-webkit-text-decoration:var(--notification-style-text-decoration);text-decoration:var(--notification-style-text-decoration);font-size:var(--notification-style-font-size);font-family:var(--notification-style-font-family);text-align:var(--notification-style-text-align);line-height:var(--notification-style-line-height);color:var(--notification-style-color)}.videocall.top[_ngcontent-%COMP%], .videocall.top-left[_ngcontent-%COMP%], .videocall.top-right[_ngcontent-%COMP%], .videocall.top[_ngcontent-%COMP%]   .share-notification[_ngcontent-%COMP%], .videocall.top-left[_ngcontent-%COMP%]   .share-notification[_ngcontent-%COMP%], .videocall.top-right[_ngcontent-%COMP%]   .share-notification[_ngcontent-%COMP%]{top:0}.videocall.bottom[_ngcontent-%COMP%], .videocall.bottom-left[_ngcontent-%COMP%], .videocall.bottom-right[_ngcontent-%COMP%], .videocall.bottom[_ngcontent-%COMP%]   .share-notification[_ngcontent-%COMP%], .videocall.bottom-left[_ngcontent-%COMP%]   .share-notification[_ngcontent-%COMP%], .videocall.bottom-right[_ngcontent-%COMP%]   .share-notification[_ngcontent-%COMP%]{bottom:0}.videocall.bottom-left[_ngcontent-%COMP%], .videocall.left[_ngcontent-%COMP%], .videocall.top-left[_ngcontent-%COMP%], .videocall.bottom-left[_ngcontent-%COMP%]   .share-notification[_ngcontent-%COMP%], .videocall.left[_ngcontent-%COMP%]   .share-notification[_ngcontent-%COMP%], .videocall.top-left[_ngcontent-%COMP%]   .share-notification[_ngcontent-%COMP%]{left:0}.videocall.bottom-right[_ngcontent-%COMP%], .videocall.right[_ngcontent-%COMP%], .videocall.top-right[_ngcontent-%COMP%], .videocall.bottom-right[_ngcontent-%COMP%]   .share-notification[_ngcontent-%COMP%], .videocall.right[_ngcontent-%COMP%]   .share-notification[_ngcontent-%COMP%], .videocall.top-right[_ngcontent-%COMP%]   .share-notification[_ngcontent-%COMP%]{right:0}.videocall.bottom[_ngcontent-%COMP%], .videocall.top[_ngcontent-%COMP%]{left:50%;transform:translate(-50%);margin-left:0;margin-right:0}.videocall.bottom[_ngcontent-%COMP%]   .share-notification[_ngcontent-%COMP%], .videocall.top[_ngcontent-%COMP%]   .share-notification[_ngcontent-%COMP%]{left:50%;transform:translate(-50%)}.videocall.left[_ngcontent-%COMP%], .videocall.right[_ngcontent-%COMP%]{top:50%;transform:translateY(-50%);margin-top:0;margin-bottom:0}.videocall.left[_ngcontent-%COMP%]   .share-notification[_ngcontent-%COMP%], .videocall.right[_ngcontent-%COMP%]   .share-notification[_ngcontent-%COMP%]{top:50%;transform:translateY(-50%)}.videocall.bottom[_ngcontent-%COMP%], .videocall.bottom-left[_ngcontent-%COMP%], .videocall.bottom-right[_ngcontent-%COMP%]{flex-direction:column-reverse}.videocall.vertical[_ngcontent-%COMP%]{flex-direction:row}.videocall.vertical[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%], .videocall.vertical[_ngcontent-%COMP%]   .list[_ngcontent-%COMP%]{flex-direction:column}.videocall.vertical[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]{margin:0 var(--margin)}.videocall.vertical.bottom-right[_ngcontent-%COMP%], .videocall.vertical.right[_ngcontent-%COMP%], .videocall.vertical.top-right[_ngcontent-%COMP%]{flex-direction:row-reverse}.videocall[_ngcontent-%COMP%]   .list[_ngcontent-%COMP%]{display:flex;gap:10px;flex-wrap:wrap}.videocall[_ngcontent-%COMP%]   .list[_ngcontent-%COMP%]   wdg-other-videocall-user[_ngcontent-%COMP%]{width:var(--size);flex:1;border-radius:var(--border-radius-top-left) var(--border-radius-top-right) var(--border-radius-bottom-right) var(--border-radius-bottom-left)}.videocall[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{color:inherit;background:var(--background)}.videocall[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{opacity:.3}.videocall[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{background:var(--active-color)}.videocall[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]{margin:var(--margin) 0;display:flex;gap:10px}.videocall.minimized[_ngcontent-%COMP%]   .list[_ngcontent-%COMP%], .videocall.minimized[_ngcontent-%COMP%]   .share-notification[_ngcontent-%COMP%], .videocall.minimized[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:not(.toggle){display:none}code[_ngcontent-%COMP%]{display:none}"]}),o})();var Oe=a(4507),we=a(6031),xe=a(9488);let Me=(()=>{class o{constructor(t){this.componentFactoryResolver=t}resolveComponent(){return this.componentFactoryResolver.resolveComponentFactory(Te)}}return o.\u0275fac=function(t){return new(t||o)(i.LFG(i._Vd))},o.\u0275mod=i.oAB({type:o}),o.\u0275inj=i.cJS({imports:[d.ez,Oe.D,we.Q,K.ot,xe.y]}),o})()}}]);